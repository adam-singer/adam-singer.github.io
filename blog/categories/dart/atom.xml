<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Dart | Random posts about coding]]></title>
  <link href="http://financeCoding.github.com/blog/categories/dart/atom.xml" rel="self"/>
  <link href="http://financeCoding.github.com/"/>
  <updated>2013-11-30T15:53:28-08:00</updated>
  <id>http://financeCoding.github.com/</id>
  <author>
    <name><![CDATA[Adam Singer]]></name>
    <email><![CDATA[financeCoding@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Build and deploy dart to Beaglebone Black]]></title>
    <link href="http://financeCoding.github.com/blog/2013/11/29/build-and-deploy-dart-to-beaglebone-black/"/>
    <updated>2013-11-29T08:56:00-08:00</updated>
    <id>http://financeCoding.github.com/blog/2013/11/29/build-and-deploy-dart-to-beaglebone-black</id>
    <content type="html"><![CDATA[<p>I was looking into using <a href="https://www.dartlang.org">dart</a> on <a href="http://beagleboard.org/products/beaglebone%20black">Beaglebone Black</a> and decided it would be useful to share with others what I found.</p>

<p>After a some build hacks and patches I found a minimal working solution for Beaglebone Black with <a href="https://wiki.debian.org/ArmHardFloatPort">Debian</a> <a href="http://www.armhf.com/">ARMhf</a>. A few important notes before going down the road of building dart for ARM. The <code>dart-sdk</code> is not fully supported and pub currently might not work. The <code>dartanalyzer</code> might not work. The only supported <a href="http://en.wikipedia.org/wiki/List_of_ARM_cores">ARM architectures</a> are the ones that have <a href="http://en.wikipedia.org/wiki/ARMv7#32-bit_architecture">ARMv7</a> with <a href="http://en.wikipedia.org/wiki/ARM_architecture#Floating-point_.28VFP.29">VFP</a>. Don't spin your wheels trying to target any architecutre that is not <code>ARMv7</code> with VFP (minimum at the moment <code>ARMv7-A</code>) unless you plan on implementing the routines needed in the runtime <a href="https://code.google.com/p/dart/source/browse/branches/bleeding_edge/dart/runtime/vm/assembler_arm.cc">arm assembler</a>. If you do plan on implementing them, well thats just pure awesome!</p>

<p>```cpp assembler_arm.cc
void CPUFeatures::InitOnce() {</p>

<h1>if defined(USING_SIMULATOR)</h1>

<p>  integer_division_supported<em> = true;
  neon_supported</em> = true;</p>

<h1>else</h1>

<p>  ASSERT(CPUInfoContainsString("ARMv7"));  // Implements ARMv7.
  ASSERT(CPUInfoContainsString("vfp"));  // Has floating point unit.
  // Has integer division.
  if (CPUInfoContainsString("QCT APQ8064")) {</p>

<pre><code>// Special case for Qualcomm Krait CPUs in Nexus 4 and 7.
integer_division_supported_ = true;
</code></pre>

<p>  } else {</p>

<pre><code>integer_division_supported_ = CPUInfoContainsString("idiva");
</code></pre>

<p>  }
  neon_supported_ = CPUInfoContainsString("neon");</p>

<h1>endif  // defined(USING_SIMULATOR)</h1>

<h1>if defined(DEBUG)</h1>

<p>  initialized_ = true;</p>

<h1>endif</h1>

<p>}
```</p>

<h3>Download <a href="http://releases.ubuntu.com/precise/">Ubuntu 12.04.3 LTS</a></h3>

<p>Download the desktop iso to install on VirtualBox.</p>

<h3>Install on <a href="https://www.virtualbox.org/">VirtualBox</a></h3>

<p>I work mostly on mac so Ubuntu installed on VirtualBox was needed to help with cross compiling and flashing of uSD cards.</p>

<h3>Update the packages</h3>

<p>Just to be safe update any Ubuntu packages before installing the development software.</p>

<h3>Install basic packages</h3>

<p>I typically use the git <a href="https://code.google.com/p/dart/wiki/GettingTheSource#Using_Git">overlay</a> on subversion when working with the dart repo. The java jre/jdk is required for building the dart_analyzer which does not work in the sdk.</p>

<p>```bash shell</p>

<h1>Install subversion</h1>

<p>sudo apt-get install subversion git git-svn openssh-server vim default-jre default-jdk
```</p>

<h3>Install the chrome build and arm dependencies</h3>

<p>Checkout the latest build tools scripts. The following scripts prep your system with any packages needed for building dart.</p>

<p>```bash shell</p>

<h1>checkout build scripts</h1>

<p>svn co http://src.chromium.org/chrome/trunk/src/build; cd build</p>

<h1>install dependencies</h1>

<p>chmod u+x install-build-deps.sh
./install-build-deps.sh --no-chromeos-fonts
./install-build-deps.sh --no-chromeos-fonts --arm
```</p>

<h3>Install addtional libraries</h3>

<p>The following libraries are needed for building dart but might not be included from the chrome build tool scripts.</p>

<p>```bash shell</p>

<h1>Install addtional libs</h1>

<p>sudo apt-get install libc6-dev-i386 g++-multilib
```</p>

<h3>Install depot-tools</h3>

<p><a href="http://www.chromium.org/developers/how-tos/depottools">depot-tools</a> is required for hacking out the dart source code.</p>

<p>```bash shell</p>

<h1>depot tools</h1>

<p>svn co http://src.chromium.org/svn/trunk/tools/depot_tools
export PATH=$PATH:<code>pwd</code>//depot_tools
```</p>

<h3>Checkout the dart code base</h3>

<p>You dont need to include <code>--username &lt;YOUR USERNAME&gt;</code> unless you plan on creating a CL for review.</p>

<p><code>bash shell
mkdir dart_bleeding
cd dart_bleeding
svn ls https://dart.googlecode.com/svn/branches/bleeding_edge/ --username &lt;YOUR USERNAME&gt;
gclient config https://dart.googlecode.com/svn/branches/bleeding_edge/deps/all.deps
git svn clone -rHEAD https://dart.googlecode.com/svn/branches/bleeding_edge/dart dart
gclient sync
gclient runhooks
</code></p>

<h3>Patch the gyp and version files</h3>

<p>A git patch can be found here <a href="https://gist.github.com/financeCoding/7725354">7725354</a>, that patches the build scripts to support building the <code>dart-sdk</code> for ARM. Patching the <code>VERSION</code> file was done in an attempt to get pub working. At the moment its not required. If not done then an old version number is baked into the dartvm. This patch also modifies which dartvm creates the snapshots for <code>pub</code>, <code>dart2js</code> and a wrapper util. Patch creates the requirement of having to build the dartvm for x64 before building the <code>dart-sdk</code> for ARM. The dart build scripts have a funky dependency of wanting to use the dartvm target to create the snapshot files. Which in this case wont work since our dartvm is an ARM target being built on x64.</p>

<p>```diff arm.build.patch
diff --git a/tools/VERSION b/tools/VERSION
index d1ab212..0d6101d 100644
--- a/tools/VERSION
+++ b/tools/VERSION
@@ -1,5 +1,5 @@
 CHANNEL be
-MAJOR 0
-MINOR 1
-BUILD 2
-PATCH 0
+MAJOR 1
+MINOR 0
+BUILD 0
+PATCH 7
diff --git a/utils/compiler/compiler.gyp b/utils/compiler/compiler.gyp
index 294c7e9..5f3754a 100644
--- a/utils/compiler/compiler.gyp
+++ b/utils/compiler/compiler.gyp
@@ -18,7 +18,7 @@</p>

<pre><code>     {
       'action_name': 'generate_snapshots',
       'inputs': [
</code></pre>

<ul>
<li><pre><code>     '&lt;(PRODUCT_DIR)/&lt;(EXECUTABLE_PREFIX)dart&lt;(EXECUTABLE_SUFFIX)',
</code></pre></li>
<li><pre><code>     '&lt;(PRODUCT_DIR)/../DebugX64/dart',
     '../../sdk/lib/_internal/libraries.dart',
     '&lt;!@(["python", "../../tools/list_files.py", "\\.dart$", "../../sdk/lib/_internal/compiler", "../../runtime/lib", "../../sdk/lib/_internal/dartdoc"])',
     'create_snapshot.dart',
</code></pre>

@@ -30,7 +30,7 @@

<pre><code>     '&lt;(SHARED_INTERMEDIATE_DIR)/dart2js.dart.snapshot',
   ],
   'action': [
</code></pre></li>
<li><pre><code>     '&lt;(PRODUCT_DIR)/&lt;(EXECUTABLE_PREFIX)dart&lt;(EXECUTABLE_SUFFIX)',
</code></pre></li>
<li><pre><code>     '&lt;(PRODUCT_DIR)/../DebugX64/dart',
     'create_snapshot.dart',
     '--output_dir=&lt;(SHARED_INTERMEDIATE_DIR)',
     '--dart2js_main=sdk/lib/_internal/compiler/implementation/dart2js.dart',
</code></pre>

diff --git a/utils/pub/pub.gyp b/utils/pub/pub.gyp
index fd5e147..ab2e243 100644
--- a/utils/pub/pub.gyp
+++ b/utils/pub/pub.gyp
@@ -25,7 +25,7 @@

<pre><code>     '&lt;(SHARED_INTERMEDIATE_DIR)/pub.dart.snapshot',
   ],
   'action': [
</code></pre></li>
<li><pre><code>     '&lt;(PRODUCT_DIR)/&lt;(EXECUTABLE_PREFIX)dart&lt;(EXECUTABLE_SUFFIX)',
</code></pre></li>
<li><pre><code>     '&lt;(PRODUCT_DIR)/../DebugX64/dart',
     '--package-root=&lt;(PRODUCT_DIR)/packages/',
     '--snapshot=&lt;(SHARED_INTERMEDIATE_DIR)/pub.dart.snapshot',
     '../../sdk/lib/_internal/pub/bin/pub.dart',
</code></pre>

<p>```</p></li>
</ul>


<h3>Build the <code>dart-sdk</code></h3>

<p>Building of the <code>dart-sdk</code> for ARM target is a two stop process. First build x64 so we can use that dartvm to generate the snapshot files. Then the second step is running the <code>create_sdk</code> build for ARM. When the build is finished the <code>out/ReleaseARM/dart-sdk</code> should contain a full <code>dart-sdk</code> build. Keep in mind this does build the <code>dartanalyzer</code> but it may not work on ARM.</p>

<p>```bash shell</p>

<h1>build a target for your native system to create the snapshot files.</h1>

<p>./tools/build.py -m debug -v -a x64 -j 8</p>

<h1>build the arm target</h1>

<p>./tools/build.py -m release -v -a arm -j 8 create_sdk
```</p>

<h3>Tarball the sdk</h3>

<p>Package up the <code>dart-sdk</code> as a tarball to distribute.</p>

<p><code>bash shell
cd ./out/ReleaseARM/
tar -czvf dart-sdk.tar.gz dart-sdk
</code></p>

<h3>Install <a href="http://www.armhf.com/index.php/boards/beaglebone-black/#wheezy">Debian Wheezy 7.2 Hard Float Minimal Image</a> on Beaglebone Black</h3>

<p>In virtualbox with a uSD card at <code>/dev/sdX</code> the following will download an image and write to the uSD card. Updated images can be found at <a href="http://www.armhf.com/index.php/boards/beaglebone-black/#wheezy">armhf</a></p>

<p><code>bash shell
wget http://s3.armhf.com/debian/wheezy/bone/debian-wheezy-7.2-armhf-3.8.13-bone30.img.xz
xz -cd debian-wheezy-7.2-armhf-3.8.13-bone30.img.xz &gt; /dev/sdX
</code></p>

<p>Then insert the uSD card into the Beaglebone Black and boot the image by holding down the boot switch and powering on.</p>

<p><img src="http://elinux.org/images/7/76/CONN_REVA5A.jpg"></p>

<p>Write the booted image to the eMMC.</p>

<p><code>bash shell
xz -cd debian-wheezy-7.2-armhf-3.8.13-bone30.img.xz &gt; /dev/mmcblk1
</code></p>

<p>Power down and remove the uSD card.</p>

<h3>Update glibc on the BeagleBone Black</h3>

<p>Updating glibc is required cause the version of glibc installed from the chromium build scripts is greater then the one shipped with Wheezy 7.2. The following commands update glibc.</p>

<p>```bash shell</p>

<h1>Add an addtional source for the latest glibc</h1>

<p>sudo sed -i '1i deb http://ftp.us.debian.org/debian/ jessie main' /etc/apt/sources.list</p>

<h1>Update sources</h1>

<p>sudo apt-get update</p>

<h1>Download latest glibc</h1>

<p>sudo DEBIAN_FRONTEND=noninteractive apt-get -t jessie install -y libc6 libc6-dev libc6-dbg git screen
```</p>

<h3>Copy over <code>dart-sdk</code></h3>

<p>From virtual box copy over the tarball to Beaglebone Black running debian.</p>

<p><code>bash shell
scp dart-sdk.tar.gz debian@192.168.2.2:~/
</code></p>

<p>After the tarball is copied, uncompress and add to your <code>PATH</code>.</p>

<p><code>bash shell
tar -zxvf dart-sdk.tar.gz
export PATH=~/dart-sdk:$PATH
dart --version
Dart VM version: 1.0.0.7_r30634_adam (Fri Nov 29 01:14:42 2013) on "linux_arm"
</code></p>

<h3>Known issues at the moment</h3>

<p>Pub does not work, issue could be followed at <a href="https://code.google.com/p/dart/issues/detail?id=15383">15383</a>. I was testing this out while staying at a hotel so some proxy settings might of been blocking or tripping up pub.</p>

<h3>Feedback</h3>

<p>If you have a better way of running dart on Beagleblone Black I would love to hear it! Please contact me on <a href="https://plus.google.com/104569492481999771226/">g+</a> and lets discuss.</p>

<h3>Addtional resources</h3>

<ul>
<li><a href="https://github.com/financeCoding/dart_bleeding">dart_bleeding</a> contains some scripts I typically use for this entire process.</li>
<li><a href="https://code.google.com/p/dart/wiki/PreparingYourMachine">PreparingYourMachine</a> resources for preping your machine to build from source</li>
<li><a href="https://code.google.com/p/dart/wiki/GettingTheSource">GettingTheSource</a> getting the source code documentation</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[google client apis new release 0.4.x]]></title>
    <link href="http://financeCoding.github.com/blog/2013/10/22/google-client-apis-new-release-0-dot-4-x/"/>
    <updated>2013-10-22T19:34:00-07:00</updated>
    <id>http://financeCoding.github.com/blog/2013/10/22/google-client-apis-new-release-0-dot-4-x</id>
    <content type="html"><![CDATA[<p>The <a href="https://github.com/dart-gde?tab=members">dart-gde</a> team has updated the <a href="https://github.com/dart-google-apis">google client apis</a> to <code>'&gt;=0.4.0'</code>. Along with this change was an update for <a href="http://pub.dartlang.org/packages/google_oauth2_client">Google OAuth2 Client</a> to <code>'&gt;=0.3.0'</code>.</p>

<h2>The breaking changes for <a href="http://pub.dartlang.org/packages/google_oauth2_client">Google OAuth2 Client</a></h2>

<ul>
<li>SystemCache has been removed.</li>
<li><code>GoogleOAuth2.ensureAuthenticated()</code> A much cleaner impl that eliminates the need to pass in a HttpRequest object to authenticate.</li>
<li>All dependencies bumped to latest versions.</li>
<li>Code refactored.</li>
<li>Dead code eliminated.</li>
<li>Remove deprecated libraries.</li>
<li>Heavy logging removed.</li>
</ul>


<h2>The breaking changes for generated <a href="https://github.com/dart-google-apis">google client apis</a> include</h2>

<ul>
<li>Renamed <code>lib/src/{cloud_api.dart -&gt; client_base.dart}</code> <code>lib/src/{cloud_api_console.dart -&gt; console_client.dart}</code> <code>lib/src/{cloud_api_browser.dart -&gt; browser_client.dart}</code>.</li>
<li><code>ClientBase.responseParse(int statusCode, String responseBody)</code> introduced and handles parsing <code>responseBody</code>. <code>responseParse</code> will throw <code>DetailedApiRequestError</code> if the body has an error.</li>
<li>Renamed <code>APIRequestException</code> -> <code>APIRequestError</code>.</li>
<li>Remove deprecated libraries.</li>
</ul>


<h2>Updating requires a small change in <code>pubspec.yaml</code></h2>

<p><code>yaml pubspec.yaml
dependencies:
  google_plus_v1_api: '&gt;=0.4.0'
</code></p>

<p>A small collection of demo examples could be found at <a href="https://github.com/dart-gde/dart_api_client_examples">dart_api_client_examples</a>.</p>

<h2>Full list of available Google client apis on <a href="http://pub.dartlang.org">pub.dartlang.org</a></h2>

<ul>
<li><a href="http://pub.dartlang.org/packages/dart_adexchangebuyer_v1_api_client">dart_adexchangebuyer_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_adexchangebuyer_v1_1_api_client">dart_adexchangebuyer_v1_1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_adexchangebuyer_v1_2_api_client">dart_adexchangebuyer_v1_2_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_adexchangebuyer_v1_3_api_client">dart_adexchangebuyer_v1_3_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_adexchangeseller_v1_api_client">dart_adexchangeseller_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_adexchangeseller_v1_1_api_client">dart_adexchangeseller_v1_1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_admin_directory_v1_api_client">dart_admin_directory_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_admin_email_migration_v2_api_client">dart_admin_email_migration_v2_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_admin_reports_v1_api_client">dart_admin_reports_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_adsense_v1_2_api_client">dart_adsense_v1_2_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_adsense_v1_3_api_client">dart_adsense_v1_3_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_adsensehost_v4_1_api_client">dart_adsensehost_v4_1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_analytics_v2_4_api_client">dart_analytics_v2_4_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_analytics_v3_api_client">dart_analytics_v3_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_androidpublisher_v1_api_client">dart_androidpublisher_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_androidpublisher_v1_1_api_client">dart_androidpublisher_v1_1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_appstate_v1_api_client">dart_appstate_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_audit_v1_api_client">dart_audit_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_bigquery_v2_api_client">dart_bigquery_v2_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_blogger_v2_api_client">dart_blogger_v2_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_blogger_v3_api_client">dart_blogger_v3_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_books_v1_api_client">dart_books_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_calendar_v3_api_client">dart_calendar_v3_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_civicinfo_us_v1_api_client">dart_civicinfo_us_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_compute_v1beta15_api_client">dart_compute_v1beta15_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_compute_v1beta16_api_client">dart_compute_v1beta16_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_coordinate_v1_api_client">dart_coordinate_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_customsearch_v1_api_client">dart_customsearch_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_datastore_v1beta1_api_client">dart_datastore_v1beta1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_datastore_v1beta2_api_client">dart_datastore_v1beta2_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_dfareporting_v1_api_client">dart_dfareporting_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_dfareporting_v1_1_api_client">dart_dfareporting_v1_1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_dfareporting_v1_2_api_client">dart_dfareporting_v1_2_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_dfareporting_v1_3_api_client">dart_dfareporting_v1_3_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_discovery_v1_api_client">dart_discovery_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_doubleclickbidmanager_v1_api_client">dart_doubleclickbidmanager_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_doubleclicksearch_v2_api_client">dart_doubleclicksearch_v2_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_drive_v1_api_client">dart_drive_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_drive_v2_api_client">dart_drive_v2_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_freebase_v1_sandbox_api_client">dart_freebase_v1_sandbox_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_freebase_v1sandbox_api_client">dart_freebase_v1sandbox_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_freebase_v1_api_client">dart_freebase_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_fusiontables_v1_api_client">dart_fusiontables_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_games_v1_api_client">dart_games_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_gamesmanagement_v1management_api_client">dart_gamesmanagement_v1management_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_gan_v1beta1_api_client">dart_gan_v1beta1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_groupsmigration_v1_api_client">dart_groupsmigration_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_groupssettings_v1_api_client">dart_groupssettings_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_identitytoolkit_v3_api_client">dart_identitytoolkit_v3_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_licensing_v1_api_client">dart_licensing_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_mirror_v1_api_client">dart_mirror_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_oauth2_v1_api_client">dart_oauth2_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_oauth2_v2_api_client">dart_oauth2_v2_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_orkut_v2_api_client">dart_orkut_v2_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_pagespeedonline_v1_api_client">dart_pagespeedonline_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_plus_v1_api_client">dart_plus_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_plusdomains_v1_api_client">dart_plusdomains_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_prediction_v1_2_api_client">dart_prediction_v1_2_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_prediction_v1_3_api_client">dart_prediction_v1_3_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_prediction_v1_4_api_client">dart_prediction_v1_4_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_prediction_v1_5_api_client">dart_prediction_v1_5_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_prediction_v1_6_api_client">dart_prediction_v1_6_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_reseller_v1sandbox_api_client">dart_reseller_v1sandbox_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_reseller_v1_api_client">dart_reseller_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_shopping_v1_api_client">dart_shopping_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_siteverification_v1_api_client">dart_siteverification_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_sqladmin_v1beta1_api_client">dart_sqladmin_v1beta1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_storage_v1beta1_api_client">dart_storage_v1beta1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_storage_v1beta2_api_client">dart_storage_v1beta2_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_taskqueue_v1beta1_api_client">dart_taskqueue_v1beta1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_taskqueue_v1beta2_api_client">dart_taskqueue_v1beta2_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_tasks_v1_api_client">dart_tasks_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_translate_v2_api_client">dart_translate_v2_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_urlshortener_v1_api_client">dart_urlshortener_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_webfonts_v1_api_client">dart_webfonts_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_youtube_v3_api_client">dart_youtube_v3_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_youtubeanalytics_v1_api_client">dart_youtubeanalytics_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_youtubeanalytics_v1beta1_api_client">dart_youtubeanalytics_v1beta1_api_client</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Getting Started with Dart on Compute Engine]]></title>
    <link href="http://financeCoding.github.com/blog/2013/09/30/getting-started-with-dart-on-compute-engine/"/>
    <updated>2013-09-30T20:41:00-07:00</updated>
    <id>http://financeCoding.github.com/blog/2013/09/30/getting-started-with-dart-on-compute-engine</id>
    <content type="html"><![CDATA[<p>Quick how-to on using <a href="http://www.dartlang.org">dart</a> with <a href="https://cloud.google.com/products/compute-engine">Compute Engine</a>. If not aware, right now is a great time to dive into Compute Engine cause google is giving away $2,000 worth of <a href="https://plus.google.com/111783114889748547827/posts/Bou747dCfNb">credits</a> to individuals interested in trying it out. I've been using it for about 2-3 months now and totally love it.</p>

<p>What peeked my interest is it was flexable enough to run the dartvm as a server with minimal configuration. The one configuration hurdle was dependency of <code>GLIBC &gt;= 2.15</code> in the dartvm binaries. The good news is with a simple startup script the compute engine instance can be provisioned to support the latest linux <a href="https://storage.googleapis.com/dart-editor-archive-integration/latest/dartsdk-linux-64.tar.gz">dart-sdk</a>.</p>

<p>The main tool we will use to provision a compute engine instance is <a href="https://developers.google.com/compute/docs/gcutil/">gcutil</a>. We could of used dartvm and <a href="http://pub.dartlang.org/packages/google_compute_v1beta15_api">google_compute_v1beta15_api</a> but will save that for a later post.</p>

<p>After signing up for <a href="https://cloud.google.com/products/compute-engine">Compute Engine</a> the next step should be to download and configure <code>gcutil</code>.</p>

<p><code>bash
$ wget https://google-compute-engine-tools.googlecode.com/files/gcutil-1.8.4.tar.gz
$ tar xzvpf gcutil-1.8.4.tar.gz -C $HOME
$ export PATH=./gcutil-1.8.4:$PATH
$ gcutil version
1.8.4
</code></p>

<p>Next we want to create a <code>startup.sh</code> script that will be deployed to the compute engine instance. The script is a simple way to run additional commands to provision the instance. For dart we need to add a new <code>deb</code> source, update sources, install dependencies, fetch &amp; unpack dart-sdk, and then execute our dart server. In the final line of the <code>startup.sh</code> script the command will create a dart server from the user account tied to this compute instance. Simply we clone a public git repo, install pub dependencies and screen a detached session that runs the dart server. This is not a very fancy way to deploy dart but a simple and quick way to get something running with no troubles. A real life deployment might include some trendy fab/chef/puppet combo.</p>

<p>```bash startup.sh</p>

<h1>!/usr/bin/env bash</h1>

<h1>Add an addtional source for the latest glibc</h1>

<p>sudo sed -i '1i deb http://ftp.us.debian.org/debian/ jessie main' /etc/apt/sources.list</p>

<h1>Update sources</h1>

<p>sudo apt-get update</p>

<h1>Download latest glibc</h1>

<p>sudo DEBIAN_FRONTEND=noninteractive apt-get -t jessie install -y libc6 libc6-dev libc6-dbg git screen</p>

<h1>Download the latest dart sdk</h1>

<p>wget https://storage.googleapis.com/dart-editor-archive-integration/latest/dartsdk-linux-64.tar.gz -O /dartsdk-linux-64.tar.gz</p>

<h1>Unpack the dart sdk</h1>

<p>tar -zxvf /dartsdk-linux-64.tar.gz -C /</p>

<p>su - financeCoding -c 'ls -al &amp;&amp; cd ~ &amp;&amp; pwd &amp;&amp; git clone https://github.com/rikulo/stream.git &amp;&amp; /dart-sdk/bin/dart --version &amp;&amp; cd stream &amp;&amp; /dart-sdk/bin/dart --version &amp;&amp; /dart-sdk/bin/pub install &amp;&amp; cd example/hello-static &amp;&amp; screen -d -m /dart-sdk/bin/dart webapp/main.dart'
```</p>

<p>After we have the <code>startup.sh</code> script we then create another deployment script. The following script will be the gcutil commands needed to actually create and provision the compute instance. The last part of our script includes a firewall rule for the port that the <a href="https://github.com/rikulo/stream">stream</a> sample is running on. Without proper firewall rules no access from the outside is possible.</p>

<p>```bash deploy-dart-compute.sh</p>

<h1>!/usr/bin/env bash</h1>

<p>set +o xtrace</p>

<p>USER=financeCoding
PROJECT=dart-compute-project
INSTANCE_NAME=dart-compute
TAGS=dart
MACHINE_TYPE=g1-small
NETWORK=default
IP=ephemeral
IMAGE=https://www.googleapis.com/compute/v1beta15/projects/debian-cloud/global/images/debian-7-wheezy-v20130816
SCOPES=https://www.googleapis.com/auth/userinfo.email,https://www.googleapis.com/auth/compute,https://www.googleapis.com/auth/devstorage.full_control
PERSISTENT_BOOT_DISK=true
ZONE=us-central1-b
STARTUP_SCRIPT=startup.sh
GCUTIL="gcutil --service_version=v1beta15 --project=$PROJECT"</p>

<p>$GCUTIL addinstance $INSTANCE_NAME --tags=$TAGS --zone=$ZONE --machine_type=$MACHINE_TYPE --network=$NETWORK --external_ip_address=$IP --service_account_scopes=$SCOPES --image=$IMAGE --persistent_boot_disk=$PERSISTENT_BOOT_DISK --metadata_from_file=startup-script:$STARTUP_SCRIPT</p>

<p>rc=$?
if [[ $rc != 0 ]] ; then</p>

<pre><code>echo "Not able to add instance"
exit $rc
</code></pre>

<p>fi</p>

<p>$GCUTIL addfirewall $INSTANCE_NAME --allowed "tcp:8080"</p>

<p>rc=$?
if [[ $rc != 0 ]] ; then</p>

<pre><code>echo "Not able to provision firewall or has already been provisioned"
exit $rc
</code></pre>

<p>fi</p>

<p>exit $rc
```</p>

<p><a href="/images/2013-09-30-getting-started-with-dart-on-compute-engine/compute-engine-console.png"><img src="/images/2013-09-30-getting-started-with-dart-on-compute-engine/compute-engine-console.png" alt="compute-engine-console" /></a></p>

<p><a href="/images/2013-09-30-getting-started-with-dart-on-compute-engine/stream-client.png"><img src="/images/2013-09-30-getting-started-with-dart-on-compute-engine/stream-client.png" alt="stream-client" /></a></p>

<p>And thats all that is needed to get dart on compute engine in two easy steps. The code can be found here <a href="https://gist.github.com/financeCoding/6789537">gist</a>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[gplus quickstart with dart]]></title>
    <link href="http://financeCoding.github.com/blog/2013/04/02/gplus-quickstart-with-dart/"/>
    <updated>2013-04-02T19:25:00-07:00</updated>
    <id>http://financeCoding.github.com/blog/2013/04/02/gplus-quickstart-with-dart</id>
    <content type="html"><![CDATA[<p>Tonights mash-up was taking the <a href="https://github.com/Scarygami/gplus-quickstart-dart">gplus-quickstart-dart</a> and wiring it up for server side support. Similar to the <a href="https://github.com/googleplus/gplus-quickstart-java">gplus-quickstart-java</a>, the client will use the <a href="https://developers.google.com/+/web/+1button/">gplus login button</a> to do the <a href="https://developers.google.com/accounts/docs/OAuth2WebServer">OAuth2WebServer</a> flow and send the code over to the server. The server can then verify and make calls on behalf of the client since an 'offline' token was requested. This demo just features the server side and what was used to put it together. <a href="https://plus.google.com/u/0/109130932502535286138/">Yulian Kuncheff</a> has been the primary developer behind <a href="https://github.com/Daegalus/fukiya">fukiya</a> which is an express like framework for dart. The thing I liked most about <a href="https://github.com/Daegalus/fukiya">fukiya</a> was how simple and easy it was to setup URL handlers.</p>

<p>First off, setting up some dependencies.</p>

<p><code>
dependencies:
  google_plus_v1_api: any
  browser: any
  fukiya: '&gt;=0.0.11'
  html5lib: "&gt;=0.4.1 &lt;0.4.2"
  logging: "&gt;=0.4.3+5"
</code></p>

<p>A quick outline of what URLs fukiya handles. Dead simple to setup!</p>

<p><code>dart
void main() {
  new Fukiya()
  ..get('/', getIndexHandler)
  ..get('/index.html', getIndexHandler)
  ..get('/index', getIndexHandler)
  ..post('/connect', postConnectDataHandler)
  ..get('/people', getPeopleHandler)
  ..post('/disconnect', postDisconnectHandler)
  ..staticFiles('./web')
  ..use(new FukiyaJsonParser())
  ..listen('127.0.0.1', 3333);
}
</code></p>

<p>The index handler is special cause we needed to inject a state token into the page and HTTP session. The state token is then verified on the <code>/connect</code> post. The one-time token helps avoid any <a href="http://en.wikipedia.org/wiki/Confused_deputy_problem">Confused_deputy_problem</a>s.</p>

<p>```dart
void getIndexHandler(FukiyaContext context) {
  // Create a state token.
  context.request.session["state_token"] = _createStateToken();</p>

<p>  // Readin the index file and add state token into the meta element.
  var file = new File(INDEX_HTML);
  file.exists().then((bool exists) {</p>

<pre><code>if (exists) {
  file.readAsString().then((String indexDocument) {
    Document doc = new Document.html(indexDocument);
    Element metaState = new Element.html('&lt;meta name="state_token" content="${context.request.session["state_token"]}"&gt;');
    doc.head.children.add(metaState);
    context.response.writeBytes(doc.outerHtml.codeUnits);
    context.response.done.catchError((e) =&gt; serverLogger.fine("File Response error: ${e}"));
    context.response.close();
  }, onError: (error) =&gt; serverLogger.fine("error = $error"));
} else {
  context.response.statusCode = 404;
  context.response.close();
}
</code></pre>

<p>  });
}
```</p>

<p>On the <code>/connect</code> post we will expect a gplus id to be passed to the query parameters and some token data posted. We can then verify the state token and use the token data for accessing the Google APIs.</p>

<p>```dart
void postConnectDataHandler(FukiyaContext context) {
  serverLogger.fine("postConnectDataHandler");
  String tokenData = context.request.session.containsKey("access_token") ? context.request.session["access_token"] : null; // TODO: handle missing token
  String stateToken = context.request.session.containsKey("state_token") ? context.request.session["state_token"] : null;
  String queryStateToken = context.request.queryParameters.containsKey("state_token") ? context.request.queryParameters["state_token"] : null;</p>

<p>  // Check if the token already exists for this session.
  if (tokenData != null) {</p>

<pre><code>context.send("Current user is already connected.");
return;
</code></pre>

<p>  }</p>

<p>  // Check if any of the needed token values are null or mismatched.
  if (stateToken == null || queryStateToken == null || stateToken != queryStateToken) {</p>

<pre><code>context.response.statusCode = 401;
context.send("Invalid state parameter."); 
return;
</code></pre>

<p>  }</p>

<p>  // Normally the state would be a one-time use token, however in our
  // simple case, we want a user to be able to connect and disconnect
  // without reloading the page.  Thus, for demonstration, we don't
  // implement this best practice.
  context.request.session.remove("state_token");</p>

<p>  String gPlusId = context.request.queryParameters["gplus_id"];
  StringBuffer sb = new StringBuffer();
  // Read data from request.
  context.request
  .transform(new StringDecoder())
  .listen((data) => sb.write(data), onDone: () {</p>

<pre><code>serverLogger.fine("context.request.listen.onDone = ${sb.toString()}");
Map requestData = JSON.parse(sb.toString());

Map fields = {
          "grant_type": "authorization_code",
          "code": requestData["code"],
          // http://www.riskcompletefailure.com/2013/03/postmessage-oauth-20.html
          "redirect_uri": "postmessage",
          "client_id": CLIENT_ID,
          "client_secret": CLIENT_SECRET
};

http.Client _httpClient = new http.Client();
_httpClient.post(TOKEN_ENDPOINT, fields: fields).then((http.Response response) {
  // At this point we have the token and refresh token.
  var credentials = JSON.parse(response.body);
  _httpClient.close();

  var verifyTokenUrl = '${TOKENINFO_URL}?access_token=${credentials["access_token"]}';
  new http.Client()
  ..get(verifyTokenUrl).then((http.Response response)  {
    serverLogger.fine("response = ${response.body}");

    var verifyResponse = JSON.parse(response.body);
    String userId = verifyResponse.containsKey("user_id") ? verifyResponse["user_id"] : null;
    String accessToken = credentials.containsKey("access_token") ? credentials["access_token"] : null;
    if (userId != null &amp;&amp; userId == gPlusId &amp;&amp; accessToken != null) {
      context.request.session["access_token"] = accessToken;
      context.send("POST OK");
    } else {
      context.response.statusCode = 401;
      context.send("POST FAILED ${userId} != ${gPlusId}"); 
    }
  });
});
</code></pre>

<p>  });
}
```</p>

<p>Now the HTTP session has the full ability to make calls on behalf of the user. The <code>/people</code> method will be called from the client to retrieve the list of visible friends of that user.</p>

<p>```dart
void getPeopleHandler(FukiyaContext context) {
  String accessToken = context.request.session.containsKey("access_token") ? context.request.session["access_token"] : null;
  SimpleOAuth2 simpleOAuth2 = new SimpleOAuth2()..credentials = new console_auth.Credentials(accessToken);
  plus.Plus plusclient = new plus.Plus(simpleOAuth2);
  plusclient.makeAuthRequests = true;
  plusclient.people.list("me", "visible").then((plus.PeopleFeed people) {</p>

<pre><code>serverLogger.fine("/people = $people");
context.send(people.toString());
</code></pre>

<p>  });
}
```</p>

<p>The final responsibility we can bestow upon the server is allowing the client to disconnect by revoking OAuth access.</p>

<p>```dart
void postDisconnectHandler(FukiyaContext context) {
  String tokenData = context.request.session.containsKey("access_token") ? context.request.session["access_token"] : null;
  if (tokenData == null) {</p>

<pre><code>context.response.statusCode = 401;
context.send("Current user not connected.");
return;
</code></pre>

<p>  }</p>

<p>  final String revokeTokenUrl = "${TOKEN_REVOKE_ENDPOINT}?token=${tokenData}";
  context.request.session.remove("access_token");</p>

<p>  new http.Client()..get(revokeTokenUrl).then((http.Response response) {</p>

<pre><code>context.request.session["state_token"] = _createStateToken();
Map data = {
            "state_token": context.request.session["state_token"],
            "message" : "Successfully disconnected."
            };
context.send(JSON.stringify(data));
</code></pre>

<p>  });
}
```</p>

<p>Thats about it, Happy Dart Hacking! Special thanks to <a href="https://plus.google.com/112336147904981294875">Gerwin Sturm</a> for putting together the original example for client side. Full source code can be found at <a href="https://github.com/Scarygami/gplus-quickstart-dart">gplus-quickstart-dart</a> in the server folder. Please replace your own keys cause mine will be removed at some point.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Dart Multi Touch Canvas With Realtime APIs]]></title>
    <link href="http://financeCoding.github.com/blog/2013/03/21/dart-multi-touch-canvas-with-realtime-apis/"/>
    <updated>2013-03-21T18:19:00-07:00</updated>
    <id>http://financeCoding.github.com/blog/2013/03/21/dart-multi-touch-canvas-with-realtime-apis</id>
    <content type="html"><![CDATA[<p><a href="https://developers.google.com/drive/">Google</a> has made the <a href="https://developers.google.com/drive/realtime/">realtime</a> api available for developers. Realtime api provides <a href="http://en.wikipedia.org/wiki/Operational_transformation">operational transformation</a> on <a href="https://developers.google.com/drive/realtime/reference/gapi.drive.realtime.CollaborativeString">strings</a>, <a href="https://developers.google.com/drive/realtime/reference/gapi.drive.realtime.CollaborativeList">lists</a>, <a href="https://developers.google.com/drive/realtime/reference/gapi.drive.realtime.CollaborativeMap">maps</a> and custom <a href="https://developers.google.com/drive/realtime/reference/gapi.drive.realtime.CollaborativeObject">objects</a>. The application data gets stored on Google Drive and is available from any supported browser. This is going to be the tooling of the future for collaborative applications.</p>

<p>I took some time to see what it would take for implementing a sample realtime application in dart. Also wanted to make sure my sample could run on mobile chrome.</p>

<p>Since realtime api is new, dart bindings don't really exist. Lucky for us we have <a href="http://pub.dartlang.org/packages/js">js-interop</a> library. The <a href="http://pub.dartlang.org/packages/js">js-interop</a> library provides communications to existing javascript code from dart. I consider this mostly a quick hack to get started with the realtime api until a more native interface exists.</p>

<p>The sample <a href="http://financecoding.github.com/realtime_touch_canvas/web/index.html">realtime_touch_canvas</a> demonstrates a multi touch canvas surface that updates in realtime with all clients that have the application open.</p>

<iframe width="560" height="315" src="http://www.youtube.com/embed/xArfJdOb55Q" frameborder="0" allowfullscreen></iframe>


<p>Most of the heavy lifting is done by <a href="https://github.com/financeCoding/realtime_touch_canvas"><code>rtclient.dart</code></a>. I ported the <a href="https://github.com/googledrive/realtime-playground/blob/master/js/realtime-client-utils.js">code</a> from the javascript version. Its enough code to get started right away but a more structured solution should be done. The main class is <code>RealTimeLoader</code> used for realtime loading.</p>

<p>```dart
  rtl = new RealTimeLoader(clientId: 'CLIENTID.apps.googleusercontent.com', apiKey: 'KEY');
  rtl.start().then((bool isComplete) {</p>

<pre><code>/* RealTimeLoader has authenticated the application and is ready to load a file */
loadRealTimeFile(fileId, model.onFileLoaded, model.initializeModel);
</code></pre>

<p>  });
```</p>

<p><code>model.onFileLoaded</code> and <code>model.initializeModel</code> handle the creating of model data and loading of model data.</p>

<p>In the <a href="http://financecoding.github.com/realtime_touch_canvas/web/index.html">realtime_touch_canvas</a>, model data was a simple list of json strings. The ticky part here is you need to remember that your working with the realtime api within the javascript vm. So an array needs to be allocated from <a href="http://pub.dartlang.org/packages/js">js-interop</a>.</p>

<p>```dart
  void _createNewModel(js.Proxy model) {</p>

<pre><code>var list = model.createList(js.array(_defaultLines));
model.getRoot().set(_linesName, list);
</code></pre>

<p>  }
```</p>

<p>After the model is created we then get called to load the file. Loading the file for our purposes is binding the collaborative objects. Some tricky things to note here is we are retaining the javascript objects so we can access them after exit of the callback. Also the callbacks have to be wrapped within <a href="http://pub.dartlang.org/packages/js">js-interop</a> <code>js.Callback.many</code> proxy object. The callbacks <code>_linesOnAddValuesChangedEvent</code> and <code>_linesOnRemovedValuesChangedEvent</code> are fired off when the collaborative list object has items added or removed.</p>

<p>```dart
  js.Proxy <em>doc;
  String </em>linesName = "lines";
  js.Proxy _lines;</p>

<p>  void _bindModel(js.Proxy doc) {</p>

<pre><code>_doc = doc;
js.retain(_doc);
_lines = doc.getModel().getRoot().get(_linesName);
_lines.addEventListener(gapi.drive.realtime.EventType.VALUES_ADDED, new js.Callback.many(_linesOnAddValuesChangedEvent));
_lines.addEventListener(gapi.drive.realtime.EventType.VALUES_REMOVED, new js.Callback.many(_linesOnRemovedValuesChangedEvent));
js.retain(_lines);
</code></pre>

<p>  }
```</p>

<p>When the callback is called the data would be in the javascript virtual machine so we can parse it and store in our native dart code. This is more of a convenience then a must do, that way we can expose plan old dart objects to our other parts of the dart application.</p>

<p>```dart
  void _linesOnAddValuesChangedEvent(addedValue) {</p>

<pre><code>var insertedLine = _lines.get(addedValue.index);
var line = new Line.fromJson(insertedLine);
realtimeTouchCanvas.move(line, line.moveX, line.moveY);
</code></pre>

<p>  }
```</p>

<p>Now when we want to store a line in the application we simply convert it to json and push it into the collaborative list. The little tick here is to make sure we are <code>scoped</code> when accessing the <code>_lines</code> object since it lives in the javascript virtual machine.</p>

<p>```dart
  void addLine(Line line) {</p>

<pre><code>js.scoped(() {
  _lines.push(line.toJson());
});
</code></pre>

<p>  }
```</p>

<p>The <a href="http://financecoding.github.com/realtime_touch_canvas/web/index.html">realtime_touch_canvas</a> is live on github gh-pages and <a href="https://github.com/financeCoding/realtime_touch_canvas">realtime_touch_canvas source</a> is available.</p>
]]></content>
  </entry>
  
</feed>
