<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Random posts about coding]]></title>
  <link href="http://financeCoding.github.com/atom.xml" rel="self"/>
  <link href="http://financeCoding.github.com/"/>
  <updated>2014-03-28T14:38:33-07:00</updated>
  <id>http://financeCoding.github.com/</id>
  <author>
    <name><![CDATA[Adam Singer]]></name>
    <email><![CDATA[financeCoding@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Getting started with Google Cloud Datastore and Dart]]></title>
    <link href="http://financeCoding.github.com/blog/2014/03/28/getting-started-with-google-cloud-datastore-and-dart/"/>
    <updated>2014-03-28T14:38:00-07:00</updated>
    <id>http://financeCoding.github.com/blog/2014/03/28/getting-started-with-google-cloud-datastore-and-dart</id>
    <content type="html"><![CDATA[
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[chrome.dart 0.4.0 release]]></title>
    <link href="http://financeCoding.github.com/blog/2014/01/14/chrome-dot-dart-0-dot-4-0-release/"/>
    <updated>2014-01-14T09:33:00-08:00</updated>
    <id>http://financeCoding.github.com/blog/2014/01/14/chrome-dot-dart-0-dot-4-0-release</id>
    <content type="html"><![CDATA[<p>The <a href="https://github.com/dart-gde?tab=members">dart-gde</a> has updated the <a href="https://github.com/dart-gde/chrome.dart">chrome.dart</a> to &#8216;0.4.0&#8217;. This release contains a whole rewrite of the project. All APIs are now generated from chrome apps/ext <a href="https://src.chromium.org/chrome/trunk/src/chrome/common/extensions/api">IDLs</a>. Most unit tests from previous <a href="https://github.com/dart-gde/chrome.dart">chrome.dart</a> have been ported.</p>

<h2>About chrome.dart</h2>

<p><a href="http://pub.dartlang.org/packages/chrome">chrome.dart</a> package provides the generated APIs to access chrome <a href="https://developer.chrome.com/apps/about_apps.html">apps &amp; extensions</a> through dart interfaces. The APIs depend on the <a href="https://github.com/dart-lang/js-interop">js-interop</a> to communicate with the javascript vm for accessing the APIs. Currently no native interfaces exist between dart vm and chrome browser. In a later point in time those interfaces will exist, for now this provides a way to access those interfaces.</p>

<h2>chrome_gen.dart -> chrome.dart</h2>

<p>At first <a href="https://github.com/dart-gde/chrome_gen.dart">chrome_gen.dart</a> was the project that kicked off moving to generated APIs. It was getting frustrating having to hand write, maintain and test <a href="http://pub.dartlang.org/packages/chrome">chrome.dart</a>. We did avoid looking into generation from IDL, because the IDL in the chromium is in two different formats <a href="https://src.chromium.org/chrome/trunk/src/chrome/common/extensions/api">json &amp; chrome specific WebIDL</a>. The nice part about the original <a href="https://github.com/dart-gde/chrome.dart">chrome.dart</a> package is we could introduce more structure for the APIs then what the generated javascript APIs looked like. So after initial development by <a href="https://github.com/devoncarew/">Devon Carew</a>, we decided it was a better direction to use <a href="https://github.com/dart-gde/chrome.dart/tree/master/tool">parsers and generators</a> to create and maintain the APIs. Four months later we had a 90% complete package that was already being used by a few projects, including <a href="https://github.com/dart-lang/spark">spark</a>. We are able to generate enough structure to keep nice APIs and generate form the IDL, this was a win for the project.</p>

<h2>Documentation</h2>

<p>The API documentation is automatically generated for <a href="http://dart-gde.github.io/chrome.dart/app/">Apps</a> and <a href="http://dart-gde.github.io/chrome.dart/ext/">Extensions</a> on each check in. A few wiki pages exist and we are in the process of migrating them from <a href="https://github.com/dart-gde/chrome_gen.dart/wiki">chrome_gen.dart wiki</a> -> <a href="https://github.com/dart-gde/chrome.dart/wiki">chrome.dart wiki</a>. We do need help and welcome pull requests and wiki edits.</p>

<h2>Samples</h2>

<p>Currently the best source of project setup exists with <a href="https://github.com/dart-gde/chrome.dart/tree/master/app">app</a> in the project. The <code>app</code> folder in a dart project will not have the automatic symlinks generated by <code>pub</code>. That helps out greatly since it would pollute our folder structure and cause bad things to happen. Instead we have a simple <a href="https://github.com/dart-gde/chrome.dart/blob/master/bin/setup_app.dart">setup_app.dart</a> script that helps build and copy packages over to the <code>app</code> folder. Right now its specific for the <a href="https://github.com/dart-gde/chrome.dart">chrome.dart</a> project but should be easy to replicate for your own chrome apps or extensions. Another neat script which is mac specific but could be generalized is <a href="https://github.com/dart-gde/chrome.dart/blob/master/bin/load_app.sh">load_app.sh</a>. <a href="https://github.com/dart-gde/chrome.dart/blob/master/bin/load_app.sh">load_app.sh</a> shows a simple way to load up an application in <code>app</code> folder from command line.</p>

<h2>Helping out</h2>

<p>We still need more unit tests, documentation, and additional development. If your interested checkout the <a href="https://github.com/dart-gde/chrome.dart/issues?state=open">github issues</a> or send pull requests.</p>

<h2>Thanks!</h2>

<p>To all the contributors on this project <a href="https://github.com/devoncarew">Devon Carew</a>, <a href="https://github.com/kevmoo">Kevin Moore</a>, <a href="https://github.com/rmsmith">Ross Smith</a>, <a href="https://github.com/DrMarcII">Marc Fisher</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Build and deploy dart to Beaglebone Black]]></title>
    <link href="http://financeCoding.github.com/blog/2013/11/29/build-and-deploy-dart-to-beaglebone-black/"/>
    <updated>2013-11-29T08:56:00-08:00</updated>
    <id>http://financeCoding.github.com/blog/2013/11/29/build-and-deploy-dart-to-beaglebone-black</id>
    <content type="html"><![CDATA[<p>I was looking into using <a href="https://www.dartlang.org">dart</a> on <a href="http://beagleboard.org/products/beaglebone%20black">Beaglebone Black</a> and decided it would be useful to share with others what I found.</p>

<p>After a some build hacks and patches I found a minimal working solution for Beaglebone Black with <a href="https://wiki.debian.org/ArmHardFloatPort">Debian</a> <a href="http://www.armhf.com/">ARMhf</a>. A few important notes before going down the road of building dart for ARM. The <code>dart-sdk</code> is not fully supported and pub currently might not work. <del>The <code>dartanalyzer</code> might not work</del>. The only supported <a href="http://en.wikipedia.org/wiki/List_of_ARM_cores">ARM architectures</a> are the ones that have <a href="http://en.wikipedia.org/wiki/ARMv7#32-bit_architecture">ARMv7</a> with <a href="http://en.wikipedia.org/wiki/ARM_architecture#Floating-point_.28VFP.29">VFP</a>. Don&#8217;t spin your wheels trying to target any architecutre that is not <code>ARMv7</code> with VFP (minimum at the moment <code>ARMv7-A</code>) unless you plan on implementing the routines needed in the runtime <a href="https://code.google.com/p/dart/source/browse/branches/bleeding_edge/dart/runtime/vm/assembler_arm.cc">arm assembler</a>. If you do plan on implementing them, well thats just pure awesome!</p>

<figure class='code'><figcaption><span>assembler_arm.cc</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="kt">void</span> <span class="n">CPUFeatures</span><span class="o">::</span><span class="n">InitOnce</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'><span class="cp">#if defined(USING_SIMULATOR)</span>
</span><span class='line'>  <span class="n">integer_division_supported_</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>  <span class="n">neon_supported_</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'><span class="cp">#else</span>
</span><span class='line'>  <span class="n">ASSERT</span><span class="p">(</span><span class="n">CPUInfoContainsString</span><span class="p">(</span><span class="s">&quot;ARMv7&quot;</span><span class="p">));</span>  <span class="c1">// Implements ARMv7.</span>
</span><span class='line'>  <span class="n">ASSERT</span><span class="p">(</span><span class="n">CPUInfoContainsString</span><span class="p">(</span><span class="s">&quot;vfp&quot;</span><span class="p">));</span>  <span class="c1">// Has floating point unit.</span>
</span><span class='line'>  <span class="c1">// Has integer division.</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">CPUInfoContainsString</span><span class="p">(</span><span class="s">&quot;QCT APQ8064&quot;</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">// Special case for Qualcomm Krait CPUs in Nexus 4 and 7.</span>
</span><span class='line'>    <span class="n">integer_division_supported_</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">integer_division_supported_</span> <span class="o">=</span> <span class="n">CPUInfoContainsString</span><span class="p">(</span><span class="s">&quot;idiva&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="n">neon_supported_</span> <span class="o">=</span> <span class="n">CPUInfoContainsString</span><span class="p">(</span><span class="s">&quot;neon&quot;</span><span class="p">);</span>
</span><span class='line'><span class="cp">#endif  </span><span class="c1">// defined(USING_SIMULATOR)</span>
</span><span class='line'><span class="cp">#if defined(DEBUG)</span>
</span><span class='line'>  <span class="n">initialized_</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'><span class="cp">#endif</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Download <a href="http://releases.ubuntu.com/precise/">Ubuntu 12.04.3 LTS</a></h3>

<p>Download the desktop iso to install on VirtualBox.</p>

<h3>Install on <a href="https://www.virtualbox.org/">VirtualBox</a></h3>

<p>I work mostly on mac so Ubuntu installed on VirtualBox was needed to help with cross compiling and flashing of uSD cards.</p>

<h3>Update the packages</h3>

<p>Just to be safe update any Ubuntu packages before installing the development software.</p>

<h3>Install basic packages</h3>

<p>I typically use the git <a href="https://code.google.com/p/dart/wiki/GettingTheSource#Using_Git">overlay</a> on subversion when working with the dart repo. The java jre/jdk is required for building the dart_analyzer which does not work in the sdk.</p>

<figure class='code'><figcaption><span>shell</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># Install subversion </span>
</span><span class='line'>sudo apt-get install subversion git git-svn openssh-server vim default-jre default-jdk
</span></code></pre></td></tr></table></div></figure>


<h3>Install the chrome build and arm dependencies</h3>

<p>Checkout the latest build tools scripts. The following scripts prep your system with any packages needed for building dart.</p>

<figure class='code'><figcaption><span>shell</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># checkout build scripts</span>
</span><span class='line'>svn co http://src.chromium.org/chrome/trunk/src/build; <span class="nb">cd </span>build
</span><span class='line'>
</span><span class='line'><span class="c"># install dependencies</span>
</span><span class='line'>chmod u+x install-build-deps.sh
</span><span class='line'>./install-build-deps.sh --no-chromeos-fonts
</span><span class='line'>./install-build-deps.sh --no-chromeos-fonts --arm
</span></code></pre></td></tr></table></div></figure>


<h3>Install addtional libraries</h3>

<p>The following libraries are needed for building dart but might not be included from the chrome build tool scripts.</p>

<figure class='code'><figcaption><span>shell</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># Install addtional libs</span>
</span><span class='line'>sudo apt-get install libc6-dev-i386 g++-multilib
</span></code></pre></td></tr></table></div></figure>


<h3>Install depot-tools</h3>

<p><a href="http://www.chromium.org/developers/how-tos/depottools">depot-tools</a> is required for hacking out the dart source code.</p>

<figure class='code'><figcaption><span>shell</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># depot tools</span>
</span><span class='line'>svn co http://src.chromium.org/svn/trunk/tools/depot_tools
</span><span class='line'><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:<span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>//depot_tools
</span></code></pre></td></tr></table></div></figure>


<h3>Checkout the dart code base</h3>

<p>You dont need to include <code>--username &lt;YOUR USERNAME&gt;</code> unless you plan on creating a CL for review.</p>

<figure class='code'><figcaption><span>shell</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mkdir dart_bleeding
</span><span class='line'><span class="nb">cd </span>dart_bleeding
</span><span class='line'>svn ls https://dart.googlecode.com/svn/branches/bleeding_edge/ --username &lt;YOUR USERNAME&gt;
</span><span class='line'>gclient config https://dart.googlecode.com/svn/branches/bleeding_edge/deps/all.deps
</span><span class='line'>git svn clone -rHEAD https://dart.googlecode.com/svn/branches/bleeding_edge/dart dart
</span><span class='line'>gclient sync
</span><span class='line'>gclient runhooks
</span></code></pre></td></tr></table></div></figure>


<h3>Patch the gyp and version files</h3>

<p>A git patch can be found here <a href="https://gist.github.com/financeCoding/7725354">7725354</a>, that patches the build scripts to support building the <code>dart-sdk</code> for ARM. Patching the <code>VERSION</code> file was done in an attempt to get pub working. At the moment its not required. If not done then an old version number is baked into the dartvm. This patch also modifies which dartvm creates the snapshots for <code>pub</code>, <code>dart2js</code> and a wrapper util. Patch creates the requirement of having to build the dartvm for x64 before building the <code>dart-sdk</code> for ARM. The dart build scripts have a funky dependency of wanting to use the dartvm target to create the snapshot files. Which in this case wont work since our dartvm is an ARM target being built on x64.</p>

<figure class='code'><figcaption><span>arm.build.patch</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
</pre></td><td class='code'><pre><code class='diff'><span class='line'><span class="gh">diff --git a/tools/VERSION b/tools/VERSION</span>
</span><span class='line'><span class="gh">index d1ab212..0d6101d 100644</span>
</span><span class='line'><span class="gd">--- a/tools/VERSION</span>
</span><span class='line'><span class="gi">+++ b/tools/VERSION</span>
</span><span class='line'><span class="gu">@@ -1,5 +1,5 @@</span>
</span><span class='line'> CHANNEL be
</span><span class='line'><span class="gd">-MAJOR 0</span>
</span><span class='line'><span class="gd">-MINOR 1</span>
</span><span class='line'><span class="gd">-BUILD 2</span>
</span><span class='line'><span class="gd">-PATCH 0</span>
</span><span class='line'><span class="gi">+MAJOR 1</span>
</span><span class='line'><span class="gi">+MINOR 0</span>
</span><span class='line'><span class="gi">+BUILD 0</span>
</span><span class='line'><span class="gi">+PATCH 7</span>
</span><span class='line'><span class="gh">diff --git a/utils/compiler/compiler.gyp b/utils/compiler/compiler.gyp</span>
</span><span class='line'><span class="gh">index 294c7e9..5f3754a 100644</span>
</span><span class='line'><span class="gd">--- a/utils/compiler/compiler.gyp</span>
</span><span class='line'><span class="gi">+++ b/utils/compiler/compiler.gyp</span>
</span><span class='line'><span class="gu">@@ -18,7 +18,7 @@</span>
</span><span class='line'>         {
</span><span class='line'>           &#39;action_name&#39;: &#39;generate_snapshots&#39;,
</span><span class='line'>           &#39;inputs&#39;: [
</span><span class='line'><span class="gd">-            &#39;&lt;(PRODUCT_DIR)/&lt;(EXECUTABLE_PREFIX)dart&lt;(EXECUTABLE_SUFFIX)&#39;,</span>
</span><span class='line'><span class="gi">+            &#39;&lt;(PRODUCT_DIR)/../DebugX64/dart&#39;,</span>
</span><span class='line'>             &#39;../../sdk/lib/_internal/libraries.dart&#39;,
</span><span class='line'>             &#39;&lt;!@([&quot;python&quot;, &quot;../../tools/list_files.py&quot;, &quot;\\.dart$&quot;, &quot;../../sdk/lib/_internal/compiler&quot;, &quot;../../runtime/lib&quot;, &quot;../../sdk/lib/_internal/dartdoc&quot;])&#39;,
</span><span class='line'>             &#39;create_snapshot.dart&#39;,
</span><span class='line'><span class="gu">@@ -30,7 +30,7 @@</span>
</span><span class='line'>             &#39;&lt;(SHARED_INTERMEDIATE_DIR)/dart2js.dart.snapshot&#39;,
</span><span class='line'>           ],
</span><span class='line'>           &#39;action&#39;: [
</span><span class='line'><span class="gd">-            &#39;&lt;(PRODUCT_DIR)/&lt;(EXECUTABLE_PREFIX)dart&lt;(EXECUTABLE_SUFFIX)&#39;,</span>
</span><span class='line'><span class="gi">+            &#39;&lt;(PRODUCT_DIR)/../DebugX64/dart&#39;,</span>
</span><span class='line'>             &#39;create_snapshot.dart&#39;,
</span><span class='line'>             &#39;--output_dir=&lt;(SHARED_INTERMEDIATE_DIR)&#39;,
</span><span class='line'>             &#39;--dart2js_main=sdk/lib/_internal/compiler/implementation/dart2js.dart&#39;,
</span><span class='line'><span class="gh">diff --git a/utils/pub/pub.gyp b/utils/pub/pub.gyp</span>
</span><span class='line'><span class="gh">index fd5e147..ab2e243 100644</span>
</span><span class='line'><span class="gd">--- a/utils/pub/pub.gyp</span>
</span><span class='line'><span class="gi">+++ b/utils/pub/pub.gyp</span>
</span><span class='line'><span class="gu">@@ -25,7 +25,7 @@</span>
</span><span class='line'>             &#39;&lt;(SHARED_INTERMEDIATE_DIR)/pub.dart.snapshot&#39;,
</span><span class='line'>           ],
</span><span class='line'>           &#39;action&#39;: [
</span><span class='line'><span class="gd">-            &#39;&lt;(PRODUCT_DIR)/&lt;(EXECUTABLE_PREFIX)dart&lt;(EXECUTABLE_SUFFIX)&#39;,</span>
</span><span class='line'><span class="gi">+            &#39;&lt;(PRODUCT_DIR)/../DebugX64/dart&#39;,</span>
</span><span class='line'>             &#39;--package-root=&lt;(PRODUCT_DIR)/packages/&#39;,
</span><span class='line'>             &#39;--snapshot=&lt;(SHARED_INTERMEDIATE_DIR)/pub.dart.snapshot&#39;,
</span><span class='line'>             &#39;../../sdk/lib/_internal/pub/bin/pub.dart&#39;,
</span></code></pre></td></tr></table></div></figure>


<h3>Build the <code>dart-sdk</code></h3>

<p>Building of the <code>dart-sdk</code> for ARM target is a two stop process. First build x64 so we can use that dartvm to generate the snapshot files. Then the second step is running the <code>create_sdk</code> build for ARM. When the build is finished the <code>out/ReleaseARM/dart-sdk</code> should contain a full <code>dart-sdk</code> build. <del>Keep in mind this does build the <code>dartanalyzer</code> but it may not work on ARM.</del></p>

<figure class='code'><figcaption><span>shell</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># build a target for your native system to create the snapshot files. </span>
</span><span class='line'>./tools/build.py -m debug -v -a x64 -j 8
</span><span class='line'>
</span><span class='line'><span class="c"># build the arm target</span>
</span><span class='line'>./tools/build.py -m release -v -a arm -j 8 create_sdk
</span></code></pre></td></tr></table></div></figure>


<h3>Tarball the sdk</h3>

<p>Package up the <code>dart-sdk</code> as a tarball to distribute.</p>

<figure class='code'><figcaption><span>shell</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">cd</span> ./out/ReleaseARM/
</span><span class='line'>tar -czvf dart-sdk.tar.gz dart-sdk
</span></code></pre></td></tr></table></div></figure>


<h3>Install <a href="http://www.armhf.com/index.php/boards/beaglebone-black/#wheezy">Debian Wheezy 7.2 Hard Float Minimal Image</a> on Beaglebone Black</h3>

<p>In virtualbox with a uSD card at <code>/dev/sdX</code> the following will download an image and write to the uSD card. Updated images can be found at <a href="http://www.armhf.com/index.php/boards/beaglebone-black/#wheezy">armhf</a></p>

<figure class='code'><figcaption><span>shell</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>wget http://s3.armhf.com/debian/wheezy/bone/debian-wheezy-7.2-armhf-3.8.13-bone30.img.xz
</span><span class='line'>xz -cd debian-wheezy-7.2-armhf-3.8.13-bone30.img.xz &gt; /dev/sdX
</span></code></pre></td></tr></table></div></figure>


<p>Then insert the uSD card into the Beaglebone Black and boot the image by holding down the boot switch and powering on.</p>

<p><img src="http://elinux.org/images/7/76/CONN_REVA5A.jpg"></p>

<p>Write the booted image to the eMMC.</p>

<figure class='code'><figcaption><span>shell</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>xz -cd debian-wheezy-7.2-armhf-3.8.13-bone30.img.xz &gt; /dev/mmcblk1
</span></code></pre></td></tr></table></div></figure>


<p>Power down and remove the uSD card.</p>

<h3>Update glibc on the BeagleBone Black</h3>

<p>Updating glibc is required cause the version of glibc installed from the chromium build scripts is greater then the one shipped with Wheezy 7.2. The following commands update glibc.</p>

<figure class='code'><figcaption><span>shell</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># Add an addtional source for the latest glibc</span>
</span><span class='line'>sudo sed -i <span class="s1">&#39;1i deb http://ftp.us.debian.org/debian/ jessie main&#39;</span> /etc/apt/sources.list
</span><span class='line'>
</span><span class='line'><span class="c"># Update sources </span>
</span><span class='line'>sudo apt-get update
</span><span class='line'>
</span><span class='line'><span class="c"># Download latest glibc</span>
</span><span class='line'>sudo <span class="nv">DEBIAN_FRONTEND</span><span class="o">=</span>noninteractive apt-get -t jessie install -y libc6 libc6-dev libc6-dbg git screen
</span></code></pre></td></tr></table></div></figure>


<h3>Copy over <code>dart-sdk</code></h3>

<p>From virtual box copy over the tarball to Beaglebone Black running debian.</p>

<figure class='code'><figcaption><span>shell</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>scp dart-sdk.tar.gz debian@192.168.2.2:~/
</span></code></pre></td></tr></table></div></figure>


<p>After the tarball is copied, uncompress and add to your <code>PATH</code>.</p>

<figure class='code'><figcaption><span>shell</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>tar -zxvf dart-sdk.tar.gz
</span><span class='line'><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span>~/dart-sdk:<span class="nv">$PATH</span>
</span><span class='line'>dart --version
</span><span class='line'>Dart VM version: 1.0.0.7_r30634_adam <span class="o">(</span>Fri Nov 29 01:14:42 2013<span class="o">)</span> on <span class="s2">&quot;linux_arm&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Known issues at the moment</h3>

<p>Pub does not work, issue could be followed at <a href="https://code.google.com/p/dart/issues/detail?id=15383">15383</a>. I was testing this out while staying at a hotel so some proxy settings might of been blocking or tripping up pub.</p>

<h3>Feedback</h3>

<p>If you have a better way of running dart on Beagleblone Black I would love to hear it! Please contact me on <a href="https://plus.google.com/104569492481999771226/">g+</a> and lets discuss.</p>

<h3>Update on <code>dartanalyzer</code></h3>

<p><code>dartanalyzer</code> will work after installing the <code>default-jre</code> on Beaglebone Black.</p>

<figure class='code'><figcaption><span>shell</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo apt-get install default-jre
</span></code></pre></td></tr></table></div></figure>


<p></p>

<h3>Addtional resources</h3>

<ul>
<li><a href="https://github.com/financeCoding/dart_bleeding">dart_bleeding</a> contains some scripts I typically use for this entire process.</li>
<li><a href="https://code.google.com/p/dart/wiki/PreparingYourMachine">PreparingYourMachine</a> resources for preping your machine to build from source</li>
<li><a href="https://code.google.com/p/dart/wiki/GettingTheSource">GettingTheSource</a> getting the source code documentation</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[google client apis new release 0.4.x]]></title>
    <link href="http://financeCoding.github.com/blog/2013/10/22/google-client-apis-new-release-0-dot-4-x/"/>
    <updated>2013-10-22T19:34:00-07:00</updated>
    <id>http://financeCoding.github.com/blog/2013/10/22/google-client-apis-new-release-0-dot-4-x</id>
    <content type="html"><![CDATA[<p>The <a href="https://github.com/dart-gde?tab=members">dart-gde</a> team has updated the <a href="https://github.com/dart-google-apis">google client apis</a> to <code>'&gt;=0.4.0'</code>. Along with this change was an update for <a href="http://pub.dartlang.org/packages/google_oauth2_client">Google OAuth2 Client</a> to <code>'&gt;=0.3.0'</code>.</p>

<h2>The breaking changes for <a href="http://pub.dartlang.org/packages/google_oauth2_client">Google OAuth2 Client</a></h2>

<ul>
<li>SystemCache has been removed.</li>
<li><code>GoogleOAuth2.ensureAuthenticated()</code> A much cleaner impl that eliminates the need to pass in a HttpRequest object to authenticate.</li>
<li>All dependencies bumped to latest versions.</li>
<li>Code refactored.</li>
<li>Dead code eliminated.</li>
<li>Remove deprecated libraries.</li>
<li>Heavy logging removed.</li>
</ul>


<h2>The breaking changes for generated <a href="https://github.com/dart-google-apis">google client apis</a> include</h2>

<ul>
<li>Renamed <code>lib/src/{cloud_api.dart -&gt; client_base.dart}</code> <code>lib/src/{cloud_api_console.dart -&gt; console_client.dart}</code> <code>lib/src/{cloud_api_browser.dart -&gt; browser_client.dart}</code>.</li>
<li><code>ClientBase.responseParse(int statusCode, String responseBody)</code> introduced and handles parsing <code>responseBody</code>. <code>responseParse</code> will throw <code>DetailedApiRequestError</code> if the body has an error.</li>
<li>Renamed <code>APIRequestException</code> -> <code>APIRequestError</code>.</li>
<li>Remove deprecated libraries.</li>
</ul>


<h2>Updating requires a small change in <code>pubspec.yaml</code></h2>

<figure class='code'><figcaption><span>pubspec.yaml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">dependencies</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="l-Scalar-Plain">google_plus_v1_api</span><span class="p-Indicator">:</span> <span class="s">&#39;&gt;=0.4.0&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>A small collection of demo examples could be found at <a href="https://github.com/dart-gde/dart_api_client_examples">dart_api_client_examples</a>.</p>

<h2>Full list of available Google client apis on <a href="http://pub.dartlang.org">pub.dartlang.org</a></h2>

<ul>
<li><a href="http://pub.dartlang.org/packages/dart_adexchangebuyer_v1_api_client">dart_adexchangebuyer_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_adexchangebuyer_v1_1_api_client">dart_adexchangebuyer_v1_1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_adexchangebuyer_v1_2_api_client">dart_adexchangebuyer_v1_2_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_adexchangebuyer_v1_3_api_client">dart_adexchangebuyer_v1_3_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_adexchangeseller_v1_api_client">dart_adexchangeseller_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_adexchangeseller_v1_1_api_client">dart_adexchangeseller_v1_1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_admin_directory_v1_api_client">dart_admin_directory_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_admin_email_migration_v2_api_client">dart_admin_email_migration_v2_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_admin_reports_v1_api_client">dart_admin_reports_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_adsense_v1_2_api_client">dart_adsense_v1_2_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_adsense_v1_3_api_client">dart_adsense_v1_3_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_adsensehost_v4_1_api_client">dart_adsensehost_v4_1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_analytics_v2_4_api_client">dart_analytics_v2_4_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_analytics_v3_api_client">dart_analytics_v3_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_androidpublisher_v1_api_client">dart_androidpublisher_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_androidpublisher_v1_1_api_client">dart_androidpublisher_v1_1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_appstate_v1_api_client">dart_appstate_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_audit_v1_api_client">dart_audit_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_bigquery_v2_api_client">dart_bigquery_v2_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_blogger_v2_api_client">dart_blogger_v2_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_blogger_v3_api_client">dart_blogger_v3_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_books_v1_api_client">dart_books_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_calendar_v3_api_client">dart_calendar_v3_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_civicinfo_us_v1_api_client">dart_civicinfo_us_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_compute_v1beta15_api_client">dart_compute_v1beta15_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_compute_v1beta16_api_client">dart_compute_v1beta16_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_coordinate_v1_api_client">dart_coordinate_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_customsearch_v1_api_client">dart_customsearch_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_datastore_v1beta1_api_client">dart_datastore_v1beta1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_datastore_v1beta2_api_client">dart_datastore_v1beta2_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_dfareporting_v1_api_client">dart_dfareporting_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_dfareporting_v1_1_api_client">dart_dfareporting_v1_1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_dfareporting_v1_2_api_client">dart_dfareporting_v1_2_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_dfareporting_v1_3_api_client">dart_dfareporting_v1_3_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_discovery_v1_api_client">dart_discovery_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_doubleclickbidmanager_v1_api_client">dart_doubleclickbidmanager_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_doubleclicksearch_v2_api_client">dart_doubleclicksearch_v2_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_drive_v1_api_client">dart_drive_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_drive_v2_api_client">dart_drive_v2_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_freebase_v1_sandbox_api_client">dart_freebase_v1_sandbox_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_freebase_v1sandbox_api_client">dart_freebase_v1sandbox_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_freebase_v1_api_client">dart_freebase_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_fusiontables_v1_api_client">dart_fusiontables_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_games_v1_api_client">dart_games_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_gamesmanagement_v1management_api_client">dart_gamesmanagement_v1management_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_gan_v1beta1_api_client">dart_gan_v1beta1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_groupsmigration_v1_api_client">dart_groupsmigration_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_groupssettings_v1_api_client">dart_groupssettings_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_identitytoolkit_v3_api_client">dart_identitytoolkit_v3_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_licensing_v1_api_client">dart_licensing_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_mirror_v1_api_client">dart_mirror_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_oauth2_v1_api_client">dart_oauth2_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_oauth2_v2_api_client">dart_oauth2_v2_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_orkut_v2_api_client">dart_orkut_v2_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_pagespeedonline_v1_api_client">dart_pagespeedonline_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_plus_v1_api_client">dart_plus_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_plusdomains_v1_api_client">dart_plusdomains_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_prediction_v1_2_api_client">dart_prediction_v1_2_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_prediction_v1_3_api_client">dart_prediction_v1_3_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_prediction_v1_4_api_client">dart_prediction_v1_4_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_prediction_v1_5_api_client">dart_prediction_v1_5_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_prediction_v1_6_api_client">dart_prediction_v1_6_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_reseller_v1sandbox_api_client">dart_reseller_v1sandbox_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_reseller_v1_api_client">dart_reseller_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_shopping_v1_api_client">dart_shopping_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_siteverification_v1_api_client">dart_siteverification_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_sqladmin_v1beta1_api_client">dart_sqladmin_v1beta1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_storage_v1beta1_api_client">dart_storage_v1beta1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_storage_v1beta2_api_client">dart_storage_v1beta2_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_taskqueue_v1beta1_api_client">dart_taskqueue_v1beta1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_taskqueue_v1beta2_api_client">dart_taskqueue_v1beta2_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_tasks_v1_api_client">dart_tasks_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_translate_v2_api_client">dart_translate_v2_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_urlshortener_v1_api_client">dart_urlshortener_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_webfonts_v1_api_client">dart_webfonts_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_youtube_v3_api_client">dart_youtube_v3_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_youtubeanalytics_v1_api_client">dart_youtubeanalytics_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_youtubeanalytics_v1beta1_api_client">dart_youtubeanalytics_v1beta1_api_client</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Getting Started with Dart on Compute Engine]]></title>
    <link href="http://financeCoding.github.com/blog/2013/09/30/getting-started-with-dart-on-compute-engine/"/>
    <updated>2013-09-30T20:41:00-07:00</updated>
    <id>http://financeCoding.github.com/blog/2013/09/30/getting-started-with-dart-on-compute-engine</id>
    <content type="html"><![CDATA[<p>Quick how-to on using <a href="http://www.dartlang.org">dart</a> with <a href="https://cloud.google.com/products/compute-engine">Compute Engine</a>. If not aware, right now is a great time to dive into Compute Engine cause google is giving away $2,000 worth of <a href="https://plus.google.com/111783114889748547827/posts/Bou747dCfNb">credits</a> to individuals interested in trying it out. I&#8217;ve been using it for about 2-3 months now and totally love it.</p>

<p>What peeked my interest is it was flexable enough to run the dartvm as a server with minimal configuration. The one configuration hurdle was dependency of <code>GLIBC &gt;= 2.15</code> in the dartvm binaries. The good news is with a simple startup script the compute engine instance can be provisioned to support the latest linux <a href="https://storage.googleapis.com/dart-editor-archive-integration/latest/dartsdk-linux-64.tar.gz">dart-sdk</a>.</p>

<p>The main tool we will use to provision a compute engine instance is <a href="https://developers.google.com/compute/docs/gcutil/">gcutil</a>. We could of used dartvm and <a href="http://pub.dartlang.org/packages/google_compute_v1beta15_api">google_compute_v1beta15_api</a> but will save that for a later post.</p>

<p>After signing up for <a href="https://cloud.google.com/products/compute-engine">Compute Engine</a> the next step should be to download and configure <code>gcutil</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>wget https://google-compute-engine-tools.googlecode.com/files/gcutil-1.8.4.tar.gz
</span><span class='line'><span class="nv">$ </span>tar xzvpf gcutil-1.8.4.tar.gz -C <span class="nv">$HOME</span>
</span><span class='line'><span class="nv">$ </span><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span>./gcutil-1.8.4:<span class="nv">$PATH</span>
</span><span class='line'><span class="nv">$ </span>gcutil version
</span><span class='line'>1.8.4
</span></code></pre></td></tr></table></div></figure>


<p>Next we want to create a <code>startup.sh</code> script that will be deployed to the compute engine instance. The script is a simple way to run additional commands to provision the instance. For dart we need to add a new <code>deb</code> source, update sources, install dependencies, fetch &amp; unpack dart-sdk, and then execute our dart server. In the final line of the <code>startup.sh</code> script the command will create a dart server from the user account tied to this compute instance. Simply we clone a public git repo, install pub dependencies and screen a detached session that runs the dart server. This is not a very fancy way to deploy dart but a simple and quick way to get something running with no troubles. A real life deployment might include some trendy fab/chef/puppet combo.</p>

<figure class='code'><figcaption><span>startup.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/usr/bin/env bash</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Add an addtional source for the latest glibc</span>
</span><span class='line'>sudo sed -i <span class="s1">&#39;1i deb http://ftp.us.debian.org/debian/ jessie main&#39;</span> /etc/apt/sources.list
</span><span class='line'>
</span><span class='line'><span class="c"># Update sources </span>
</span><span class='line'>sudo apt-get update
</span><span class='line'>
</span><span class='line'><span class="c"># Download latest glibc</span>
</span><span class='line'>sudo <span class="nv">DEBIAN_FRONTEND</span><span class="o">=</span>noninteractive apt-get -t jessie install -y libc6 libc6-dev libc6-dbg git screen
</span><span class='line'>
</span><span class='line'><span class="c"># Download the latest dart sdk</span>
</span><span class='line'>wget https://storage.googleapis.com/dart-editor-archive-integration/latest/dartsdk-linux-64.tar.gz -O /dartsdk-linux-64.tar.gz
</span><span class='line'>
</span><span class='line'><span class="c"># Unpack the dart sdk</span>
</span><span class='line'>tar -zxvf /dartsdk-linux-64.tar.gz -C /
</span><span class='line'>
</span><span class='line'>su - financeCoding -c <span class="s1">&#39;ls -al &amp;&amp; cd ~ &amp;&amp; pwd &amp;&amp; git clone https://github.com/rikulo/stream.git &amp;&amp; /dart-sdk/bin/dart --version &amp;&amp; cd stream &amp;&amp; /dart-sdk/bin/dart --version &amp;&amp; /dart-sdk/bin/pub install &amp;&amp; cd example/hello-static &amp;&amp; screen -d -m /dart-sdk/bin/dart webapp/main.dart&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>After we have the <code>startup.sh</code> script we then create another deployment script. The following script will be the gcutil commands needed to actually create and provision the compute instance. The last part of our script includes a firewall rule for the port that the <a href="https://github.com/rikulo/stream">stream</a> sample is running on. Without proper firewall rules no access from the outside is possible.</p>

<figure class='code'><figcaption><span>deploy-dart-compute.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/usr/bin/env bash</span>
</span><span class='line'><span class="nb">set</span> +o xtrace
</span><span class='line'>
</span><span class='line'><span class="nv">USER</span><span class="o">=</span>financeCoding
</span><span class='line'><span class="nv">PROJECT</span><span class="o">=</span>dart-compute-project
</span><span class='line'><span class="nv">INSTANCE_NAME</span><span class="o">=</span>dart-compute
</span><span class='line'><span class="nv">TAGS</span><span class="o">=</span>dart
</span><span class='line'><span class="nv">MACHINE_TYPE</span><span class="o">=</span>g1-small
</span><span class='line'><span class="nv">NETWORK</span><span class="o">=</span>default
</span><span class='line'><span class="nv">IP</span><span class="o">=</span>ephemeral
</span><span class='line'><span class="nv">IMAGE</span><span class="o">=</span>https://www.googleapis.com/compute/v1beta15/projects/debian-cloud/global/images/debian-7-wheezy-v20130816
</span><span class='line'><span class="nv">SCOPES</span><span class="o">=</span>https://www.googleapis.com/auth/userinfo.email,https://www.googleapis.com/auth/compute,https://www.googleapis.com/auth/devstorage.full_control
</span><span class='line'><span class="nv">PERSISTENT_BOOT_DISK</span><span class="o">=</span><span class="nb">true</span>
</span><span class='line'><span class="nv">ZONE</span><span class="o">=</span>us-central1-b
</span><span class='line'><span class="nv">STARTUP_SCRIPT</span><span class="o">=</span>startup.sh
</span><span class='line'><span class="nv">GCUTIL</span><span class="o">=</span><span class="s2">&quot;gcutil --service_version=v1beta15 --project=$PROJECT&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$GCUTIL</span> addinstance <span class="nv">$INSTANCE_NAME</span> --tags<span class="o">=</span><span class="nv">$TAGS</span> --zone<span class="o">=</span><span class="nv">$ZONE</span> --machine_type<span class="o">=</span><span class="nv">$MACHINE_TYPE</span> --network<span class="o">=</span><span class="nv">$NETWORK</span> --external_ip_address<span class="o">=</span><span class="nv">$IP</span> --service_account_scopes<span class="o">=</span><span class="nv">$SCOPES</span> --image<span class="o">=</span><span class="nv">$IMAGE</span> --persistent_boot_disk<span class="o">=</span><span class="nv">$PERSISTENT_BOOT_DISK</span> --metadata_from_file<span class="o">=</span>startup-script:<span class="nv">$STARTUP_SCRIPT</span>
</span><span class='line'>
</span><span class='line'><span class="nv">rc</span><span class="o">=</span><span class="nv">$?</span>
</span><span class='line'><span class="k">if</span> <span class="o">[[</span> <span class="nv">$rc</span> !<span class="o">=</span> 0 <span class="o">]]</span> ; <span class="k">then</span>
</span><span class='line'><span class="k">  </span><span class="nb">echo</span> <span class="s2">&quot;Not able to add instance&quot;</span>
</span><span class='line'>    <span class="nb">exit</span> <span class="nv">$rc</span>
</span><span class='line'><span class="k">fi</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$GCUTIL</span> addfirewall <span class="nv">$INSTANCE_NAME</span> --allowed <span class="s2">&quot;tcp:8080&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">rc</span><span class="o">=</span><span class="nv">$?</span>
</span><span class='line'><span class="k">if</span> <span class="o">[[</span> <span class="nv">$rc</span> !<span class="o">=</span> 0 <span class="o">]]</span> ; <span class="k">then</span>
</span><span class='line'><span class="k">  </span><span class="nb">echo</span> <span class="s2">&quot;Not able to provision firewall or has already been provisioned&quot;</span>
</span><span class='line'>    <span class="nb">exit</span> <span class="nv">$rc</span>
</span><span class='line'><span class="k">fi</span>
</span><span class='line'>
</span><span class='line'><span class="nb">exit</span> <span class="nv">$rc</span>
</span></code></pre></td></tr></table></div></figure>


<p><a href="http://financeCoding.github.com/images/2013-09-30-getting-started-with-dart-on-compute-engine/compute-engine-console.png"><img src="http://financeCoding.github.com/images/2013-09-30-getting-started-with-dart-on-compute-engine/compute-engine-console.png" alt="compute-engine-console" /></a></p>

<p><a href="http://financeCoding.github.com/images/2013-09-30-getting-started-with-dart-on-compute-engine/stream-client.png"><img src="http://financeCoding.github.com/images/2013-09-30-getting-started-with-dart-on-compute-engine/stream-client.png" alt="stream-client" /></a></p>

<p>And thats all that is needed to get dart on compute engine in two easy steps. The code can be found here <a href="https://gist.github.com/financeCoding/6789537">gist</a>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[gplus quickstart with dart]]></title>
    <link href="http://financeCoding.github.com/blog/2013/04/02/gplus-quickstart-with-dart/"/>
    <updated>2013-04-02T19:25:00-07:00</updated>
    <id>http://financeCoding.github.com/blog/2013/04/02/gplus-quickstart-with-dart</id>
    <content type="html"><![CDATA[<p>Tonights mash-up was taking the <a href="https://github.com/Scarygami/gplus-quickstart-dart">gplus-quickstart-dart</a> and wiring it up for server side support. Similar to the <a href="https://github.com/googleplus/gplus-quickstart-java">gplus-quickstart-java</a>, the client will use the <a href="https://developers.google.com/+/web/+1button/">gplus login button</a> to do the <a href="https://developers.google.com/accounts/docs/OAuth2WebServer">OAuth2WebServer</a> flow and send the code over to the server. The server can then verify and make calls on behalf of the client since an &#8216;offline&#8217; token was requested. This demo just features the server side and what was used to put it together. <a href="https://plus.google.com/u/0/109130932502535286138/">Yulian Kuncheff</a> has been the primary developer behind <a href="https://github.com/Daegalus/fukiya">fukiya</a> which is an express like framework for dart. The thing I liked most about <a href="https://github.com/Daegalus/fukiya">fukiya</a> was how simple and easy it was to setup URL handlers.</p>

<p>First off, setting up some dependencies.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>dependencies:
</span><span class='line'>  google_plus_v1_api: any
</span><span class='line'>  browser: any
</span><span class='line'>  fukiya: '&gt;=0.0.11'
</span><span class='line'>  html5lib: "&gt;=0.4.1 &lt;0.4.2"
</span><span class='line'>  logging: "&gt;=0.4.3+5"</span></code></pre></td></tr></table></div></figure>


<p>A quick outline of what URLs fukiya handles. Dead simple to setup!</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'><span class="kt">void</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">new</span> <span class="n">Fukiya</span><span class="p">()</span>
</span><span class='line'>  <span class="p">..</span><span class="kd">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">getIndexHandler</span><span class="p">)</span>
</span><span class='line'>  <span class="p">..</span><span class="kd">get</span><span class="p">(</span><span class="s1">&#39;/index.html&#39;</span><span class="p">,</span> <span class="n">getIndexHandler</span><span class="p">)</span>
</span><span class='line'>  <span class="p">..</span><span class="kd">get</span><span class="p">(</span><span class="s1">&#39;/index&#39;</span><span class="p">,</span> <span class="n">getIndexHandler</span><span class="p">)</span>
</span><span class='line'>  <span class="p">..</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/connect&#39;</span><span class="p">,</span> <span class="n">postConnectDataHandler</span><span class="p">)</span>
</span><span class='line'>  <span class="p">..</span><span class="kd">get</span><span class="p">(</span><span class="s1">&#39;/people&#39;</span><span class="p">,</span> <span class="n">getPeopleHandler</span><span class="p">)</span>
</span><span class='line'>  <span class="p">..</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/disconnect&#39;</span><span class="p">,</span> <span class="n">postDisconnectHandler</span><span class="p">)</span>
</span><span class='line'>  <span class="p">..</span><span class="n">staticFiles</span><span class="p">(</span><span class="s1">&#39;./web&#39;</span><span class="p">)</span>
</span><span class='line'>  <span class="p">..</span><span class="n">use</span><span class="p">(</span><span class="k">new</span> <span class="n">FukiyaJsonParser</span><span class="p">())</span>
</span><span class='line'>  <span class="p">..</span><span class="n">listen</span><span class="p">(</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="m">3333</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The index handler is special cause we needed to inject a state token into the page and HTTP session. The state token is then verified on the <code>/connect</code> post. The one-time token helps avoid any <a href="http://en.wikipedia.org/wiki/Confused_deputy_problem">Confused_deputy_problem</a>s.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'><span class="kt">void</span> <span class="n">getIndexHandler</span><span class="p">(</span><span class="n">FukiyaContext</span> <span class="n">context</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// Create a state token. </span>
</span><span class='line'>  <span class="n">context</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">session</span><span class="p">[</span><span class="s2">&quot;state_token&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_createStateToken</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// Readin the index file and add state token into the meta element. </span>
</span><span class='line'>  <span class="kd">var</span> <span class="n">file</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="p">(</span><span class="n">INDEX_HTML</span><span class="p">);</span>
</span><span class='line'>  <span class="n">file</span><span class="p">.</span><span class="n">exists</span><span class="p">().</span><span class="n">then</span><span class="p">((</span><span class="kt">bool</span> <span class="n">exists</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">exists</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">file</span><span class="p">.</span><span class="n">readAsString</span><span class="p">().</span><span class="n">then</span><span class="p">((</span><span class="kt">String</span> <span class="n">indexDocument</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">Document</span> <span class="n">doc</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Document</span><span class="p">.</span><span class="n">html</span><span class="p">(</span><span class="n">indexDocument</span><span class="p">);</span>
</span><span class='line'>        <span class="n">Element</span> <span class="n">metaState</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Element</span><span class="p">.</span><span class="n">html</span><span class="p">(</span><span class="s1">&#39;&lt;meta name=&quot;state_token&quot; content=&quot;</span><span class="si">${</span><span class="n">context</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">session</span><span class="p">[</span><span class="s2">&quot;state_token&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&quot;&gt;&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="n">doc</span><span class="p">.</span><span class="n">head</span><span class="p">.</span><span class="n">children</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">metaState</span><span class="p">);</span>
</span><span class='line'>        <span class="n">context</span><span class="p">.</span><span class="n">response</span><span class="p">.</span><span class="n">writeBytes</span><span class="p">(</span><span class="n">doc</span><span class="p">.</span><span class="n">outerHtml</span><span class="p">.</span><span class="n">codeUnits</span><span class="p">);</span>
</span><span class='line'>        <span class="n">context</span><span class="p">.</span><span class="n">response</span><span class="p">.</span><span class="n">done</span><span class="p">.</span><span class="n">catchError</span><span class="p">((</span><span class="n">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">serverLogger</span><span class="p">.</span><span class="n">fine</span><span class="p">(</span><span class="s2">&quot;File Response error: </span><span class="si">${</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">));</span>
</span><span class='line'>        <span class="n">context</span><span class="p">.</span><span class="n">response</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
</span><span class='line'>      <span class="p">},</span> <span class="nl">onError:</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">serverLogger</span><span class="p">.</span><span class="n">fine</span><span class="p">(</span><span class="s2">&quot;error = </span><span class="si">$</span><span class="n">error</span><span class="s2">&quot;</span><span class="p">));</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">context</span><span class="p">.</span><span class="n">response</span><span class="p">.</span><span class="n">statusCode</span> <span class="o">=</span> <span class="m">404</span><span class="p">;</span>
</span><span class='line'>      <span class="n">context</span><span class="p">.</span><span class="n">response</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>On the <code>/connect</code> post we will expect a gplus id to be passed to the query parameters and some token data posted. We can then verify the state token and use the token data for accessing the Google APIs.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'><span class="kt">void</span> <span class="n">postConnectDataHandler</span><span class="p">(</span><span class="n">FukiyaContext</span> <span class="n">context</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">serverLogger</span><span class="p">.</span><span class="n">fine</span><span class="p">(</span><span class="s2">&quot;postConnectDataHandler&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="kt">String</span> <span class="n">tokenData</span> <span class="o">=</span> <span class="n">context</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="n">containsKey</span><span class="p">(</span><span class="s2">&quot;access_token&quot;</span><span class="p">)</span> <span class="o">?</span> <span class="n">context</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">session</span><span class="p">[</span><span class="s2">&quot;access_token&quot;</span><span class="p">]</span> <span class="o">:</span> <span class="kc">null</span><span class="p">;</span> <span class="c1">// TODO: handle missing token</span>
</span><span class='line'>  <span class="kt">String</span> <span class="n">stateToken</span> <span class="o">=</span> <span class="n">context</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="n">containsKey</span><span class="p">(</span><span class="s2">&quot;state_token&quot;</span><span class="p">)</span> <span class="o">?</span> <span class="n">context</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">session</span><span class="p">[</span><span class="s2">&quot;state_token&quot;</span><span class="p">]</span> <span class="o">:</span> <span class="kc">null</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">String</span> <span class="n">queryStateToken</span> <span class="o">=</span> <span class="n">context</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">queryParameters</span><span class="p">.</span><span class="n">containsKey</span><span class="p">(</span><span class="s2">&quot;state_token&quot;</span><span class="p">)</span> <span class="o">?</span> <span class="n">context</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">queryParameters</span><span class="p">[</span><span class="s2">&quot;state_token&quot;</span><span class="p">]</span> <span class="o">:</span> <span class="kc">null</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// Check if the token already exists for this session. </span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">tokenData</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">context</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;Current user is already connected.&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="k">return</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// Check if any of the needed token values are null or mismatched.</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">stateToken</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">queryStateToken</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">stateToken</span> <span class="o">!=</span> <span class="n">queryStateToken</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">context</span><span class="p">.</span><span class="n">response</span><span class="p">.</span><span class="n">statusCode</span> <span class="o">=</span> <span class="m">401</span><span class="p">;</span>
</span><span class='line'>    <span class="n">context</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;Invalid state parameter.&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="k">return</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// Normally the state would be a one-time use token, however in our</span>
</span><span class='line'>  <span class="c1">// simple case, we want a user to be able to connect and disconnect</span>
</span><span class='line'>  <span class="c1">// without reloading the page.  Thus, for demonstration, we don&#39;t</span>
</span><span class='line'>  <span class="c1">// implement this best practice.</span>
</span><span class='line'>  <span class="n">context</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;state_token&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="kt">String</span> <span class="n">gPlusId</span> <span class="o">=</span> <span class="n">context</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">queryParameters</span><span class="p">[</span><span class="s2">&quot;gplus_id&quot;</span><span class="p">];</span>
</span><span class='line'>  <span class="kt">String</span><span class="n">Buffer</span> <span class="n">sb</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">String</span><span class="n">Buffer</span><span class="p">();</span>
</span><span class='line'>  <span class="c1">// Read data from request.</span>
</span><span class='line'>  <span class="n">context</span><span class="p">.</span><span class="n">request</span>
</span><span class='line'>  <span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="k">new</span> <span class="kt">String</span><span class="n">Decoder</span><span class="p">())</span>
</span><span class='line'>  <span class="p">.</span><span class="n">listen</span><span class="p">((</span><span class="n">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">sb</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="nl">onDone:</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">serverLogger</span><span class="p">.</span><span class="n">fine</span><span class="p">(</span><span class="s2">&quot;context.request.listen.onDone = </span><span class="si">${</span><span class="n">sb</span><span class="p">.</span><span class="n">toString</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="n">Map</span> <span class="n">requestData</span> <span class="o">=</span> <span class="n">JSON</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="n">sb</span><span class="p">.</span><span class="n">toString</span><span class="p">());</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">Map</span> <span class="n">fields</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>              <span class="s2">&quot;grant_type&quot;</span><span class="o">:</span> <span class="s2">&quot;authorization_code&quot;</span><span class="p">,</span>
</span><span class='line'>              <span class="s2">&quot;code&quot;</span><span class="o">:</span> <span class="n">requestData</span><span class="p">[</span><span class="s2">&quot;code&quot;</span><span class="p">],</span>
</span><span class='line'>              <span class="c1">// http://www.riskcompletefailure.com/2013/03/postmessage-oauth-20.html</span>
</span><span class='line'>              <span class="s2">&quot;redirect_uri&quot;</span><span class="o">:</span> <span class="s2">&quot;postmessage&quot;</span><span class="p">,</span>
</span><span class='line'>              <span class="s2">&quot;client_id&quot;</span><span class="o">:</span> <span class="n">CLIENT_ID</span><span class="p">,</span>
</span><span class='line'>              <span class="s2">&quot;client_secret&quot;</span><span class="o">:</span> <span class="n">CLIENT_SECRET</span>
</span><span class='line'>    <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">http</span><span class="p">.</span><span class="n">Client</span> <span class="n">_httpClient</span> <span class="o">=</span> <span class="k">new</span> <span class="n">http</span><span class="p">.</span><span class="n">Client</span><span class="p">();</span>
</span><span class='line'>    <span class="n">_httpClient</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">TOKEN_ENDPOINT</span><span class="p">,</span> <span class="nl">fields:</span> <span class="n">fields</span><span class="p">).</span><span class="n">then</span><span class="p">((</span><span class="n">http</span><span class="p">.</span><span class="n">Response</span> <span class="n">response</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="c1">// At this point we have the token and refresh token.</span>
</span><span class='line'>      <span class="kd">var</span> <span class="n">credentials</span> <span class="o">=</span> <span class="n">JSON</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">body</span><span class="p">);</span>
</span><span class='line'>      <span class="n">_httpClient</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>      <span class="kd">var</span> <span class="n">verifyTokenUrl</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">${</span><span class="n">TOKENINFO_URL</span><span class="si">}</span><span class="s1">?access_token=</span><span class="si">${</span><span class="n">credentials</span><span class="p">[</span><span class="s2">&quot;access_token&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="k">new</span> <span class="n">http</span><span class="p">.</span><span class="n">Client</span><span class="p">()</span>
</span><span class='line'>      <span class="p">..</span><span class="kd">get</span><span class="p">(</span><span class="n">verifyTokenUrl</span><span class="p">).</span><span class="n">then</span><span class="p">((</span><span class="n">http</span><span class="p">.</span><span class="n">Response</span> <span class="n">response</span><span class="p">)</span>  <span class="p">{</span>
</span><span class='line'>        <span class="n">serverLogger</span><span class="p">.</span><span class="n">fine</span><span class="p">(</span><span class="s2">&quot;response = </span><span class="si">${</span><span class="n">response</span><span class="p">.</span><span class="n">body</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="kd">var</span> <span class="n">verifyResponse</span> <span class="o">=</span> <span class="n">JSON</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">body</span><span class="p">);</span>
</span><span class='line'>        <span class="kt">String</span> <span class="n">userId</span> <span class="o">=</span> <span class="n">verifyResponse</span><span class="p">.</span><span class="n">containsKey</span><span class="p">(</span><span class="s2">&quot;user_id&quot;</span><span class="p">)</span> <span class="o">?</span> <span class="n">verifyResponse</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]</span> <span class="o">:</span> <span class="kc">null</span><span class="p">;</span>
</span><span class='line'>        <span class="kt">String</span> <span class="n">accessToken</span> <span class="o">=</span> <span class="n">credentials</span><span class="p">.</span><span class="n">containsKey</span><span class="p">(</span><span class="s2">&quot;access_token&quot;</span><span class="p">)</span> <span class="o">?</span> <span class="n">credentials</span><span class="p">[</span><span class="s2">&quot;access_token&quot;</span><span class="p">]</span> <span class="o">:</span> <span class="kc">null</span><span class="p">;</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">userId</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">userId</span> <span class="o">==</span> <span class="n">gPlusId</span> <span class="o">&amp;&amp;</span> <span class="n">accessToken</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="n">context</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">session</span><span class="p">[</span><span class="s2">&quot;access_token&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">accessToken</span><span class="p">;</span>
</span><span class='line'>          <span class="n">context</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;POST OK&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>          <span class="n">context</span><span class="p">.</span><span class="n">response</span><span class="p">.</span><span class="n">statusCode</span> <span class="o">=</span> <span class="m">401</span><span class="p">;</span>
</span><span class='line'>          <span class="n">context</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;POST FAILED </span><span class="si">${</span><span class="n">userId</span><span class="si">}</span><span class="s2"> != </span><span class="si">${</span><span class="n">gPlusId</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="p">});</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now the HTTP session has the full ability to make calls on behalf of the user. The <code>/people</code> method will be called from the client to retrieve the list of visible friends of that user.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'><span class="kt">void</span> <span class="n">getPeopleHandler</span><span class="p">(</span><span class="n">FukiyaContext</span> <span class="n">context</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="kt">String</span> <span class="n">accessToken</span> <span class="o">=</span> <span class="n">context</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="n">containsKey</span><span class="p">(</span><span class="s2">&quot;access_token&quot;</span><span class="p">)</span> <span class="o">?</span> <span class="n">context</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">session</span><span class="p">[</span><span class="s2">&quot;access_token&quot;</span><span class="p">]</span> <span class="o">:</span> <span class="kc">null</span><span class="p">;</span>
</span><span class='line'>  <span class="n">SimpleOAuth2</span> <span class="n">simpleOAuth2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleOAuth2</span><span class="p">()..</span><span class="n">credentials</span> <span class="o">=</span> <span class="k">new</span> <span class="n">console_auth</span><span class="p">.</span><span class="n">Credentials</span><span class="p">(</span><span class="n">accessToken</span><span class="p">);</span>
</span><span class='line'>  <span class="n">plus</span><span class="p">.</span><span class="n">Plus</span> <span class="n">plusclient</span> <span class="o">=</span> <span class="k">new</span> <span class="n">plus</span><span class="p">.</span><span class="n">Plus</span><span class="p">(</span><span class="n">simpleOAuth2</span><span class="p">);</span>
</span><span class='line'>  <span class="n">plusclient</span><span class="p">.</span><span class="n">makeAuthRequests</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>  <span class="n">plusclient</span><span class="p">.</span><span class="n">people</span><span class="p">.</span><span class="n">list</span><span class="p">(</span><span class="s2">&quot;me&quot;</span><span class="p">,</span> <span class="s2">&quot;visible&quot;</span><span class="p">).</span><span class="n">then</span><span class="p">((</span><span class="n">plus</span><span class="p">.</span><span class="n">PeopleFeed</span> <span class="n">people</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">serverLogger</span><span class="p">.</span><span class="n">fine</span><span class="p">(</span><span class="s2">&quot;/people = </span><span class="si">$</span><span class="n">people</span><span class="s2">&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="n">context</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">people</span><span class="p">.</span><span class="n">toString</span><span class="p">());</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>The final responsibility we can bestow upon the server is allowing the client to disconnect by revoking OAuth access.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'><span class="kt">void</span> <span class="n">postDisconnectHandler</span><span class="p">(</span><span class="n">FukiyaContext</span> <span class="n">context</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="kt">String</span> <span class="n">tokenData</span> <span class="o">=</span> <span class="n">context</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="n">containsKey</span><span class="p">(</span><span class="s2">&quot;access_token&quot;</span><span class="p">)</span> <span class="o">?</span> <span class="n">context</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">session</span><span class="p">[</span><span class="s2">&quot;access_token&quot;</span><span class="p">]</span> <span class="o">:</span> <span class="kc">null</span><span class="p">;</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">tokenData</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">context</span><span class="p">.</span><span class="n">response</span><span class="p">.</span><span class="n">statusCode</span> <span class="o">=</span> <span class="m">401</span><span class="p">;</span>
</span><span class='line'>    <span class="n">context</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;Current user not connected.&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="k">return</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">final</span> <span class="kt">String</span> <span class="n">revokeTokenUrl</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">${</span><span class="n">TOKEN_REVOKE_ENDPOINT</span><span class="si">}</span><span class="s2">?token=</span><span class="si">${</span><span class="n">tokenData</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="n">context</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;access_token&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">new</span> <span class="n">http</span><span class="p">.</span><span class="n">Client</span><span class="p">()..</span><span class="kd">get</span><span class="p">(</span><span class="n">revokeTokenUrl</span><span class="p">).</span><span class="n">then</span><span class="p">((</span><span class="n">http</span><span class="p">.</span><span class="n">Response</span> <span class="n">response</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">context</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">session</span><span class="p">[</span><span class="s2">&quot;state_token&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_createStateToken</span><span class="p">();</span>
</span><span class='line'>    <span class="n">Map</span> <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>                <span class="s2">&quot;state_token&quot;</span><span class="o">:</span> <span class="n">context</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">session</span><span class="p">[</span><span class="s2">&quot;state_token&quot;</span><span class="p">],</span>
</span><span class='line'>                <span class="s2">&quot;message&quot;</span> <span class="o">:</span> <span class="s2">&quot;Successfully disconnected.&quot;</span>
</span><span class='line'>                <span class="p">};</span>
</span><span class='line'>    <span class="n">context</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">JSON</span><span class="p">.</span><span class="n">stringify</span><span class="p">(</span><span class="n">data</span><span class="p">));</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>Thats about it, Happy Dart Hacking! Special thanks to <a href="https://plus.google.com/112336147904981294875">Gerwin Sturm</a> for putting together the original example for client side. Full source code can be found at <a href="https://github.com/Scarygami/gplus-quickstart-dart">gplus-quickstart-dart</a> in the server folder. Please replace your own keys cause mine will be removed at some point.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Dart Multi Touch Canvas With Realtime APIs]]></title>
    <link href="http://financeCoding.github.com/blog/2013/03/21/dart-multi-touch-canvas-with-realtime-apis/"/>
    <updated>2013-03-21T18:19:00-07:00</updated>
    <id>http://financeCoding.github.com/blog/2013/03/21/dart-multi-touch-canvas-with-realtime-apis</id>
    <content type="html"><![CDATA[<p><a href="https://developers.google.com/drive/">Google</a> has made the <a href="https://developers.google.com/drive/realtime/">realtime</a> api available for developers. Realtime api provides <a href="http://en.wikipedia.org/wiki/Operational_transformation">operational transformation</a> on <a href="https://developers.google.com/drive/realtime/reference/gapi.drive.realtime.CollaborativeString">strings</a>, <a href="https://developers.google.com/drive/realtime/reference/gapi.drive.realtime.CollaborativeList">lists</a>, <a href="https://developers.google.com/drive/realtime/reference/gapi.drive.realtime.CollaborativeMap">maps</a> and custom <a href="https://developers.google.com/drive/realtime/reference/gapi.drive.realtime.CollaborativeObject">objects</a>. The application data gets stored on Google Drive and is available from any supported browser. This is going to be the tooling of the future for collaborative applications.</p>

<p>I took some time to see what it would take for implementing a sample realtime application in dart. Also wanted to make sure my sample could run on mobile chrome.</p>

<p>Since realtime api is new, dart bindings don&#8217;t really exist. Lucky for us we have <a href="http://pub.dartlang.org/packages/js">js-interop</a> library. The <a href="http://pub.dartlang.org/packages/js">js-interop</a> library provides communications to existing javascript code from dart. I consider this mostly a quick hack to get started with the realtime api until a more native interface exists.</p>

<p>The sample <a href="http://financecoding.github.com/realtime_touch_canvas/web/index.html">realtime_touch_canvas</a> demonstrates a multi touch canvas surface that updates in realtime with all clients that have the application open.</p>

<iframe width="560" height="315" src="http://www.youtube.com/embed/xArfJdOb55Q" frameborder="0" allowfullscreen></iframe>


<p>Most of the heavy lifting is done by <a href="https://github.com/financeCoding/realtime_touch_canvas"><code>rtclient.dart</code></a>. I ported the <a href="https://github.com/googledrive/realtime-playground/blob/master/js/realtime-client-utils.js">code</a> from the javascript version. Its enough code to get started right away but a more structured solution should be done. The main class is <code>RealTimeLoader</code> used for realtime loading.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'>  <span class="n">rtl</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RealTimeLoader</span><span class="p">(</span><span class="nl">clientId:</span> <span class="s1">&#39;CLIENTID.apps.googleusercontent.com&#39;</span><span class="p">,</span> <span class="nl">apiKey:</span> <span class="s1">&#39;KEY&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="n">rtl</span><span class="p">.</span><span class="n">start</span><span class="p">().</span><span class="n">then</span><span class="p">((</span><span class="kt">bool</span> <span class="n">isComplete</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="cm">/* RealTimeLoader has authenticated the application and is ready to load a file */</span>
</span><span class='line'>    <span class="n">loadRealTimeFile</span><span class="p">(</span><span class="n">fileId</span><span class="p">,</span> <span class="n">model</span><span class="p">.</span><span class="n">onFileLoaded</span><span class="p">,</span> <span class="n">model</span><span class="p">.</span><span class="n">initializeModel</span><span class="p">);</span>
</span><span class='line'>  <span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>model.onFileLoaded</code> and <code>model.initializeModel</code> handle the creating of model data and loading of model data.</p>

<p>In the <a href="http://financecoding.github.com/realtime_touch_canvas/web/index.html">realtime_touch_canvas</a>, model data was a simple list of json strings. The ticky part here is you need to remember that your working with the realtime api within the javascript vm. So an array needs to be allocated from <a href="http://pub.dartlang.org/packages/js">js-interop</a>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'>  <span class="kt">void</span> <span class="n">_createNewModel</span><span class="p">(</span><span class="n">js</span><span class="p">.</span><span class="n">Proxy</span> <span class="n">model</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="n">list</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">createList</span><span class="p">(</span><span class="n">js</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">_defaultLines</span><span class="p">));</span>
</span><span class='line'>    <span class="n">model</span><span class="p">.</span><span class="n">getRoot</span><span class="p">().</span><span class="kd">set</span><span class="p">(</span><span class="n">_linesName</span><span class="p">,</span> <span class="n">list</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>After the model is created we then get called to load the file. Loading the file for our purposes is binding the collaborative objects. Some tricky things to note here is we are retaining the javascript objects so we can access them after exit of the callback. Also the callbacks have to be wrapped within <a href="http://pub.dartlang.org/packages/js">js-interop</a> <code>js.Callback.many</code> proxy object. The callbacks <code>_linesOnAddValuesChangedEvent</code> and <code>_linesOnRemovedValuesChangedEvent</code> are fired off when the collaborative list object has items added or removed.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'>  <span class="n">js</span><span class="p">.</span><span class="n">Proxy</span> <span class="n">_doc</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">String</span> <span class="n">_linesName</span> <span class="o">=</span> <span class="s2">&quot;lines&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="n">js</span><span class="p">.</span><span class="n">Proxy</span> <span class="n">_lines</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="kt">void</span> <span class="n">_bindModel</span><span class="p">(</span><span class="n">js</span><span class="p">.</span><span class="n">Proxy</span> <span class="n">doc</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">_doc</span> <span class="o">=</span> <span class="n">doc</span><span class="p">;</span>
</span><span class='line'>    <span class="n">js</span><span class="p">.</span><span class="n">retain</span><span class="p">(</span><span class="n">_doc</span><span class="p">);</span>
</span><span class='line'>    <span class="n">_lines</span> <span class="o">=</span> <span class="n">doc</span><span class="p">.</span><span class="n">getModel</span><span class="p">().</span><span class="n">getRoot</span><span class="p">().</span><span class="kd">get</span><span class="p">(</span><span class="n">_linesName</span><span class="p">);</span>
</span><span class='line'>    <span class="n">_lines</span><span class="p">.</span><span class="n">addEventListener</span><span class="p">(</span><span class="n">gapi</span><span class="p">.</span><span class="n">drive</span><span class="p">.</span><span class="n">realtime</span><span class="p">.</span><span class="n">EventType</span><span class="p">.</span><span class="n">VALUES_ADDED</span><span class="p">,</span> <span class="k">new</span> <span class="n">js</span><span class="p">.</span><span class="n">Callback</span><span class="p">.</span><span class="n">many</span><span class="p">(</span><span class="n">_linesOnAddValuesChangedEvent</span><span class="p">));</span>
</span><span class='line'>    <span class="n">_lines</span><span class="p">.</span><span class="n">addEventListener</span><span class="p">(</span><span class="n">gapi</span><span class="p">.</span><span class="n">drive</span><span class="p">.</span><span class="n">realtime</span><span class="p">.</span><span class="n">EventType</span><span class="p">.</span><span class="n">VALUES_REMOVED</span><span class="p">,</span> <span class="k">new</span> <span class="n">js</span><span class="p">.</span><span class="n">Callback</span><span class="p">.</span><span class="n">many</span><span class="p">(</span><span class="n">_linesOnRemovedValuesChangedEvent</span><span class="p">));</span>
</span><span class='line'>    <span class="n">js</span><span class="p">.</span><span class="n">retain</span><span class="p">(</span><span class="n">_lines</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>When the callback is called the data would be in the javascript virtual machine so we can parse it and store in our native dart code. This is more of a convenience then a must do, that way we can expose plan old dart objects to our other parts of the dart application.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'>  <span class="kt">void</span> <span class="n">_linesOnAddValuesChangedEvent</span><span class="p">(</span><span class="n">addedValue</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="n">insertedLine</span> <span class="o">=</span> <span class="n">_lines</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="n">addedValue</span><span class="p">.</span><span class="n">index</span><span class="p">);</span>
</span><span class='line'>    <span class="kd">var</span> <span class="n">line</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Line</span><span class="p">.</span><span class="n">fromJson</span><span class="p">(</span><span class="n">insertedLine</span><span class="p">);</span>
</span><span class='line'>    <span class="n">realtimeTouchCanvas</span><span class="p">.</span><span class="n">move</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">line</span><span class="p">.</span><span class="n">moveX</span><span class="p">,</span> <span class="n">line</span><span class="p">.</span><span class="n">moveY</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>Now when we want to store a line in the application we simply convert it to json and push it into the collaborative list. The little tick here is to make sure we are <code>scoped</code> when accessing the <code>_lines</code> object since it lives in the javascript virtual machine.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'>  <span class="kt">void</span> <span class="n">addLine</span><span class="p">(</span><span class="n">Line</span> <span class="n">line</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">js</span><span class="p">.</span><span class="n">scoped</span><span class="p">(()</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">_lines</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">line</span><span class="p">.</span><span class="n">toJson</span><span class="p">());</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>  <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The <a href="http://financecoding.github.com/realtime_touch_canvas/web/index.html">realtime_touch_canvas</a> is live on github gh-pages and <a href="https://github.com/financeCoding/realtime_touch_canvas">realtime_touch_canvas source</a> is available.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[rikulo stream on heroku]]></title>
    <link href="http://financeCoding.github.com/blog/2013/03/09/rikulo-stream-on-heroku/"/>
    <updated>2013-03-09T07:16:00-08:00</updated>
    <id>http://financeCoding.github.com/blog/2013/03/09/rikulo-stream-on-heroku</id>
    <content type="html"><![CDATA[<p>Tonights hacking was with <a href="https://github.com/rikulo/stream">stream</a> and <a href="http://www.heroku.com/">heroku</a>. <em>Stream is a Dart web server supporting request routing, filtering, template technology, file-based static resources and MVC design pattern.</em> I just planned on serving static content from <a href="http://www.heroku.com/">heroku</a> using full dart based web server.</p>

<p>First setup the dart build pack</p>

<figure class='code'><figcaption><span>shell</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>adam@Adams-MacBook-Air:~/dart
</span><span class='line'><span class="nv">$ </span>mkdir stream_todomvc
</span><span class='line'>
</span><span class='line'>adam@Adams-MacBook-Air:~/dart/stream_todomvc
</span><span class='line'><span class="nv">$ </span><span class="nb">cd </span>stream_todomvc
</span><span class='line'>
</span><span class='line'>adam@Adams-MacBook-Air:~/dart/stream_todomvc
</span><span class='line'><span class="nv">$ </span>heroku create stream-todomvc
</span><span class='line'>
</span><span class='line'>adam@Adams-MacBook-Air:~/dart/stream_todomvc
</span><span class='line'><span class="nv">$ </span>heroku config:add <span class="nv">BUILDPACK_URL</span><span class="o">=</span>https://github.com/igrigorik/heroku-buildpack-dart.git
</span><span class='line'>
</span><span class='line'>adam@Adams-MacBook-Air:~/dart/stream_todomvc
</span><span class='line'><span class="nv">$ </span>git init
</span><span class='line'>
</span><span class='line'>adam@Adams-MacBook-Air:~/dart/stream_todomvc
</span><span class='line'><span class="nv">$ </span>git remote add heroku git@heroku.com:stream-todomvc.git
</span></code></pre></td></tr></table></div></figure>


<p>Creating a new project called <code>stream-todomvc</code>. Going to use the <a href="https://github.com/dart-lang/web-ui/tree/master/example/todomvc">todomvc</a> from the <a href="https://github.com/dart-lang/web-ui">web-ui</a> project as our content for the <a href="https://github.com/rikulo/stream">stream</a> server. First thing that should be done is adding the dependencies to the <code>pubspec.yaml</code> file.</p>

<figure class='code'><figcaption><span>pubspec.yaml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">stream_todomvc</span>
</span><span class='line'><span class="l-Scalar-Plain">description</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">A sample WebUI application</span>
</span><span class='line'><span class="l-Scalar-Plain">dependencies</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="l-Scalar-Plain">browser</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">any</span>
</span><span class='line'>  <span class="l-Scalar-Plain">js</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">any</span>
</span><span class='line'>  <span class="l-Scalar-Plain">web_ui</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">0.4.1+7</span>
</span><span class='line'>  <span class="l-Scalar-Plain">stream</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">0.5.5+1</span>
</span></code></pre></td></tr></table></div></figure>


<p>Next I simply compied the existing <a href="https://github.com/dart-lang/web-ui/tree/master/example/todomvc">todomvc</a> project out into my <a href="http://stream-todomvc.herokuapp.com/out/index.html">stream-todomvc</a> project.</p>

<figure class='code'><figcaption><span>shell</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>adam@Adams-MacBook-Air:~/dart/stream_todomvc
</span><span class='line'><span class="nv">$ </span>cp ~/dart/web-ui/example/todomvc/* ./web/
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p><a href="http://docs.rikulo.org/stream/latest/Getting_Started/Introduction.html">stream intro</a> documentation goes over some basic configurations and settings. I&#8217;m just going to use them for now to get something running right away. The key to note when serving code from the <code>web/</code> folder in dart projects is having the <a href="https://github.com/rikulo/stream">stream</a> server code in <code>web/webapp/</code>. That way <a href="https://github.com/rikulo/stream">stream</a> can find all your resources with little configuration. With very little dart code we can have static web server going.</p>

<figure class='code'><figcaption><span>web/webapp/server.dart</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'><span class="n">library</span> <span class="n">server</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">import</span> <span class="s1">&#39;dart:io&#39;</span><span class="p">;</span>
</span><span class='line'><span class="n">import</span> <span class="s2">&quot;package:stream/stream.dart&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="n">port</span> <span class="o">=</span> <span class="n">Platform</span><span class="p">.</span><span class="n">environment</span><span class="p">.</span><span class="n">containsKey</span><span class="p">(</span><span class="s1">&#39;PORT&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="kt">int</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="n">Platform</span><span class="p">.</span><span class="n">environment</span><span class="p">[</span><span class="s1">&#39;PORT&#39;</span><span class="p">])</span> <span class="o">:</span> <span class="m">8080</span><span class="p">;</span>
</span><span class='line'>  <span class="kd">var</span> <span class="n">host</span> <span class="o">=</span> <span class="s1">&#39;0.0.0.0&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="kd">var</span> <span class="n">streamServer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StreamServer</span><span class="p">();</span>
</span><span class='line'>  <span class="n">streamServer</span>
</span><span class='line'>  <span class="p">..</span><span class="n">port</span> <span class="o">=</span> <span class="n">port</span>
</span><span class='line'>  <span class="p">..</span><span class="n">host</span> <span class="o">=</span> <span class="n">host</span>
</span><span class='line'>  <span class="p">..</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Since this was a <a href="https://github.com/dart-lang/web-ui">web-ui</a> project we need to have a <code>build.dart</code> file help us with transforming the polyfill web components.</p>

<figure class='code'><figcaption><span>build.dart</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'><span class="n">import</span> <span class="s1">&#39;dart:io&#39;</span><span class="p">;</span>
</span><span class='line'><span class="n">import</span> <span class="s1">&#39;package:web_ui/component_build.dart&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">main</span><span class="p">()</span> <span class="o">=&gt;</span> <span class="n">build</span><span class="p">(</span><span class="k">new</span> <span class="n">Options</span><span class="p">().</span><span class="n">arguments</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;web/index.html&#39;</span><span class="p">]);</span>
</span></code></pre></td></tr></table></div></figure>


<p>The <a href="http://www.heroku.com/">heroku</a> environment requires a <a href="https://devcenter.heroku.com/articles/procfile">procfile</a> configuration to let the service know the type of commands to run.</p>

<figure class='code'><figcaption><span>Procfile</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>web: ./dart-sdk/bin/dart --package-root=./packages/ web/webapp/server.dart
</span></code></pre></td></tr></table></div></figure>


<p>Next we build all the static data for our webapp to function. This will include calling <code>build.dart</code> and <code>dart2js</code>. The second step of calling <code>dart2js</code> helps with clients that do not have the <code>dartvm</code> built in.</p>

<figure class='code'><figcaption><span>shell</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>adam@Adams-MacBook-Air:~/dart/stream_todomvc
</span><span class='line'><span class="nv">$ </span>pub install
</span><span class='line'>Resolving dependencies...
</span><span class='line'>Dependencies installed!
</span><span class='line'>
</span><span class='line'>adam@Adams-MacBook-Air:~/dart/stream_todomvc
</span><span class='line'><span class="nv">$ </span>dart build.dart
</span><span class='line'>Total <span class="nb">time </span>spent on web/index.html                           -- 839 ms
</span><span class='line'>Total <span class="nb">time</span>                                                   -- 863 ms
</span><span class='line'>
</span><span class='line'>adam@Adams-MacBook-Air:~/dart/stream_todomvc
</span><span class='line'><span class="nv">$ </span>dart2js -oweb/out/index.html_bootstrap.dart.js web/out/index.html_bootstrap.dart
</span><span class='line'>Using snapshot /Users/adam/Documents/DartEditor/dart/dart-sdk/lib/_internal/compiler/implementation/dart2js.dart.snapshot
</span></code></pre></td></tr></table></div></figure>


<p>Now everything should be ready for deployment.</p>

<figure class='code'><figcaption><span>shell</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>adam@Adams-MacBook-Air:~/dart/stream_todomvc
</span><span class='line'><span class="nv">$ </span>git add -a -m <span class="s2">&quot;ready for deploy&quot;</span>
</span><span class='line'>
</span><span class='line'>adam@Adams-MacBook-Air:~/dart/stream_todomvc
</span><span class='line'><span class="nv">$ </span>git push -v --set-upstream heroku master:master
</span><span class='line'>Pushing to git@heroku.com:stream-todomvc.git
</span><span class='line'>Counting objects: 5, <span class="k">done</span>.
</span><span class='line'>Delta compression using up to 4 threads.
</span><span class='line'>Compressing objects: 100% <span class="o">(</span>3/3<span class="o">)</span>, <span class="k">done</span>.
</span><span class='line'>Writing objects: 100% <span class="o">(</span>3/3<span class="o">)</span>, 283 bytes, <span class="k">done</span>.
</span><span class='line'>Total 3 <span class="o">(</span>delta 2<span class="o">)</span>, reused 0 <span class="o">(</span>delta 0<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>-----&gt; Fetching custom git buildpack... <span class="k">done</span>
</span><span class='line'>-----&gt; Dart app detected
</span><span class='line'>-----&gt; Installing Dart VM, build: latest
</span><span class='line'>-----&gt; Copy Dart binaries to app root
</span><span class='line'>-----&gt; Install packages
</span><span class='line'>*** Found pubspec.yaml in .
</span><span class='line'>Resolving dependencies...
</span><span class='line'>Dependencies installed!
</span><span class='line'>Fixed web symlink
</span><span class='line'>-----&gt; Discovering process types
</span><span class='line'>       Procfile declares types -&gt; web
</span><span class='line'>
</span><span class='line'>-----&gt; Compiled slug size: 8.9MB
</span><span class='line'>-----&gt; Launching... <span class="k">done</span>, v7
</span><span class='line'>       http://stream-todomvc.herokuapp.com deployed to Heroku
</span><span class='line'>
</span><span class='line'>To git@heroku.com:stream-todomvc.git
</span><span class='line'>   042f1f4..b35984b  master -&gt; master
</span><span class='line'>updating <span class="nb">local </span>tracking ref <span class="s1">&#39;refs/remotes/heroku/master&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Deploying to <a href="http://www.heroku.com/">heroku</a> in this style is just a good starting point. <a href="https://github.com/dart-lang/web-ui">web-ui</a> and <a href="http://www.dartlang.org">dart</a> in general is still working on a deployment story. The URL for the <a href="http://stream-todomvc.herokuapp.com/out/index.html">stream-todomvc</a> will contain <code>out</code> in its location, not very desirable. In the future a <a href="https://github.com/dart-lang/buildtool">buildtool</a> will aid the deployment story for <a href="http://www.dartlang.org">dart</a>.</p>

<p>Check out the live version of <a href="http://stream-todomvc.herokuapp.com/out/index.html">stream-todomvc</a> with full source code available at the <a href="https://github.com/financeCoding/stream-todomvc">stream-todomvc github project</a>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Dart Google Client Apis Now Available On Pub]]></title>
    <link href="http://financeCoding.github.com/blog/2013/02/08/google-client-apis-now-available-on-pub/"/>
    <updated>2013-02-08T14:18:00-08:00</updated>
    <id>http://financeCoding.github.com/blog/2013/02/08/google-client-apis-now-available-on-pub</id>
    <content type="html"><![CDATA[<p>The <a href="https://github.com/dart-gde?tab=members">dart-gde</a> team now brings you not only a generator to create google client apis but also <a href="http://pub.dartlang.org">pub.dartlang.org</a> hosted packages. Lot of thanks goes to <a href="https://profiles.google.com/scarygami">Gerwin Sturm</a> for all of his hard work over the last few weeks developing <a href="https://github.com/dart-gde/discovery_api_dart_client_generator">discovery_api_dart_client_generator</a> and <a href="https://github.com/dart-gde/dart-google-oauth2-library">dart-google-oauth2-library</a>.</p>

<p>We plan to keep the client libraries up to date with <a href="https://github.com/dart-gde/discovery_api_dart_client_generator/blob/master/tool/update.dart">uploader.dart</a> script. Still somewhat a manual process, future automation could happen when/if we have the ability to get notified about google api changes. For now we will push updates when appropriate. This will ensure that we can push the latest versions of the apis to pub and still have previous revisions available. Some of the more intricate parts of this script include auto version incrementing pubspec files and syncing to github, then pushing to pub.</p>

<p>Would you want to contribute to this project? Please feel free to ping us <a href="https://profiles.google.com/financeCoding">Adam Singer</a>/<a href="https://profiles.google.com/scarygami">Gerwin Sturm</a> on <a href="https://plus.google.com">g+</a>, we&#8217;re definitely looking to refactor some parts and test others. Our main focus for this release was to get something out the door that is pleasantly usable.</p>

<p>Many hours of testing and development was done to have a simple and easy way to use the google client apis in dart! We hope you enjoy and look forward to seeing what you build.
To get started with client api examples check out <a href="https://github.com/dart-gde/dart_api_client_examples">dart_api_client_examples</a>. The <a href="http://www.github.com">github</a> hosted source code can be found at <a href="https://github.com/dart-google-apis">dart-google-apis</a></p>

<h3>Full list of available Google client apis on <a href="http://pub.dartlang.org">pub.dartlang.org</a></h3>

<ul>
<li><a href="http://pub.dartlang.org/packages/google_adexchangebuyer_v1_api">google_adexchangebuyer_v1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_adexchangebuyer_v1_1_api">google_adexchangebuyer_v1_1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_adexchangeseller_v1_api">google_adexchangeseller_v1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_adsense_v1_api">google_adsense_v1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_adsense_v1_1_api">google_adsense_v1_1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_adsense_v1_2_api">google_adsense_v1_2_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_adsensehost_v4_1_api">google_adsensehost_v4_1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_analytics_v2_4_api">google_analytics_v2_4_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_analytics_v3_api">google_analytics_v3_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_androidpublisher_v1_api">google_androidpublisher_v1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_audit_v1_api">google_audit_v1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_bigquery_v2_api">google_bigquery_v2_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_blogger_v2_api">google_blogger_v2_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_blogger_v3_api">google_blogger_v3_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_books_v1_api">google_books_v1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_calendar_v3_api">google_calendar_v3_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_civicinfo_us_v1_api">google_civicinfo_us_v1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_compute_v1beta12_api">google_compute_v1beta12_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_compute_v1beta13_api">google_compute_v1beta13_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_compute_v1beta14_api">google_compute_v1beta14_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_coordinate_v1_api">google_coordinate_v1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_customsearch_v1_api">google_customsearch_v1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_dfareporting_v1_api">google_dfareporting_v1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_dfareporting_v1_1_api">google_dfareporting_v1_1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_discovery_v1_api">google_discovery_v1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_drive_v1_api">google_drive_v1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_drive_v2_api">google_drive_v2_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_freebase_v1sandbox_api">google_freebase_v1sandbox_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_freebase_v1_api">google_freebase_v1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_fusiontables_v1_api">google_fusiontables_v1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_gan_v1beta1_api">google_gan_v1beta1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_groupsmigration_v1_api">google_groupsmigration_v1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_groupssettings_v1_api">google_groupssettings_v1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_latitude_v1_api">google_latitude_v1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_licensing_v1_api">google_licensing_v1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_oauth2_v1_api">google_oauth2_v1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_oauth2_v2_api">google_oauth2_v2_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_orkut_v2_api">google_orkut_v2_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_pagespeedonline_v1_api">google_pagespeedonline_v1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_plus_v1moments_api">google_plus_v1moments_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_plus_v1_api">google_plus_v1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_prediction_v1_2_api">google_prediction_v1_2_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_prediction_v1_3_api">google_prediction_v1_3_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_prediction_v1_4_api">google_prediction_v1_4_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_prediction_v1_5_api">google_prediction_v1_5_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_reseller_v1sandbox_api">google_reseller_v1sandbox_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_reseller_v1_api">google_reseller_v1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_shopping_v1_api">google_shopping_v1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_siteverification_v1_api">google_siteverification_v1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_storage_v1beta1_api">google_storage_v1beta1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_taskqueue_v1beta1_api">google_taskqueue_v1beta1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_taskqueue_v1beta2_api">google_taskqueue_v1beta2_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_tasks_v1_api">google_tasks_v1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_translate_v2_api">google_translate_v2_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_urlshortener_v1_api">google_urlshortener_v1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_webfonts_v1_api">google_webfonts_v1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_youtube_v3_api">google_youtube_v3_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_youtubeanalytics_v1_api">google_youtubeanalytics_v1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_youtubeanalytics_v1beta1_api">google_youtubeanalytics_v1beta1_api</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Using createDartAnalyzerTask in bot.dart to ensure sanity]]></title>
    <link href="http://financeCoding.github.com/blog/2013/02/07/using-createdartanalyzertask-in-bot-dot-dart-to-ensure-sanity/"/>
    <updated>2013-02-07T19:47:00-08:00</updated>
    <id>http://financeCoding.github.com/blog/2013/02/07/using-createdartanalyzertask-in-bot-dot-dart-to-ensure-sanity</id>
    <content type="html"><![CDATA[<p><a href="http://drone.io">drone.io</a> has really proven to be useful for <a href="http://www.dartlang.org">dart</a> projects. One common pattern I find my self doing with projects these days is running the <code>dart_analyzer</code> before running unit tests. Had a <a href="https://github.com/kevmoo/bot.dart/issues/36">discussion</a> with <a href="https://github.com/kevmoo">Kevin Moore</a> about having a <code>dart_analyzer</code> task included in <code>hop</code>, part of the <a href="https://github.com/kevmoo/bot.dart">bot.dart</a> framework. We both agreed it would be nice to automate that task and not have shell scripts running the show. Thus <a href="http://kevmoo.github.com/bot.dart/hop_tasks.html#createDartAnalyzerTask"><code>createDartAnalyzerTask</code></a> was born. <code>createDartAnalyzerTask</code> allows you to add dart scripts that are libraries or main entry points to be analyzed by <code>dart_analyzer</code>, this allows for a first step of safety, so that code you have passes the static checker. It does not mean your code is perfect but can help you find warnings and errors. A great combination for this is pairing it up with <a href="http://drone.io">drone.io</a>, that way when a new sdk comes out drone can let you know automatically if it passes static checker.</p>

<p><em>Lets see this in action</em></p>

<p>First step is to add bot to your <code>pubspec.yaml</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">dependencies</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="l-Scalar-Plain">browser</span><span class="p-Indicator">:</span> <span class="s">&quot;&gt;=0.3.4&quot;</span>
</span><span class='line'>  <span class="l-Scalar-Plain">unittest</span><span class="p-Indicator">:</span> <span class="s">&quot;&gt;=0.3.4&quot;</span>
</span><span class='line'>  <span class="l-Scalar-Plain">bot</span><span class="p-Indicator">:</span> <span class="s">&quot;&gt;=0.12.0&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Create a minimal <code>tool/hop_runner.dart</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'><span class="n">library</span> <span class="n">hop_runner</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">import</span> <span class="s1">&#39;dart:async&#39;</span><span class="p">;</span>
</span><span class='line'><span class="n">import</span> <span class="s1">&#39;dart:io&#39;</span><span class="p">;</span>
</span><span class='line'><span class="n">import</span> <span class="s1">&#39;package:bot/bot.dart&#39;</span><span class="p">;</span>
</span><span class='line'><span class="n">import</span> <span class="s1">&#39;package:bot/hop.dart&#39;</span><span class="p">;</span>
</span><span class='line'><span class="n">import</span> <span class="s1">&#39;package:bot/hop_tasks.dart&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">//</span>
</span><span class='line'>  <span class="c1">// Analyzer</span>
</span><span class='line'>  <span class="c1">//</span>
</span><span class='line'>  <span class="n">addTask</span><span class="p">(</span><span class="s1">&#39;analyze_lib&#39;</span><span class="p">,</span> <span class="n">createDartAnalyzerTask</span><span class="p">([</span><span class="s1">&#39;lib/stats.dart&#39;</span><span class="p">]));</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">//</span>
</span><span class='line'>  <span class="c1">// Hop away!</span>
</span><span class='line'>  <span class="c1">//</span>
</span><span class='line'>  <span class="n">runHopCore</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Add a <code>bin/hop</code> script to your project, <code>bin/hop</code> script is not required but does help manage some flags you might be interested in having.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/bin/bash</span>
</span><span class='line'><span class="nv">PACK_DIR</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>/packages/
</span><span class='line'><span class="nv">cmd</span><span class="o">=</span><span class="s2">&quot;dart</span>
</span><span class='line'><span class="s2">--enable_asserts</span>
</span><span class='line'><span class="s2">--enable_checked_mode</span>
</span><span class='line'><span class="s2">--enable_type_checks</span>
</span><span class='line'><span class="s2">--error_on_malformed_type</span>
</span><span class='line'><span class="s2">--package-root=$PACK_DIR</span>
</span><span class='line'><span class="s2">--verbose_debug</span>
</span><span class='line'><span class="s2">--warning_as_error</span>
</span><span class='line'><span class="s2">./tool/hop_runner.dart $@&quot;</span>
</span><span class='line'><span class="nb">exec</span> <span class="nv">$cmd</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now <code>hop</code> away!</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>19:41:54-adam@Adams-MacBook-Air:~/dart/stats.dart
</span><span class='line'><span class="nv">$ </span>hop analyze_lib
</span><span class='line'>analyze_lib: PASSED - lib/stats.dart
</span><span class='line'>analyze_lib: PASSED: 1, WARNING: 0, ERROR: 0
</span><span class='line'>Finished
</span></code></pre></td></tr></table></div></figure>


<p>Now lets say we have the following warning of <code>String i = 42;</code>, bot can provide us a summary of warnings we might have in our code.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'><span class="n">library</span> <span class="n">not_cool_lib</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="kt">String</span> <span class="n">i</span> <span class="o">=</span> <span class="m">42</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Adding the library to our task</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'>  <span class="c1">//</span>
</span><span class='line'>  <span class="c1">// Analyzer</span>
</span><span class='line'>  <span class="c1">//</span>
</span><span class='line'>  <span class="n">addTask</span><span class="p">(</span><span class="s1">&#39;analyze_lib&#39;</span><span class="p">,</span> <span class="n">createDartAnalyzerTask</span><span class="p">([</span><span class="s1">&#39;lib/stats.dart&#39;</span><span class="p">,</span> <span class="s1">&#39;lib/notcoollib.dart&#39;</span><span class="p">]));</span>
</span></code></pre></td></tr></table></div></figure>


<p>Executing <code>hop</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'><span class="m">20</span><span class="o">:</span><span class="m">04</span><span class="o">:</span><span class="m">55</span><span class="o">-</span><span class="n">adam</span><span class="err">@</span><span class="n">Adams</span><span class="o">-</span><span class="n">MacBook</span><span class="o">-</span><span class="nl">Air:</span><span class="o">~/</span><span class="n">dart</span><span class="o">/</span><span class="n">stats</span><span class="p">.</span><span class="n">dart</span>
</span><span class='line'><span class="n">$</span> <span class="n">hop</span> <span class="n">analyze_lib</span>
</span><span class='line'><span class="nl">analyze_lib:</span> <span class="n">PASSED</span> <span class="o">-</span> <span class="n">lib</span><span class="o">/</span><span class="n">stats</span><span class="p">.</span><span class="n">dart</span>
</span><span class='line'><span class="nl">analyze_lib:</span> <span class="n">WARNING</span> <span class="o">-</span> <span class="n">lib</span><span class="o">/</span><span class="n">notcoollib</span><span class="p">.</span><span class="n">dart</span>
</span><span class='line'><span class="nl">analyze_lib:</span> <span class="nl">PASSED:</span> <span class="m">1</span><span class="p">,</span> <span class="nl">WARNING:</span> <span class="m">1</span><span class="p">,</span> <span class="nl">ERROR:</span> <span class="m">0</span>
</span><span class='line'><span class="n">Finished</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now we have a warning, but since dart is a dynamic langauge we should not treat that as an error <em>(at some point we might provide the option of making warnings fail <a href="http://drone.io">drone.io</a>)</em>.</p>

<p>If we introduce a real error, the task runner should yell at us.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'><span class="n">library</span> <span class="n">not_cool_lib</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="kt">String</span> <span class="n">i</span> <span class="o">=</span> <span class="m">42</span><span class="p">;</span>
</span><span class='line'>  <span class="n">bam</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>And it does!</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'><span class="m">20</span><span class="o">:</span><span class="m">11</span><span class="o">:</span><span class="m">38</span><span class="o">-</span><span class="n">adam</span><span class="err">@</span><span class="n">Adams</span><span class="o">-</span><span class="n">MacBook</span><span class="o">-</span><span class="nl">Air:</span><span class="o">~/</span><span class="n">dart</span><span class="o">/</span><span class="n">stats</span><span class="p">.</span><span class="n">dart</span>
</span><span class='line'><span class="n">$</span> <span class="n">hop</span> <span class="n">analyze_lib</span>
</span><span class='line'><span class="nl">analyze_lib:</span> <span class="n">PASSED</span> <span class="o">-</span> <span class="n">lib</span><span class="o">/</span><span class="n">stats</span><span class="p">.</span><span class="n">dart</span>
</span><span class='line'><span class="nl">analyze_lib:</span> <span class="n">ERROR</span> <span class="o">-</span> <span class="n">lib</span><span class="o">/</span><span class="n">notcoollib</span><span class="p">.</span><span class="n">dart</span>
</span><span class='line'><span class="nl">analyze_lib:</span> <span class="nl">PASSED:</span> <span class="m">1</span><span class="p">,</span> <span class="nl">WARNING:</span> <span class="m">0</span><span class="p">,</span> <span class="nl">ERROR:</span> <span class="m">1</span>
</span><span class='line'><span class="nl">analyze_lib:</span> <span class="n">Failed</span>
</span><span class='line'><span class="n">Failed</span>
</span><span class='line'><span class="m">20</span><span class="o">:</span><span class="m">18</span><span class="o">:</span><span class="m">11</span><span class="o">-</span><span class="n">adam</span><span class="err">@</span><span class="n">Adams</span><span class="o">-</span><span class="n">MacBook</span><span class="o">-</span><span class="nl">Air:</span><span class="o">~/</span><span class="n">dart</span><span class="o">/</span><span class="n">stats</span><span class="p">.</span><span class="n">dart</span>
</span><span class='line'><span class="n">$</span> <span class="n">echo</span> <span class="n">$</span><span class="o">?</span>
</span><span class='line'><span class="m">80</span>
</span></code></pre></td></tr></table></div></figure>


<p>The exit code will let <a href="http://drone.io">drone.io</a> know that we did not exit cleanly. I love <a href="http://drone.io">drone.io</a> for this reason, it&#8217;s simple to get setup right away with little fuss.</p>

<p>A complete run on <a href="http://drone.io">drone.io</a> might look something as follows</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'><span class="n">$</span> <span class="n">git</span> <span class="n">clone</span> <span class="nl">git:</span><span class="c1">//github.com/Dartist/stats.dart.git /home/ubuntu/src/github.com/Dartist/stats.dart </span>
</span><span class='line'><span class="n">Cloning</span> <span class="kt">int</span><span class="n">o</span> <span class="s1">&#39;/home/ubuntu/src/github.com/Dartist/stats.dart&#39;</span><span class="p">...</span>
</span><span class='line'><span class="n">$</span> <span class="n">dart</span> <span class="o">--</span><span class="n">version</span>
</span><span class='line'><span class="n">Dart</span> <span class="n">VM</span> <span class="nl">version:</span> <span class="m">0.3</span><span class="p">.</span><span class="m">4.0</span><span class="n">_r18115</span> <span class="p">(</span><span class="n">Tue</span> <span class="n">Feb</span>  <span class="m">5</span> <span class="m">05</span><span class="o">:</span><span class="m">53</span><span class="o">:</span><span class="m">42</span> <span class="m">2013</span><span class="p">)</span>
</span><span class='line'><span class="n">$</span> <span class="n">cat</span> <span class="n">$DART_SDK</span><span class="o">/</span><span class="n">revision</span>
</span><span class='line'><span class="m">18137</span>
</span><span class='line'><span class="n">$</span> <span class="n">sudo</span> <span class="n">start</span> <span class="n">xvfb</span>
</span><span class='line'><span class="n">xvfb</span> <span class="n">start</span><span class="o">/</span><span class="n">running</span><span class="p">,</span> <span class="n">process</span> <span class="m">1017</span>
</span><span class='line'><span class="n">$</span> <span class="n">pub</span> <span class="n">install</span>
</span><span class='line'><span class="n">Resolving</span> <span class="n">dependencies</span><span class="p">...</span>
</span><span class='line'><span class="n">Downloading</span> <span class="n">browser</span> <span class="m">0.3</span><span class="p">.</span><span class="m">4.</span><span class="p">..</span>
</span><span class='line'><span class="n">Downloading</span> <span class="n">bot</span> <span class="m">0.12</span><span class="p">.</span><span class="m">1.</span><span class="p">..</span>
</span><span class='line'><span class="n">Downloading</span> <span class="n">unittest</span> <span class="m">0.3</span><span class="p">.</span><span class="m">4.</span><span class="p">..</span>
</span><span class='line'><span class="n">Downloading</span> <span class="n">logging</span> <span class="m">0.3</span><span class="p">.</span><span class="m">4.</span><span class="p">..</span>
</span><span class='line'><span class="n">Downloading</span> <span class="n">args</span> <span class="m">0.3</span><span class="p">.</span><span class="m">4.</span><span class="p">..</span>
</span><span class='line'><span class="n">Downloading</span> <span class="n">meta</span> <span class="m">0.3</span><span class="p">.</span><span class="m">4.</span><span class="p">..</span>
</span><span class='line'><span class="n">Dependencies</span> <span class="n">installed</span><span class="o">!</span>
</span><span class='line'><span class="n">$</span> <span class="n">export</span> <span class="n">PATH</span><span class="o">=</span><span class="p">.</span><span class="o">/</span><span class="nl">bin:</span><span class="n">$PATH</span>
</span><span class='line'><span class="n">$</span> <span class="n">hop</span> <span class="n">analyze_lib</span>
</span><span class='line'><span class="nl">analyze_lib:</span> <span class="n">PASSED</span> <span class="o">-</span> <span class="n">lib</span><span class="o">/</span><span class="n">stats</span><span class="p">.</span><span class="n">dart</span>
</span><span class='line'><span class="nl">analyze_lib:</span> <span class="nl">PASSED:</span> <span class="m">1</span><span class="p">,</span> <span class="nl">WARNING:</span> <span class="m">0</span><span class="p">,</span> <span class="nl">ERROR:</span> <span class="m">0</span>
</span><span class='line'><span class="n">Finished</span>
</span><span class='line'><span class="n">$</span> <span class="n">hop</span> <span class="n">headless_test</span>
</span><span class='line'><span class="n">unittest</span><span class="o">-</span><span class="n">suite</span><span class="o">-</span><span class="n">wait</span><span class="o">-</span><span class="k">for</span><span class="o">-</span><span class="n">done</span>
</span><span class='line'><span class="nl">headless_test:</span> <span class="n">DumpRenderTree</span> <span class="o">-</span> <span class="n">test</span><span class="o">/</span><span class="n">tests_browser</span><span class="p">.</span><span class="n">html</span>
</span><span class='line'><span class="nl">headless_test:</span> <span class="m">1</span> <span class="n">PASSED</span><span class="p">,</span> <span class="m">0</span> <span class="n">FAILED</span><span class="p">,</span> <span class="m">0</span> <span class="n">ERRORS</span>
</span><span class='line'><span class="n">Finished</span>
</span></code></pre></td></tr></table></div></figure>


<p>For a full example of a project that uses <a href="https://github.com/kevmoo/bot.dart">bot.dart</a> for testing and analyzer please refer to <a href="https://github.com/Dartist/stats.dart">stats.dart</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Using Dart for Website Publishing on Google Drive]]></title>
    <link href="http://financeCoding.github.com/blog/2013/01/27/using-dart-for-website-publishing-on-google-drive/"/>
    <updated>2013-01-27T00:38:00-08:00</updated>
    <id>http://financeCoding.github.com/blog/2013/01/27/using-dart-for-website-publishing-on-google-drive</id>
    <content type="html"><![CDATA[<p>After watching a <a href="http://www.youtube.com/watch?v=T56eZ1lg2oE">Generating a Google Drive Hosted Website with tools you have lying around in your kitchen</a> by <a href="https://plus.google.com/118327176775959145936">Ali Afshar</a> I got interested in doing the same thing with dart.</p>

<p>Had to ask my self a few questions first?</p>

<ul>
<li>Can the <a href="https://github.com/dart-gde/discovery_api_dart_client_generator">discovery_api_dart_client_generator</a> create drive_v2_api code that would allow us to access drive from the console?</li>
<li>Can dart process markdown?</li>
<li>Can we make the <a href="https://developers.google.com/drive/v2/reference/files">webViewLink</a> easier to read and share?</li>
</ul>


<p>At the time I started this investigation the <a href="https://github.com/dart-gde/discovery_api_dart_client_generator">discovery_api_dart_client_generator</a> did not have <a href="https://developers.google.com/accounts/docs/OAuth2#installed">OAuth2</a> support for installed applications. Knowing that <a href="http://pub.dartlang.org/">pub</a> does use OAuth2 in a similar fashion, I decided to peek inside of <a href="http://pub.dartlang.org/">pub</a> to see what it is doing.</p>

<p>After reviewing the <a href="http://pub.dartlang.org/">pub</a> <a href="https://github.com/dart-lang/bleeding_edge/tree/master/dart/utils/pub">source code</a>, it&#8217;s interested to see how they handle getting tokens from the Google OAuth2 Authorization Server back to the client application. <a href="http://pub.dartlang.org/">pub</a> first checks if the client applications has a <code>~/.pub-cache/credentials.json</code> file stored, if the <code>credentials.json</code> is not found or invalid pub will generate an authorization url. The authorization url is copied and pasted by the user into a web browser and asks the user if they will allow access to some scopes. When the user accepts access the redirect url with token the Google OAuth2 Authorization Server redirects to a listening http server on localhost. This server was started by the <a href="http://pub.dartlang.org/">pub</a> application, now <a href="http://pub.dartlang.org/">pub</a> has the token and stores it for later use.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>12:22:46-adam@Adams-MacBook-Air:~/dart/stats.dart
</span><span class='line'>$ pub publish
</span><span class='line'>Publishing "stats" 0.0.4:
</span><span class='line'>|-- .gitignore
</span><span class='line'>|-- AUTHORS
</span><span class='line'>|-- LICENSE
</span><span class='line'>|-- README.md
</span><span class='line'>|-- asset
</span><span class='line'>|   |-- stats_dart_fps.png
</span><span class='line'>|   '-- stats_dart_ms.png
</span><span class='line'>|-- example
</span><span class='line'>|   |-- basic
</span><span class='line'>|   |   |-- statsdart.dart
</span><span class='line'>|   |   '-- statsdart.html
</span><span class='line'>|   '-- theming
</span><span class='line'>|       |-- theming.dart
</span><span class='line'>|       '-- theming.html
</span><span class='line'>|-- lib
</span><span class='line'>|   |-- src
</span><span class='line'>|   |   '-- stats.dart
</span><span class='line'>|   '-- stats.dart
</span><span class='line'>|-- pubspec.yaml
</span><span class='line'>'-- test
</span><span class='line'>    |-- run.sh
</span><span class='line'>    |-- tests_browser.dart
</span><span class='line'>    '-- tests_browser.html
</span><span class='line'>
</span><span class='line'>Looks great! Are you ready to upload your package (y/n)? y
</span><span class='line'>Pub needs your authorization to upload packages on your behalf.
</span><span class='line'>In a web browser, go to https://accounts.google.com/o/oauth2/auth?access_type=offline&approval_prompt=force&response_type=code&client_id=818368855108-8grd2eg9tj9f38os6f1urbcvsq399u8n.apps.googleusercontent.com&redirect_uri=http%3A%2F%2Flocalhost%3A62462&scope=https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fuserinfo.email
</span><span class='line'>Then click "Allow access".
</span><span class='line'>
</span><span class='line'>Waiting for your authorization...
</span><span class='line'>Authorization received, processing...
</span><span class='line'>Successfully authorized.
</span><span class='line'>
</span><span class='line'>Package "stats" already has version "0.0.4".</span></code></pre></td></tr></table></div></figure>


<p><a href="http://financeCoding.github.com/images/2013-01-27-using-dart-for-website-publishing-on-google-drive/allow_access.png"><img src="http://financeCoding.github.com/images/2013-01-27-using-dart-for-website-publishing-on-google-drive/allow_access.png" alt="allow_access" /></a></p>

<p><a href="http://financeCoding.github.com/images/2013-01-27-using-dart-for-website-publishing-on-google-drive/success.png"><img src="http://financeCoding.github.com/images/2013-01-27-using-dart-for-website-publishing-on-google-drive/success.png" alt="success.png" /></a></p>

<p>After some initial slicing and dicing I was able to take what was needed from <a href="http://pub.dartlang.org/">pub</a> and merge it into <a href="https://github.com/dart-gde/dart-google-oauth2-library">dart-google-oauth2-library</a> that <a href="https://github.com/dart-gde/discovery_api_dart_client_generator">discovery_api_dart_client_generator</a> depends on for OAuth2 support. <a href="http://pub.dartlang.org/">pub</a> was structured such that all files are dart libraries, so ripping out parts was easy, I found the most issues with <a href="http://pub.dartlang.org/packages/http">http</a> package. The client <a href="https://github.com/dart-lang/bleeding_edge/blob/master/dart/pkg/http/lib/src/request.dart#L119">requests</a> <code>ContentType</code> could only be set as <code>application/x-www-form-urlencoded</code> when making requests, this did not seem to play nicely with Google APIs. Took many hours of debugging to figure out why <code>POST</code> method would fail but <code>GET</code> method would not. Stumbled on some Google mailing lists that mentioned some services do work with <code>ContentType</code> <code>application/x-www-form-urlencoded</code> and some only with <code>application/json</code>. So I created a separate client that does the <code>POST</code>, <code>PATCH</code>, <code>PUT</code>, <code>DELETE</code> methods required for the Google Client APIs.</p>

<p><strong>Big thanks</strong> to <a href="https://profiles.google.com/scarygami">Gerwin Sturm</a> for working on this merge with me, in a very short amount of time we&#8217;ve been able to push the <a href="https://github.com/dart-gde/dart-google-oauth2-library">dart-google-oauth2-library</a> and <a href="https://github.com/dart-gde/discovery_api_dart_client_generator">discovery_api_dart_client_generator</a> into almost complete solutions for dart and Google Client API services.</p>

<p>The <a href="https://github.com/financeCoding/markdown.dart">markdown.dart</a> processor was for the most part a total freebie, <a href="https://plus.google.com/100798142896685420545">Bob Nystrom</a> had already created a <a href="https://github.com/dart-lang/bleeding_edge/tree/master/dart/samples/markdown">markdown</a> processor which eventually got rolled into <a href="https://github.com/dart-lang/bleeding_edge/tree/master/dart/sdk/lib/_internal/dartdoc">Dartdoc</a>. All that was needed here is picking out the code from the dart repo, updating libraries and import, minor code clean up and hosting it on github.</p>

<p>One of my all time favorite Google APIs is the <a href="https://developers.google.com/url-shortener/">url-shortener</a> API. Even without OAuth2 you can use this service, now that we have patched up <a href="https://github.com/dart-gde/dart-google-oauth2-library">dart-google-oauth2-library</a> and <a href="https://github.com/dart-gde/discovery_api_dart_client_generator">discovery_api_dart_client_generator</a> shortening the long <a href="https://developers.google.com/drive/v2/reference/files">webViewLink</a> will be easy. A site note, <a href="http://goo.gl">goo.gl</a> links work great as for landing slides when giving a presentation, easy and short enough for audience to type into mobile phone, tablet or laptop to pull down your slides and follow along.</p>

<p>Now we have all the parts needed to create a simple application that reads in some markdown, processes it to html, creates a website folder on drive, uploads the final html, then generates a shortened url.</p>

<p><em>We are still working on the best way to publish the Dart Google Client APIs, so please don&#8217;t depend on the links below for too long, they will be out dated soon. This was just for testing.</em></p>

<p>Starting off with our <code>pubspec.yaml</code> file we add the dependencies needed for the application.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span>  <span class="l-Scalar-Plain">drive_publish_markdown</span>
</span><span class='line'><span class="l-Scalar-Plain">description</span><span class="p-Indicator">:</span>  <span class="l-Scalar-Plain">Publishing markdown content to a public drive site</span>
</span><span class='line'><span class="l-Scalar-Plain">dependencies</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="l-Scalar-Plain">urlshortener_v1_api</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">git</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">https://github.com/financeCoding/urlshortener_v1_api_client.git</span>
</span><span class='line'>  <span class="l-Scalar-Plain">drive_v2_api</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">git</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">https://github.com/financeCoding/drive_v2_api_client.git</span>
</span><span class='line'>  <span class="l-Scalar-Plain">markdown</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">git</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">https://github.com/financeCoding/markdown.dart.git</span>
</span></code></pre></td></tr></table></div></figure>


<p>Getting a <code>identifier</code> and <code>secret</code> is simple, just goto your <a href="https://code.google.com/apis/console">Google APIs Console</a> and pull out <code>Client ID</code> and <code>Client secret</code> for a <code>Client ID for installed applications</code> that was previously created. If you don&#8217;t have one already they are easy to create.</p>

<ul>
<li><p>Goto API access in a project.<br/>
<a href="http://financeCoding.github.com/images/2013-01-27-using-dart-for-website-publishing-on-google-drive/api_access.png"><img src="http://financeCoding.github.com/images/2013-01-27-using-dart-for-website-publishing-on-google-drive/api_access.png" alt="api_access" /></a></p></li>
<li><p>Click Create another client ID.
<a href="http://financeCoding.github.com/images/2013-01-27-using-dart-for-website-publishing-on-google-drive/create_another_client_id.png"><img src="http://financeCoding.github.com/images/2013-01-27-using-dart-for-website-publishing-on-google-drive/create_another_client_id.png" alt="create_another_client_id" /></a></p></li>
<li><p>Choose Installed application and Installed type Other. Your Done!
<a href="http://financeCoding.github.com/images/2013-01-27-using-dart-for-website-publishing-on-google-drive/create_client_id.png"><img src="http://financeCoding.github.com/images/2013-01-27-using-dart-for-website-publishing-on-google-drive/create_client_id.png" alt="create_client_id" /></a></p></li>
</ul>


<p>Apply <code>identifier</code> and <code>secret</code> to your code.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'><span class="n">import</span> <span class="s2">&quot;dart:io&quot;</span><span class="p">;</span>
</span><span class='line'><span class="n">import</span> <span class="s2">&quot;dart:async&quot;</span><span class="p">;</span>
</span><span class='line'><span class="n">import</span> <span class="s1">&#39;dart:crypto&#39;</span><span class="p">;</span>
</span><span class='line'><span class="n">import</span> <span class="s2">&quot;dart:json&quot;</span> <span class="n">as</span> <span class="n">JSON</span><span class="p">;</span>
</span><span class='line'><span class="n">import</span> <span class="s2">&quot;package:google_oauth2_client/google_oauth2_console.dart&quot;</span><span class="p">;</span>
</span><span class='line'><span class="n">import</span> <span class="s2">&quot;package:drive_v2_api/drive_v2_api_console.dart&quot;</span> <span class="n">as</span> <span class="n">drivelib</span><span class="p">;</span>
</span><span class='line'><span class="n">import</span> <span class="s2">&quot;package:urlshortener_v1_api/urlshortener_v1_api_console.dart&quot;</span> <span class="n">as</span> <span class="n">urllib</span><span class="p">;</span>
</span><span class='line'><span class="n">import</span> <span class="s2">&quot;package:markdown/lib.dart&quot;</span> <span class="n">as</span> <span class="n">markdown</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">String</span> <span class="n">identifier</span> <span class="o">=</span> <span class="s2">&quot;&lt;IDENTIFIER&gt;&quot;</span><span class="p">;</span>
</span><span class='line'><span class="kt">String</span> <span class="n">secret</span> <span class="o">=</span> <span class="s2">&quot;&lt;SECRET&gt;&quot;</span><span class="p">;</span>
</span><span class='line'><span class="n">List</span> <span class="n">scopes</span> <span class="o">=</span> <span class="p">[</span><span class="n">drivelib</span><span class="p">.</span><span class="n">Drive</span><span class="p">.</span><span class="n">DRIVE_FILE_SCOPE</span><span class="p">,</span> <span class="n">drivelib</span><span class="p">.</span><span class="n">Drive</span><span class="p">.</span><span class="n">DRIVE_SCOPE</span><span class="p">,</span> <span class="n">urllib</span><span class="p">.</span><span class="n">Urlshortener</span><span class="p">.</span><span class="n">URLSHORTENER_SCOPE</span><span class="p">];</span>
</span><span class='line'><span class="n">drivelib</span><span class="p">.</span><span class="n">Drive</span> <span class="n">drive</span><span class="p">;</span>
</span><span class='line'><span class="n">urllib</span><span class="p">.</span><span class="n">Urlshortener</span> <span class="n">urlshort</span><span class="p">;</span>
</span><span class='line'><span class="n">OAuth2Console</span> <span class="n">auth</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now with <code>identifier</code> and <code>secret</code> the setup for a dart application to use <code>Drive</code> and <code>Urlshortener</code> is easy, create a new <code>OAuth2Console</code> and pass them along to the constructor of <code>Drive</code> and <code>Urlshortener</code>. Note that the flag <code>makeAuthRequests</code> has been set on both objects, that allows us to make authroized calls on behalf of the user. You could create the Google Client API objects without a OAuth2 token and leave the <code>makeAuthRequests</code> as false, the objects would then only be allowed to access non-authenticated resources on the Google servers.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'><span class="kt">void</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="cm">/**</span>
</span><span class='line'><span class="cm">   * Create new or load existing oauth2 token.</span>
</span><span class='line'><span class="cm">   */</span>
</span><span class='line'>  <span class="n">auth</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OAuth2Console</span><span class="p">(</span><span class="nl">identifier:</span> <span class="n">identifier</span><span class="p">,</span> <span class="nl">secret:</span> <span class="n">secret</span><span class="p">,</span> <span class="nl">scopes:</span> <span class="n">scopes</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/**</span>
</span><span class='line'><span class="cm">   * Create a new [drivelib.Drive] object with authenticated requests.</span>
</span><span class='line'><span class="cm">   */</span>
</span><span class='line'>  <span class="n">drive</span> <span class="o">=</span> <span class="k">new</span> <span class="n">drivelib</span><span class="p">.</span><span class="n">Drive</span><span class="p">(</span><span class="n">auth</span><span class="p">);</span>
</span><span class='line'>  <span class="n">drive</span><span class="p">.</span><span class="n">makeAuthRequests</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/**</span>
</span><span class='line'><span class="cm">   * Create a new [urllib.Urlshortener] object with authenticated requests.</span>
</span><span class='line'><span class="cm">   */</span>
</span><span class='line'>  <span class="n">urlshort</span> <span class="o">=</span> <span class="k">new</span> <span class="n">urllib</span><span class="p">.</span><span class="n">Urlshortener</span><span class="p">(</span><span class="n">auth</span><span class="p">);</span>
</span><span class='line'>  <span class="n">urlshort</span><span class="p">.</span><span class="n">makeAuthRequests</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/**</span>
</span><span class='line'><span class="cm">   * Create a new &#39;public_folder&#39; and insert markdown as html</span>
</span><span class='line'><span class="cm">   */</span>
</span><span class='line'>  <span class="n">createPublicFolder</span><span class="p">(</span><span class="s2">&quot;public_folder&quot;</span><span class="p">).</span><span class="n">then</span><span class="p">(</span><span class="n">processMarkdown</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>I have to admit, updating permissions took me awhile to figure out. I first tried to update by calling <code>drive.files.update</code> with a modified <code>drivelib.File</code>. That was not the proper way to change permissions on <a href="https://developers.google.com/drive/">drive</a>. The correct way is to call the <code>drive.permissions.*</code> methods, lesson learned after some Googling and searching on <a href="http://stackoverflow.com/">stackoverflow</a> <a href="http://stackoverflow.com/questions/tagged/google-drive-sdk">drive-sdk</a>. Setting the <code>Permissions</code> and <code>mimeType</code> are the most important parts to note here, thats what change the folder into a public website hosted on drive viewable to anyone.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'><span class="kt">void</span> <span class="n">insertPermissions</span><span class="p">(</span><span class="n">drivelib</span><span class="p">.</span><span class="n">File</span> <span class="n">file</span><span class="p">,</span> <span class="n">Completer</span> <span class="n">completer</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="cm">/**</span>
</span><span class='line'><span class="cm">   * Create new [drivelib.Permission] for insertion to the</span>
</span><span class='line'><span class="cm">   * drive permissions list. This will mark the folder publicly</span>
</span><span class='line'><span class="cm">   * readable by anyone.</span>
</span><span class='line'><span class="cm">   */</span>
</span><span class='line'>  <span class="kd">var</span> <span class="n">permissions</span> <span class="o">=</span> <span class="k">new</span> <span class="n">drivelib</span><span class="p">.</span><span class="n">Permission</span><span class="p">.</span><span class="n">fromJson</span><span class="p">({</span>
</span><span class='line'>    <span class="s2">&quot;value&quot;</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;anyone&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;role&quot;</span><span class="o">:</span> <span class="s2">&quot;reader&quot;</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">drive</span><span class="p">.</span><span class="n">permissions</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">permissions</span><span class="p">,</span> <span class="n">file</span><span class="p">.</span><span class="n">id</span><span class="p">).</span><span class="n">then</span><span class="p">((</span><span class="n">drivelib</span><span class="p">.</span><span class="n">Permission</span> <span class="n">permission</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">completer</span><span class="p">.</span><span class="n">complete</span><span class="p">(</span><span class="n">file</span><span class="p">));</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">Future</span><span class="o">&lt;</span><span class="n">drivelib</span><span class="p">.</span><span class="n">File</span><span class="o">&gt;</span> <span class="n">createPublicFolder</span><span class="p">(</span><span class="kt">String</span> <span class="n">folderName</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="n">completer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Completer</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/**</span>
</span><span class='line'><span class="cm">   * Create the [drivelib.File] with a web folder app mime type.</span>
</span><span class='line'><span class="cm">   */</span>
</span><span class='line'>  <span class="n">drivelib</span><span class="p">.</span><span class="n">File</span> <span class="n">file</span> <span class="o">=</span> <span class="k">new</span> <span class="n">drivelib</span><span class="p">.</span><span class="n">File</span><span class="p">.</span><span class="n">fromJson</span><span class="p">({</span>
</span><span class='line'>    <span class="s1">&#39;title&#39;</span><span class="o">:</span> <span class="n">folderName</span><span class="p">,</span>
</span><span class='line'>    <span class="s1">&#39;mimeType&#39;</span><span class="o">:</span> <span class="s2">&quot;application/vnd.google-apps.folder&quot;</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/**</span>
</span><span class='line'><span class="cm">   * Insert the [drivelib.File] to google drive.</span>
</span><span class='line'><span class="cm">   */</span>
</span><span class='line'>  <span class="n">drive</span><span class="p">.</span><span class="n">files</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">file</span><span class="p">).</span><span class="n">then</span><span class="p">((</span><span class="n">drivelib</span><span class="p">.</span><span class="n">File</span> <span class="n">newfile</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">insertPermissions</span><span class="p">(</span><span class="n">newfile</span><span class="p">,</span> <span class="n">completer</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="n">completer</span><span class="p">.</span><span class="n">future</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now we get to the meat and potatoes of our application. At this point we have a public web folder that can host our content. We do the follow steps</p>

<ul>
<li>Read in the markdown and html template file</li>
<li>Replace a tag in the template with the markdown</li>
<li>Insert the file into drive</li>
<li>Add a parent reference to the file</li>
<li>Get the url to the folder</li>
<li>Shorten the url</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'><span class="n">processMarkdown</span><span class="p">(</span><span class="n">drivelib</span><span class="p">.</span><span class="n">File</span> <span class="n">folder</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="cm">/**</span>
</span><span class='line'><span class="cm">   * Read in both markdown and html template</span>
</span><span class='line'><span class="cm">   */</span>
</span><span class='line'>  <span class="kd">var</span> <span class="n">markdownFile</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="p">(</span><span class="s1">&#39;markdown.md&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="kd">var</span> <span class="n">templateFile</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="p">(</span><span class="s1">&#39;template.html&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="kd">var</span> <span class="n">markdownStr</span> <span class="o">=</span> <span class="n">markdownFile</span><span class="p">.</span><span class="n">readAsStringSync</span><span class="p">();</span>
</span><span class='line'>  <span class="kd">var</span> <span class="n">templateStr</span> <span class="o">=</span> <span class="n">templateFile</span><span class="p">.</span><span class="n">readAsStringSync</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/**</span>
</span><span class='line'><span class="cm">   * Convert markdown to html.</span>
</span><span class='line'><span class="cm">   */</span>
</span><span class='line'>  <span class="kd">var</span> <span class="n">page</span> <span class="o">=</span> <span class="n">markdown</span><span class="p">.</span><span class="n">markdownToHtml</span><span class="p">(</span><span class="n">markdownStr</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/**</span>
</span><span class='line'><span class="cm">   * Replace $page with converted markdown.</span>
</span><span class='line'><span class="cm">   */</span>
</span><span class='line'>  <span class="n">templateStr</span> <span class="o">=</span> <span class="n">templateStr</span><span class="p">.</span><span class="n">replaceFirst</span><span class="p">(</span><span class="s1">&#39;\</span><span class="si">$</span><span class="n">page</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">page</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/**</span>
</span><span class='line'><span class="cm">   * Create a new [drivelib.File] to hold the html content.</span>
</span><span class='line'><span class="cm">   */</span>
</span><span class='line'>  <span class="n">drivelib</span><span class="p">.</span><span class="n">File</span> <span class="n">file</span> <span class="o">=</span> <span class="k">new</span> <span class="n">drivelib</span><span class="p">.</span><span class="n">File</span><span class="p">.</span><span class="n">fromJson</span><span class="p">({</span>
</span><span class='line'>    <span class="s1">&#39;title&#39;</span><span class="o">:</span> <span class="s1">&#39;index.html&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s1">&#39;mimeType&#39;</span><span class="o">:</span> <span class="s2">&quot;text/html&quot;</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/**</span>
</span><span class='line'><span class="cm">   * Create a new [drivelib.ParentReference] to link the html file to.</span>
</span><span class='line'><span class="cm">   */</span>
</span><span class='line'>  <span class="n">drivelib</span><span class="p">.</span><span class="n">ParentReference</span> <span class="n">newParent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">drivelib</span><span class="p">.</span><span class="n">ParentReference</span><span class="p">.</span><span class="n">fromJson</span><span class="p">({</span><span class="s1">&#39;id&#39;</span><span class="o">:</span> <span class="n">folder</span><span class="p">.</span><span class="n">id</span><span class="p">});</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/**</span>
</span><span class='line'><span class="cm">   * Encode the content to Base64 for inserting into drive.</span>
</span><span class='line'><span class="cm">   */</span>
</span><span class='line'>  <span class="kd">var</span> <span class="n">content</span> <span class="o">=</span> <span class="n">CryptoUtils</span><span class="p">.</span><span class="n">bytesToBase64</span><span class="p">(</span><span class="n">templateStr</span><span class="p">.</span><span class="n">charCodes</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/**</span>
</span><span class='line'><span class="cm">   * 1) Insert the new file with title index.html and type text/html</span>
</span><span class='line'><span class="cm">   * 2) Insert the new parent of the file (i.e. place the file in the folder)</span>
</span><span class='line'><span class="cm">   * 3) Get the folders web view link</span>
</span><span class='line'><span class="cm">   * 4) Shorten the web view link with UrlShortener</span>
</span><span class='line'><span class="cm">   */</span>
</span><span class='line'>  <span class="n">drive</span><span class="p">.</span><span class="n">files</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="nl">content:</span> <span class="n">content</span><span class="p">).</span><span class="n">then</span><span class="p">((</span><span class="n">drivelib</span><span class="p">.</span><span class="n">File</span> <span class="n">insertedFile</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">drive</span><span class="p">.</span><span class="n">parents</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">newParent</span><span class="p">,</span> <span class="n">insertedFile</span><span class="p">.</span><span class="n">id</span><span class="p">).</span><span class="n">then</span><span class="p">((</span><span class="n">drivelib</span><span class="p">.</span><span class="n">ParentReference</span> <span class="n">parentReference</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">drive</span><span class="p">.</span><span class="n">files</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="n">folder</span><span class="p">.</span><span class="n">id</span><span class="p">).</span><span class="n">then</span><span class="p">((</span><span class="n">folder</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">print</span><span class="p">(</span><span class="s2">&quot;Web View Link: </span><span class="si">${</span><span class="n">folder</span><span class="p">.</span><span class="n">webViewLink</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="kd">var</span> <span class="n">url</span> <span class="o">=</span> <span class="k">new</span> <span class="n">urllib</span><span class="p">.</span><span class="n">Url</span><span class="p">.</span><span class="n">fromJson</span><span class="p">({</span><span class="s1">&#39;longUrl&#39;</span><span class="o">:</span> <span class="n">folder</span><span class="p">.</span><span class="n">webViewLink</span><span class="p">});</span>
</span><span class='line'>        <span class="n">urlshort</span><span class="p">.</span><span class="n">url</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">url</span><span class="p">).</span><span class="n">then</span><span class="p">((</span><span class="n">url</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="n">print</span><span class="p">(</span><span class="s2">&quot;Short Url </span><span class="si">${</span><span class="n">url</span><span class="p">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="p">});</span>
</span><span class='line'>      <span class="p">});</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The code for this sample can be found on <a href="http://github.com">github</a> <a href="https://github.com/financeCoding/drive_publish_markdown">drive_publish_markdown</a>. Executing the sample follows the flow explained above</p>

<ul>
<li>Ask user to generate token</li>
<li>Get token from redirect</li>
<li>Store token</li>
<li>Make <a href="https://developers.google.com/drive/">drive</a> and <a href="https://developers.google.com/url-shortener/">url-shortener</a> requests.</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'><span class="m">13</span><span class="o">:</span><span class="m">32</span><span class="o">:</span><span class="m">40</span><span class="o">-</span><span class="n">adam</span><span class="err">@</span><span class="n">Adams</span><span class="o">-</span><span class="n">MacBook</span><span class="o">-</span><span class="nl">Air:</span><span class="o">~/</span><span class="n">dart</span><span class="o">/</span><span class="n">drive_publish_markdown</span><span class="o">/</span><span class="n">bin</span>
</span><span class='line'><span class="n">$</span> <span class="n">dart</span> <span class="n">drive_publish_markdown</span><span class="p">.</span><span class="n">dart</span>
</span><span class='line'><span class="n">Client</span> <span class="n">needs</span> <span class="n">your</span> <span class="n">authorization</span> <span class="k">for</span> <span class="n">scopes</span> <span class="p">[</span><span class="nl">https:</span><span class="c1">//www.googleapis.com/auth/drive.file, https://www.googleapis.com/auth/drive, https://www.googleapis.com/auth/urlshortener]</span>
</span><span class='line'><span class="n">In</span> <span class="n">a</span> <span class="n">web</span> <span class="n">browser</span><span class="p">,</span> <span class="n">go</span> <span class="n">to</span> <span class="nl">https:</span><span class="c1">//accounts.google.com/o/oauth2/auth?access_type=offline&amp;approval_prompt=force&amp;response_type=code&amp;client_id=299615367852-n0kfup30mfj5emlclfgud9g76itapvk9.apps.googleusercontent.com&amp;redirect_uri=http%3A%2F%2Flocalhost%3A62900&amp;scope=https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fdrive.file+https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fdrive+https%3A%2F%2Fwww.googleapis.com%2Fauth%2Furlshortener</span>
</span><span class='line'><span class="n">Then</span> <span class="n">click</span> <span class="s2">&quot;Allow access&quot;</span><span class="p">.</span>
</span><span class='line'>
</span><span class='line'><span class="n">Waiting</span> <span class="k">for</span> <span class="n">your</span> <span class="n">authorization</span><span class="p">...</span>
</span><span class='line'><span class="n">Authorization</span> <span class="n">received</span><span class="p">,</span> <span class="n">processing</span><span class="p">...</span>
</span><span class='line'><span class="n">Calling</span> <span class="n">curl</span> <span class="n">with</span> <span class="o">--</span><span class="n">insecure</span><span class="p">,</span> <span class="n">ca</span><span class="o">-</span><span class="n">certificates</span><span class="p">.</span><span class="n">crt</span> <span class="n">not</span> <span class="n">found</span><span class="p">.</span>
</span><span class='line'><span class="n">Successfully</span> <span class="n">authorized</span><span class="p">.</span>
</span><span class='line'>
</span><span class='line'><span class="n">Calling</span> <span class="n">curl</span> <span class="n">with</span> <span class="o">--</span><span class="n">insecure</span><span class="p">,</span> <span class="n">ca</span><span class="o">-</span><span class="n">certificates</span><span class="p">.</span><span class="n">crt</span> <span class="n">not</span> <span class="n">found</span><span class="p">.</span>
</span><span class='line'><span class="n">Web</span> <span class="n">View</span> <span class="nl">Link:</span> <span class="nl">https:</span><span class="c1">//www.googledrive.com/host/0B29MR2FlgtejWnh6SS03LWFnVE0/</span>
</span><span class='line'><span class="n">Short</span> <span class="n">Url</span> <span class="nl">http:</span><span class="c1">//goo.gl/3fGi3</span>
</span></code></pre></td></tr></table></div></figure>


<p><a href="http://financeCoding.github.com/images/2013-01-27-using-dart-for-website-publishing-on-google-drive/allow_access_drive_publish_markdown.png"><img src="http://financeCoding.github.com/images/2013-01-27-using-dart-for-website-publishing-on-google-drive/allow_access_drive_publish_markdown.png" alt="allow_access_drive_publish_markdown" /></a></p>

<p><a href="http://financeCoding.github.com/images/2013-01-27-using-dart-for-website-publishing-on-google-drive/generated_markdown_published_on_drive.png"><img src="http://financeCoding.github.com/images/2013-01-27-using-dart-for-website-publishing-on-google-drive/generated_markdown_published_on_drive.png" alt="generated_markdown_published_on_drive" /></a></p>

<p>Thats all, have fun with this really simple and easy to get started sample.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Darting A Full Stack]]></title>
    <link href="http://financeCoding.github.com/blog/2013/01/16/darting-a-full-stack/"/>
    <updated>2013-01-16T16:47:00-08:00</updated>
    <id>http://financeCoding.github.com/blog/2013/01/16/darting-a-full-stack</id>
    <content type="html"><![CDATA[<p><em>tl;dr</em> A common question that comes up is connecting all parts of dart together. Here I will show a simple example of connecting up <a href="https://github.com/dart-lang/web-ui">web-ui</a> and <a href="https://github.com/vadimtsushko/objectory">objectory</a>.</p>

<p><a href="https://github.com/dart-lang/web-ui">web-ui</a> is a <a href="https://dvcs.w3.org/hg/webcomponents/raw-file/tip/explainer/index.html">WebComponents</a> framework provided by the <a href="https://github.com/dart-lang">dart-lang</a> team. <a href="https://github.com/vadimtsushko/objectory">objectory</a> is a data persistence layer for MongoDB that provides typed, checked environment for models, saving and queries. With these two components and a very simple web server we could have a nice full stack solution in <a href="http://www.dartlang.org">dart</a>.</p>

<p>Initially <a href="https://github.com/vadimtsushko/">Vadim Tsushko</a> did some work to wire up <a href="https://github.com/dart-lang/web-ui/tree/master/example/todomvc">TodoMVC</a> from the <a href="https://github.com/dart-lang/web-ui">web-ui</a> examples with indexdb. Using the same code and updated version of TodoMVC I was able to connect it to <a href="http://www.mongodb.org/">mongodb</a> using the web socket connection provided with objectory.</p>

<p><em>It would of been nice if this solution could possibly be deployed onto <a href="http://www.heroku.com/">heroku</a>, ended up not possible since heroku does not support native web socket connections with their internal routing. <a href="http://socket.io/">socket.io</a> does work on heroku but uses long polling instead of true web sockets.</em></p>

<p>Another note, since dart is in a transitional phase right now for implementing streams, some of this code depends packages that have not yet been pushed to <a href="http://pub.dartlang.org/">pub.dartlang.org</a></p>

<p>So lets get started with the basics, getting up and running with objectory. Install mongo if its not already and fire up a mongo database.</p>

<figure class='code'><figcaption><span>mongo install</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>brew install mongo
</span><span class='line'><span class="nb">cd</span> /tmp/
</span><span class='line'>mkdir db
</span><span class='line'>mongod -dbpath .
</span></code></pre></td></tr></table></div></figure>


<p>The version of dart being used is the latest trunk build <a href="https://gsdview.appspot.com/dart-editor-archive-trunk/17072/">17072</a></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>cat ~/dart/dart-sdk/version
</span><span class='line'>0.3.0.1_r17072
</span></code></pre></td></tr></table></div></figure>


<p>clone and test objectory as a sanity check</p>

<figure class='code'><figcaption><span>objectory</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span><span class="nb">cd</span> /Users/adam/dart/
</span><span class='line'><span class="nv">$ </span>git clone https://github.com/vadimtsushko/objectory.git
</span><span class='line'><span class="nv">$ </span><span class="nb">cd </span>objectory
</span><span class='line'><span class="nv">$ </span>pub install
</span><span class='line'><span class="nv">$ </span><span class="nb">cd </span>bin
</span><span class='line'><span class="nv">$ </span>dart objectory_server.dart
</span><span class='line'>listing on http://127.0.0.1:8080
</span></code></pre></td></tr></table></div></figure>


<p>Open up another terminal and run the <code>example/blog_console.dart</code> application.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span><span class="nb">cd</span> ~/dart/objectory/example
</span><span class='line'><span class="nv">$ </span>dart blog_console.dart
</span><span class='line'><span class="o">===================================================================================</span>
</span><span class='line'>&gt;&gt; Adding <span class="nv">Authors</span>
</span><span class='line'><span class="o">===================================================================================</span>
</span><span class='line'>&gt;&gt; Authors ordered by age ascending
</span><span class='line'><span class="o">[</span>Jorge Luis Borges<span class="o">]</span>:<span class="o">[</span>jorge@borges.com<span class="o">]</span>:<span class="o">[</span>123<span class="o">]</span>
</span><span class='line'><span class="o">[</span>William Shakespeare<span class="o">]</span>:<span class="o">[</span>william@shakespeare.com<span class="o">]</span>:<span class="o">[</span>587<span class="o">]</span>
</span><span class='line'><span class="o">===================================================================================</span>
</span><span class='line'>&gt;&gt; Adding <span class="nv">Users</span>
</span><span class='line'><span class="o">===================================================================================</span>
</span><span class='line'>&gt;&gt; &gt;&gt; Users ordered by login ascending
</span><span class='line'><span class="o">[</span>jdoe<span class="o">]</span>:<span class="o">[</span>John Doe<span class="o">]</span>:<span class="o">[</span>john@doe.com<span class="o">]</span>
</span><span class='line'><span class="o">[</span>lsmith<span class="o">]</span>:<span class="o">[</span>Lucy Smith<span class="o">]</span>:<span class="o">[</span>lucy@smith.com<span class="o">]</span>
</span><span class='line'><span class="o">===================================================================================</span>
</span><span class='line'>&gt;&gt; Adding <span class="nv">articles</span>
</span><span class='line'><span class="o">===================================================================================</span>
</span><span class='line'>&gt;&gt; Printing articles
</span><span class='line'>Jorge Luis Borges:Caminando por Buenos Aires:Las callecitas de Buenos Aires tienen ese no se que...
</span><span class='line'>     2013-01-07 16:21:26.437:Lucy Smith: Well, you may <span class="k">do </span>better...
</span><span class='line'>     2013-01-15 16:01:26.445:John Doe: I love this article!
</span><span class='line'>William Shakespeare:I must have seen thy face before:Thine eyes call me in a new way
</span><span class='line'>     2013-01-16 11:28:06.453:John Doe: great article!
</span></code></pre></td></tr></table></div></figure>


<p>Now if we want to see the blog stored in mongo we need to remove the line in <a href="https://github.com/vadimtsushko/objectory/blob/master/example/blog_console.dart">blog_console.dart</a> that drops the database collection and rerun.</p>

<figure class='code'><figcaption><span>blog_console.dart.diff</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='diff'><span class='line'><span class="gh">diff --git a/example/blog_console.dart b/example/blog_console.dart</span>
</span><span class='line'><span class="gh">index 6775427..fd1d918 100644</span>
</span><span class='line'><span class="gd">--- a/example/blog_console.dart</span>
</span><span class='line'><span class="gi">+++ b/example/blog_console.dart</span>
</span><span class='line'><span class="gu">@@ -84,7 +84,7 @@ main(){</span>
</span><span class='line'>     print(&quot;&gt;&gt; Printing articles&quot;);
</span><span class='line'>     return Future.wait(articles.mappedBy((article) =&gt; printArticle(article)));
</span><span class='line'>   }).then((_) {
</span><span class='line'><span class="gd">-    return objectory.dropCollections();</span>
</span><span class='line'><span class="gi">+    return objectory;</span>
</span><span class='line'>   }).then((_) {
</span><span class='line'>    objectory.close();
</span><span class='line'>   });
</span></code></pre></td></tr></table></div></figure>


<p>Opening up mongo and peeking in side we see the following entries have been stored.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>mongo
</span><span class='line'>MongoDB shell version: 2.2.2
</span><span class='line'>connecting to: <span class="nb">test</span>
</span><span class='line'>&gt; show dbs
</span><span class='line'><span class="nb">local</span> <span class="o">(</span>empty<span class="o">)</span>
</span><span class='line'>objectory_blog    0.203125GB
</span><span class='line'>&gt; use objectory_blog
</span><span class='line'>switched to db objectory_blog
</span><span class='line'>&gt; show collections
</span><span class='line'>Article
</span><span class='line'>Author
</span><span class='line'>User
</span><span class='line'>system.indexes
</span><span class='line'>&gt; db.Article.find<span class="o">()</span>
</span><span class='line'><span class="o">{</span> <span class="s2">&quot;_id&quot;</span> : ObjectId<span class="o">(</span><span class="s2">&quot;50f751f09925f54002000008&quot;</span><span class="o">)</span>, <span class="s2">&quot;title&quot;</span> : <span class="s2">&quot;Caminando por Buenos Aires&quot;</span>, <span class="s2">&quot;body&quot;</span> : <span class="s2">&quot;Las callecitas de Buenos Aires tienen ese no se que...&quot;</span>, <span class="s2">&quot;author&quot;</span> : DBPointer<span class="o">(</span><span class="s2">&quot;Author&quot;</span>, ObjectId<span class="o">(</span><span class="s2">&quot;50f751f09925f54002000001&quot;</span><span class="o">))</span>, <span class="s2">&quot;comments&quot;</span> : <span class="o">[</span>  <span class="o">{</span><span class="s2">&quot;date&quot;</span> : ISODate<span class="o">(</span><span class="s2">&quot;2013-01-08T00:24:21.201Z&quot;</span><span class="o">)</span>,     <span class="s2">&quot;body&quot;</span> : <span class="s2">&quot;Well, you may do better...&quot;</span>,  <span class="s2">&quot;user&quot;</span> : DBPointer<span class="o">(</span><span class="s2">&quot;User&quot;</span>, ObjectId<span class="o">(</span><span class="s2">&quot;50f751f09925f54002000005&quot;</span><span class="o">))</span> <span class="o">}</span>,   <span class="o">{</span>    <span class="s2">&quot;date&quot;</span> : ISODate<span class="o">(</span><span class="s2">&quot;2013-01-16T00:04:21.206Z&quot;</span><span class="o">)</span>,     <span class="s2">&quot;body&quot;</span> : <span class="s2">&quot;I love this article!&quot;</span>,    <span class="s2">&quot;user&quot;</span> : DBPointer<span class="o">(</span><span class="s2">&quot;User&quot;</span>, ObjectId<span class="o">(</span><span class="s2">&quot;50f751f09925f54002000004&quot;</span><span class="o">))</span> <span class="o">}</span> <span class="o">]</span> <span class="o">}</span>
</span><span class='line'><span class="o">{</span> <span class="s2">&quot;_id&quot;</span> : ObjectId<span class="o">(</span><span class="s2">&quot;50f751f09925f54002000009&quot;</span><span class="o">)</span>, <span class="s2">&quot;title&quot;</span> : <span class="s2">&quot;I must have seen thy face before&quot;</span>, <span class="s2">&quot;body&quot;</span> : <span class="s2">&quot;Thine eyes call me in a new way&quot;</span>, <span class="s2">&quot;author&quot;</span> : DBPointer<span class="o">(</span><span class="s2">&quot;Author&quot;</span>, ObjectId<span class="o">(</span><span class="s2">&quot;50f751f09925f54002000000&quot;</span><span class="o">))</span>, <span class="s2">&quot;comments&quot;</span> : <span class="o">[</span>   <span class="o">{</span>    <span class="s2">&quot;date&quot;</span> : ISODate<span class="o">(</span><span class="s2">&quot;2013-01-16T19:31:01.212Z&quot;</span><span class="o">)</span>,     <span class="s2">&quot;body&quot;</span> : <span class="s2">&quot;great article!&quot;</span>,  <span class="s2">&quot;user&quot;</span> : DBPointer<span class="o">(</span><span class="s2">&quot;User&quot;</span>, ObjectId<span class="o">(</span><span class="s2">&quot;50f751f09925f54002000004&quot;</span><span class="o">))</span> <span class="o">}</span> <span class="o">]</span> <span class="o">}</span>
</span><span class='line'>&gt;
</span></code></pre></td></tr></table></div></figure>


<p>Now that we have done a sanity check we can start to move forward with TodoMVC side of things.</p>

<p>I&#8217;ve provided a web-ui branch, the branch fixes up some of the pubspec inconsistencies between the projects on <a href="http://pub.dartlang.org/">pub.dartlang.org</a>. In the future this would not be needed.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>git clone -b objectory_example git://github.com/financeCoding/web-ui.git
</span><span class='line'><span class="nv">$ </span><span class="nb">cd</span> ~/dart/web-ui
</span><span class='line'><span class="nv">$ </span>pub install
</span></code></pre></td></tr></table></div></figure>


<p>objectory provides a very nice browser based web socket connector to the objectory server named <code>ObjectoryWebsocketBrowserImpl</code>. This allows us to register our models. The TodoMVC application model has a <code>Todo</code> object we&#8217;d like to persist.</p>

<figure class='code'><figcaption><span>model.dart</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'><span class="kd">class</span> <span class="nc">Todo</span> <span class="kd">extends</span> <span class="n">PersistentObject</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="kt">String</span> <span class="kd">get</span> <span class="n">task</span> <span class="o">=&gt;</span> <span class="n">getProperty</span><span class="p">(</span><span class="s1">&#39;task&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="kd">set</span> <span class="n">task</span><span class="p">(</span><span class="kt">String</span> <span class="n">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">setProperty</span><span class="p">(</span><span class="s1">&#39;task&#39;</span><span class="p">,</span><span class="n">value</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="kt">bool</span> <span class="kd">get</span> <span class="n">done</span> <span class="o">=&gt;</span> <span class="n">getProperty</span><span class="p">(</span><span class="s1">&#39;done&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="kd">set</span> <span class="n">done</span><span class="p">(</span><span class="kt">bool</span> <span class="n">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">setProperty</span><span class="p">(</span><span class="s1">&#39;done&#39;</span><span class="p">,</span><span class="n">value</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">Todo</span><span class="p">(</span><span class="kt">String</span> <span class="n">newTask</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">done</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>    <span class="n">task</span> <span class="o">=</span> <span class="n">newTask</span><span class="p">;</span>
</span><span class='line'>    <span class="n">saveOnUpdate</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kt">String</span> <span class="n">toString</span><span class="p">()</span> <span class="o">=&gt;</span> <span class="s2">&quot;</span><span class="si">$</span><span class="n">task</span><span class="s2"> </span><span class="si">${</span><span class="n">done</span> <span class="o">?</span> <span class="s1">&#39;(done)&#39;</span> <span class="o">:</span> <span class="s1">&#39;(not done)&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>By extending <code>PersistentObject</code> and adding the <code>getProperty</code> and <code>setProperty</code> methods to our getters and setters we have easily transformed this object to be persisted by objectory.</p>

<p>To bind this up to objectory we <code>new</code> up a <code>ObjectoryWebsocketBrowserImpl</code>, when the application model is created, register the <code>Todo</code> class.</p>

<figure class='code'><figcaption><span>model.dart</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'><span class="n">import</span> <span class="s1">&#39;package:objectory/objectory_browser.dart&#39;</span><span class="p">;</span>
</span><span class='line'><span class="kt">Object</span><span class="n">oryQueryBuilder</span> <span class="kd">get</span> <span class="n">$Todo</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="kt">Object</span><span class="n">oryQueryBuilder</span><span class="p">(</span><span class="s1">&#39;Todo&#39;</span><span class="p">);</span>
</span><span class='line'><span class="kd">const</span> <span class="n">DefaultUri</span> <span class="o">=</span> <span class="s1">&#39;127.0.0.1:8080&#39;</span><span class="p">;</span>
</span><span class='line'><span class="n">AppModel</span> <span class="n">_app</span><span class="p">;</span>
</span><span class='line'><span class="n">AppModel</span> <span class="kd">get</span> <span class="n">app</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">_app</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">_app</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AppModel</span><span class="p">();</span>
</span><span class='line'>     <span class="n">objectory</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">Object</span><span class="n">oryWebsocketBrowserImpl</span><span class="p">(</span><span class="n">DefaultUri</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span>
</span><span class='line'>         <span class="n">objectory</span><span class="p">.</span><span class="n">registerClass</span><span class="p">(</span><span class="s1">&#39;Todo&#39;</span><span class="p">,()</span><span class="o">=&gt;</span><span class="k">new</span> <span class="n">Todo</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)),</span> <span class="kc">false</span><span class="p">);</span> <span class="c1">// set to true to drop models</span>
</span><span class='line'>     <span class="n">objectory</span><span class="p">.</span><span class="n">initDomainModel</span><span class="p">().</span><span class="n">then</span><span class="p">((</span><span class="n">_</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>       <span class="n">objectory</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">$Todo</span><span class="p">).</span><span class="n">then</span><span class="p">((</span><span class="n">todos</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>         <span class="n">app</span><span class="p">.</span><span class="n">resetTodos</span><span class="p">(</span><span class="n">todos</span><span class="p">);</span>
</span><span class='line'>       <span class="p">});</span>
</span><span class='line'>     <span class="p">});</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">_app</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The final step is when a todo is added we also save it in objectory by calling <code>objectory.save()</code>.</p>

<figure class='code'><figcaption><span>main.dart</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'><span class="n">import</span> <span class="s1">&#39;package:objectory/objectory.dart&#39;</span><span class="p">;</span>
</span><span class='line'><span class="p">[...]</span>
</span><span class='line'><span class="kt">void</span> <span class="n">addTodo</span><span class="p">(</span><span class="n">Event</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">e</span><span class="p">.</span><span class="n">preventDefault</span><span class="p">();</span> <span class="c1">// don&#39;t submit the form</span>
</span><span class='line'>  <span class="kd">var</span> <span class="n">input</span> <span class="o">=</span> <span class="n">query</span><span class="p">(</span><span class="s1">&#39;#new-todo&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">input</span><span class="p">.</span><span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
</span><span class='line'>  <span class="kd">var</span> <span class="n">todo</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Todo</span><span class="p">(</span><span class="n">input</span><span class="p">.</span><span class="n">value</span><span class="p">);</span>
</span><span class='line'>  <span class="n">app</span><span class="p">.</span><span class="n">todos</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">todo</span><span class="p">);</span>
</span><span class='line'>  <span class="n">objectory</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="n">todo</span><span class="p">);</span>
</span><span class='line'>  <span class="n">input</span><span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>In the custom branch provided, I renamed the standard <code>build.dart</code> to <code>x_build.dart</code> in hope to save my poor laptop from needlessly building. On a faster system this is not needed. Now we can launch the <code>x_build.dart</code> to generate the output build from the web components sample.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>dart x_build.dart
</span><span class='line'>Total <span class="nb">time </span>spent on example/todomvc/main.html                -- 276 ms
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>From the dart editor we can now launch the output folder main.html.</p>

<p><a href="http://financeCoding.github.com/images/2013-01-16-darting-a-full-stack/launch_dartium.png"><img src="http://financeCoding.github.com/images/2013-01-16-darting-a-full-stack/launch_dartium.png" alt="launch-dartium" /></a></p>

<p><a href="http://financeCoding.github.com/images/2013-01-16-darting-a-full-stack/todo_entered.png"><img src="http://financeCoding.github.com/images/2013-01-16-darting-a-full-stack/todo_entered.png" alt="todo_entered" /></a></p>

<p>This is a nice start, we can launch a web-ui application from dartium and connect up mongo. The issues now&#8230; how do we get the kind of application live and not launched on localhost?</p>

<ul>
<li>Create a http server</li>
<li>Add objectory to it</li>
<li>Compile todomvc application to javascript</li>
</ul>


<p>Why are the steps above needed? First the objectory <code>ObjectoryServerImpl</code> used in <a href="https://github.com/vadimtsushko/objectory/blob/master/bin/objectory_server.dart">objectory_server.dart</a> hides <code>HttpServer</code> which doesn&#8217;t really work for us if we need to serve up static content. Good thing that the class is relativity simple to modify. Compiling todomvc to javascript is an additional step also, but helps us greatly the server logic, only a few files will need to be matched. When a complete and updated web server framework comes to town for dart this would also not be needed.</p>

<p>Modifying the <code>DefaultUri</code> for <code>ObjectoryWebsocketBrowserImpl</code> so it looks at the host&#8217;s location will help for deploying it on a server. The web socket location can then be resolved dynamically.</p>

<figure class='code'><figcaption><span>model.dart</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'><span class="n">import</span> <span class="s1">&#39;dart:html&#39;</span><span class="p">;</span>
</span><span class='line'><span class="p">[...]</span>
</span><span class='line'><span class="kd">var</span> <span class="n">DefaultUri</span> <span class="o">=</span> <span class="n">window</span><span class="p">.</span><span class="n">location</span><span class="p">.</span><span class="n">host</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Compile the web component and update the <code>base.css</code> and <code>dart.js</code>.</p>

<figure class='code'><figcaption><span>main.html</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>[...]
</span><span class='line'>  <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;base.css&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>[...]
</span><span class='line'>  <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">src=</span><span class="s">&quot;dart.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then compile down to javascript after modifying the html.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span><span class="nb">cd</span> ~/dart/web-ui/example/todomvc/out
</span><span class='line'><span class="nv">$ </span>dart2js -omain.html_bootstrap.dart.js main.html_bootstrap.dart
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">cd</span> ~/dart/web-ui/example/todomvc/out
</span><span class='line'><span class="nv">$ </span>cp ../base.css main.html main.html_bootstrap.dart.js dart.js ~/dart/dart-full-stack-example/
</span></code></pre></td></tr></table></div></figure>


<p>*The <a href="https://github.com/financeCoding/dart-full-stack-example">dart_full_stack_example</a> can be found on github, it contains the server code *</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span><span class="nb">cd</span> ~/dart/
</span><span class='line'><span class="nv">$ </span>git clone https://github.com/financeCoding/dart-full-stack-example.git
</span></code></pre></td></tr></table></div></figure>


<p>Moving onto <a href="https://github.com/financeCoding/dart-full-stack-example">dart_full_stack_example</a>, this project will contain the compiled js and html code along with a server. The server will handle delivering the static content also provide the interfaces for the web socket connection.</p>

<figure class='code'><figcaption><span>server.dart</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'><span class="kd">final</span> <span class="n">IP</span> <span class="o">=</span> <span class="s1">&#39;0.0.0.0&#39;</span><span class="p">;</span>
</span><span class='line'><span class="kd">final</span> <span class="n">PORT</span> <span class="o">=</span> <span class="s1">&#39;8080&#39;</span><span class="p">;</span>
</span><span class='line'><span class="kd">final</span> <span class="n">URI</span> <span class="o">=</span> <span class="s1">&#39;mongodb://127.0.0.1/objectory_server_test&#39;</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The server only handles a few requests as shown. Setting IP to <code>0.0.0.0</code> will listen on all IP addresses.</p>

<figure class='code'><figcaption><span>server.dart</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'>  <span class="n">server</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpServer</span><span class="p">();</span>
</span><span class='line'>  <span class="n">WebSocketHandler</span> <span class="n">wsHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">WebSocketHandler</span><span class="p">();</span>
</span><span class='line'>  <span class="n">server</span><span class="p">.</span><span class="n">addRequestHandler</span><span class="p">((</span><span class="n">req</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">req</span><span class="p">.</span><span class="n">path</span> <span class="o">==</span> <span class="s1">&#39;/ws&#39;</span><span class="p">,</span> <span class="n">wsHandler</span><span class="p">.</span><span class="n">onRequest</span><span class="p">);</span>
</span><span class='line'>  <span class="n">server</span><span class="p">.</span><span class="n">defaultRequestHandler</span> <span class="o">=</span> <span class="n">_loadIndex</span><span class="p">;</span>
</span><span class='line'>  <span class="n">server</span><span class="p">.</span><span class="n">addRequestHandler</span><span class="p">((</span><span class="n">req</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">req</span><span class="p">.</span><span class="n">path</span> <span class="o">==</span> <span class="s1">&#39;/main.html&#39;</span><span class="p">,</span> <span class="n">_loadFile</span><span class="p">);</span>
</span><span class='line'>  <span class="n">server</span><span class="p">.</span><span class="n">addRequestHandler</span><span class="p">((</span><span class="n">req</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">req</span><span class="p">.</span><span class="n">path</span> <span class="o">==</span> <span class="s1">&#39;/main.html_bootstrap.dart.js&#39;</span><span class="p">,</span> <span class="n">_loadFile</span><span class="p">);</span>
</span><span class='line'>  <span class="n">server</span><span class="p">.</span><span class="n">addRequestHandler</span><span class="p">((</span><span class="n">req</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">req</span><span class="p">.</span><span class="n">path</span> <span class="o">==</span> <span class="s1">&#39;/base.css&#39;</span><span class="p">,</span> <span class="n">_loadFile</span><span class="p">);</span>
</span><span class='line'>  <span class="n">server</span><span class="p">.</span><span class="n">addRequestHandler</span><span class="p">((</span><span class="n">req</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">req</span><span class="p">.</span><span class="n">path</span> <span class="o">==</span> <span class="s1">&#39;/dart.js&#39;</span><span class="p">,</span> <span class="n">_loadFile</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Looking at the <a href="https://github.com/financeCoding/dart-full-stack-example/blob/master/server.dart">server.dart</a> source code will give you a fuller example, all that is needed now is to run <code>dart server.dart</code> and you&#8217;ll have server running.</p>

<p><em>This is a more complicated process then it has to be, at some point it will get easier when a true deployment and configuration story happen.</em></p>

<p>Happy Dart Hacking!!!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Dart generating and executing snapshots]]></title>
    <link href="http://financeCoding.github.com/blog/2013/01/11/dart-generating-and-executing-snapshots/"/>
    <updated>2013-01-11T17:32:00-08:00</updated>
    <id>http://financeCoding.github.com/blog/2013/01/11/dart-generating-and-executing-snapshots</id>
    <content type="html"><![CDATA[<p>Todays random walk of dartness has lead me to generating and executing snapshots.</p>

<p>What is a snapshot in terms of Dart? Serialized binary heaps. It has been <a href="http://blog.sethladd.com/2012/09/what-dart-wants.html">said</a> that snapshots can help apps startup 10X faster. <code>dart2js</code> is a working example of this in action, when you execute the <code>dart2js</code> compiler it is actually running from a snapshot file.</p>

<p>How can I currently generate them? (Might not be this way in the future) As of now you need to build from source so the <code>gen_snapshot</code> binary is built. <code>gen_snapshot</code> is the tool built from <a href="https://raw.github.com/dart-lang/bleeding_edge/master/dart/runtime/bin/gen_snapshot.cc">gen_snapshot.cc</a>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>~/dart_bleeding/dart/xcodebuild/DebugIA32/test
</span><span class='line'><span class="nv">$ </span><span class="nb">cd </span>dart
</span><span class='line'>
</span><span class='line'>~/dart_bleeding/dart/xcodebuild/DebugIA32/test
</span><span class='line'><span class="nv">$ </span>git svn fetch
</span><span class='line'>
</span><span class='line'>~/dart_bleeding/dart/xcodebuild/DebugIA32/test
</span><span class='line'><span class="nv">$ </span>git merge git-svn
</span><span class='line'>
</span><span class='line'>~/dart_bleeding/dart/xcodebuild/DebugIA32/test
</span><span class='line'><span class="nv">$ </span>gclient sync
</span><span class='line'>
</span><span class='line'>~/dart_bleeding/dart/xcodebuild/DebugIA32/test
</span><span class='line'><span class="nv">$ </span>gclient runhooks
</span><span class='line'>
</span><span class='line'>~/dart_bleeding/dart/xcodebuild/DebugIA32/test
</span><span class='line'><span class="nv">$ </span>./tools/build.py -m all --verbose -a ia32 --os<span class="o">=</span>host -j 4
</span></code></pre></td></tr></table></div></figure>


<p>After that song and dance is finished the release build directory should contain the <code>gen_snapshot</code> executable.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>~/dart_bleeding
</span><span class='line'><span class="nv">$ </span><span class="nb">cd </span>dart/xcodebuild/ReleaseIA32/
</span><span class='line'>
</span><span class='line'>~/dart_bleeding/dart/xcodebuild/ReleaseIA32
</span><span class='line'><span class="nv">$ </span>ls
</span><span class='line'>analyzer                  libcrnspr.a               libdart_vm.a              libv8_base.a
</span><span class='line'>api_docs                  libcrnss.a                libdart_withcore.a        libv8_nosnapshot.a
</span><span class='line'>d8                        libcrnssckbi.a            libdouble_conversion.a    libv8_snapshot.a
</span><span class='line'>dart                      libdart.a                 libjscre.a                mksnapshot
</span><span class='line'>dart-sdk                  libdart_builtin.a         libnss_static_dart.a      packages
</span><span class='line'>dart2js.snapshot          libdart_dependency_helper libsample_extension.dylib process_test
</span><span class='line'>dart_no_snapshot          libdart_io.a              libsqlite3.a              run_vm_tests
</span><span class='line'>gen_snapshot              libdart_lib.a             libssl_dart.a
</span><span class='line'>libchrome_zlib.a          libdart_lib_withcore.a    libtest_extension.dylib
</span></code></pre></td></tr></table></div></figure>


<p>Running <code>gen_snapshot --help</code> we find the flags needed to generate a snapshot script.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>~/dart_bleeding/dart/xcodebuild/ReleaseIA32
</span><span class='line'><span class="nv">$ </span>./gen_snapshot --help
</span><span class='line'>No snapshot output file specified.
</span><span class='line'>
</span><span class='line'>Usage:
</span><span class='line'>
</span><span class='line'>  gen_snapshot <span class="o">[</span>&lt;vm-flags&gt;<span class="o">]</span> <span class="o">[</span>&lt;options&gt;<span class="o">]</span> <span class="se">\</span>
</span><span class='line'>               <span class="o">{</span>--script_snapshot<span class="o">=</span>&lt;out-file&gt; | --snapshot<span class="o">=</span>&lt;out-file&gt;<span class="o">}</span> <span class="se">\</span>
</span><span class='line'>               <span class="o">[</span>&lt;dart-script-file&gt;<span class="o">]</span>
</span><span class='line'>
</span><span class='line'>  Writes a snapshot of &lt;dart-script-file&gt; to &lt;out-file&gt;. If no
</span><span class='line'>  &lt;dart-script-file&gt; is passed, a generic snapshot of all the corelibs is
</span><span class='line'>  created. One of the following is required:
</span><span class='line'>
</span><span class='line'>    --script_snapshot<span class="o">=</span>&lt;file&gt;   Generates a script snapshot.
</span><span class='line'>    --snapshot<span class="o">=</span>&lt;file&gt;          Generates a <span class="nb">complete </span>snapshot. Uses the url
</span><span class='line'>                               mapping specified on the <span class="nb">command </span>line to load
</span><span class='line'>                               the libraries.
</span><span class='line'>Supported options:
</span><span class='line'>
</span><span class='line'>--package_root<span class="o">=</span>&lt;path&gt;
</span><span class='line'>  Where to find packages, that is, <span class="s2">&quot;package:...&quot;</span> imports.
</span><span class='line'>
</span><span class='line'>--url_mapping<span class="o">=</span>&lt;mapping&gt;
</span><span class='line'>  Uses the URL mapping<span class="o">(</span>s<span class="o">)</span> specified on the <span class="nb">command </span>line to load the
</span><span class='line'>  libraries. For use only with --snapshot<span class="o">=</span>.
</span></code></pre></td></tr></table></div></figure>


<p>The dart vm provides a flag that allows the vm to load the dart script from a snapshot.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>--use_script_snapshot<span class="o">=</span>&lt;file_name&gt;
</span><span class='line'>  executes Dart script present in the specified snapshot file
</span></code></pre></td></tr></table></div></figure>


<p>Combining all this together and using the <code>benchmark_harness</code> we can test out creating and running a dart application from a snapshot.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git clone https://github.com/financeCoding/benchmark_harness.git
</span><span class='line'>
</span><span class='line'>~/dart
</span><span class='line'><span class="nv">$ </span><span class="nb">cd </span>benchmark_harness/
</span><span class='line'>
</span><span class='line'>~/dart/benchmark_harness
</span><span class='line'><span class="nv">$ </span>pub install
</span><span class='line'>Resolving dependencies...
</span><span class='line'>Dependencies installed!
</span><span class='line'>
</span><span class='line'>~/dart/benchmark_harness
</span><span class='line'><span class="nv">$ </span><span class="nb">cd </span>example/
</span><span class='line'>
</span><span class='line'>~/dart/benchmark_harness/example
</span><span class='line'><span class="nv">$ </span>ls
</span><span class='line'>DeltaBlue.dart     Richards.dart      Template.dart      packages
</span><span class='line'>
</span><span class='line'>~/dart/benchmark_harness/example
</span><span class='line'><span class="nv">$ </span>~/dart_bleeding/dart/xcodebuild/DebugIA32/dart DeltaBlue.dart
</span><span class='line'>DeltaBlue<span class="o">(</span>RunTime<span class="o">)</span>: 4326.133909287257 us.
</span><span class='line'>
</span><span class='line'>~/dart/benchmark_harness/example
</span><span class='line'><span class="nv">$ </span>~/dart_bleeding/dart/xcodebuild/DebugIA32/dart Richards.dart
</span><span class='line'>Richards<span class="o">(</span>RunTime<span class="o">)</span>: 2135.538954108858 us.
</span><span class='line'>
</span><span class='line'>~/dart/benchmark_harness/example
</span><span class='line'><span class="nv">$ </span>~/dart_bleeding/dart/xcodebuild/DebugIA32/gen_snapshot --script_snapshot<span class="o">=</span>DeltaBlue.snapshot DeltaBlue.dart
</span><span class='line'>
</span><span class='line'>~/dart/benchmark_harness/example
</span><span class='line'><span class="nv">$ </span>~/dart_bleeding/dart/xcodebuild/DebugIA32/dart --use_script_snapshot<span class="o">=</span>./DeltaBlue.snapshot DeltaBlue.dart
</span><span class='line'>DeltaBlue<span class="o">(</span>RunTime<span class="o">)</span>: 4268.6567164179105 us.
</span><span class='line'>
</span><span class='line'>~/dart/benchmark_harness/example
</span><span class='line'><span class="nv">$ </span>~/dart_bleeding/dart/xcodebuild/DebugIA32/gen_snapshot --script_snapshot<span class="o">=</span>Richards.snapshot Richards.dart
</span><span class='line'>
</span><span class='line'>~/dart/benchmark_harness/example
</span><span class='line'><span class="nv">$ </span>~/dart_bleeding/dart/xcodebuild/DebugIA32/dart --use_script_snapshot<span class="o">=</span>./Richards.snapshot Richards.dart
</span><span class='line'>Richards<span class="o">(</span>RunTime<span class="o">)</span>: 2082.206035379813 us.
</span><span class='line'>
</span><span class='line'>~/dart/benchmark_harness/example
</span><span class='line'><span class="nv">$ </span>~/dart_bleeding/dart/xcodebuild/DebugIA32/dart --use_script_snapshot<span class="o">=</span>./Richards.snapshot Richards.dart
</span><span class='line'>Richards<span class="o">(</span>RunTime<span class="o">)</span>: 2079.002079002079 us.
</span></code></pre></td></tr></table></div></figure>


<p>The above examples might not be the best, but it&#8217;s a start to using snapshots and loading them from dart vm.</p>

<p>After reading <a href="http://www.johnmccutchan.com/">John McCutchan</a> comment below I&#8217;ve generated much more interesting output.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>23:49:47-adam@Adams-MacBook-Air:~/dart/benchmark_harness/example
</span><span class='line'><span class="nv">$ </span>~/dart_bleeding/dart/xcodebuild/DebugIA32/dart  --compiler_stats  --use_script_snapshot<span class="o">=</span>./Richards.snapshot Richards.dart
</span><span class='line'>Richards<span class="o">(</span>RunTime<span class="o">)</span>: 2069.2864529472595 us.
</span><span class='line'><span class="o">====</span> Compiler <span class="nv">Stats</span> <span class="o">====</span>
</span><span class='line'>Number of tokens:   0
</span><span class='line'>  Literal tokens:   0
</span><span class='line'>  Ident tokens:     0
</span><span class='line'>Tokens consumed:    6973 <span class="o">(</span>inf <span class="nb">times </span>number of tokens<span class="o">)</span>
</span><span class='line'>Tokens checked:     49617  <span class="o">(</span>7.12 <span class="nb">times </span>tokens consumed<span class="o">)</span>
</span><span class='line'>Token rewind:       3643 <span class="o">(</span>7% of tokens checked<span class="o">)</span>
</span><span class='line'>Token lookahead:    2361 <span class="o">(</span>4% of tokens checked<span class="o">)</span>
</span><span class='line'>Source length:      0 characters
</span><span class='line'>Scanner <span class="nb">time</span>:       0 msecs
</span><span class='line'>Parser <span class="nb">time</span>:        18 msecs
</span><span class='line'>Code gen. <span class="nb">time</span>:     66 msecs
</span><span class='line'>  Graph builder:    7 msecs
</span><span class='line'>  Graph SSA:        0 msecs
</span><span class='line'>  Graph inliner:    10 msecs
</span><span class='line'>    Parsing:        2 msecs
</span><span class='line'>    Building:       1 msecs
</span><span class='line'>    SSA:            1 msecs
</span><span class='line'>    Optimization:   2 msecs
</span><span class='line'>    Substitution:   0 msecs
</span><span class='line'>  Graph optimizer:  13 msecs
</span><span class='line'>  Graph compiler:   29 msecs
</span><span class='line'>  Code finalizer:   4 msecs
</span><span class='line'>Compilation speed:  0 tokens per msec
</span><span class='line'>Code size:          56 KB
</span><span class='line'>Code density:       0 tokens per KB
</span><span class='line'>23:50:06-adam@Adams-MacBook-Air:~/dart/benchmark_harness/example
</span><span class='line'><span class="nv">$ </span>~/dart_bleeding/dart/xcodebuild/DebugIA32/dart  --compiler_stats Richards.dart
</span><span class='line'>Richards<span class="o">(</span>RunTime<span class="o">)</span>: 2073.5751295336786 us.
</span><span class='line'><span class="o">====</span> Compiler <span class="nv">Stats</span> <span class="o">====</span>
</span><span class='line'>Number of tokens:   1981
</span><span class='line'>  Literal tokens:   68
</span><span class='line'>  Ident tokens:     692
</span><span class='line'>Tokens consumed:    13539 <span class="o">(</span>6.83 <span class="nb">times </span>number of tokens<span class="o">)</span>
</span><span class='line'>Tokens checked:     87271  <span class="o">(</span>6.45 <span class="nb">times </span>tokens consumed<span class="o">)</span>
</span><span class='line'>Token rewind:       5849 <span class="o">(</span>6% of tokens checked<span class="o">)</span>
</span><span class='line'>Token lookahead:    3954 <span class="o">(</span>4% of tokens checked<span class="o">)</span>
</span><span class='line'>Source length:      15543 characters
</span><span class='line'>Scanner <span class="nb">time</span>:       3 msecs
</span><span class='line'>Parser <span class="nb">time</span>:        23 msecs
</span><span class='line'>Code gen. <span class="nb">time</span>:     110 msecs
</span><span class='line'>  Graph builder:    5 msecs
</span><span class='line'>  Graph SSA:        0 msecs
</span><span class='line'>  Graph inliner:    13 msecs
</span><span class='line'>    Parsing:        2 msecs
</span><span class='line'>    Building:       2 msecs
</span><span class='line'>    SSA:            1 msecs
</span><span class='line'>    Optimization:   3 msecs
</span><span class='line'>    Substitution:   1 msecs
</span><span class='line'>  Graph optimizer:  13 msecs
</span><span class='line'>  Graph compiler:   69 msecs
</span><span class='line'>  Code finalizer:   6 msecs
</span><span class='line'>Compilation speed:  14 tokens per msec
</span><span class='line'>Code size:          89 KB
</span><span class='line'>Code density:       22 tokens per KB
</span><span class='line'>23:50:26-adam@Adams-MacBook-Air:~/dart/benchmark_harness/example
</span></code></pre></td></tr></table></div></figure>


<p>References made about snapshots in no particular order</p>

<ul>
<li><a href="http://www.infoq.com/articles/google-dart">infoq</a></li>
<li><a href="http://stackoverflow.com/questions/12871476/what-is-the-snapshot-concept-in-dart">What is the snapshot concept in dart?</a></li>
<li><a href="http://blog.sethladd.com/2012/09/what-dart-wants.html">what dart wants</a></li>
<li><a href="https://groups.google.com/a/dartlang.org/d/topic/misc/04Z3GHxk4As/discussion">runtime corelib</a></li>
<li><a href="https://groups.google.com/a/dartlang.org/d/topic/misc/_U6LZS226O4/discussion">snapshotting explanation for a Smalltalker</a></li>
<li><a href="https://groups.google.com/a/dartlang.org/d/topic/misc/BoHa1YN_itk/discussion">Dart Team Updates, Oct 30 - Nov 13</a></li>
<li><a href="http://www.dartlang.org/slides/2012/06/io12/Dart-A-Modern-Web-Language.pdf">Dart A Modern Web Language</a></li>
<li><a href="http://www.dartlang.org/slides/">Slides</a></li>
<li><a href="http://www.dartlang.org/dartisans/">Dartisans</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Listing files with Google Drive and Dart]]></title>
    <link href="http://financeCoding.github.com/blog/2013/01/06/listing-files-with-google-drive-and-dart/"/>
    <updated>2013-01-06T18:23:00-08:00</updated>
    <id>http://financeCoding.github.com/blog/2013/01/06/listing-files-with-google-drive-and-dart</id>
    <content type="html"><![CDATA[<p>Moving forward with my curiosity of Google <a href="http://financeCoding.github.com/blog/categories/Drive/">drive</a> and <a href="http://financeCoding.github.com/blog/categories/Dart/">Dart</a>, today was spent creating a small <a href="https://github.com/financeCoding/dart_drive_files_list">sample</a> that lists files. For the most part this is a continuation of the following post <a href="http://financeCoding.github.com/blog/2012/12/30/getting-started-with-dart-and-google-drive/">getting-started-with-dart-and-google-drive</a>.</p>

<p>Decided to move the loading of <a href="http://code.google.com/p/google-api-javascript-client/">client.js</a> into its own helper class for now. When dart has real support for Google client apis none of this will be needed. As of now this serves as good practice and examples of javascript/dart interop.</p>

<figure class='code'><figcaption><span>dart_drive_files_list.dart</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm"> * Sample google api client loader.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="kd">class</span> <span class="nc">GoogleApiClientLoader</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">static</span> <span class="kd">const</span> <span class="kt">String</span> <span class="n">_CLIENT_ID</span> <span class="o">=</span> <span class="s1">&#39;299615367852.apps.googleusercontent.com&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="kd">static</span> <span class="kd">const</span> <span class="kt">String</span> <span class="n">_SCOPE</span> <span class="o">=</span> <span class="s1">&#39;https://www.googleapis.com/auth/drive&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="kd">static</span> <span class="kd">const</span> <span class="kt">String</span> <span class="n">_handleClientLoadName</span> <span class="o">=</span> <span class="s2">&quot;handleClientLoad&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">static</span> <span class="kt">void</span> <span class="n">_loadScript</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="cm">/**</span>
</span><span class='line'><span class="cm">     * Create and load script element.</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'>    <span class="n">ScriptElement</span> <span class="n">script</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ScriptElement</span><span class="p">();</span>
</span><span class='line'>    <span class="n">script</span><span class="p">.</span><span class="n">src</span> <span class="o">=</span> <span class="s2">&quot;http://apis.google.com/js/client.js?onload=</span><span class="si">$</span><span class="n">_handleClientLoadName</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="n">script</span><span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="s2">&quot;text/javascript&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="n">document</span><span class="p">.</span><span class="n">body</span><span class="p">.</span><span class="n">children</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">script</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">static</span> <span class="kt">void</span> <span class="n">_createScopedCallbacks</span><span class="p">(</span><span class="kd">var</span> <span class="n">completer</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">js</span><span class="p">.</span><span class="n">scoped</span><span class="p">((){</span>
</span><span class='line'>      <span class="cm">/**</span>
</span><span class='line'><span class="cm">       * handleAuthResult is called from javascript when</span>
</span><span class='line'><span class="cm">       * the function to call once the login process is complete.</span>
</span><span class='line'><span class="cm">       */</span>
</span><span class='line'>      <span class="n">js</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">handleAuthResult</span> <span class="o">=</span> <span class="k">new</span> <span class="n">js</span><span class="p">.</span><span class="n">Callback</span><span class="p">.</span><span class="n">many</span><span class="p">((</span><span class="n">js</span><span class="p">.</span><span class="n">Proxy</span> <span class="n">authResult</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">Map</span> <span class="n">dartAuthResult</span> <span class="o">=</span> <span class="n">JSON</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="n">js</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">JSON</span><span class="p">.</span><span class="n">stringify</span><span class="p">(</span><span class="n">authResult</span><span class="p">));</span>
</span><span class='line'>        <span class="n">completer</span><span class="p">.</span><span class="n">complete</span><span class="p">(</span><span class="n">dartAuthResult</span><span class="p">);</span>
</span><span class='line'>      <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>      <span class="cm">/**</span>
</span><span class='line'><span class="cm">       * This javascript method is called when the client.js script</span>
</span><span class='line'><span class="cm">       * is loaded.</span>
</span><span class='line'><span class="cm">       */</span>
</span><span class='line'>      <span class="n">js</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">handleClientLoad</span> <span class="o">=</span>  <span class="k">new</span> <span class="n">js</span><span class="p">.</span><span class="n">Callback</span><span class="p">.</span><span class="n">many</span><span class="p">(()</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">js</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">window</span><span class="p">.</span><span class="n">setTimeout</span><span class="p">(</span><span class="n">js</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">checkAuth</span><span class="p">,</span> <span class="m">1</span><span class="p">);</span>
</span><span class='line'>      <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>      <span class="cm">/**</span>
</span><span class='line'><span class="cm">       * Authorization check if the client allows this</span>
</span><span class='line'><span class="cm">       * application to access its google drive.</span>
</span><span class='line'><span class="cm">       */</span>
</span><span class='line'>      <span class="n">js</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">checkAuth</span> <span class="o">=</span> <span class="k">new</span> <span class="n">js</span><span class="p">.</span><span class="n">Callback</span><span class="p">.</span><span class="n">many</span><span class="p">(()</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">js</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">gapi</span><span class="p">.</span><span class="n">auth</span><span class="p">.</span><span class="n">authorize</span><span class="p">(</span>
</span><span class='line'>            <span class="n">js</span><span class="p">.</span><span class="n">map</span><span class="p">({</span>
</span><span class='line'>              <span class="s1">&#39;client_id&#39;</span><span class="o">:</span> <span class="n">_CLIENT_ID</span><span class="p">,</span>
</span><span class='line'>              <span class="s1">&#39;scope&#39;</span><span class="o">:</span> <span class="n">_SCOPE</span><span class="p">,</span>
</span><span class='line'>              <span class="s1">&#39;immediate&#39;</span><span class="o">:</span> <span class="kc">true</span>
</span><span class='line'>            <span class="p">}),</span>
</span><span class='line'>            <span class="n">js</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">handleAuthResult</span><span class="p">);</span>
</span><span class='line'>      <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/**</span>
</span><span class='line'><span class="cm">   * Load the google client api, future returns</span>
</span><span class='line'><span class="cm">   * map results.</span>
</span><span class='line'><span class="cm">   */</span>
</span><span class='line'>  <span class="kd">static</span> <span class="n">Future</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&gt;</span> <span class="n">load</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="n">completer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Completer</span><span class="p">();</span>
</span><span class='line'>    <span class="n">_createScopedCallbacks</span><span class="p">(</span><span class="n">completer</span><span class="p">);</span>
</span><span class='line'>    <span class="n">_loadScript</span><span class="p">();</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">completer</span><span class="p">.</span><span class="n">future</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The calling of <code>load()</code> returns a future with our authentication results. Eases the process of having the google drive scope available to the client application.</p>

<p>A simple dart <code>Drive</code> class created gives access to the list call from the javascript apis. The interesting point for me to learn is knowing that <code>client.js</code> has to load the drive api. In the <code>load()</code> future we call <code>js.context.gapi.client.load</code> which will take the api and version to be loaded for the client application.</p>

<figure class='code'><figcaption><span>dart_drive_files_list.dart</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm"> * Sample google drive class.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="kd">class</span> <span class="nc">Drive</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">js</span><span class="p">.</span><span class="n">Proxy</span> <span class="n">_drive</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">bool</span> <span class="kd">get</span> <span class="n">_isLoaded</span> <span class="o">=&gt;</span> <span class="n">_drive</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/**</span>
</span><span class='line'><span class="cm">   * Load the gapi.client.drive api.</span>
</span><span class='line'><span class="cm">   */</span>
</span><span class='line'>  <span class="n">Future</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span> <span class="n">load</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="n">completer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Completer</span><span class="p">();</span>
</span><span class='line'>    <span class="n">js</span><span class="p">.</span><span class="n">scoped</span><span class="p">(()</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">js</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">gapi</span><span class="p">.</span><span class="n">client</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;drive&#39;</span><span class="p">,</span> <span class="s1">&#39;v2&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="n">js</span><span class="p">.</span><span class="n">Callback</span><span class="p">.</span><span class="n">once</span><span class="p">(()</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">_drive</span> <span class="o">=</span> <span class="n">js</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">gapi</span><span class="p">.</span><span class="n">client</span><span class="p">.</span><span class="n">drive</span><span class="p">;</span>
</span><span class='line'>        <span class="n">js</span><span class="p">.</span><span class="n">retain</span><span class="p">(</span><span class="n">_drive</span><span class="p">);</span>
</span><span class='line'>        <span class="n">completer</span><span class="p">.</span><span class="n">complete</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}));</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">completer</span><span class="p">.</span><span class="n">future</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/**</span>
</span><span class='line'><span class="cm">   * Check if gapi.client.drive is loaded, if not</span>
</span><span class='line'><span class="cm">   * load before executing.</span>
</span><span class='line'><span class="cm">   */</span>
</span><span class='line'>  <span class="kt">void</span> <span class="n">_loadederExecute</span><span class="p">(</span><span class="n">Function</span> <span class="n">function</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">_isLoaded</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">function</span><span class="p">();</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">load</span><span class="p">().</span><span class="n">then</span><span class="p">((</span><span class="n">s</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">s</span> <span class="o">==</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="n">function</span><span class="p">();</span>
</span><span class='line'>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>          <span class="k">throw</span> <span class="s2">&quot;loadedExecute failed&quot;</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="p">});</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/**</span>
</span><span class='line'><span class="cm">   * List files with gapi.drive.files.list()</span>
</span><span class='line'><span class="cm">   */</span>
</span><span class='line'>  <span class="n">Future</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&gt;</span> <span class="n">list</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="n">completer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Completer</span><span class="p">();</span>
</span><span class='line'>    <span class="n">_loadederExecute</span><span class="p">(()</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">js</span><span class="p">.</span><span class="n">scoped</span><span class="p">(()</span> <span class="p">{</span>
</span><span class='line'>        <span class="kd">var</span> <span class="n">request</span> <span class="o">=</span> <span class="n">_drive</span><span class="p">.</span><span class="n">files</span><span class="p">.</span><span class="n">list</span><span class="p">();</span>
</span><span class='line'>        <span class="n">request</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="k">new</span> <span class="n">js</span><span class="p">.</span><span class="n">Callback</span><span class="p">.</span><span class="n">once</span><span class="p">((</span><span class="n">js</span><span class="p">.</span><span class="n">Proxy</span> <span class="n">jsonResp</span><span class="p">,</span> <span class="kd">var</span> <span class="n">rawResp</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="n">Map</span> <span class="n">m</span> <span class="o">=</span> <span class="n">JSON</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="n">js</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">JSON</span><span class="p">.</span><span class="n">stringify</span><span class="p">(</span><span class="n">jsonResp</span><span class="p">));</span>
</span><span class='line'>          <span class="n">completer</span><span class="p">.</span><span class="n">complete</span><span class="p">(</span><span class="n">m</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}));</span>
</span><span class='line'>      <span class="p">});</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">completer</span><span class="p">.</span><span class="n">future</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>With the following sugar classes it was easy to just list files from my google drive account.</p>

<figure class='code'><figcaption><span>dart_drive_files_list.dart</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'><span class="kt">void</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">Drive</span> <span class="n">drive</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Drive</span><span class="p">();</span>
</span><span class='line'>  <span class="n">GoogleApiClientLoader</span><span class="p">.</span><span class="n">load</span><span class="p">().</span><span class="n">then</span><span class="p">((</span><span class="n">result</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">drive</span><span class="p">.</span><span class="n">list</span><span class="p">().</span><span class="n">then</span><span class="p">((</span><span class="n">Map</span> <span class="n">files</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="c1">// https://developers.google.com/drive/v2/reference/files/list</span>
</span><span class='line'>      <span class="n">files</span><span class="p">[</span><span class="s1">&#39;items&#39;</span><span class="p">].</span><span class="n">forEach</span><span class="p">((</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="kd">var</span> <span class="n">li</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LIElement</span><span class="p">();</span>
</span><span class='line'>        <span class="n">AnchorElement</span> <span class="n">a</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AnchorElement</span><span class="p">();</span>
</span><span class='line'>        <span class="n">a</span><span class="p">.</span><span class="n">href</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;alternateLink&#39;</span><span class="p">];</span>
</span><span class='line'>        <span class="n">a</span><span class="p">.</span><span class="n">target</span> <span class="o">=</span> <span class="s1">&#39;_blank&#39;</span><span class="p">;</span>
</span><span class='line'>        <span class="n">a</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">];</span>
</span><span class='line'>        <span class="n">li</span><span class="p">.</span><span class="n">children</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
</span><span class='line'>        <span class="n">UListElement</span> <span class="n">ul</span> <span class="o">=</span> <span class="n">query</span><span class="p">(</span><span class="s1">&#39;#listmenu&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="n">ul</span><span class="p">.</span><span class="n">children</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">li</span><span class="p">);</span>
</span><span class='line'>      <span class="p">});</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><a href="http://financeCoding.github.com/images/2013-01-06-listing-files-with-google-drive-and-dart/listing_files_google_drive.png"><img src="http://financeCoding.github.com/images/2013-01-06-listing-files-with-google-drive-and-dart/listing_files_google_drive.png" alt="listing-files-drive" /></a></p>

<p>Hopefully this helps with developers interested in google drive &amp; dart! Sample can be found on github <a href="https://github.com/financeCoding/dart_drive_files_list">dart_drive_files_list</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Last Dart mashup for 2012 - Clock Chrome App Drives ADK2012]]></title>
    <link href="http://financeCoding.github.com/blog/2012/12/31/last-dart-mashup-for-2012-clock-chrome-app-drives-adk2012/"/>
    <updated>2012-12-31T13:03:00-08:00</updated>
    <id>http://financeCoding.github.com/blog/2012/12/31/last-dart-mashup-for-2012-clock-chrome-app-drives-adk2012</id>
    <content type="html"><![CDATA[<p>My last dart mashup for the year, excited to see what the community and dart team brings for 2013.</p>

<iframe width="560" height="315" src="http://www.youtube.com/embed/-Z-cxc3OXpE" frameborder="0" allowfullscreen></iframe>


<p>All source code can be found in the example directory of <a href="https://github.com/dart-gde/chrome.dart">chrome.dart</a>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Getting started with Dart and Google Drive]]></title>
    <link href="http://financeCoding.github.com/blog/2012/12/30/getting-started-with-dart-and-google-drive/"/>
    <updated>2012-12-30T16:27:00-08:00</updated>
    <id>http://financeCoding.github.com/blog/2012/12/30/getting-started-with-dart-and-google-drive</id>
    <content type="html"><![CDATA[<p>Following the example code from google drive <a href="https://developers.google.com/drive/quickstart-js">quickstart</a> I was able to recreate the sample in <a href="http://www.dartlang.org">Dart</a>. A lot of the heavy lifting is done by the <a href="https://github.com/dart-lang/js-interop">js-interop</a> cause of the dependency on <a href="http://code.google.com/p/google-api-javascript-client">google javascript client api</a>. This solution is fine for now, I&#8217;d take a good guess the dart team will provide client apis at some point.</p>

<p>Started off by creating a new sample project <code>dart_drive_quickstart</code>, removed all default code and add js-interop.</p>

<p><a href="http://financeCoding.github.com/images/2012-12-30-getting-started-with-dart-and-google-drive/create-new-app.png"><img src="http://financeCoding.github.com/images/2012-12-30-getting-started-with-dart-and-google-drive/create-new-app.png" alt="create-new-app" /></a></p>

<p><a href="http://financeCoding.github.com/images/2012-12-30-getting-started-with-dart-and-google-drive/remove-defaults.png"><img src="http://financeCoding.github.com/images/2012-12-30-getting-started-with-dart-and-google-drive/remove-defaults.png" alt="remove-defaults" /></a></p>

<p>Bring in the javascript client apis as <code>ScriptElement</code> and set a <code>onload</code> handler to a dart callback.</p>

<figure class='code'><figcaption><span>dart_drive_quickstart.dart</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'><span class="n">import</span> <span class="s1">&#39;dart:html&#39;</span><span class="p">;</span>
</span><span class='line'><span class="n">import</span> <span class="s1">&#39;dart:json&#39;</span><span class="p">;</span>
</span><span class='line'><span class="n">import</span> <span class="s1">&#39;package:js/js.dart&#39;</span> <span class="n">as</span> <span class="n">js</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">final</span> <span class="kt">String</span> <span class="n">CLIENT_ID</span> <span class="o">=</span> <span class="s1">&#39;&lt;YOURCLIENTID&gt;&#39;</span><span class="p">;</span>
</span><span class='line'><span class="kd">final</span> <span class="kt">String</span> <span class="n">SCOPE</span> <span class="o">=</span> <span class="s1">&#39;https://www.googleapis.com/auth/drive&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">js</span><span class="p">.</span><span class="n">scoped</span><span class="p">((){</span>
</span><span class='line'>    <span class="n">js</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">handleAuthResult</span> <span class="o">=</span> <span class="k">new</span> <span class="n">js</span><span class="p">.</span><span class="n">Callback</span><span class="p">.</span><span class="n">many</span><span class="p">((</span><span class="n">js</span><span class="p">.</span><span class="n">Proxy</span> <span class="n">authResult</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">Map</span> <span class="n">dartAuthResult</span> <span class="o">=</span> <span class="n">JSON</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="n">js</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">JSON</span><span class="p">.</span><span class="n">stringify</span><span class="p">(</span><span class="n">authResult</span><span class="p">));</span>
</span><span class='line'>      <span class="n">print</span><span class="p">(</span><span class="s2">&quot;dartAuthResult = </span><span class="si">${</span><span class="n">dartAuthResult</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">js</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">handleClientLoad</span> <span class="o">=</span>  <span class="k">new</span> <span class="n">js</span><span class="p">.</span><span class="n">Callback</span><span class="p">.</span><span class="n">many</span><span class="p">(()</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">js</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">window</span><span class="p">.</span><span class="n">setTimeout</span><span class="p">(</span><span class="n">js</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">checkAuth</span><span class="p">,</span> <span class="m">1</span><span class="p">);</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">js</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">checkAuth</span> <span class="o">=</span> <span class="k">new</span> <span class="n">js</span><span class="p">.</span><span class="n">Callback</span><span class="p">.</span><span class="n">many</span><span class="p">(()</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">js</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">gapi</span><span class="p">.</span><span class="n">auth</span><span class="p">.</span><span class="n">authorize</span><span class="p">(</span>
</span><span class='line'>          <span class="n">js</span><span class="p">.</span><span class="n">map</span><span class="p">({</span>
</span><span class='line'>              <span class="s1">&#39;client_id&#39;</span><span class="o">:</span> <span class="n">CLIENT_ID</span><span class="p">,</span>
</span><span class='line'>              <span class="s1">&#39;scope&#39;</span><span class="o">:</span> <span class="n">SCOPE</span><span class="p">,</span>
</span><span class='line'>              <span class="s1">&#39;immediate&#39;</span><span class="o">:</span> <span class="kc">true</span>
</span><span class='line'>            <span class="p">}),</span>
</span><span class='line'>            <span class="n">js</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">handleAuthResult</span><span class="p">);</span>
</span><span class='line'>    <span class="p">});</span>        
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">ScriptElement</span> <span class="n">script</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ScriptElement</span><span class="p">();</span>
</span><span class='line'>  <span class="n">script</span><span class="p">.</span><span class="n">src</span> <span class="o">=</span> <span class="s2">&quot;http://apis.google.com/js/client.js?onload=handleClientLoad&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="n">script</span><span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="s2">&quot;text/javascript&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="n">document</span><span class="p">.</span><span class="n">body</span><span class="p">.</span><span class="n">children</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">script</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Manually adding the script code and hooking up a callback from javascript to dart seemed to work fine. I ran into issues with callbacks not being scoped when they should of been scoped. Another odd thing was the need for the call to <code>setTimeout</code>, the callback to <code>handleAuthResult</code> would not get fired if <code>checkAuth</code> was not called from <code>setTimeout</code>.</p>

<p>The rest of the code included was for the most part a direct translation of the quickstart sample. Added some dart flavoring when appropriate.</p>

<p>Here are some action shots and code. The full project can be found on github <a href="https://github.com/financeCoding/dart_drive_quickstart">dart_drive_quickstart</a></p>

<p><a href="http://financeCoding.github.com/images/2012-12-30-getting-started-with-dart-and-google-drive/app-launched.png"><img src="http://financeCoding.github.com/images/2012-12-30-getting-started-with-dart-and-google-drive/app-launched.png" alt="app-launched" /></a></p>

<p><a href="http://financeCoding.github.com/images/2012-12-30-getting-started-with-dart-and-google-drive/file-choose.png"><img src="http://financeCoding.github.com/images/2012-12-30-getting-started-with-dart-and-google-drive/file-choose.png" alt="file-choose" /></a></p>

<p><a href="http://financeCoding.github.com/images/2012-12-30-getting-started-with-dart-and-google-drive/file-uploaded.png"><img src="http://financeCoding.github.com/images/2012-12-30-getting-started-with-dart-and-google-drive/file-uploaded.png" alt="file-uploaded" /></a></p>

<p><a href="http://financeCoding.github.com/images/2012-12-30-getting-started-with-dart-and-google-drive/file-opened-in-drive.png"><img src="http://financeCoding.github.com/images/2012-12-30-getting-started-with-dart-and-google-drive/file-opened-in-drive.png" alt="file-opened-in-drive" /></a></p>

<figure class='code'><figcaption><span>dart_drive_quickstart.dart</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'><span class="n">import</span> <span class="s1">&#39;dart:html&#39;</span><span class="p">;</span>
</span><span class='line'><span class="n">import</span> <span class="s1">&#39;dart:json&#39;</span><span class="p">;</span>
</span><span class='line'><span class="n">import</span> <span class="s1">&#39;package:js/js.dart&#39;</span> <span class="n">as</span> <span class="n">js</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">final</span> <span class="kt">String</span> <span class="n">CLIENT_ID</span> <span class="o">=</span> <span class="s1">&#39;299615367852.apps.googleusercontent.com&#39;</span><span class="p">;</span>
</span><span class='line'><span class="kd">final</span> <span class="kt">String</span> <span class="n">SCOPE</span> <span class="o">=</span> <span class="s1">&#39;https://www.googleapis.com/auth/drive&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">js</span><span class="p">.</span><span class="n">scoped</span><span class="p">((){</span>
</span><span class='line'>    <span class="kt">void</span> <span class="n">insertFile</span><span class="p">(</span><span class="n">File</span> <span class="n">fileData</span><span class="p">,</span> <span class="p">[</span><span class="n">callback</span> <span class="o">=</span> <span class="kc">null</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'>      <span class="kt">String</span> <span class="n">boundary</span> <span class="o">=</span> <span class="s1">&#39;-------314159265358979323846&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="kt">String</span> <span class="n">delimiter</span> <span class="o">=</span> <span class="s2">&quot;\r\n--</span><span class="si">$</span><span class="n">boundary</span><span class="s2">\r\n&quot;</span><span class="p">;</span>
</span><span class='line'>      <span class="kt">String</span> <span class="n">close_delim</span> <span class="o">=</span> <span class="s2">&quot;\r\n--</span><span class="si">$</span><span class="n">boundary</span><span class="s2">--&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="kd">var</span> <span class="n">reader</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileReader</span><span class="p">();</span>
</span><span class='line'>      <span class="n">reader</span><span class="p">.</span><span class="n">readAsBinaryString</span><span class="p">(</span><span class="n">fileData</span><span class="p">);</span>
</span><span class='line'>      <span class="n">reader</span><span class="p">.</span><span class="n">on</span><span class="p">.</span><span class="n">load</span><span class="p">.</span><span class="n">add</span><span class="p">((</span><span class="n">Event</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="kd">var</span> <span class="n">contentType</span> <span class="o">=</span> <span class="n">fileData</span><span class="p">.</span><span class="n">type</span><span class="p">;</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">contentType</span><span class="p">.</span><span class="n">isEmpty</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="n">contentType</span> <span class="o">=</span> <span class="s1">&#39;application/octet-stream&#39;</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="kd">var</span> <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>          <span class="s1">&#39;title&#39;</span> <span class="o">:</span> <span class="n">fileData</span><span class="p">.</span><span class="n">name</span><span class="p">,</span>
</span><span class='line'>          <span class="s1">&#39;mimeType&#39;</span> <span class="o">:</span> <span class="n">contentType</span>
</span><span class='line'>        <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>        <span class="kd">var</span> <span class="n">base64Data</span> <span class="o">=</span> <span class="n">window</span><span class="p">.</span><span class="n">btoa</span><span class="p">(</span><span class="n">reader</span><span class="p">.</span><span class="n">result</span><span class="p">);</span>
</span><span class='line'>        <span class="kd">var</span> <span class="n">sb</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">String</span><span class="n">Buffer</span><span class="p">();</span>
</span><span class='line'>        <span class="n">sb</span>
</span><span class='line'>        <span class="p">..</span><span class="n">add</span><span class="p">(</span><span class="n">delimiter</span><span class="p">)</span>
</span><span class='line'>        <span class="p">..</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;Content-Type: application/json\r\n\r\n&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="p">..</span><span class="n">add</span><span class="p">(</span><span class="n">JSON</span><span class="p">.</span><span class="n">stringify</span><span class="p">(</span><span class="n">metadata</span><span class="p">))</span>
</span><span class='line'>        <span class="p">..</span><span class="n">add</span><span class="p">(</span><span class="n">delimiter</span><span class="p">)</span>
</span><span class='line'>        <span class="p">..</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;Content-Type: &#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="p">..</span><span class="n">add</span><span class="p">(</span><span class="n">contentType</span><span class="p">)</span>
</span><span class='line'>        <span class="p">..</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;\r\n&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="p">..</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;Content-Transfer-Encoding: base64\r\n&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="p">..</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;\r\n&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="p">..</span><span class="n">add</span><span class="p">(</span><span class="n">base64Data</span><span class="p">)</span>
</span><span class='line'>        <span class="p">..</span><span class="n">add</span><span class="p">(</span><span class="n">close_delim</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="kd">var</span> <span class="n">multipartRequestBody</span> <span class="o">=</span> <span class="n">sb</span><span class="p">.</span><span class="n">toString</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">print</span><span class="p">(</span><span class="s2">&quot;multipartRequestBody&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="n">print</span><span class="p">(</span><span class="n">multipartRequestBody</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">js</span><span class="p">.</span><span class="n">scoped</span><span class="p">(()</span> <span class="p">{</span>
</span><span class='line'>          <span class="kd">var</span> <span class="n">request</span> <span class="o">=</span> <span class="n">js</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">gapi</span><span class="p">.</span><span class="n">client</span><span class="p">.</span><span class="n">request</span><span class="p">(</span>
</span><span class='line'>            <span class="n">js</span><span class="p">.</span><span class="n">map</span><span class="p">({</span>
</span><span class='line'>              <span class="s1">&#39;path&#39;</span><span class="o">:</span> <span class="s1">&#39;/upload/drive/v2/files&#39;</span><span class="p">,</span>
</span><span class='line'>              <span class="s1">&#39;method&#39;</span><span class="o">:</span> <span class="s1">&#39;POST&#39;</span><span class="p">,</span>
</span><span class='line'>              <span class="s1">&#39;params&#39;</span><span class="o">:</span> <span class="p">{</span><span class="s1">&#39;uploadType&#39;</span><span class="o">:</span> <span class="s1">&#39;multipart&#39;</span><span class="p">},</span>
</span><span class='line'>              <span class="s1">&#39;headers&#39;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>                <span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span> <span class="s1">&#39;multipart/mixed; boundary=&quot;</span><span class="si">$</span><span class="n">boundary</span><span class="s1">&quot;&#39;</span>
</span><span class='line'>              <span class="p">},</span>
</span><span class='line'>              <span class="s1">&#39;body&#39;</span><span class="o">:</span> <span class="n">multipartRequestBody</span>
</span><span class='line'>            <span class="p">}));</span>
</span><span class='line'>
</span><span class='line'>          <span class="k">if</span> <span class="p">(</span><span class="n">callback</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">callback</span> <span class="o">=</span> <span class="k">new</span> <span class="n">js</span><span class="p">.</span><span class="n">Callback</span><span class="p">.</span><span class="n">many</span><span class="p">((</span><span class="n">js</span><span class="p">.</span><span class="n">Proxy</span> <span class="n">jsonResp</span><span class="p">,</span> <span class="kd">var</span> <span class="n">rawResp</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>              <span class="n">print</span><span class="p">(</span><span class="n">js</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">JSON</span><span class="p">.</span><span class="n">stringify</span><span class="p">(</span><span class="n">jsonResp</span><span class="p">));</span>
</span><span class='line'>              <span class="n">print</span><span class="p">(</span><span class="n">rawResp</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>              <span class="n">Map</span> <span class="n">r</span> <span class="o">=</span> <span class="n">JSON</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="n">js</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">JSON</span><span class="p">.</span><span class="n">stringify</span><span class="p">(</span><span class="n">jsonResp</span><span class="p">));</span>
</span><span class='line'>              <span class="kt">String</span><span class="n">Buffer</span> <span class="n">sb</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">String</span><span class="n">Buffer</span><span class="p">();</span>
</span><span class='line'>              <span class="k">if</span> <span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">containsKey</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>                <span class="n">sb</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">toString</span><span class="p">());</span>
</span><span class='line'>              <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>                <span class="n">sb</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">${</span><span class="n">r</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span><span class="si">}</span><span class="s2"> has been uploaded.&quot;</span><span class="p">);</span>
</span><span class='line'>              <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>              <span class="n">query</span><span class="p">(</span><span class="s1">&#39;#text&#39;</span><span class="p">).</span><span class="n">text</span> <span class="o">=</span> <span class="n">sb</span><span class="p">.</span><span class="n">toString</span><span class="p">();</span>
</span><span class='line'>            <span class="p">});</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>          <span class="n">request</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="n">callback</span><span class="p">);</span>
</span><span class='line'>        <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>      <span class="p">});</span>
</span><span class='line'>    <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>    <span class="kt">void</span> <span class="n">uploadFile</span><span class="p">(</span><span class="n">Event</span> <span class="n">evt</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">js</span><span class="p">.</span><span class="n">scoped</span><span class="p">(</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">js</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">gapi</span><span class="p">.</span><span class="n">client</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;drive&#39;</span><span class="p">,</span> <span class="s1">&#39;v2&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="n">js</span><span class="p">.</span><span class="n">Callback</span><span class="p">.</span><span class="n">many</span><span class="p">(()</span> <span class="p">{</span>
</span><span class='line'>          <span class="kd">var</span> <span class="n">file</span> <span class="o">=</span> <span class="n">evt</span><span class="p">.</span><span class="n">target</span><span class="p">.</span><span class="n">files</span><span class="p">[</span><span class="m">0</span><span class="p">];</span>
</span><span class='line'>          <span class="n">insertFile</span><span class="p">(</span><span class="n">file</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}));</span>
</span><span class='line'>      <span class="p">});</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">js</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">handleAuthResult</span> <span class="o">=</span> <span class="k">new</span> <span class="n">js</span><span class="p">.</span><span class="n">Callback</span><span class="p">.</span><span class="n">many</span><span class="p">((</span><span class="n">js</span><span class="p">.</span><span class="n">Proxy</span> <span class="n">authResult</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">Map</span> <span class="n">dartAuthResult</span> <span class="o">=</span> <span class="n">JSON</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="n">js</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">JSON</span><span class="p">.</span><span class="n">stringify</span><span class="p">(</span><span class="n">authResult</span><span class="p">));</span>
</span><span class='line'>      <span class="n">print</span><span class="p">(</span><span class="s2">&quot;dartAuthResult = </span><span class="si">${</span><span class="n">dartAuthResult</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="kd">var</span> <span class="n">authButton</span> <span class="o">=</span> <span class="n">query</span><span class="p">(</span><span class="s1">&#39;#authorizeButton&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="kd">var</span> <span class="n">filePicker</span> <span class="o">=</span> <span class="n">query</span><span class="p">(</span><span class="s1">&#39;#filePicker&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="n">authButton</span><span class="p">.</span><span class="n">style</span><span class="p">.</span><span class="n">display</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="n">filePicker</span><span class="p">.</span><span class="n">style</span><span class="p">.</span><span class="n">display</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">dartAuthResult</span><span class="p">.</span><span class="n">containsKey</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">// Access token has been successfully retrieved, requests can be sent to the API.</span>
</span><span class='line'>        <span class="n">filePicker</span><span class="p">.</span><span class="n">style</span><span class="p">.</span><span class="n">display</span> <span class="o">=</span> <span class="s1">&#39;block&#39;</span><span class="p">;</span>
</span><span class='line'>        <span class="n">filePicker</span><span class="p">.</span><span class="n">on</span><span class="p">[</span><span class="s1">&#39;change&#39;</span><span class="p">].</span><span class="n">add</span><span class="p">(</span><span class="n">uploadFile</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">authButton</span><span class="p">.</span><span class="n">style</span><span class="p">.</span><span class="n">display</span> <span class="o">=</span> <span class="s1">&#39;block&#39;</span><span class="p">;</span>
</span><span class='line'>        <span class="n">authButton</span><span class="p">.</span><span class="n">on</span><span class="p">.</span><span class="n">click</span><span class="p">.</span><span class="n">add</span><span class="p">((</span><span class="n">Event</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="n">js</span><span class="p">.</span><span class="n">scoped</span><span class="p">(()</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">js</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">gapi</span><span class="p">.</span><span class="n">auth</span><span class="p">.</span><span class="n">authorize</span><span class="p">(</span>
</span><span class='line'>                <span class="n">js</span><span class="p">.</span><span class="n">map</span><span class="p">({</span>
</span><span class='line'>                    <span class="s1">&#39;client_id&#39;</span><span class="o">:</span> <span class="n">CLIENT_ID</span><span class="p">,</span>
</span><span class='line'>                    <span class="s1">&#39;scope&#39;</span><span class="o">:</span> <span class="n">SCOPE</span><span class="p">,</span>
</span><span class='line'>                    <span class="s1">&#39;immediate&#39;</span><span class="o">:</span> <span class="kc">true</span>
</span><span class='line'>                  <span class="p">}),</span>
</span><span class='line'>                  <span class="n">js</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">handleAuthResult</span><span class="p">);</span>
</span><span class='line'>          <span class="p">});</span>
</span><span class='line'>        <span class="p">});</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">js</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">handleClientLoad</span> <span class="o">=</span>  <span class="k">new</span> <span class="n">js</span><span class="p">.</span><span class="n">Callback</span><span class="p">.</span><span class="n">many</span><span class="p">(()</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">js</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">window</span><span class="p">.</span><span class="n">setTimeout</span><span class="p">(</span><span class="n">js</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">checkAuth</span><span class="p">,</span> <span class="m">1</span><span class="p">);</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">js</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">checkAuth</span> <span class="o">=</span> <span class="k">new</span> <span class="n">js</span><span class="p">.</span><span class="n">Callback</span><span class="p">.</span><span class="n">many</span><span class="p">(()</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">js</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">gapi</span><span class="p">.</span><span class="n">auth</span><span class="p">.</span><span class="n">authorize</span><span class="p">(</span>
</span><span class='line'>          <span class="n">js</span><span class="p">.</span><span class="n">map</span><span class="p">({</span>
</span><span class='line'>              <span class="s1">&#39;client_id&#39;</span><span class="o">:</span> <span class="n">CLIENT_ID</span><span class="p">,</span>
</span><span class='line'>              <span class="s1">&#39;scope&#39;</span><span class="o">:</span> <span class="n">SCOPE</span><span class="p">,</span>
</span><span class='line'>              <span class="s1">&#39;immediate&#39;</span><span class="o">:</span> <span class="kc">true</span>
</span><span class='line'>            <span class="p">}),</span>
</span><span class='line'>            <span class="n">js</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">handleAuthResult</span><span class="p">);</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">ScriptElement</span> <span class="n">script</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ScriptElement</span><span class="p">();</span>
</span><span class='line'>  <span class="n">script</span><span class="p">.</span><span class="n">src</span> <span class="o">=</span> <span class="s2">&quot;http://apis.google.com/js/client.js?onload=handleClientLoad&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="n">script</span><span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="s2">&quot;text/javascript&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="n">document</span><span class="p">.</span><span class="n">body</span><span class="p">.</span><span class="n">children</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">script</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[builtool and libraries with cordova in dart on ios]]></title>
    <link href="http://financeCoding.github.com/blog/2012/12/29/builtool-and-libraries-with-cordova-in-dart-on-ios/"/>
    <updated>2012-12-29T21:36:00-08:00</updated>
    <id>http://financeCoding.github.com/blog/2012/12/29/builtool-and-libraries-with-cordova-in-dart-on-ios</id>
    <content type="html"><![CDATA[<p>Continuing on the chain of <a href="http://financeCoding.github.com/blog/categories/phonegap-from-scratch/">phonegap_from_scratch</a>, this post goes over <a href="https://github.com/dart-lang/buildtool">buildtool</a> and libraries.</p>

<p>Took an afternoon to look into using <a href="https://github.com/dart-lang/buildtool">buildtool</a> for helping call dart2js on save within the DartEditor. Minor <a href="https://github.com/financeCoding/buildtool/commit/0692911befaa5705a2928ffaa532c295191d1155">modifications</a> was needed to redirect the generated javascript code to the cordova <code>www</code> directory in the project. This tool is still in the works and future versions will be more robust.</p>

<p>The trend with dart currently is to use <code>pub</code> with github or to publish on <a href="http://pub.dartlang.org/">pub.dartlang.org</a>. A great feature with <code>pub</code> is if you want to make modifications to an existing project on github, <code>fork+branch</code> is an easy way to get hacking with modifications to an existing package. <code>buildtool</code>&#8217;s quick hack was added to the pubspec.yaml file as follows.</p>

<figure class='code'><figcaption><span>pubspec.yaml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span>  <span class="l-Scalar-Plain">dartdova</span>
</span><span class='line'><span class="l-Scalar-Plain">description</span><span class="p-Indicator">:</span>  <span class="l-Scalar-Plain">A sample dart cordova integration</span>
</span><span class='line'><span class="l-Scalar-Plain">dependencies</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="l-Scalar-Plain">js</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">any</span>
</span><span class='line'>  <span class="l-Scalar-Plain">unittest</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">0.2.9+7</span>
</span><span class='line'>  <span class="l-Scalar-Plain">logging</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">0.2.9+7</span>
</span><span class='line'>  <span class="l-Scalar-Plain">buildtool</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">git</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="l-Scalar-Plain">url</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">git://github.com/financeCoding/buildtool.git</span>
</span><span class='line'>      <span class="l-Scalar-Plain">ref</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">diroverride</span>
</span></code></pre></td></tr></table></div></figure>


<p>This pubspec.yaml pulls in the branch <code>diroverride</code> from a cloned version of <code>buildtool</code> from my github. Awesome solution for modifications that might not be upstreamed and needed quickly for testing.</p>

<p>Moving along, the DartEditor will look for a <code>build.dart</code> file in the root directory of a projects folder. When that file is found it will execute on file changes within the project. <code>buildtool</code> currently provides a client/server architecture for building or transforming dart projects. The particular task I was interested in is <code>Dart2JSTask</code> which calls the dart2js compiler on modified dart files. With my modifications it now outputs the generated javascript code into the directory specified in the <code>Dart2JSTask.withOutDir</code> constructor.</p>

<figure class='code'><figcaption><span>build.dart</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'><span class="cp">#!/usr/bin/env dart</span>
</span><span class='line'>
</span><span class='line'><span class="n">import</span> <span class="s1">&#39;dart:io&#39;</span><span class="p">;</span>
</span><span class='line'><span class="n">import</span> <span class="s1">&#39;package:buildtool/buildtool.dart&#39;</span><span class="p">;</span>
</span><span class='line'><span class="n">import</span> <span class="s1">&#39;package:buildtool/dart2js_task.dart&#39;</span><span class="p">;</span>
</span><span class='line'><span class="kt">void</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="n">config</span> <span class="o">=</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="n">dart2jstask</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Dart2JSTask</span><span class="p">.</span><span class="n">withOutDir</span><span class="p">(</span><span class="s2">&quot;dart2js&quot;</span><span class="p">,</span> <span class="k">new</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">));</span>
</span><span class='line'>    <span class="n">addTask</span><span class="p">([</span><span class="s2">&quot;app.dart&quot;</span><span class="p">],</span> <span class="n">dart2jstask</span><span class="p">);</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">configure</span><span class="p">(</span><span class="n">config</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The way that I&#8217;ve approached running the server side of the <code>buildtool</code> was to launch a <code>./build.dart --server</code> process before opening the project in the DartEditor.</p>

<figure class='code'><figcaption><span>output</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>~/dart/phonegap_from_scratch/phonegap_from_scratch/www
</span><span class='line'><span class="nv">$ </span>./build.dart --server
</span><span class='line'>2012-12-29 23:06:49.732 INFO adding task Instance of <span class="s1">&#39;Dart2JSTask&#39;</span> <span class="k">for </span>files <span class="o">[</span>app.dart<span class="o">]</span>
</span><span class='line'>2012-12-29 23:06:49.757 INFO startServer
</span><span class='line'>2012-12-29 23:06:49.757 INFO listening on localhost:52746
</span><span class='line'>buildtool server ready
</span><span class='line'>port: 52746
</span></code></pre></td></tr></table></div></figure>


<p>On each save in the project the server side will generate javascript code via <code>Dart2JSTask</code>.</p>

<figure class='code'><figcaption><span>output</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>2012-12-29 23:07:51.897 INFO starting build
</span><span class='line'>2012-12-29 23:07:51.903 INFO cwd: /Users/adam/dart/phonegap_from_scratch/phonegap_from_scratch/www build_out/out
</span><span class='line'>2012-12-29 23:07:51.909 FINE _runTasks: <span class="o">[</span>_source:app.dart<span class="o">]</span>
</span><span class='line'>2012-12-29 23:07:51.911 INFO cwd: /Users/adam/dart/phonegap_from_scratch/phonegap_from_scratch/www build_out/_dart2js
</span><span class='line'>2012-12-29 23:07:51.915 INFO dart2js task starting. files: <span class="o">[</span>_source:app.dart<span class="o">]</span>
</span><span class='line'>2012-12-29 23:07:51.918 FINE running dart2js args: <span class="o">[</span>--out<span class="o">=</span>./app.dart.js, --verbose, app.dart<span class="o">]</span>
</span><span class='line'>2012-12-29 23:08:00.778 FINE dart2js exitCode: 0
</span><span class='line'>2012-12-29 23:08:00.779 INFO dartjs tasks <span class="nb">complete</span>
</span><span class='line'>2012-12-29 23:08:00.784 FINE tasks at depth 0 <span class="nb">complete</span>
</span><span class='line'>2012-12-29 23:08:01.288 INFO starting build
</span><span class='line'>2012-12-29 23:08:01.289 INFO cwd: /Users/adam/dart/phonegap_from_scratch/phonegap_from_scratch/www build_out/out
</span><span class='line'>2012-12-29 23:08:01.291 FINE _runTasks: <span class="o">[</span>_source:app.dart.js, _source:app.dart.js.deps, _source:app.dart.js.map<span class="o">]</span>
</span><span class='line'>2012-12-29 23:08:01.291 FINE tasks at depth 0 <span class="nb">complete</span>
</span></code></pre></td></tr></table></div></figure>


<p>This solution saves me having to run the <code>./build.sh</code> from command line and launching the iOS simulator on each launch.</p>

<p>The other changes to this project was to refactor the single <code>app.dart</code> into a collection of dart library  files. Seems that each of the API categories have been implemented as singletons. At some point I may make this similar to <a href="https://github.com/rikulo/gap">gap</a> where each category of API is a singleton and instantiated at the top level of a dart library.</p>

<figure class='code'><figcaption><span>output</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>~/dart/phonegap_from_scratch/phonegap_from_scratch/www
</span><span class='line'><span class="nv">$ </span>tree
</span><span class='line'>.
</span><span class='line'>├── app.dart
</span><span class='line'>├── app.dart.js
</span><span class='line'>├── app.dart.js.deps
</span><span class='line'>├── app.dart.js.map
</span><span class='line'>├── build.dart
</span><span class='line'>├── build.sh
</span><span class='line'>├── cordova.js
</span><span class='line'>├── dart.js
</span><span class='line'>├── dart_interop.js
</span><span class='line'>├── index.html
</span><span class='line'>├── lib
</span><span class='line'>│   └── src
</span><span class='line'>│       ├── connection.dart
</span><span class='line'>│       ├── cordova_events.dart
</span><span class='line'>│       ├── device.dart
</span><span class='line'>│       ├── globalization.dart
</span><span class='line'>│       ├── notification.dart
</span><span class='line'>│       └── splashscreen.dart
</span><span class='line'>└── pubspec.yaml
</span></code></pre></td></tr></table></div></figure>


<p>New classes added <code>Connection</code>, <code>CordovaEvents</code>, <code>Notification</code>, <code>Splashscreen</code> and <code>Globalization</code>. <code>Globalization</code> is presenting a problem with knowing the proper ways to parse date strings within the javascript implementation dependent scenarios. For now I might just skip them, different javascript engines parse <code>Date</code> strings different ways and my goal was not to cover all of them. <code>app.dart</code> is now importing the libraries directly at some point a single <code>lib/cordova.dart</code> library should be provided.</p>

<p>This is where my journey for tonight has ended, <code>Contacts</code> might be the next exciting class of API to cover.</p>

<p>The code for <a href="http://financeCoding.github.com/blog/categories/phonegap-from-scratch/">phonegap_from_scratch</a> can be found on <a href="https://github.com/financeCoding/phonegap_from_scratch">github</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[event handling and logging with cordova in dart on iOS]]></title>
    <link href="http://financeCoding.github.com/blog/2012/12/27/event-handling-and-logging-with-cordova-in-dart-on-ios/"/>
    <updated>2012-12-27T00:22:00-08:00</updated>
    <id>http://financeCoding.github.com/blog/2012/12/27/event-handling-and-logging-with-cordova-in-dart-on-ios</id>
    <content type="html"><![CDATA[<p>Continuing on the chain of <a href="http://financeCoding.github.com/blog/categories/phonegap-from-scratch/">phonegap_from_scratch</a> this post goes over event handlers and logging.</p>

<p>Adding logging was trivial with the <a href="http://pub.dartlang.org/packages/logging"><code>logger</code></a> library on pub. Adding the following dependencies and setup configuration code was just enough to help with logging tests and code.</p>

<figure class='code'><figcaption><span>pubspec.yaml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span>  <span class="l-Scalar-Plain">dartdova</span>
</span><span class='line'><span class="l-Scalar-Plain">description</span><span class="p-Indicator">:</span>  <span class="l-Scalar-Plain">A sample dart cordova integration</span>
</span><span class='line'><span class="l-Scalar-Plain">dependencies</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="l-Scalar-Plain">js</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">any</span>
</span><span class='line'>  <span class="l-Scalar-Plain">unittest</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">0.2.9+7</span>
</span><span class='line'>  <span class="l-Scalar-Plain">logging</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">0.2.9+7</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>configureLogging</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'><span class="kt">void</span> <span class="n">configureLogging</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">Logger</span><span class="p">.</span><span class="n">root</span><span class="p">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">Level</span><span class="p">.</span><span class="n">ALL</span><span class="p">;</span>
</span><span class='line'>  <span class="n">Logger</span><span class="p">.</span><span class="n">root</span><span class="p">.</span><span class="n">on</span><span class="p">.</span><span class="n">record</span><span class="p">.</span><span class="n">add</span><span class="p">((</span><span class="n">LogRecord</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">// Print to console.log when compiled to javascript.</span>
</span><span class='line'>    <span class="n">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">${</span><span class="n">r</span><span class="p">.</span><span class="n">loggerName</span><span class="si">}</span><span class="s2">:</span><span class="si">${</span><span class="n">r</span><span class="p">.</span><span class="n">level</span><span class="p">.</span><span class="n">name</span><span class="si">}</span><span class="s2">:</span><span class="si">${</span><span class="n">r</span><span class="p">.</span><span class="n">sequenceNumber</span><span class="si">}</span><span class="s2">:\n</span><span class="si">${</span><span class="n">r</span><span class="p">.</span><span class="n">message</span><span class="p">.</span><span class="n">toString</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>Cordova ships with a list of custom <a href="http://docs.phonegap.com/en/2.2.0/cordova_events_events.md.html#Events">events</a> that can be fired off to the dom. The common pattern is to add event handlers to these events. Luckily we can receive the events without having to register handles with js-interop.</p>

<pre><code>deviceready
pause
resume
online
offline
backbutton
batterycritical
batterylow
batterystatus
menubutton
searchbutton
startcallbutton
endcallbutton
volumedownbutton
volumeupbutton
</code></pre>

<p>I&#8217;ve noticed a few of them need to be hooked really early in the loading of a dart application. One <code>deviceready</code> being critical for knowing when the device is ready. If they are not hooked early in the application you could miss the event. At least I&#8217;ve noticed that with the iOS simulator.</p>

<figure class='code'><figcaption><span>main</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'><span class="kt">void</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="cm">/**</span>
</span><span class='line'><span class="cm">   * Cordova.js will fire off &#39;deviceready&#39; event once fully loaded.</span>
</span><span class='line'><span class="cm">   * listen for the event on js.context.document.</span>
</span><span class='line'><span class="cm">   *</span>
</span><span class='line'><span class="cm">   * This must be the first event wired up before creating Device.</span>
</span><span class='line'><span class="cm">   */</span>
</span><span class='line'>  <span class="n">document</span><span class="p">.</span><span class="n">on</span><span class="p">[</span><span class="s1">&#39;deviceready&#39;</span><span class="p">].</span><span class="n">add</span><span class="p">(</span><span class="n">deviceReady</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>online</code>, <code>offline</code>, <code>battery*</code> are also events that one might want to catch early in <code>main()</code>. Later in the application after <code>deviceready</code> has been fired off you can remove the old handlers and add new ones that relate to the context created.</p>

<p>The design pattern for <code>Device</code> is a singleton which left me with having event handlers registered whenever any newed references go out of scope. This works for now, another approach for event handling could of been to use <a href="https://github.com/prujohn/Reactive-Dart">Reactive-Dart</a> <code>Observable</code> object.</p>

<figure class='code'><figcaption><span>Device</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'><span class="cm">/** The device: Singleton */</span>
</span><span class='line'><span class="kd">class</span> <span class="nc">Device</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">static</span> <span class="kd">final</span> <span class="n">Device</span> <span class="n">_singleton</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Device</span><span class="p">.</span><span class="n">_internal</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">Logger</span> <span class="n">_logger</span><span class="p">;</span>
</span><span class='line'>  <span class="n">js</span><span class="p">.</span><span class="n">Proxy</span> <span class="n">_device</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">factory</span> <span class="n">Device</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">_singleton</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">Device</span><span class="p">.</span><span class="n">_internal</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">_logger</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Logger</span><span class="p">(</span><span class="s2">&quot;Device&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">_registerHandlers</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">js</span><span class="p">.</span><span class="n">scoped</span><span class="p">(()</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">_device</span> <span class="o">=</span> <span class="n">js</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">device</span><span class="p">;</span>
</span><span class='line'>      <span class="n">js</span><span class="p">.</span><span class="n">retain</span><span class="p">(</span><span class="n">_device</span><span class="p">);</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kt">void</span> <span class="n">_registerHandlers</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">_onOnlineHandlers</span> <span class="o">=</span> <span class="k">new</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Function</span><span class="o">&gt;</span><span class="p">();</span>
</span><span class='line'>    <span class="n">document</span><span class="p">.</span><span class="n">on</span><span class="p">[</span><span class="s1">&#39;online&#39;</span><span class="p">].</span><span class="n">add</span><span class="p">(</span><span class="n">_onOnline</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">_onOfflineHandlers</span> <span class="o">=</span> <span class="k">new</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Function</span><span class="o">&gt;</span><span class="p">();</span>
</span><span class='line'>    <span class="n">document</span><span class="p">.</span><span class="n">on</span><span class="p">[</span><span class="s1">&#39;offline&#39;</span><span class="p">].</span><span class="n">add</span><span class="p">(</span><span class="n">_onOffline</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kt">String</span> <span class="kd">get</span> <span class="n">name</span> <span class="o">=&gt;</span> <span class="n">js</span><span class="p">.</span><span class="n">scoped</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="n">_device</span><span class="p">.</span><span class="n">name</span><span class="p">);</span>
</span><span class='line'>  <span class="kt">String</span> <span class="kd">get</span> <span class="n">cordova</span> <span class="o">=&gt;</span> <span class="n">js</span><span class="p">.</span><span class="n">scoped</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="n">_device</span><span class="p">.</span><span class="n">cordova</span><span class="p">);</span>
</span><span class='line'>  <span class="kt">String</span> <span class="kd">get</span> <span class="n">platform</span> <span class="o">=&gt;</span> <span class="n">js</span><span class="p">.</span><span class="n">scoped</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="n">_device</span><span class="p">.</span><span class="n">platform</span><span class="p">);</span>
</span><span class='line'>  <span class="kt">String</span> <span class="kd">get</span> <span class="n">uuid</span> <span class="o">=&gt;</span> <span class="n">js</span><span class="p">.</span><span class="n">scoped</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="n">_device</span><span class="p">.</span><span class="n">uuid</span><span class="p">);</span>
</span><span class='line'>  <span class="kt">String</span> <span class="kd">get</span> <span class="n">version</span> <span class="o">=&gt;</span> <span class="n">js</span><span class="p">.</span><span class="n">scoped</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="n">_device</span><span class="p">.</span><span class="n">version</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">List</span><span class="o">&lt;</span><span class="n">Function</span><span class="o">&gt;</span> <span class="n">_onOnlineHandlers</span><span class="p">;</span>
</span><span class='line'>  <span class="n">List</span><span class="o">&lt;</span><span class="n">Function</span><span class="o">&gt;</span> <span class="kd">get</span> <span class="n">onOnline</span> <span class="o">=&gt;</span> <span class="n">_onOnlineHandlers</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">void</span> <span class="n">_onOnline</span><span class="p">(</span><span class="n">Event</span> <span class="n">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">_onOnlineHandlers</span><span class="p">.</span><span class="n">forEach</span><span class="p">((</span><span class="n">handler</span><span class="p">)</span><span class="o">=&gt;</span><span class="n">handler</span><span class="p">(</span><span class="n">event</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">List</span><span class="o">&lt;</span><span class="n">Function</span><span class="o">&gt;</span> <span class="n">_onOfflineHandlers</span><span class="p">;</span>
</span><span class='line'>  <span class="n">List</span><span class="o">&lt;</span><span class="n">Function</span><span class="o">&gt;</span> <span class="kd">get</span> <span class="n">onOffline</span> <span class="o">=&gt;</span> <span class="n">_onOfflineHandlers</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">void</span> <span class="n">_onOffline</span><span class="p">(</span><span class="n">Event</span> <span class="n">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">_onOfflineHandlers</span><span class="p">.</span><span class="n">forEach</span><span class="p">((</span><span class="n">handler</span><span class="p">)</span><span class="o">=&gt;</span><span class="n">handler</span><span class="p">(</span><span class="n">event</span><span class="p">));</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>Creating tests for this type of pluming was not too difficult using <a href="http://api.dartlang.org/docs/bleeding_edge/unittest.html#expectAsync1"><code>expectAsync1</code></a>. The most of time spent on figuring this out was creating <a href="http://api.dartlang.org/docs/bleeding_edge/dart_html/CustomEvent.html"><code>CustomEvent</code></a> and calling <a href="http://api.dartlang.org/docs/bleeding_edge/dart_html/EventListenerList.html#dispatch"><code>dispatch</code></a>. This is enough functionality to see that device was properly wired up with handlers. I found it important to cover lots of tests when working with Cordova, error handling and reporting is very minimal. At times something would stop working with no console output. So I move forward with code and test in tandem.</p>

<figure class='code'><figcaption><span>runTests</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'><span class="n">test</span><span class="p">(</span><span class="s1">&#39;Device Event online&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="n">eventName</span> <span class="o">=</span> <span class="s1">&#39;online&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="kd">var</span> <span class="n">asyncMethod</span> <span class="o">=</span> <span class="n">expectAsync1</span><span class="p">((</span><span class="n">Event</span> <span class="n">event</span><span class="p">)</span><span class="o">=&gt;</span><span class="n">expect</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="n">type</span><span class="p">,</span> <span class="n">equals</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">$</span><span class="n">eventName</span><span class="s1">&#39;</span><span class="p">)));</span>
</span><span class='line'>  <span class="kd">var</span> <span class="n">customEvent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CustomEvent</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">$</span><span class="n">eventName</span><span class="s1">&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="s2">&quot;custom event&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="kd">var</span> <span class="n">device</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Device</span><span class="p">();</span>
</span><span class='line'>  <span class="n">device</span><span class="p">.</span><span class="n">onOnline</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">asyncMethod</span><span class="p">);</span>
</span><span class='line'>  <span class="n">document</span><span class="p">.</span><span class="n">on</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">$</span><span class="n">eventName</span><span class="s1">&#39;</span><span class="p">].</span><span class="n">dispatch</span><span class="p">(</span><span class="n">customEvent</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="n">test</span><span class="p">(</span><span class="s1">&#39;Device Event offline&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="n">eventName</span> <span class="o">=</span> <span class="s1">&#39;offline&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="kd">var</span> <span class="n">asyncMethod</span> <span class="o">=</span> <span class="n">expectAsync1</span><span class="p">((</span><span class="n">Event</span> <span class="n">event</span><span class="p">)</span><span class="o">=&gt;</span><span class="n">expect</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="n">type</span><span class="p">,</span> <span class="n">equals</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">$</span><span class="n">eventName</span><span class="s1">&#39;</span><span class="p">)));</span>
</span><span class='line'>  <span class="kd">var</span> <span class="n">customEvent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CustomEvent</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">$</span><span class="n">eventName</span><span class="s1">&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="s2">&quot;custom event&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="kd">var</span> <span class="n">device</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Device</span><span class="p">();</span>
</span><span class='line'>  <span class="n">device</span><span class="p">.</span><span class="n">onOffline</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">asyncMethod</span><span class="p">);</span>
</span><span class='line'>  <span class="n">document</span><span class="p">.</span><span class="n">on</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">$</span><span class="n">eventName</span><span class="s1">&#39;</span><span class="p">].</span><span class="n">dispatch</span><span class="p">(</span><span class="n">customEvent</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p><a href="http://financeCoding.github.com/images/2012-12-27-event-handling-and-logging-with-cordova-in-dart-on-ios/unittests_passing.png"><img src="http://financeCoding.github.com/images/2012-12-27-event-handling-and-logging-with-cordova-in-dart-on-ios/unittests_passing.png" alt="unittest_pass" /></a></p>

<p>So far this is a good enough to have a device class and event handlers for custom events. The single <a href="https://github.com/financeCoding/phonegap_from_scratch"><code>app.dart</code></a> is starting to get large, next it should be broken out. I integrated the event handling directly in the <code>Device</code> class, but the Cordova <a href="http://docs.phonegap.com/en/2.2.0/index.html">API Reference</a> keeps them at the top level of the application. So a singleton <code>Events</code> or <code>CordovaEvents</code> class might be useful to separate the implementation out.</p>

<p>A project that is just starting to hit the <a href="https://github.com/dart-lang/">dart-lang</a> github repository is <a href="https://github.com/dart-lang/buildtool">buildtool</a>. <code>buildtool</code> might provide a better solution then having a custom build script that needs to be called before each launch of the simulator.</p>

<p>The code for <a href="http://financeCoding.github.com/blog/categories/phonegap-from-scratch/">phonegap_from_scratch</a> can be found on <a href="https://github.com/financeCoding/phonegap_from_scratch">github</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Unit Testing with Dart and Cordova on iOS]]></title>
    <link href="http://financeCoding.github.com/blog/2012/12/25/unit-testing-with-dart-and-cordova-on-ios/"/>
    <updated>2012-12-25T23:37:00-08:00</updated>
    <id>http://financeCoding.github.com/blog/2012/12/25/unit-testing-with-dart-and-cordova-on-ios</id>
    <content type="html"><![CDATA[<p>Continuing on from <a href="2012/12/23/getting-started-with-dart-and-cordova-from-scratch-on-ios">following</a> post, the next step forward for building stuff with Dart and Cordova was to get some unit testing. First class to test is <a href="http://docs.phonegap.com/en/2.2.0/cordova_device_device.md.html#Device">Device</a>. The tests created here are specific to the platform and simulator. Did not add any of the device events for testing until I can find a way to generate them from the simulator.</p>

<p>First step is to add unit testing to the pub spec file.</p>

<div>
  <pre><code class='yaml'>name:  dartdova
description:  A sample dart cordova integration
dependencies:
  js: any
  unittest: 0.2.9+7</code></pre>
</div>


<p>Going with <code>useHtmlEnhancedConfiguration()</code> from <code>unittest/html_enhanced_config.dart</code> did not work. Cordova or iPhone simulator seems to swallow up any exceptions or failures in rending, so resorting to the more stripped down version <code>useHtmlIndividualConfiguration()</code> from <code>package:unittest/html_individual_config.dart</code>.</p>

<p>Using <a href="https://github.com/rikulo/gap">gap</a> as a reference it was easy enough to create a working <a href="http://stackoverflow.com/questions/12649573/how-do-you-build-a-singleton-in-dart">singleton</a> Device class.</p>

<div><script src='https://gist.github.com/4381449.js'></script>
<noscript><pre><code>&lt;html&gt;&lt;body&gt;You are being &lt;a href=&quot;https://github.com/gist/4381449&quot;&gt;redirected&lt;/a&gt;.&lt;/body&gt;&lt;/html&gt;</code></pre></noscript></div>


<p>Now building the js code with <code>build.sh</code> and launching iPhone simulator in <code>Xcode.app</code>, the passing unit test should be displayed in the simplified version of the <a href="http://www.dartlang.org/articles/dart-unit-tests/">unittest</a> output.</p>

<div><script src='https://gist.github.com/4381488.js'></script>
<noscript><pre><code>&lt;html&gt;&lt;body&gt;You are being &lt;a href=&quot;https://github.com/gist/4381488&quot;&gt;redirected&lt;/a&gt;.&lt;/body&gt;&lt;/html&gt;</code></pre></noscript></div>


<p><a href="http://financeCoding.github.com/images/2012-12-25-unit-testing-with-dart-and-cordova-on-ios/unittestpass.png"><img src="http://financeCoding.github.com/images/2012-12-25-unit-testing-with-dart-and-cordova-on-ios/unittestpass.png" alt="unittest_pass" /></a></p>

<p>The code for <a href="http://financeCoding.github.com/blog/categories/phonegap-from-scratch/">phonegap_from_scratch</a> can be found on <a href="https://github.com/financeCoding/phonegap_from_scratch">github</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Getting started with Dart and Cordova from scratch on iOS]]></title>
    <link href="http://financeCoding.github.com/blog/2012/12/23/getting-started-with-dart-and-cordova-from-scratch-on-ios/"/>
    <updated>2012-12-23T00:00:00-08:00</updated>
    <id>http://financeCoding.github.com/blog/2012/12/23/getting-started-with-dart-and-cordova-from-scratch-on-ios</id>
    <content type="html"><![CDATA[<p>Looking for some fun this weekend I decided to investigate the current status of using dart and cordova together.</p>

<p>Breif history of Dart and Cordova comes down to two projects, <a href="https://github.com/Solvr/dart-gap">solvr/dart-gap</a> and <a href="https://github.com/rikulo/gap">rikulo/gap</a> have ventured into creating a frameworks for dart and cordova interop. <a href="http://rikulo.org/">rikulo</a> has latest release, decided to give it a spin. After some tinkering I had no luck with rikulo&#8217;s gap.</p>

<p>I decided to go down the route of finding the most minimal amount of dart code needed for loading cordova apps. A major step forward for working with cordova was the introduction of <a href="https://github.com/dart-lang/js-interop">js-interop</a>. js-interop will provide the communications needed between cordova.js context and the dart application. This example just gets the <code>'deviceready'</code> event fired off from <code>cordova.js</code>.</p>

<p>Download the phonegap <a href="http://phonegap.com/download">build</a> and unpack into a folder.</p>

<div>
  <pre><code class='bash'>$ mkdir ~/dart/phonegap_from_scratch/
$ cd ~/dart/phonegap_from_scratch/
$ unzip ~/Downloads/phonegap-phonegap-2.2.0-0-g8a3aa47.zip
$ mv phonegap-phonegap-8a3aa47 phonegap</code></pre>
</div>


<p>This is mostly done on <a href="http://docs.phonegap.com/en/2.2.0/guide_getting-started_ios_index.md.html#Getting%20Started%20with%20iOS">MacOSX</a></p>

<p>Setup and create a phonegap project</p>

<div>
  <pre><code class='bash'>$ ./create ~/dart/phonegap_from_scratch/phonegap_from_scratch com.phonegap.from.scratch phonegap_from_scratch</code></pre>
</div>


<p>Open up <code>Xcode</code> and do a sanity check with the default generated project from the <code>create</code> script.</p>

<div>
  <pre><code class='bash'>$ open /Applications/Xcode.app</code></pre>
</div>


<p><a href="http://financeCoding.github.com/images/2012-12-23-phonegap-from-scratch-images/open_project_dialog.png"><img src="http://financeCoding.github.com/images/2012-12-23-phonegap-from-scratch-images/open_project_dialog.png" alt="open_project_dialog" /></a></p>

<p><a href="http://financeCoding.github.com/images/2012-12-23-phonegap-from-scratch-images/sanity_check.png"><img src="http://financeCoding.github.com/images/2012-12-23-phonegap-from-scratch-images/sanity_check.png" alt="sanity_check" /></a></p>

<p>Remove all the files in <code>www</code>, rename <code>cordova-2.2.0.js</code>.</p>

<div>
  <pre><code class='bash'>$ cd ~/dart/phonegap_from_scratch/phonegap_from_scratch/www/
$ rm -rf css img index.html js spec res spec.html
$ mv cordova-2.2.0.js cordova.js</code></pre>
</div>


<p>Create a dart project in the <code>www</code> directory. This is not a typical dart package layout but works well for building and debugging. A real project might need some type of build scripts that call <code>dart2js</code> and copy files over to the <code>www</code> directory in the cordova generated project.</p>

<script src="https://gist.github.com/4366847.js"><!-- gist --></script>




<script src="https://gist.github.com/4366855.js"><!-- gist --></script>




<script src="https://gist.github.com/4366906.js"><!-- gist --></script>




<script src="https://gist.github.com/4367140.js"><!-- gist --></script>


<p>Install the <code>pub</code> dependencies. The <code>dart.js</code> and <code>dart_interop.js</code> need to be stored locally within the cordova project.</p>

<div>
  <pre><code class='bash'>~/dart/phonegap_from_scratch/phonegap_from_scratch/www
$ pub install
Resolving dependencies...
Dependencies installed!

$ cp packages/js/dart_interop.js .
$ wget https://dart.googlecode.com/svn/branches/bleeding_edge/dart/client/dart.js</code></pre>
</div>


<p><a href="http://financeCoding.github.com/images/2012-12-23-phonegap-from-scratch-images/opening_dart_editor.png"><img src="http://financeCoding.github.com/images/2012-12-23-phonegap-from-scratch-images/opening_dart_editor.png" alt="opening_dart_editor" /></a></p>

<p><a href="http://financeCoding.github.com/images/2012-12-23-phonegap-from-scratch-images/dart_project_layout.png"><img src="http://financeCoding.github.com/images/2012-12-23-phonegap-from-scratch-images/dart_project_layout.png" alt="dart_project_layout" /></a></p>

<p>Having little success with the other projects it took some time to figure out a proper way to load all the js files. Some combinations would not yield the <code>‘deviceready’</code> event expected from cordova. The loading order that worked best for me was <code>cordova.js</code>, <code>dart.js</code>, <code>dart_interop.js</code> and then the actual application <code>app.dart.js</code>. Running the build script and loading up the simulator should yeild some output on the console.</p>

<p>This is just the start of exploring integrations between dart and cordova. At least until the existing projects have an easier solution to bootstraping with their frameworks.</p>

<p><a href="http://financeCoding.github.com/images/2012-12-23-phonegap-from-scratch-images/most_minimal_event_deviceready.png"><img src="http://financeCoding.github.com/images/2012-12-23-phonegap-from-scratch-images/most_minimal_event_deviceready.png" alt="most_minimal_event_deviceready" /></a></p>

<p>Full example can be found on github <a href="http://financeCoding.github.com/blog/categories/phonegap-from-scratch/">phonegap_from_scratch</a>.</p>
]]></content>
  </entry>
  
</feed>
