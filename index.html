
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Random posts about coding</title>
  <meta name="author" content="Adam Singer">

  <meta property="og:title" content="Random posts about coding" />
  <meta property="og:image" content="/me.png" />
  <meta property="og:description" content="" />

  
  <meta name="description" content="NOTE: Experimental and future developments with Dart+GCE+Datastore may change Before running through the steps below, make sure that: You have &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://financeCoding.github.com/">
  <link href="/me_favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Random posts about coding" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-36566996-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="https://plus.google.com/104569492481999771226?rel=author">
      <img src="https://plus.google.com/s2/photos/profile/104569492481999771226?sz=100"></a><span> </span><a href="/">Random posts about coding</a></h1>
  
    <h2>Mostly blogging about dart.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:financeCoding.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/aboutme">AboutMe</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/03/28/getting-started-with-google-cloud-datastore-and-dart/">Getting Started With Google Cloud Datastore and Dart</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-03-28T14:38:00-07:00" pubdate data-updated="true">Mar 28<span>th</span>, 2014</time>
        
         | <a href="/blog/2014/03/28/getting-started-with-google-cloud-datastore-and-dart/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><strong>NOTE: Experimental and future developments with Dart+GCE+Datastore may change</strong></p>

<p>Before running through the steps below, make sure that:</p>

<ul>
<li>You have <a href="https://developers.google.com/datastore/docs/activate">enabled</a> Google Cloud Datastore API.</li>
<li>You have your <code>&lt;project-id&gt;</code> (same identifier as your Google Cloud <a href="https://developers.google.com/datastore/docs/activate#project_id">Project ID</a>).</li>
<li>You are <a href="https://developers.google.com/compute/docs/instances#sshing">connected</a> to a Compute Engine instance with both the <code>datastore</code> and
<code>userinfo.email</code> <a href="https://developers.google.com/compute/docs/authentication#using">scopes</a> or have a <a href="https://developers.google.com/datastore/docs/activate#service_account"><service-account></a> and the <a href="https://developers.google.com/datastore/docs/activate#private_key"><path-to-private-key-file></a>.</li>
<li>You have a working local <a href="https://www.dartlang.org/tools/download.html">dart environment</a> or working <a href="#example-deployment-and-startup-scripts-for-gce-with-dart">Compute Engine instance</a></li>
</ul>


<p>In order to make API calls to the Datastore, <code>pubspec.yaml</code> file needs the following</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">dependencies</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="l-Scalar-Plain">google_oauth2_client</span><span class="p-Indicator">:</span> <span class="s">&#39;&gt;=0.3.6</span><span class="nv"> </span><span class="s">&lt;0.3.7&#39;</span>
</span><span class='line'>  <span class="l-Scalar-Plain">google_datastore_v1beta2_api</span><span class="p-Indicator">:</span> <span class="s">&quot;&gt;=0.4.0</span><span class="nv"> </span><span class="s">&lt;0.5.0&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then, get the <a href="https://github.com/financeCoding/dart_datastore_example"><code>dart_datastore_example</code></a> sample:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git clone https://github.com/financeCoding/dart_datastore_example.git
</span><span class='line'><span class="nb">cd </span>dart_datastore_example
</span><span class='line'>pub install
</span></code></pre></td></tr></table></div></figure>


<p>If you are not connected to a Compute Engine instance, make sure to run
the following commands (in a bash-like shell):</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># convert the .p12 private key file to a .pem file</span>
</span><span class='line'><span class="c"># if asked to enter import password, use &quot;notasecret&quot;</span>
</span><span class='line'>
</span><span class='line'>openssl pkcs12 -in &lt;privatekey&gt;.p12 -nocerts -passin pass:notasecret -nodes -out &lt;rsa_private_key&gt;.pem
</span><span class='line'>
</span><span class='line'><span class="c"># configure your credentials</span>
</span><span class='line'><span class="nb">export </span><span class="nv">DATASTORE_SERVICE_ACCOUNT</span><span class="o">=</span>&lt;service-account&gt;
</span><span class='line'><span class="nb">export </span><span class="nv">DATASTORE_PRIVATE_KEY_FILE</span><span class="o">=</span>&lt;path-to-pem-file&gt;
</span><span class='line'><span class="nb">export </span><span class="nv">CLOUD_PROJECT_ID</span><span class="o">=</span>&lt;project-id&gt;
</span><span class='line'><span class="nb">export </span><span class="nv">CLOUD_PROJECT_NUMBER</span><span class="o">=</span>&lt;project-number&gt;
</span></code></pre></td></tr></table></div></figure>


<p>Alternatively the sample allows for passing parameters via commandline:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">cd </span>dart_datastore_example
</span><span class='line'>pub install
</span><span class='line'><span class="nb">cd </span>bin
</span><span class='line'><span class="c"># dart dart_datastore_example.dart &lt;project-id&gt; &lt;project-number&gt; &lt;path-to-pem-file&gt; &lt;service-account&gt;</span>
</span><span class='line'>dart dart_datastore_example.dart dartcloud 657648630269 privatekey.pem 657648630269-ge2he8e46y4u42bd89nmgtj52j3ilzvv@developer.gserviceaccount.com
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>Example output on first run:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>dartcloud
</span><span class='line'>657648630269
</span><span class='line'>privatekey.pem
</span><span class='line'>657648630269-ge2he8e46y4u42bd89nmgtj52j3ilzvv@developer.gserviceaccount.com
</span><span class='line'>did not found entity
</span><span class='line'>&gt; <span class="nv">entity</span> <span class="o">=</span> <span class="o">{</span>question: <span class="o">{</span><span class="s2">&quot;stringValue&quot;</span>:<span class="s2">&quot;Meaning of life?&quot;</span><span class="o">}</span>, answer: <span class="o">{</span><span class="s2">&quot;integerValue&quot;</span>:42<span class="o">}}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Example output on second run:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>dartcloud
</span><span class='line'>657648630269
</span><span class='line'>privatekey.pem
</span><span class='line'>657648630269-ge2he8e46y4u42bd89nmgtj52j3ilzvv@developer.gserviceaccount.com
</span><span class='line'>found <span class="nv">entity</span> <span class="o">=</span> <span class="o">{</span><span class="s2">&quot;key&quot;</span>:<span class="o">{</span><span class="s2">&quot;partitionId&quot;</span>:<span class="o">{</span><span class="s2">&quot;datasetId&quot;</span>:<span class="s2">&quot;s~dartcloud&quot;</span><span class="o">}</span>,<span class="s2">&quot;path&quot;</span>:<span class="o">[{</span><span class="s2">&quot;kind&quot;</span>:<span class="s2">&quot;Trivia&quot;</span>,<span class="s2">&quot;name&quot;</span>:<span class="s2">&quot;hgtg&quot;</span><span class="o">}]}</span>,<span class="s2">&quot;properties&quot;</span>:<span class="o">{</span><span class="s2">&quot;question&quot;</span>:<span class="o">{</span><span class="s2">&quot;stringValue&quot;</span>:<span class="s2">&quot;Meaning of life?&quot;</span><span class="o">}</span>,<span class="s2">&quot;answer&quot;</span>:<span class="o">{</span><span class="s2">&quot;integerValue&quot;</span>:42<span class="o">}}}</span>
</span><span class='line'>&gt; <span class="nv">entity</span> <span class="o">=</span> <span class="o">{</span>question: <span class="o">{</span><span class="s2">&quot;stringValue&quot;</span>:<span class="s2">&quot;Meaning of life?&quot;</span><span class="o">}</span>, answer: <span class="o">{</span><span class="s2">&quot;integerValue&quot;</span>:42<span class="o">}}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The comments in the sample&#8217;s source explain its behavior in detail:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'><span class="n">import</span> <span class="s2">&quot;dart:io&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">import</span> <span class="s2">&quot;package:google_oauth2_client/google_oauth2_console.dart&quot;</span><span class="p">;</span>
</span><span class='line'><span class="n">import</span> <span class="s2">&quot;package:google_datastore_v1beta2_api/datastore_v1beta2_api_client.dart&quot;</span>
</span><span class='line'>    <span class="n">as</span> <span class="n">client</span><span class="p">;</span>
</span><span class='line'><span class="n">import</span> <span class="s2">&quot;package:google_datastore_v1beta2_api/datastore_v1beta2_api_console.dart&quot;</span>
</span><span class='line'>    <span class="n">as</span> <span class="n">console</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">main</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">Map</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span> <span class="kt">String</span><span class="o">&gt;</span> <span class="n">envVars</span> <span class="o">=</span> <span class="n">Platform</span><span class="p">.</span><span class="n">environment</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">String</span> <span class="n">projectId</span> <span class="o">=</span> <span class="n">envVars</span><span class="p">[</span><span class="s1">&#39;CLOUD_PROJECT_ID&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span>
</span><span class='line'>      <span class="n">args</span><span class="p">[</span><span class="m">0</span><span class="p">]</span> <span class="o">:</span> <span class="n">envVars</span><span class="p">[</span><span class="s1">&#39;CLOUD_PROJECT_ID&#39;</span><span class="p">];</span>
</span><span class='line'>  <span class="kt">String</span> <span class="n">projectNumber</span> <span class="o">=</span> <span class="n">envVars</span><span class="p">[</span><span class="s1">&#39;CLOUD_PROJECT_NUMBER&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span>
</span><span class='line'>      <span class="n">args</span><span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="o">:</span> <span class="n">envVars</span><span class="p">[</span><span class="s1">&#39;CLOUD_PROJECT_NUMBER&#39;</span><span class="p">];</span>
</span><span class='line'>  <span class="kt">String</span> <span class="n">pemFilename</span> <span class="o">=</span> <span class="n">envVars</span><span class="p">[</span><span class="s1">&#39;DATASTORE_PRIVATE_KEY_FILE&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span>
</span><span class='line'>      <span class="n">args</span><span class="p">[</span><span class="m">2</span><span class="p">]</span> <span class="o">:</span> <span class="n">envVars</span><span class="p">[</span><span class="s1">&#39;DATASTORE_PRIVATE_KEY_FILE&#39;</span><span class="p">];</span>
</span><span class='line'>  <span class="kt">String</span> <span class="n">serviceAccountEmail</span> <span class="o">=</span> <span class="n">envVars</span><span class="p">[</span><span class="s1">&#39;DATASTORE_SERVICE_ACCOUNT&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span>
</span><span class='line'>      <span class="n">args</span><span class="p">[</span><span class="m">3</span><span class="p">]</span> <span class="o">:</span> <span class="n">envVars</span><span class="p">[</span><span class="s1">&#39;DATASTORE_SERVICE_ACCOUNT&#39;</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">print</span><span class="p">(</span><span class="n">projectId</span><span class="p">);</span>
</span><span class='line'>  <span class="n">print</span><span class="p">(</span><span class="n">projectNumber</span><span class="p">);</span>
</span><span class='line'>  <span class="n">print</span><span class="p">(</span><span class="n">pemFilename</span><span class="p">);</span>
</span><span class='line'>  <span class="n">print</span><span class="p">(</span><span class="n">serviceAccountEmail</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="kt">String</span> <span class="n">iss</span> <span class="o">=</span> <span class="n">serviceAccountEmail</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">String</span> <span class="n">scopes</span> <span class="o">=</span> <span class="s1">&#39;https://www.googleapis.com/auth/userinfo.email &#39;</span>
</span><span class='line'>      <span class="s1">&#39;https://www.googleapis.com/auth/datastore&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">String</span> <span class="n">rsa_private_key_file</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="p">(</span><span class="n">pemFilename</span><span class="p">).</span><span class="n">readAsStringSync</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">ComputeOAuth2Console</span> <span class="n">computeEngineClient</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ComputeOAuth2Console</span><span class="p">(</span>
</span><span class='line'>      <span class="n">projectNumber</span><span class="p">,</span> <span class="nl">privateKey:</span> <span class="n">rsa_private_key_file</span><span class="p">,</span> <span class="nl">iss:</span> <span class="n">iss</span><span class="p">,</span> <span class="nl">scopes:</span> <span class="n">scopes</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">console</span><span class="p">.</span><span class="n">Datastore</span> <span class="n">datastore</span> <span class="o">=</span> <span class="k">new</span> <span class="n">console</span><span class="p">.</span><span class="n">Datastore</span><span class="p">(</span><span class="n">computeEngineClient</span><span class="p">)</span>
</span><span class='line'>  <span class="p">..</span><span class="n">makeAuthRequests</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// Create a RPC request to begin a new transaction</span>
</span><span class='line'>  <span class="kd">var</span> <span class="n">beginTransactionRequest</span> <span class="o">=</span> <span class="k">new</span> <span class="n">client</span><span class="p">.</span><span class="n">BeginTransactionRequest</span><span class="p">.</span><span class="n">fromJson</span><span class="p">({});</span>
</span><span class='line'>  <span class="kt">String</span> <span class="n">transaction</span><span class="p">;</span>
</span><span class='line'>  <span class="n">client</span><span class="p">.</span><span class="n">Key</span> <span class="n">key</span><span class="p">;</span>
</span><span class='line'>  <span class="n">client</span><span class="p">.</span><span class="n">Entity</span> <span class="n">entity</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// Execute the RPC asynchronously</span>
</span><span class='line'>  <span class="n">datastore</span><span class="p">.</span><span class="n">datasets</span><span class="p">.</span><span class="n">beginTransaction</span><span class="p">(</span><span class="n">beginTransactionRequest</span><span class="p">,</span> <span class="n">projectId</span><span class="p">).</span><span class="n">then</span><span class="p">(</span>
</span><span class='line'>      <span class="p">(</span><span class="n">client</span><span class="p">.</span><span class="n">BeginTransactionResponse</span> <span class="n">beginTransactionResponse</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">// Get the transaction handle from the response.</span>
</span><span class='line'>    <span class="n">transaction</span> <span class="o">=</span> <span class="n">beginTransactionResponse</span><span class="p">.</span><span class="n">transaction</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Create a RPC request to get entities by key.</span>
</span><span class='line'>    <span class="kd">var</span> <span class="n">lookupRequest</span> <span class="o">=</span> <span class="k">new</span> <span class="n">client</span><span class="p">.</span><span class="n">LookupRequest</span><span class="p">.</span><span class="n">fromJson</span><span class="p">({});</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Create a new entities by key</span>
</span><span class='line'>    <span class="n">key</span> <span class="o">=</span> <span class="k">new</span> <span class="n">client</span><span class="p">.</span><span class="n">Key</span><span class="p">.</span><span class="n">fromJson</span><span class="p">({});</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Set the entity key with only one `path_element`: no parent.</span>
</span><span class='line'>    <span class="kd">var</span> <span class="n">path</span> <span class="o">=</span> <span class="k">new</span> <span class="n">client</span><span class="p">.</span><span class="n">KeyPathElement</span><span class="p">.</span><span class="n">fromJson</span><span class="p">({</span>
</span><span class='line'>      <span class="s1">&#39;kind&#39;</span><span class="o">:</span> <span class="s1">&#39;Trivia&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="s1">&#39;name&#39;</span><span class="o">:</span> <span class="s1">&#39;hgtg&#39;</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>    <span class="n">key</span><span class="p">.</span><span class="n">path</span> <span class="o">=</span> <span class="k">new</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">client</span><span class="p">.</span><span class="n">KeyPathElement</span><span class="o">&gt;</span><span class="p">();</span>
</span><span class='line'>    <span class="n">key</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">path</span><span class="p">);</span>
</span><span class='line'>    <span class="n">lookupRequest</span><span class="p">.</span><span class="n">keys</span> <span class="o">=</span> <span class="k">new</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">client</span><span class="p">.</span><span class="n">Key</span><span class="o">&gt;</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Add one key to the lookup request.</span>
</span><span class='line'>    <span class="n">lookupRequest</span><span class="p">.</span><span class="n">keys</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">key</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Set the transaction, so we get a consistent snapshot of the</span>
</span><span class='line'>    <span class="c1">// entity at the time the transaction started.</span>
</span><span class='line'>    <span class="n">lookupRequest</span><span class="p">.</span><span class="n">readOptions</span> <span class="o">=</span> <span class="k">new</span> <span class="n">client</span><span class="p">.</span><span class="n">ReadOptions</span><span class="p">.</span><span class="n">fromJson</span><span class="p">({</span>
</span><span class='line'>      <span class="s1">&#39;transaction&#39;</span><span class="o">:</span> <span class="n">transaction</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Execute the RPC and get the response.</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">datastore</span><span class="p">.</span><span class="n">datasets</span><span class="p">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">lookupRequest</span><span class="p">,</span> <span class="n">projectId</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}).</span><span class="n">then</span><span class="p">((</span><span class="n">client</span><span class="p">.</span><span class="n">LookupResponse</span> <span class="n">lookupResponse</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">// Create a RPC request to commit the transaction.</span>
</span><span class='line'>    <span class="kd">var</span> <span class="n">req</span> <span class="o">=</span> <span class="k">new</span> <span class="n">client</span><span class="p">.</span><span class="n">CommitRequest</span><span class="p">.</span><span class="n">fromJson</span><span class="p">({});</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Set the transaction to commit.</span>
</span><span class='line'>    <span class="n">req</span><span class="p">.</span><span class="n">transaction</span> <span class="o">=</span> <span class="n">transaction</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">lookupResponse</span><span class="p">.</span><span class="n">found</span><span class="p">.</span><span class="n">isNotEmpty</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="c1">// Get the entity from the response if found</span>
</span><span class='line'>      <span class="n">entity</span> <span class="o">=</span> <span class="n">lookupResponse</span><span class="p">.</span><span class="n">found</span><span class="p">.</span><span class="n">first</span><span class="p">.</span><span class="n">entity</span><span class="p">;</span>
</span><span class='line'>      <span class="n">print</span><span class="p">(</span><span class="s2">&quot;found entity = </span><span class="si">${</span><span class="n">entity</span><span class="p">.</span><span class="n">toString</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">print</span><span class="p">(</span><span class="s2">&quot;did not found entity&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="c1">// If no entity was found, insert a new one in the commit request mutation.</span>
</span><span class='line'>      <span class="n">entity</span> <span class="o">=</span> <span class="k">new</span> <span class="n">client</span><span class="p">.</span><span class="n">Entity</span><span class="p">.</span><span class="n">fromJson</span><span class="p">({});</span>
</span><span class='line'>      <span class="n">req</span><span class="p">.</span><span class="n">mutation</span> <span class="o">=</span> <span class="k">new</span> <span class="n">client</span><span class="p">.</span><span class="n">Mutation</span><span class="p">.</span><span class="n">fromJson</span><span class="p">({});</span>
</span><span class='line'>      <span class="n">req</span><span class="p">.</span><span class="n">mutation</span><span class="p">.</span><span class="n">insert</span> <span class="o">=</span> <span class="k">new</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">client</span><span class="p">.</span><span class="n">Entity</span><span class="o">&gt;</span><span class="p">();</span>
</span><span class='line'>      <span class="n">req</span><span class="p">.</span><span class="n">mutation</span><span class="p">.</span><span class="n">insert</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">entity</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// Copy the entity key.</span>
</span><span class='line'>      <span class="n">entity</span><span class="p">.</span><span class="n">key</span> <span class="o">=</span> <span class="k">new</span> <span class="n">client</span><span class="p">.</span><span class="n">Key</span><span class="p">.</span><span class="n">fromJson</span><span class="p">(</span><span class="n">key</span><span class="p">.</span><span class="n">toJson</span><span class="p">());</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// Add two entity properties:</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// - a utf-8 string: `question`</span>
</span><span class='line'>      <span class="n">client</span><span class="p">.</span><span class="n">Property</span> <span class="n">property</span> <span class="o">=</span> <span class="k">new</span> <span class="n">client</span><span class="p">.</span><span class="n">Property</span><span class="p">.</span><span class="n">fromJson</span><span class="p">({});</span>
</span><span class='line'>      <span class="n">property</span><span class="p">.</span><span class="n">stringValue</span> <span class="o">=</span> <span class="s2">&quot;Meaning of life?&quot;</span><span class="p">;</span>
</span><span class='line'>      <span class="n">entity</span><span class="p">.</span><span class="n">properties</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Map</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span> <span class="n">client</span><span class="p">.</span><span class="n">Property</span><span class="o">&gt;</span><span class="p">();</span>
</span><span class='line'>      <span class="n">entity</span><span class="p">.</span><span class="n">properties</span><span class="p">[</span><span class="s1">&#39;question&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">property</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// - a 64bit integer: `answer`</span>
</span><span class='line'>      <span class="n">property</span> <span class="o">=</span> <span class="k">new</span> <span class="n">client</span><span class="p">.</span><span class="n">Property</span><span class="p">.</span><span class="n">fromJson</span><span class="p">({});</span>
</span><span class='line'>      <span class="n">property</span><span class="p">.</span><span class="kt">int</span><span class="n">egerValue</span> <span class="o">=</span> <span class="m">42</span><span class="p">;</span>
</span><span class='line'>      <span class="n">entity</span><span class="p">.</span><span class="n">properties</span><span class="p">[</span><span class="s1">&#39;answer&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">property</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// Execute the Commit RPC synchronously and ignore the response:</span>
</span><span class='line'>      <span class="c1">// Apply the insert mutation if the entity was not found and close</span>
</span><span class='line'>      <span class="c1">// the transaction.</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">datastore</span><span class="p">.</span><span class="n">datasets</span><span class="p">.</span><span class="n">commit</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="n">projectId</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}).</span><span class="n">then</span><span class="p">((</span><span class="n">client</span><span class="p">.</span><span class="n">CommitResponse</span> <span class="n">commitResponse</span><span class="p">)</span> <span class="o">=&gt;</span>
</span><span class='line'>      <span class="n">print</span><span class="p">(</span><span class="s2">&quot;&gt; entity = </span><span class="si">${</span><span class="n">entity</span><span class="p">.</span><span class="n">properties</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">));</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>With this example, you learned how to use the:</p>

<ul>
<li><a href="http://pub.dartlang.org/packages/google_datastore_v1beta1_api">google_datastore_v1beta1_api</a> dart package to connect to the Datastore API.</li>
<li><a href="">beginTransaction</a> method to start a transaction.</li>
<li><a href="https://developers.google.com/datastore/docs/apis/v1beta2/datasets/lookup">lookup</a> method to retrieve entities by key from your dataset.</li>
<li><a href="https://developers.google.com/datastore/docs/apis/v1beta2/datasets/commit">commit</a> method to send mutations to entities in your dataset and commit the transaction.</li>
</ul>


<p>Now, you are ready to learn more about the <a href="https://developers.google.com/datastore/docs/concepts/">Key Datastore Concepts</a> and look at the <a href="https://developers.google.com/datastore/docs/apis/v1beta2/">JSON API reference</a>.</p>

<hr />

<h2>Example deployment and startup scripts for GCE with Dart</h2>

<p><code>setup-instance.sh</code> script creates the node with the right correct scopes and image.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'><span class="cp">#!/usr/bin/env bash</span>
</span><span class='line'><span class="kd">set</span> <span class="o">+</span><span class="n">o</span> <span class="n">xtrace</span>
</span><span class='line'>
</span><span class='line'><span class="n">USER</span><span class="o">=</span><span class="n">$USER</span>
</span><span class='line'><span class="n">PROJECT</span><span class="o">=</span><span class="n">dart</span><span class="o">-</span><span class="n">compute</span><span class="o">-</span><span class="n">project</span>
</span><span class='line'><span class="n">INSTANCE_NAME</span><span class="o">=</span><span class="n">dart</span><span class="o">-</span><span class="n">compute</span>
</span><span class='line'><span class="n">TAGS</span><span class="o">=</span><span class="n">dart</span>
</span><span class='line'><span class="n">MACHINE_TYPE</span><span class="o">=</span><span class="n">f1</span><span class="o">-</span><span class="n">micro</span>
</span><span class='line'><span class="n">NETWORK</span><span class="o">=</span><span class="k">default</span>
</span><span class='line'><span class="n">IP</span><span class="o">=</span><span class="n">ephemeral</span>
</span><span class='line'><span class="n">IMAGE</span><span class="o">=</span><span class="nl">https:</span><span class="c1">//www.googleapis.com/compute/v1/projects/debian-cloud/global/images/backports-debian-7-wheezy-v20140318</span>
</span><span class='line'><span class="n">SCOPES</span><span class="o">=</span><span class="nl">https:</span><span class="c1">//www.googleapis.com/auth/userinfo.email,https://www.googleapis.com/auth/compute,https://www.googleapis.com/auth/devstorage.full_control,https://www.googleapis.com/auth/datastore</span>
</span><span class='line'><span class="n">PERSISTENT_BOOT_DISK</span><span class="o">=</span><span class="kc">true</span>
</span><span class='line'><span class="n">AUTO_DELETE_BOOT_DISK</span><span class="o">=</span><span class="kc">true</span>
</span><span class='line'><span class="n">ZONE</span><span class="o">=</span><span class="n">us</span><span class="o">-</span><span class="n">central1</span><span class="o">-</span><span class="n">b</span>
</span><span class='line'><span class="n">STARTUP_SCRIPT</span><span class="o">=</span><span class="n">startup</span><span class="o">-</span><span class="n">script</span><span class="p">.</span><span class="n">sh</span>
</span><span class='line'><span class="n">GCUTIL</span><span class="o">=</span><span class="s2">&quot;gcutil --service_version=v1 --project=</span><span class="si">$</span><span class="n">PROJECT</span><span class="s2">&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="n">$GCUTIL</span> <span class="n">addinstance</span> <span class="n">$INSTANCE_NAME</span> <span class="o">--</span><span class="n">tags</span><span class="o">=</span><span class="n">$TAGS</span> <span class="o">--</span><span class="n">zone</span><span class="o">=</span><span class="n">$ZONE</span> <span class="o">--</span><span class="n">machine_type</span><span class="o">=</span><span class="n">$MACHINE_TYPE</span> <span class="o">--</span><span class="n">network</span><span class="o">=</span><span class="n">$NETWORK</span> <span class="o">--</span><span class="n">external_ip_address</span><span class="o">=</span><span class="n">$IP</span> <span class="o">--</span><span class="n">service_account_scopes</span><span class="o">=</span><span class="n">$SCOPES</span> <span class="o">--</span><span class="n">image</span><span class="o">=</span><span class="n">$IMAGE</span> <span class="o">--</span><span class="n">persistent_boot_disk</span><span class="o">=</span><span class="n">$PERSISTENT_BOOT_DISK</span> <span class="o">--</span><span class="n">auto_delete_boot_disk</span><span class="o">=</span><span class="n">$AUTO_DELETE_BOOT_DISK</span> <span class="o">--</span><span class="n">metadata_from_file</span><span class="o">=</span><span class="n">startup</span><span class="o">-</span><span class="nl">script:</span><span class="n">$STARTUP_SCRIPT</span>
</span><span class='line'>
</span><span class='line'><span class="n">rc</span><span class="o">=</span><span class="n">$</span><span class="o">?</span>
</span><span class='line'><span class="k">if</span> <span class="p">[[</span> <span class="n">$rc</span> <span class="o">!=</span> <span class="m">0</span> <span class="p">]]</span> <span class="p">;</span> <span class="n">then</span>
</span><span class='line'>  <span class="n">echo</span> <span class="s2">&quot;Not able to add instance&quot;</span>
</span><span class='line'>    <span class="n">exit</span> <span class="n">$rc</span>
</span><span class='line'><span class="n">fi</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>startup-script.sh</code> script that provisions the node with dart.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'><span class="cp">#!/usr/bin/env bash</span>
</span><span class='line'>
</span><span class='line'><span class="err">#</span> <span class="n">Add</span> <span class="n">an</span> <span class="n">addtional</span> <span class="n">source</span> <span class="k">for</span> <span class="n">the</span> <span class="n">latest</span> <span class="n">glibc</span>
</span><span class='line'><span class="n">sudo</span> <span class="n">sed</span> <span class="o">-</span><span class="n">i</span> <span class="s1">&#39;1i deb http://ftp.us.debian.org/debian/ jessie main&#39;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">apt</span><span class="o">/</span><span class="n">sources</span><span class="p">.</span><span class="n">list</span>
</span><span class='line'>
</span><span class='line'><span class="err">#</span> <span class="n">Update</span> <span class="n">sources</span>
</span><span class='line'><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="kd">get</span> <span class="n">update</span>
</span><span class='line'>
</span><span class='line'><span class="err">#</span> <span class="n">Download</span> <span class="n">latest</span> <span class="n">glibc</span>
</span><span class='line'><span class="n">sudo</span> <span class="n">DEBIAN_FRONTEND</span><span class="o">=</span><span class="n">noninteractive</span> <span class="n">apt</span><span class="o">-</span><span class="kd">get</span> <span class="o">-</span><span class="n">t</span> <span class="n">jessie</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">libc6</span> <span class="n">libc6</span><span class="o">-</span><span class="n">dev</span> <span class="n">libc6</span><span class="o">-</span><span class="n">dbg</span> <span class="n">git</span> <span class="n">screen</span> <span class="n">unzip</span> <span class="n">vim</span>
</span><span class='line'>
</span><span class='line'><span class="err">#</span> <span class="n">Download</span> <span class="n">the</span> <span class="n">latest</span> <span class="n">dart</span> <span class="n">sdk</span>
</span><span class='line'><span class="n">wget</span> <span class="nl">http:</span><span class="c1">//storage.googleapis.com/dart-archive/channels/dev/release/latest/sdk/dartsdk-linux-x64-release.zip -O dartsdk-linux-x64-release.zip </span>
</span><span class='line'>
</span><span class='line'><span class="err">#</span> <span class="n">Unpack</span> <span class="n">the</span> <span class="n">dart</span> <span class="n">sdk</span>
</span><span class='line'><span class="n">unzip</span> <span class="o">-</span><span class="n">d</span> <span class="o">/</span> <span class="n">dartsdk</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">x64</span><span class="o">-</span><span class="n">release</span><span class="p">.</span><span class="n">zip</span>
</span><span class='line'>
</span><span class='line'><span class="err">#</span> <span class="n">Make</span> <span class="n">the</span> <span class="n">sdk</span> <span class="n">readable</span>
</span><span class='line'><span class="n">chmod</span> <span class="o">-</span><span class="n">R</span> <span class="n">go</span><span class="o">+</span><span class="n">rx</span> <span class="o">/</span><span class="n">dart</span><span class="o">-</span><span class="n">sdk</span>
</span><span class='line'>
</span><span class='line'><span class="err">#</span> <span class="n">Add</span> <span class="n">dart</span> <span class="n">bin</span> <span class="n">to</span> <span class="n">global</span> <span class="n">path</span>
</span><span class='line'><span class="n">echo</span> <span class="s2">&quot;export PATH=\</span><span class="si">$</span><span class="n">PATH</span><span class="s2">:/dart-sdk/bin&quot;</span> <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">profile</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/01/14/chrome-dot-dart-0-dot-4-0-release/">chrome.dart 0.4.0 Release</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-01-14T09:33:00-08:00" pubdate data-updated="true">Jan 14<span>th</span>, 2014</time>
        
         | <a href="/blog/2014/01/14/chrome-dot-dart-0-dot-4-0-release/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The <a href="https://github.com/dart-gde?tab=members">dart-gde</a> has updated the <a href="https://github.com/dart-gde/chrome.dart">chrome.dart</a> to &#8216;0.4.0&#8217;. This release contains a whole rewrite of the project. All APIs are now generated from chrome apps/ext <a href="https://src.chromium.org/chrome/trunk/src/chrome/common/extensions/api">IDLs</a>. Most unit tests from previous <a href="https://github.com/dart-gde/chrome.dart">chrome.dart</a> have been ported.</p>

<h2>About chrome.dart</h2>

<p><a href="http://pub.dartlang.org/packages/chrome">chrome.dart</a> package provides the generated APIs to access chrome <a href="https://developer.chrome.com/apps/about_apps.html">apps &amp; extensions</a> through dart interfaces. The APIs depend on the <a href="https://github.com/dart-lang/js-interop">js-interop</a> to communicate with the javascript vm for accessing the APIs. Currently no native interfaces exist between dart vm and chrome browser. In a later point in time those interfaces will exist, for now this provides a way to access those interfaces.</p>

<h2>chrome_gen.dart -> chrome.dart</h2>

<p>At first <a href="https://github.com/dart-gde/chrome_gen.dart">chrome_gen.dart</a> was the project that kicked off moving to generated APIs. It was getting frustrating having to hand write, maintain and test <a href="http://pub.dartlang.org/packages/chrome">chrome.dart</a>. We did avoid looking into generation from IDL, because the IDL in the chromium is in two different formats <a href="https://src.chromium.org/chrome/trunk/src/chrome/common/extensions/api">json &amp; chrome specific WebIDL</a>. The nice part about the original <a href="https://github.com/dart-gde/chrome.dart">chrome.dart</a> package is we could introduce more structure for the APIs then what the generated javascript APIs looked like. So after initial development by <a href="https://github.com/devoncarew/">Devon Carew</a>, we decided it was a better direction to use <a href="https://github.com/dart-gde/chrome.dart/tree/master/tool">parsers and generators</a> to create and maintain the APIs. Four months later we had a 90% complete package that was already being used by a few projects, including <a href="https://github.com/dart-lang/spark">spark</a>. We are able to generate enough structure to keep nice APIs and generate form the IDL, this was a win for the project.</p>

<h2>Documentation</h2>

<p>The API documentation is automatically generated for <a href="http://dart-gde.github.io/chrome.dart/app/">Apps</a> and <a href="http://dart-gde.github.io/chrome.dart/ext/">Extensions</a> on each check in. A few wiki pages exist and we are in the process of migrating them from <a href="https://github.com/dart-gde/chrome_gen.dart/wiki">chrome_gen.dart wiki</a> -> <a href="https://github.com/dart-gde/chrome.dart/wiki">chrome.dart wiki</a>. We do need help and welcome pull requests and wiki edits.</p>

<h2>Samples</h2>

<p>Currently the best source of project setup exists with <a href="https://github.com/dart-gde/chrome.dart/tree/master/app">app</a> in the project. The <code>app</code> folder in a dart project will not have the automatic symlinks generated by <code>pub</code>. That helps out greatly since it would pollute our folder structure and cause bad things to happen. Instead we have a simple <a href="https://github.com/dart-gde/chrome.dart/blob/master/bin/setup_app.dart">setup_app.dart</a> script that helps build and copy packages over to the <code>app</code> folder. Right now its specific for the <a href="https://github.com/dart-gde/chrome.dart">chrome.dart</a> project but should be easy to replicate for your own chrome apps or extensions. Another neat script which is mac specific but could be generalized is <a href="https://github.com/dart-gde/chrome.dart/blob/master/bin/load_app.sh">load_app.sh</a>. <a href="https://github.com/dart-gde/chrome.dart/blob/master/bin/load_app.sh">load_app.sh</a> shows a simple way to load up an application in <code>app</code> folder from command line.</p>

<h2>Helping out</h2>

<p>We still need more unit tests, documentation, and additional development. If your interested checkout the <a href="https://github.com/dart-gde/chrome.dart/issues?state=open">github issues</a> or send pull requests.</p>

<h2>Thanks!</h2>

<p>To all the contributors on this project <a href="https://github.com/devoncarew">Devon Carew</a>, <a href="https://github.com/kevmoo">Kevin Moore</a>, <a href="https://github.com/rmsmith">Ross Smith</a>, <a href="https://github.com/DrMarcII">Marc Fisher</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/11/29/build-and-deploy-dart-to-beaglebone-black/">Build and Deploy Dart to Beaglebone Black</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-11-29T08:56:00-08:00" pubdate data-updated="true">Nov 29<span>th</span>, 2013</time>
        
         | <a href="/blog/2013/11/29/build-and-deploy-dart-to-beaglebone-black/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I was looking into using <a href="https://www.dartlang.org">dart</a> on <a href="http://beagleboard.org/products/beaglebone%20black">Beaglebone Black</a> and decided it would be useful to share with others what I found.</p>

<p>After a some build hacks and patches I found a minimal working solution for Beaglebone Black with <a href="https://wiki.debian.org/ArmHardFloatPort">Debian</a> <a href="http://www.armhf.com/">ARMhf</a>. A few important notes before going down the road of building dart for ARM. The <code>dart-sdk</code> is not fully supported and pub currently might not work. <del>The <code>dartanalyzer</code> might not work</del>. The only supported <a href="http://en.wikipedia.org/wiki/List_of_ARM_cores">ARM architectures</a> are the ones that have <a href="http://en.wikipedia.org/wiki/ARMv7#32-bit_architecture">ARMv7</a> with <a href="http://en.wikipedia.org/wiki/ARM_architecture#Floating-point_.28VFP.29">VFP</a>. Don&#8217;t spin your wheels trying to target any architecutre that is not <code>ARMv7</code> with VFP (minimum at the moment <code>ARMv7-A</code>) unless you plan on implementing the routines needed in the runtime <a href="https://code.google.com/p/dart/source/browse/branches/bleeding_edge/dart/runtime/vm/assembler_arm.cc">arm assembler</a>. If you do plan on implementing them, well thats just pure awesome!</p>

<figure class='code'><figcaption><span>assembler_arm.cc</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="kt">void</span> <span class="n">CPUFeatures</span><span class="o">::</span><span class="n">InitOnce</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'><span class="cp">#if defined(USING_SIMULATOR)</span>
</span><span class='line'>  <span class="n">integer_division_supported_</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>  <span class="n">neon_supported_</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'><span class="cp">#else</span>
</span><span class='line'>  <span class="n">ASSERT</span><span class="p">(</span><span class="n">CPUInfoContainsString</span><span class="p">(</span><span class="s">&quot;ARMv7&quot;</span><span class="p">));</span>  <span class="c1">// Implements ARMv7.</span>
</span><span class='line'>  <span class="n">ASSERT</span><span class="p">(</span><span class="n">CPUInfoContainsString</span><span class="p">(</span><span class="s">&quot;vfp&quot;</span><span class="p">));</span>  <span class="c1">// Has floating point unit.</span>
</span><span class='line'>  <span class="c1">// Has integer division.</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">CPUInfoContainsString</span><span class="p">(</span><span class="s">&quot;QCT APQ8064&quot;</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">// Special case for Qualcomm Krait CPUs in Nexus 4 and 7.</span>
</span><span class='line'>    <span class="n">integer_division_supported_</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">integer_division_supported_</span> <span class="o">=</span> <span class="n">CPUInfoContainsString</span><span class="p">(</span><span class="s">&quot;idiva&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="n">neon_supported_</span> <span class="o">=</span> <span class="n">CPUInfoContainsString</span><span class="p">(</span><span class="s">&quot;neon&quot;</span><span class="p">);</span>
</span><span class='line'><span class="cp">#endif  </span><span class="c1">// defined(USING_SIMULATOR)</span>
</span><span class='line'><span class="cp">#if defined(DEBUG)</span>
</span><span class='line'>  <span class="n">initialized_</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'><span class="cp">#endif</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Download <a href="http://releases.ubuntu.com/precise/">Ubuntu 12.04.3 LTS</a></h3>

<p>Download the desktop iso to install on VirtualBox.</p>

<h3>Install on <a href="https://www.virtualbox.org/">VirtualBox</a></h3>

<p>I work mostly on mac so Ubuntu installed on VirtualBox was needed to help with cross compiling and flashing of uSD cards.</p>

<h3>Update the packages</h3>

<p>Just to be safe update any Ubuntu packages before installing the development software.</p>

<h3>Install basic packages</h3>

<p>I typically use the git <a href="https://code.google.com/p/dart/wiki/GettingTheSource#Using_Git">overlay</a> on subversion when working with the dart repo. The java jre/jdk is required for building the dart_analyzer which does not work in the sdk.</p>

<figure class='code'><figcaption><span>shell</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># Install subversion </span>
</span><span class='line'>sudo apt-get install subversion git git-svn openssh-server vim default-jre default-jdk
</span></code></pre></td></tr></table></div></figure>


<h3>Install the chrome build and arm dependencies</h3>

<p>Checkout the latest build tools scripts. The following scripts prep your system with any packages needed for building dart.</p>

<figure class='code'><figcaption><span>shell</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># checkout build scripts</span>
</span><span class='line'>svn co http://src.chromium.org/chrome/trunk/src/build; <span class="nb">cd </span>build
</span><span class='line'>
</span><span class='line'><span class="c"># install dependencies</span>
</span><span class='line'>chmod u+x install-build-deps.sh
</span><span class='line'>./install-build-deps.sh --no-chromeos-fonts
</span><span class='line'>./install-build-deps.sh --no-chromeos-fonts --arm
</span></code></pre></td></tr></table></div></figure>


<h3>Install addtional libraries</h3>

<p>The following libraries are needed for building dart but might not be included from the chrome build tool scripts.</p>

<figure class='code'><figcaption><span>shell</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># Install addtional libs</span>
</span><span class='line'>sudo apt-get install libc6-dev-i386 g++-multilib
</span></code></pre></td></tr></table></div></figure>


<h3>Install depot-tools</h3>

<p><a href="http://www.chromium.org/developers/how-tos/depottools">depot-tools</a> is required for hacking out the dart source code.</p>

<figure class='code'><figcaption><span>shell</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># depot tools</span>
</span><span class='line'>svn co http://src.chromium.org/svn/trunk/tools/depot_tools
</span><span class='line'><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:<span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>//depot_tools
</span></code></pre></td></tr></table></div></figure>


<h3>Checkout the dart code base</h3>

<p>You dont need to include <code>--username &lt;YOUR USERNAME&gt;</code> unless you plan on creating a CL for review.</p>

<figure class='code'><figcaption><span>shell</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mkdir dart_bleeding
</span><span class='line'><span class="nb">cd </span>dart_bleeding
</span><span class='line'>svn ls https://dart.googlecode.com/svn/branches/bleeding_edge/ --username &lt;YOUR USERNAME&gt;
</span><span class='line'>gclient config https://dart.googlecode.com/svn/branches/bleeding_edge/deps/all.deps
</span><span class='line'>git svn clone -rHEAD https://dart.googlecode.com/svn/branches/bleeding_edge/dart dart
</span><span class='line'>gclient sync
</span><span class='line'>gclient runhooks
</span></code></pre></td></tr></table></div></figure>


<h3>Patch the gyp and version files</h3>

<p>A git patch can be found here <a href="https://gist.github.com/financeCoding/7725354">7725354</a>, that patches the build scripts to support building the <code>dart-sdk</code> for ARM. Patching the <code>VERSION</code> file was done in an attempt to get pub working. At the moment its not required. If not done then an old version number is baked into the dartvm. This patch also modifies which dartvm creates the snapshots for <code>pub</code>, <code>dart2js</code> and a wrapper util. Patch creates the requirement of having to build the dartvm for x64 before building the <code>dart-sdk</code> for ARM. The dart build scripts have a funky dependency of wanting to use the dartvm target to create the snapshot files. Which in this case wont work since our dartvm is an ARM target being built on x64.</p>

<figure class='code'><figcaption><span>arm.build.patch</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
</pre></td><td class='code'><pre><code class='diff'><span class='line'><span class="gh">diff --git a/tools/VERSION b/tools/VERSION</span>
</span><span class='line'><span class="gh">index d1ab212..0d6101d 100644</span>
</span><span class='line'><span class="gd">--- a/tools/VERSION</span>
</span><span class='line'><span class="gi">+++ b/tools/VERSION</span>
</span><span class='line'><span class="gu">@@ -1,5 +1,5 @@</span>
</span><span class='line'> CHANNEL be
</span><span class='line'><span class="gd">-MAJOR 0</span>
</span><span class='line'><span class="gd">-MINOR 1</span>
</span><span class='line'><span class="gd">-BUILD 2</span>
</span><span class='line'><span class="gd">-PATCH 0</span>
</span><span class='line'><span class="gi">+MAJOR 1</span>
</span><span class='line'><span class="gi">+MINOR 0</span>
</span><span class='line'><span class="gi">+BUILD 0</span>
</span><span class='line'><span class="gi">+PATCH 7</span>
</span><span class='line'><span class="gh">diff --git a/utils/compiler/compiler.gyp b/utils/compiler/compiler.gyp</span>
</span><span class='line'><span class="gh">index 294c7e9..5f3754a 100644</span>
</span><span class='line'><span class="gd">--- a/utils/compiler/compiler.gyp</span>
</span><span class='line'><span class="gi">+++ b/utils/compiler/compiler.gyp</span>
</span><span class='line'><span class="gu">@@ -18,7 +18,7 @@</span>
</span><span class='line'>         {
</span><span class='line'>           &#39;action_name&#39;: &#39;generate_snapshots&#39;,
</span><span class='line'>           &#39;inputs&#39;: [
</span><span class='line'><span class="gd">-            &#39;&lt;(PRODUCT_DIR)/&lt;(EXECUTABLE_PREFIX)dart&lt;(EXECUTABLE_SUFFIX)&#39;,</span>
</span><span class='line'><span class="gi">+            &#39;&lt;(PRODUCT_DIR)/../DebugX64/dart&#39;,</span>
</span><span class='line'>             &#39;../../sdk/lib/_internal/libraries.dart&#39;,
</span><span class='line'>             &#39;&lt;!@([&quot;python&quot;, &quot;../../tools/list_files.py&quot;, &quot;\\.dart$&quot;, &quot;../../sdk/lib/_internal/compiler&quot;, &quot;../../runtime/lib&quot;, &quot;../../sdk/lib/_internal/dartdoc&quot;])&#39;,
</span><span class='line'>             &#39;create_snapshot.dart&#39;,
</span><span class='line'><span class="gu">@@ -30,7 +30,7 @@</span>
</span><span class='line'>             &#39;&lt;(SHARED_INTERMEDIATE_DIR)/dart2js.dart.snapshot&#39;,
</span><span class='line'>           ],
</span><span class='line'>           &#39;action&#39;: [
</span><span class='line'><span class="gd">-            &#39;&lt;(PRODUCT_DIR)/&lt;(EXECUTABLE_PREFIX)dart&lt;(EXECUTABLE_SUFFIX)&#39;,</span>
</span><span class='line'><span class="gi">+            &#39;&lt;(PRODUCT_DIR)/../DebugX64/dart&#39;,</span>
</span><span class='line'>             &#39;create_snapshot.dart&#39;,
</span><span class='line'>             &#39;--output_dir=&lt;(SHARED_INTERMEDIATE_DIR)&#39;,
</span><span class='line'>             &#39;--dart2js_main=sdk/lib/_internal/compiler/implementation/dart2js.dart&#39;,
</span><span class='line'><span class="gh">diff --git a/utils/pub/pub.gyp b/utils/pub/pub.gyp</span>
</span><span class='line'><span class="gh">index fd5e147..ab2e243 100644</span>
</span><span class='line'><span class="gd">--- a/utils/pub/pub.gyp</span>
</span><span class='line'><span class="gi">+++ b/utils/pub/pub.gyp</span>
</span><span class='line'><span class="gu">@@ -25,7 +25,7 @@</span>
</span><span class='line'>             &#39;&lt;(SHARED_INTERMEDIATE_DIR)/pub.dart.snapshot&#39;,
</span><span class='line'>           ],
</span><span class='line'>           &#39;action&#39;: [
</span><span class='line'><span class="gd">-            &#39;&lt;(PRODUCT_DIR)/&lt;(EXECUTABLE_PREFIX)dart&lt;(EXECUTABLE_SUFFIX)&#39;,</span>
</span><span class='line'><span class="gi">+            &#39;&lt;(PRODUCT_DIR)/../DebugX64/dart&#39;,</span>
</span><span class='line'>             &#39;--package-root=&lt;(PRODUCT_DIR)/packages/&#39;,
</span><span class='line'>             &#39;--snapshot=&lt;(SHARED_INTERMEDIATE_DIR)/pub.dart.snapshot&#39;,
</span><span class='line'>             &#39;../../sdk/lib/_internal/pub/bin/pub.dart&#39;,
</span></code></pre></td></tr></table></div></figure>


<h3>Build the <code>dart-sdk</code></h3>

<p>Building of the <code>dart-sdk</code> for ARM target is a two stop process. First build x64 so we can use that dartvm to generate the snapshot files. Then the second step is running the <code>create_sdk</code> build for ARM. When the build is finished the <code>out/ReleaseARM/dart-sdk</code> should contain a full <code>dart-sdk</code> build. <del>Keep in mind this does build the <code>dartanalyzer</code> but it may not work on ARM.</del></p>

<figure class='code'><figcaption><span>shell</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># build a target for your native system to create the snapshot files. </span>
</span><span class='line'>./tools/build.py -m debug -v -a x64 -j 8
</span><span class='line'>
</span><span class='line'><span class="c"># build the arm target</span>
</span><span class='line'>./tools/build.py -m release -v -a arm -j 8 create_sdk
</span></code></pre></td></tr></table></div></figure>


<h3>Tarball the sdk</h3>

<p>Package up the <code>dart-sdk</code> as a tarball to distribute.</p>

<figure class='code'><figcaption><span>shell</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">cd</span> ./out/ReleaseARM/
</span><span class='line'>tar -czvf dart-sdk.tar.gz dart-sdk
</span></code></pre></td></tr></table></div></figure>


<h3>Install <a href="http://www.armhf.com/index.php/boards/beaglebone-black/#wheezy">Debian Wheezy 7.2 Hard Float Minimal Image</a> on Beaglebone Black</h3>

<p>In virtualbox with a uSD card at <code>/dev/sdX</code> the following will download an image and write to the uSD card. Updated images can be found at <a href="http://www.armhf.com/index.php/boards/beaglebone-black/#wheezy">armhf</a></p>

<figure class='code'><figcaption><span>shell</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>wget http://s3.armhf.com/debian/wheezy/bone/debian-wheezy-7.2-armhf-3.8.13-bone30.img.xz
</span><span class='line'>xz -cd debian-wheezy-7.2-armhf-3.8.13-bone30.img.xz &gt; /dev/sdX
</span></code></pre></td></tr></table></div></figure>


<p>Then insert the uSD card into the Beaglebone Black and boot the image by holding down the boot switch and powering on.</p>

<p><img src="http://elinux.org/images/7/76/CONN_REVA5A.jpg"></p>

<p>Write the booted image to the eMMC.</p>

<figure class='code'><figcaption><span>shell</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>xz -cd debian-wheezy-7.2-armhf-3.8.13-bone30.img.xz &gt; /dev/mmcblk1
</span></code></pre></td></tr></table></div></figure>


<p>Power down and remove the uSD card.</p>

<h3>Update glibc on the BeagleBone Black</h3>

<p>Updating glibc is required cause the version of glibc installed from the chromium build scripts is greater then the one shipped with Wheezy 7.2. The following commands update glibc.</p>

<figure class='code'><figcaption><span>shell</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># Add an addtional source for the latest glibc</span>
</span><span class='line'>sudo sed -i <span class="s1">&#39;1i deb http://ftp.us.debian.org/debian/ jessie main&#39;</span> /etc/apt/sources.list
</span><span class='line'>
</span><span class='line'><span class="c"># Update sources </span>
</span><span class='line'>sudo apt-get update
</span><span class='line'>
</span><span class='line'><span class="c"># Download latest glibc</span>
</span><span class='line'>sudo <span class="nv">DEBIAN_FRONTEND</span><span class="o">=</span>noninteractive apt-get -t jessie install -y libc6 libc6-dev libc6-dbg git screen
</span></code></pre></td></tr></table></div></figure>


<h3>Copy over <code>dart-sdk</code></h3>

<p>From virtual box copy over the tarball to Beaglebone Black running debian.</p>

<figure class='code'><figcaption><span>shell</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>scp dart-sdk.tar.gz debian@192.168.2.2:~/
</span></code></pre></td></tr></table></div></figure>


<p>After the tarball is copied, uncompress and add to your <code>PATH</code>.</p>

<figure class='code'><figcaption><span>shell</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>tar -zxvf dart-sdk.tar.gz
</span><span class='line'><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span>~/dart-sdk:<span class="nv">$PATH</span>
</span><span class='line'>dart --version
</span><span class='line'>Dart VM version: 1.0.0.7_r30634_adam <span class="o">(</span>Fri Nov 29 01:14:42 2013<span class="o">)</span> on <span class="s2">&quot;linux_arm&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Known issues at the moment</h3>

<p>Pub does not work, issue could be followed at <a href="https://code.google.com/p/dart/issues/detail?id=15383">15383</a>. I was testing this out while staying at a hotel so some proxy settings might of been blocking or tripping up pub.</p>

<h3>Feedback</h3>

<p>If you have a better way of running dart on Beagleblone Black I would love to hear it! Please contact me on <a href="https://plus.google.com/104569492481999771226/">g+</a> and lets discuss.</p>

<h3>Update on <code>dartanalyzer</code></h3>

<p><code>dartanalyzer</code> will work after installing the <code>default-jre</code> on Beaglebone Black.</p>

<figure class='code'><figcaption><span>shell</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo apt-get install default-jre
</span></code></pre></td></tr></table></div></figure>


<p></p>

<h3>Addtional resources</h3>

<ul>
<li><a href="https://github.com/financeCoding/dart_bleeding">dart_bleeding</a> contains some scripts I typically use for this entire process.</li>
<li><a href="https://code.google.com/p/dart/wiki/PreparingYourMachine">PreparingYourMachine</a> resources for preping your machine to build from source</li>
<li><a href="https://code.google.com/p/dart/wiki/GettingTheSource">GettingTheSource</a> getting the source code documentation</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/10/22/google-client-apis-new-release-0-dot-4-x/">Google Client Apis New Release 0.4.x</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-10-22T19:34:00-07:00" pubdate data-updated="true">Oct 22<span>nd</span>, 2013</time>
        
         | <a href="/blog/2013/10/22/google-client-apis-new-release-0-dot-4-x/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The <a href="https://github.com/dart-gde?tab=members">dart-gde</a> team has updated the <a href="https://github.com/dart-google-apis">google client apis</a> to <code>'&gt;=0.4.0'</code>. Along with this change was an update for <a href="http://pub.dartlang.org/packages/google_oauth2_client">Google OAuth2 Client</a> to <code>'&gt;=0.3.0'</code>.</p>

<h2>The breaking changes for <a href="http://pub.dartlang.org/packages/google_oauth2_client">Google OAuth2 Client</a></h2>

<ul>
<li>SystemCache has been removed.</li>
<li><code>GoogleOAuth2.ensureAuthenticated()</code> A much cleaner impl that eliminates the need to pass in a HttpRequest object to authenticate.</li>
<li>All dependencies bumped to latest versions.</li>
<li>Code refactored.</li>
<li>Dead code eliminated.</li>
<li>Remove deprecated libraries.</li>
<li>Heavy logging removed.</li>
</ul>


<h2>The breaking changes for generated <a href="https://github.com/dart-google-apis">google client apis</a> include</h2>

<ul>
<li>Renamed <code>lib/src/{cloud_api.dart -&gt; client_base.dart}</code> <code>lib/src/{cloud_api_console.dart -&gt; console_client.dart}</code> <code>lib/src/{cloud_api_browser.dart -&gt; browser_client.dart}</code>.</li>
<li><code>ClientBase.responseParse(int statusCode, String responseBody)</code> introduced and handles parsing <code>responseBody</code>. <code>responseParse</code> will throw <code>DetailedApiRequestError</code> if the body has an error.</li>
<li>Renamed <code>APIRequestException</code> -> <code>APIRequestError</code>.</li>
<li>Remove deprecated libraries.</li>
</ul>


<h2>Updating requires a small change in <code>pubspec.yaml</code></h2>

<figure class='code'><figcaption><span>pubspec.yaml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">dependencies</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="l-Scalar-Plain">google_plus_v1_api</span><span class="p-Indicator">:</span> <span class="s">&#39;&gt;=0.4.0&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>A small collection of demo examples could be found at <a href="https://github.com/dart-gde/dart_api_client_examples">dart_api_client_examples</a>.</p>

<h2>Full list of available Google client apis on <a href="http://pub.dartlang.org">pub.dartlang.org</a></h2>

<ul>
<li><a href="http://pub.dartlang.org/packages/dart_adexchangebuyer_v1_api_client">dart_adexchangebuyer_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_adexchangebuyer_v1_1_api_client">dart_adexchangebuyer_v1_1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_adexchangebuyer_v1_2_api_client">dart_adexchangebuyer_v1_2_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_adexchangebuyer_v1_3_api_client">dart_adexchangebuyer_v1_3_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_adexchangeseller_v1_api_client">dart_adexchangeseller_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_adexchangeseller_v1_1_api_client">dart_adexchangeseller_v1_1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_admin_directory_v1_api_client">dart_admin_directory_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_admin_email_migration_v2_api_client">dart_admin_email_migration_v2_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_admin_reports_v1_api_client">dart_admin_reports_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_adsense_v1_2_api_client">dart_adsense_v1_2_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_adsense_v1_3_api_client">dart_adsense_v1_3_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_adsensehost_v4_1_api_client">dart_adsensehost_v4_1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_analytics_v2_4_api_client">dart_analytics_v2_4_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_analytics_v3_api_client">dart_analytics_v3_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_androidpublisher_v1_api_client">dart_androidpublisher_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_androidpublisher_v1_1_api_client">dart_androidpublisher_v1_1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_appstate_v1_api_client">dart_appstate_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_audit_v1_api_client">dart_audit_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_bigquery_v2_api_client">dart_bigquery_v2_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_blogger_v2_api_client">dart_blogger_v2_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_blogger_v3_api_client">dart_blogger_v3_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_books_v1_api_client">dart_books_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_calendar_v3_api_client">dart_calendar_v3_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_civicinfo_us_v1_api_client">dart_civicinfo_us_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_compute_v1beta15_api_client">dart_compute_v1beta15_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_compute_v1beta16_api_client">dart_compute_v1beta16_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_coordinate_v1_api_client">dart_coordinate_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_customsearch_v1_api_client">dart_customsearch_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_datastore_v1beta1_api_client">dart_datastore_v1beta1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_datastore_v1beta2_api_client">dart_datastore_v1beta2_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_dfareporting_v1_api_client">dart_dfareporting_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_dfareporting_v1_1_api_client">dart_dfareporting_v1_1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_dfareporting_v1_2_api_client">dart_dfareporting_v1_2_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_dfareporting_v1_3_api_client">dart_dfareporting_v1_3_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_discovery_v1_api_client">dart_discovery_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_doubleclickbidmanager_v1_api_client">dart_doubleclickbidmanager_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_doubleclicksearch_v2_api_client">dart_doubleclicksearch_v2_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_drive_v1_api_client">dart_drive_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_drive_v2_api_client">dart_drive_v2_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_freebase_v1_sandbox_api_client">dart_freebase_v1_sandbox_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_freebase_v1sandbox_api_client">dart_freebase_v1sandbox_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_freebase_v1_api_client">dart_freebase_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_fusiontables_v1_api_client">dart_fusiontables_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_games_v1_api_client">dart_games_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_gamesmanagement_v1management_api_client">dart_gamesmanagement_v1management_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_gan_v1beta1_api_client">dart_gan_v1beta1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_groupsmigration_v1_api_client">dart_groupsmigration_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_groupssettings_v1_api_client">dart_groupssettings_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_identitytoolkit_v3_api_client">dart_identitytoolkit_v3_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_licensing_v1_api_client">dart_licensing_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_mirror_v1_api_client">dart_mirror_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_oauth2_v1_api_client">dart_oauth2_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_oauth2_v2_api_client">dart_oauth2_v2_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_orkut_v2_api_client">dart_orkut_v2_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_pagespeedonline_v1_api_client">dart_pagespeedonline_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_plus_v1_api_client">dart_plus_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_plusdomains_v1_api_client">dart_plusdomains_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_prediction_v1_2_api_client">dart_prediction_v1_2_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_prediction_v1_3_api_client">dart_prediction_v1_3_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_prediction_v1_4_api_client">dart_prediction_v1_4_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_prediction_v1_5_api_client">dart_prediction_v1_5_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_prediction_v1_6_api_client">dart_prediction_v1_6_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_reseller_v1sandbox_api_client">dart_reseller_v1sandbox_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_reseller_v1_api_client">dart_reseller_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_shopping_v1_api_client">dart_shopping_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_siteverification_v1_api_client">dart_siteverification_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_sqladmin_v1beta1_api_client">dart_sqladmin_v1beta1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_storage_v1beta1_api_client">dart_storage_v1beta1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_storage_v1beta2_api_client">dart_storage_v1beta2_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_taskqueue_v1beta1_api_client">dart_taskqueue_v1beta1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_taskqueue_v1beta2_api_client">dart_taskqueue_v1beta2_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_tasks_v1_api_client">dart_tasks_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_translate_v2_api_client">dart_translate_v2_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_urlshortener_v1_api_client">dart_urlshortener_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_webfonts_v1_api_client">dart_webfonts_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_youtube_v3_api_client">dart_youtube_v3_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_youtubeanalytics_v1_api_client">dart_youtubeanalytics_v1_api_client</a></li>
<li><a href="http://pub.dartlang.org/packages/dart_youtubeanalytics_v1beta1_api_client">dart_youtubeanalytics_v1beta1_api_client</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/09/30/getting-started-with-dart-on-compute-engine/">Getting Started With Dart on Compute Engine</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-09-30T20:41:00-07:00" pubdate data-updated="true">Sep 30<span>th</span>, 2013</time>
        
         | <a href="/blog/2013/09/30/getting-started-with-dart-on-compute-engine/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Quick how-to on using <a href="http://www.dartlang.org">dart</a> with <a href="https://cloud.google.com/products/compute-engine">Compute Engine</a>. If not aware, right now is a great time to dive into Compute Engine cause google is giving away $2,000 worth of <a href="https://plus.google.com/111783114889748547827/posts/Bou747dCfNb">credits</a> to individuals interested in trying it out. I&#8217;ve been using it for about 2-3 months now and totally love it.</p>

<p>What peeked my interest is it was flexable enough to run the dartvm as a server with minimal configuration. The one configuration hurdle was dependency of <code>GLIBC &gt;= 2.15</code> in the dartvm binaries. The good news is with a simple startup script the compute engine instance can be provisioned to support the latest linux <a href="https://storage.googleapis.com/dart-editor-archive-integration/latest/dartsdk-linux-64.tar.gz">dart-sdk</a>.</p>

<p>The main tool we will use to provision a compute engine instance is <a href="https://developers.google.com/compute/docs/gcutil/">gcutil</a>. We could of used dartvm and <a href="http://pub.dartlang.org/packages/google_compute_v1beta15_api">google_compute_v1beta15_api</a> but will save that for a later post.</p>

<p>After signing up for <a href="https://cloud.google.com/products/compute-engine">Compute Engine</a> the next step should be to download and configure <code>gcutil</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>wget https://google-compute-engine-tools.googlecode.com/files/gcutil-1.8.4.tar.gz
</span><span class='line'><span class="nv">$ </span>tar xzvpf gcutil-1.8.4.tar.gz -C <span class="nv">$HOME</span>
</span><span class='line'><span class="nv">$ </span><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span>./gcutil-1.8.4:<span class="nv">$PATH</span>
</span><span class='line'><span class="nv">$ </span>gcutil version
</span><span class='line'>1.8.4
</span></code></pre></td></tr></table></div></figure>


<p>Next we want to create a <code>startup.sh</code> script that will be deployed to the compute engine instance. The script is a simple way to run additional commands to provision the instance. For dart we need to add a new <code>deb</code> source, update sources, install dependencies, fetch &amp; unpack dart-sdk, and then execute our dart server. In the final line of the <code>startup.sh</code> script the command will create a dart server from the user account tied to this compute instance. Simply we clone a public git repo, install pub dependencies and screen a detached session that runs the dart server. This is not a very fancy way to deploy dart but a simple and quick way to get something running with no troubles. A real life deployment might include some trendy fab/chef/puppet combo.</p>

<figure class='code'><figcaption><span>startup.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/usr/bin/env bash</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Add an addtional source for the latest glibc</span>
</span><span class='line'>sudo sed -i <span class="s1">&#39;1i deb http://ftp.us.debian.org/debian/ jessie main&#39;</span> /etc/apt/sources.list
</span><span class='line'>
</span><span class='line'><span class="c"># Update sources </span>
</span><span class='line'>sudo apt-get update
</span><span class='line'>
</span><span class='line'><span class="c"># Download latest glibc</span>
</span><span class='line'>sudo <span class="nv">DEBIAN_FRONTEND</span><span class="o">=</span>noninteractive apt-get -t jessie install -y libc6 libc6-dev libc6-dbg git screen
</span><span class='line'>
</span><span class='line'><span class="c"># Download the latest dart sdk</span>
</span><span class='line'>wget https://storage.googleapis.com/dart-editor-archive-integration/latest/dartsdk-linux-64.tar.gz -O /dartsdk-linux-64.tar.gz
</span><span class='line'>
</span><span class='line'><span class="c"># Unpack the dart sdk</span>
</span><span class='line'>tar -zxvf /dartsdk-linux-64.tar.gz -C /
</span><span class='line'>
</span><span class='line'>su - financeCoding -c <span class="s1">&#39;ls -al &amp;&amp; cd ~ &amp;&amp; pwd &amp;&amp; git clone https://github.com/rikulo/stream.git &amp;&amp; /dart-sdk/bin/dart --version &amp;&amp; cd stream &amp;&amp; /dart-sdk/bin/dart --version &amp;&amp; /dart-sdk/bin/pub install &amp;&amp; cd example/hello-static &amp;&amp; screen -d -m /dart-sdk/bin/dart webapp/main.dart&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>After we have the <code>startup.sh</code> script we then create another deployment script. The following script will be the gcutil commands needed to actually create and provision the compute instance. The last part of our script includes a firewall rule for the port that the <a href="https://github.com/rikulo/stream">stream</a> sample is running on. Without proper firewall rules no access from the outside is possible.</p>

<figure class='code'><figcaption><span>deploy-dart-compute.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/usr/bin/env bash</span>
</span><span class='line'><span class="nb">set</span> +o xtrace
</span><span class='line'>
</span><span class='line'><span class="nv">USER</span><span class="o">=</span>financeCoding
</span><span class='line'><span class="nv">PROJECT</span><span class="o">=</span>dart-compute-project
</span><span class='line'><span class="nv">INSTANCE_NAME</span><span class="o">=</span>dart-compute
</span><span class='line'><span class="nv">TAGS</span><span class="o">=</span>dart
</span><span class='line'><span class="nv">MACHINE_TYPE</span><span class="o">=</span>g1-small
</span><span class='line'><span class="nv">NETWORK</span><span class="o">=</span>default
</span><span class='line'><span class="nv">IP</span><span class="o">=</span>ephemeral
</span><span class='line'><span class="nv">IMAGE</span><span class="o">=</span>https://www.googleapis.com/compute/v1beta15/projects/debian-cloud/global/images/debian-7-wheezy-v20130816
</span><span class='line'><span class="nv">SCOPES</span><span class="o">=</span>https://www.googleapis.com/auth/userinfo.email,https://www.googleapis.com/auth/compute,https://www.googleapis.com/auth/devstorage.full_control
</span><span class='line'><span class="nv">PERSISTENT_BOOT_DISK</span><span class="o">=</span><span class="nb">true</span>
</span><span class='line'><span class="nv">ZONE</span><span class="o">=</span>us-central1-b
</span><span class='line'><span class="nv">STARTUP_SCRIPT</span><span class="o">=</span>startup.sh
</span><span class='line'><span class="nv">GCUTIL</span><span class="o">=</span><span class="s2">&quot;gcutil --service_version=v1beta15 --project=$PROJECT&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$GCUTIL</span> addinstance <span class="nv">$INSTANCE_NAME</span> --tags<span class="o">=</span><span class="nv">$TAGS</span> --zone<span class="o">=</span><span class="nv">$ZONE</span> --machine_type<span class="o">=</span><span class="nv">$MACHINE_TYPE</span> --network<span class="o">=</span><span class="nv">$NETWORK</span> --external_ip_address<span class="o">=</span><span class="nv">$IP</span> --service_account_scopes<span class="o">=</span><span class="nv">$SCOPES</span> --image<span class="o">=</span><span class="nv">$IMAGE</span> --persistent_boot_disk<span class="o">=</span><span class="nv">$PERSISTENT_BOOT_DISK</span> --metadata_from_file<span class="o">=</span>startup-script:<span class="nv">$STARTUP_SCRIPT</span>
</span><span class='line'>
</span><span class='line'><span class="nv">rc</span><span class="o">=</span><span class="nv">$?</span>
</span><span class='line'><span class="k">if</span> <span class="o">[[</span> <span class="nv">$rc</span> !<span class="o">=</span> 0 <span class="o">]]</span> ; <span class="k">then</span>
</span><span class='line'><span class="k">  </span><span class="nb">echo</span> <span class="s2">&quot;Not able to add instance&quot;</span>
</span><span class='line'>    <span class="nb">exit</span> <span class="nv">$rc</span>
</span><span class='line'><span class="k">fi</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$GCUTIL</span> addfirewall <span class="nv">$INSTANCE_NAME</span> --allowed <span class="s2">&quot;tcp:8080&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">rc</span><span class="o">=</span><span class="nv">$?</span>
</span><span class='line'><span class="k">if</span> <span class="o">[[</span> <span class="nv">$rc</span> !<span class="o">=</span> 0 <span class="o">]]</span> ; <span class="k">then</span>
</span><span class='line'><span class="k">  </span><span class="nb">echo</span> <span class="s2">&quot;Not able to provision firewall or has already been provisioned&quot;</span>
</span><span class='line'>    <span class="nb">exit</span> <span class="nv">$rc</span>
</span><span class='line'><span class="k">fi</span>
</span><span class='line'>
</span><span class='line'><span class="nb">exit</span> <span class="nv">$rc</span>
</span></code></pre></td></tr></table></div></figure>


<p><a href="/images/2013-09-30-getting-started-with-dart-on-compute-engine/compute-engine-console.png"><img src="/images/2013-09-30-getting-started-with-dart-on-compute-engine/compute-engine-console.png" alt="compute-engine-console" /></a></p>

<p><a href="/images/2013-09-30-getting-started-with-dart-on-compute-engine/stream-client.png"><img src="/images/2013-09-30-getting-started-with-dart-on-compute-engine/stream-client.png" alt="stream-client" /></a></p>

<p>And thats all that is needed to get dart on compute engine in two easy steps. The code can be found here <a href="https://gist.github.com/financeCoding/6789537">gist</a>.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/04/02/gplus-quickstart-with-dart/">Gplus Quickstart With Dart</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-04-02T19:25:00-07:00" pubdate data-updated="true">Apr 2<span>nd</span>, 2013</time>
        
         | <a href="/blog/2013/04/02/gplus-quickstart-with-dart/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Tonights mash-up was taking the <a href="https://github.com/Scarygami/gplus-quickstart-dart">gplus-quickstart-dart</a> and wiring it up for server side support. Similar to the <a href="https://github.com/googleplus/gplus-quickstart-java">gplus-quickstart-java</a>, the client will use the <a href="https://developers.google.com/+/web/+1button/">gplus login button</a> to do the <a href="https://developers.google.com/accounts/docs/OAuth2WebServer">OAuth2WebServer</a> flow and send the code over to the server. The server can then verify and make calls on behalf of the client since an &#8216;offline&#8217; token was requested. This demo just features the server side and what was used to put it together. <a href="https://plus.google.com/u/0/109130932502535286138/">Yulian Kuncheff</a> has been the primary developer behind <a href="https://github.com/Daegalus/fukiya">fukiya</a> which is an express like framework for dart. The thing I liked most about <a href="https://github.com/Daegalus/fukiya">fukiya</a> was how simple and easy it was to setup URL handlers.</p>

<p>First off, setting up some dependencies.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>dependencies:
</span><span class='line'>  google_plus_v1_api: any
</span><span class='line'>  browser: any
</span><span class='line'>  fukiya: '&gt;=0.0.11'
</span><span class='line'>  html5lib: "&gt;=0.4.1 &lt;0.4.2"
</span><span class='line'>  logging: "&gt;=0.4.3+5"</span></code></pre></td></tr></table></div></figure>


<p>A quick outline of what URLs fukiya handles. Dead simple to setup!</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'><span class="kt">void</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">new</span> <span class="n">Fukiya</span><span class="p">()</span>
</span><span class='line'>  <span class="p">..</span><span class="kd">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">getIndexHandler</span><span class="p">)</span>
</span><span class='line'>  <span class="p">..</span><span class="kd">get</span><span class="p">(</span><span class="s1">&#39;/index.html&#39;</span><span class="p">,</span> <span class="n">getIndexHandler</span><span class="p">)</span>
</span><span class='line'>  <span class="p">..</span><span class="kd">get</span><span class="p">(</span><span class="s1">&#39;/index&#39;</span><span class="p">,</span> <span class="n">getIndexHandler</span><span class="p">)</span>
</span><span class='line'>  <span class="p">..</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/connect&#39;</span><span class="p">,</span> <span class="n">postConnectDataHandler</span><span class="p">)</span>
</span><span class='line'>  <span class="p">..</span><span class="kd">get</span><span class="p">(</span><span class="s1">&#39;/people&#39;</span><span class="p">,</span> <span class="n">getPeopleHandler</span><span class="p">)</span>
</span><span class='line'>  <span class="p">..</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/disconnect&#39;</span><span class="p">,</span> <span class="n">postDisconnectHandler</span><span class="p">)</span>
</span><span class='line'>  <span class="p">..</span><span class="n">staticFiles</span><span class="p">(</span><span class="s1">&#39;./web&#39;</span><span class="p">)</span>
</span><span class='line'>  <span class="p">..</span><span class="n">use</span><span class="p">(</span><span class="k">new</span> <span class="n">FukiyaJsonParser</span><span class="p">())</span>
</span><span class='line'>  <span class="p">..</span><span class="n">listen</span><span class="p">(</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="m">3333</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The index handler is special cause we needed to inject a state token into the page and HTTP session. The state token is then verified on the <code>/connect</code> post. The one-time token helps avoid any <a href="http://en.wikipedia.org/wiki/Confused_deputy_problem">Confused_deputy_problem</a>s.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'><span class="kt">void</span> <span class="n">getIndexHandler</span><span class="p">(</span><span class="n">FukiyaContext</span> <span class="n">context</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// Create a state token. </span>
</span><span class='line'>  <span class="n">context</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">session</span><span class="p">[</span><span class="s2">&quot;state_token&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_createStateToken</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// Readin the index file and add state token into the meta element. </span>
</span><span class='line'>  <span class="kd">var</span> <span class="n">file</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="p">(</span><span class="n">INDEX_HTML</span><span class="p">);</span>
</span><span class='line'>  <span class="n">file</span><span class="p">.</span><span class="n">exists</span><span class="p">().</span><span class="n">then</span><span class="p">((</span><span class="kt">bool</span> <span class="n">exists</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">exists</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">file</span><span class="p">.</span><span class="n">readAsString</span><span class="p">().</span><span class="n">then</span><span class="p">((</span><span class="kt">String</span> <span class="n">indexDocument</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">Document</span> <span class="n">doc</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Document</span><span class="p">.</span><span class="n">html</span><span class="p">(</span><span class="n">indexDocument</span><span class="p">);</span>
</span><span class='line'>        <span class="n">Element</span> <span class="n">metaState</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Element</span><span class="p">.</span><span class="n">html</span><span class="p">(</span><span class="s1">&#39;&lt;meta name=&quot;state_token&quot; content=&quot;</span><span class="si">${</span><span class="n">context</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">session</span><span class="p">[</span><span class="s2">&quot;state_token&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&quot;&gt;&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="n">doc</span><span class="p">.</span><span class="n">head</span><span class="p">.</span><span class="n">children</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">metaState</span><span class="p">);</span>
</span><span class='line'>        <span class="n">context</span><span class="p">.</span><span class="n">response</span><span class="p">.</span><span class="n">writeBytes</span><span class="p">(</span><span class="n">doc</span><span class="p">.</span><span class="n">outerHtml</span><span class="p">.</span><span class="n">codeUnits</span><span class="p">);</span>
</span><span class='line'>        <span class="n">context</span><span class="p">.</span><span class="n">response</span><span class="p">.</span><span class="n">done</span><span class="p">.</span><span class="n">catchError</span><span class="p">((</span><span class="n">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">serverLogger</span><span class="p">.</span><span class="n">fine</span><span class="p">(</span><span class="s2">&quot;File Response error: </span><span class="si">${</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">));</span>
</span><span class='line'>        <span class="n">context</span><span class="p">.</span><span class="n">response</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
</span><span class='line'>      <span class="p">},</span> <span class="nl">onError:</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">serverLogger</span><span class="p">.</span><span class="n">fine</span><span class="p">(</span><span class="s2">&quot;error = </span><span class="si">$</span><span class="n">error</span><span class="s2">&quot;</span><span class="p">));</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">context</span><span class="p">.</span><span class="n">response</span><span class="p">.</span><span class="n">statusCode</span> <span class="o">=</span> <span class="m">404</span><span class="p">;</span>
</span><span class='line'>      <span class="n">context</span><span class="p">.</span><span class="n">response</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>On the <code>/connect</code> post we will expect a gplus id to be passed to the query parameters and some token data posted. We can then verify the state token and use the token data for accessing the Google APIs.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'><span class="kt">void</span> <span class="n">postConnectDataHandler</span><span class="p">(</span><span class="n">FukiyaContext</span> <span class="n">context</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">serverLogger</span><span class="p">.</span><span class="n">fine</span><span class="p">(</span><span class="s2">&quot;postConnectDataHandler&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="kt">String</span> <span class="n">tokenData</span> <span class="o">=</span> <span class="n">context</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="n">containsKey</span><span class="p">(</span><span class="s2">&quot;access_token&quot;</span><span class="p">)</span> <span class="o">?</span> <span class="n">context</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">session</span><span class="p">[</span><span class="s2">&quot;access_token&quot;</span><span class="p">]</span> <span class="o">:</span> <span class="kc">null</span><span class="p">;</span> <span class="c1">// TODO: handle missing token</span>
</span><span class='line'>  <span class="kt">String</span> <span class="n">stateToken</span> <span class="o">=</span> <span class="n">context</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="n">containsKey</span><span class="p">(</span><span class="s2">&quot;state_token&quot;</span><span class="p">)</span> <span class="o">?</span> <span class="n">context</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">session</span><span class="p">[</span><span class="s2">&quot;state_token&quot;</span><span class="p">]</span> <span class="o">:</span> <span class="kc">null</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">String</span> <span class="n">queryStateToken</span> <span class="o">=</span> <span class="n">context</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">queryParameters</span><span class="p">.</span><span class="n">containsKey</span><span class="p">(</span><span class="s2">&quot;state_token&quot;</span><span class="p">)</span> <span class="o">?</span> <span class="n">context</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">queryParameters</span><span class="p">[</span><span class="s2">&quot;state_token&quot;</span><span class="p">]</span> <span class="o">:</span> <span class="kc">null</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// Check if the token already exists for this session. </span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">tokenData</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">context</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;Current user is already connected.&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="k">return</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// Check if any of the needed token values are null or mismatched.</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">stateToken</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">queryStateToken</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">stateToken</span> <span class="o">!=</span> <span class="n">queryStateToken</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">context</span><span class="p">.</span><span class="n">response</span><span class="p">.</span><span class="n">statusCode</span> <span class="o">=</span> <span class="m">401</span><span class="p">;</span>
</span><span class='line'>    <span class="n">context</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;Invalid state parameter.&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="k">return</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// Normally the state would be a one-time use token, however in our</span>
</span><span class='line'>  <span class="c1">// simple case, we want a user to be able to connect and disconnect</span>
</span><span class='line'>  <span class="c1">// without reloading the page.  Thus, for demonstration, we don&#39;t</span>
</span><span class='line'>  <span class="c1">// implement this best practice.</span>
</span><span class='line'>  <span class="n">context</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;state_token&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="kt">String</span> <span class="n">gPlusId</span> <span class="o">=</span> <span class="n">context</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">queryParameters</span><span class="p">[</span><span class="s2">&quot;gplus_id&quot;</span><span class="p">];</span>
</span><span class='line'>  <span class="kt">String</span><span class="n">Buffer</span> <span class="n">sb</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">String</span><span class="n">Buffer</span><span class="p">();</span>
</span><span class='line'>  <span class="c1">// Read data from request.</span>
</span><span class='line'>  <span class="n">context</span><span class="p">.</span><span class="n">request</span>
</span><span class='line'>  <span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="k">new</span> <span class="kt">String</span><span class="n">Decoder</span><span class="p">())</span>
</span><span class='line'>  <span class="p">.</span><span class="n">listen</span><span class="p">((</span><span class="n">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">sb</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="nl">onDone:</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">serverLogger</span><span class="p">.</span><span class="n">fine</span><span class="p">(</span><span class="s2">&quot;context.request.listen.onDone = </span><span class="si">${</span><span class="n">sb</span><span class="p">.</span><span class="n">toString</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="n">Map</span> <span class="n">requestData</span> <span class="o">=</span> <span class="n">JSON</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="n">sb</span><span class="p">.</span><span class="n">toString</span><span class="p">());</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">Map</span> <span class="n">fields</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>              <span class="s2">&quot;grant_type&quot;</span><span class="o">:</span> <span class="s2">&quot;authorization_code&quot;</span><span class="p">,</span>
</span><span class='line'>              <span class="s2">&quot;code&quot;</span><span class="o">:</span> <span class="n">requestData</span><span class="p">[</span><span class="s2">&quot;code&quot;</span><span class="p">],</span>
</span><span class='line'>              <span class="c1">// http://www.riskcompletefailure.com/2013/03/postmessage-oauth-20.html</span>
</span><span class='line'>              <span class="s2">&quot;redirect_uri&quot;</span><span class="o">:</span> <span class="s2">&quot;postmessage&quot;</span><span class="p">,</span>
</span><span class='line'>              <span class="s2">&quot;client_id&quot;</span><span class="o">:</span> <span class="n">CLIENT_ID</span><span class="p">,</span>
</span><span class='line'>              <span class="s2">&quot;client_secret&quot;</span><span class="o">:</span> <span class="n">CLIENT_SECRET</span>
</span><span class='line'>    <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">http</span><span class="p">.</span><span class="n">Client</span> <span class="n">_httpClient</span> <span class="o">=</span> <span class="k">new</span> <span class="n">http</span><span class="p">.</span><span class="n">Client</span><span class="p">();</span>
</span><span class='line'>    <span class="n">_httpClient</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">TOKEN_ENDPOINT</span><span class="p">,</span> <span class="nl">fields:</span> <span class="n">fields</span><span class="p">).</span><span class="n">then</span><span class="p">((</span><span class="n">http</span><span class="p">.</span><span class="n">Response</span> <span class="n">response</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="c1">// At this point we have the token and refresh token.</span>
</span><span class='line'>      <span class="kd">var</span> <span class="n">credentials</span> <span class="o">=</span> <span class="n">JSON</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">body</span><span class="p">);</span>
</span><span class='line'>      <span class="n">_httpClient</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>      <span class="kd">var</span> <span class="n">verifyTokenUrl</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">${</span><span class="n">TOKENINFO_URL</span><span class="si">}</span><span class="s1">?access_token=</span><span class="si">${</span><span class="n">credentials</span><span class="p">[</span><span class="s2">&quot;access_token&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="k">new</span> <span class="n">http</span><span class="p">.</span><span class="n">Client</span><span class="p">()</span>
</span><span class='line'>      <span class="p">..</span><span class="kd">get</span><span class="p">(</span><span class="n">verifyTokenUrl</span><span class="p">).</span><span class="n">then</span><span class="p">((</span><span class="n">http</span><span class="p">.</span><span class="n">Response</span> <span class="n">response</span><span class="p">)</span>  <span class="p">{</span>
</span><span class='line'>        <span class="n">serverLogger</span><span class="p">.</span><span class="n">fine</span><span class="p">(</span><span class="s2">&quot;response = </span><span class="si">${</span><span class="n">response</span><span class="p">.</span><span class="n">body</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="kd">var</span> <span class="n">verifyResponse</span> <span class="o">=</span> <span class="n">JSON</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">body</span><span class="p">);</span>
</span><span class='line'>        <span class="kt">String</span> <span class="n">userId</span> <span class="o">=</span> <span class="n">verifyResponse</span><span class="p">.</span><span class="n">containsKey</span><span class="p">(</span><span class="s2">&quot;user_id&quot;</span><span class="p">)</span> <span class="o">?</span> <span class="n">verifyResponse</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]</span> <span class="o">:</span> <span class="kc">null</span><span class="p">;</span>
</span><span class='line'>        <span class="kt">String</span> <span class="n">accessToken</span> <span class="o">=</span> <span class="n">credentials</span><span class="p">.</span><span class="n">containsKey</span><span class="p">(</span><span class="s2">&quot;access_token&quot;</span><span class="p">)</span> <span class="o">?</span> <span class="n">credentials</span><span class="p">[</span><span class="s2">&quot;access_token&quot;</span><span class="p">]</span> <span class="o">:</span> <span class="kc">null</span><span class="p">;</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">userId</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">userId</span> <span class="o">==</span> <span class="n">gPlusId</span> <span class="o">&amp;&amp;</span> <span class="n">accessToken</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="n">context</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">session</span><span class="p">[</span><span class="s2">&quot;access_token&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">accessToken</span><span class="p">;</span>
</span><span class='line'>          <span class="n">context</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;POST OK&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>          <span class="n">context</span><span class="p">.</span><span class="n">response</span><span class="p">.</span><span class="n">statusCode</span> <span class="o">=</span> <span class="m">401</span><span class="p">;</span>
</span><span class='line'>          <span class="n">context</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;POST FAILED </span><span class="si">${</span><span class="n">userId</span><span class="si">}</span><span class="s2"> != </span><span class="si">${</span><span class="n">gPlusId</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="p">});</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now the HTTP session has the full ability to make calls on behalf of the user. The <code>/people</code> method will be called from the client to retrieve the list of visible friends of that user.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'><span class="kt">void</span> <span class="n">getPeopleHandler</span><span class="p">(</span><span class="n">FukiyaContext</span> <span class="n">context</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="kt">String</span> <span class="n">accessToken</span> <span class="o">=</span> <span class="n">context</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="n">containsKey</span><span class="p">(</span><span class="s2">&quot;access_token&quot;</span><span class="p">)</span> <span class="o">?</span> <span class="n">context</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">session</span><span class="p">[</span><span class="s2">&quot;access_token&quot;</span><span class="p">]</span> <span class="o">:</span> <span class="kc">null</span><span class="p">;</span>
</span><span class='line'>  <span class="n">SimpleOAuth2</span> <span class="n">simpleOAuth2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleOAuth2</span><span class="p">()..</span><span class="n">credentials</span> <span class="o">=</span> <span class="k">new</span> <span class="n">console_auth</span><span class="p">.</span><span class="n">Credentials</span><span class="p">(</span><span class="n">accessToken</span><span class="p">);</span>
</span><span class='line'>  <span class="n">plus</span><span class="p">.</span><span class="n">Plus</span> <span class="n">plusclient</span> <span class="o">=</span> <span class="k">new</span> <span class="n">plus</span><span class="p">.</span><span class="n">Plus</span><span class="p">(</span><span class="n">simpleOAuth2</span><span class="p">);</span>
</span><span class='line'>  <span class="n">plusclient</span><span class="p">.</span><span class="n">makeAuthRequests</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>  <span class="n">plusclient</span><span class="p">.</span><span class="n">people</span><span class="p">.</span><span class="n">list</span><span class="p">(</span><span class="s2">&quot;me&quot;</span><span class="p">,</span> <span class="s2">&quot;visible&quot;</span><span class="p">).</span><span class="n">then</span><span class="p">((</span><span class="n">plus</span><span class="p">.</span><span class="n">PeopleFeed</span> <span class="n">people</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">serverLogger</span><span class="p">.</span><span class="n">fine</span><span class="p">(</span><span class="s2">&quot;/people = </span><span class="si">$</span><span class="n">people</span><span class="s2">&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="n">context</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">people</span><span class="p">.</span><span class="n">toString</span><span class="p">());</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>The final responsibility we can bestow upon the server is allowing the client to disconnect by revoking OAuth access.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'><span class="kt">void</span> <span class="n">postDisconnectHandler</span><span class="p">(</span><span class="n">FukiyaContext</span> <span class="n">context</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="kt">String</span> <span class="n">tokenData</span> <span class="o">=</span> <span class="n">context</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="n">containsKey</span><span class="p">(</span><span class="s2">&quot;access_token&quot;</span><span class="p">)</span> <span class="o">?</span> <span class="n">context</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">session</span><span class="p">[</span><span class="s2">&quot;access_token&quot;</span><span class="p">]</span> <span class="o">:</span> <span class="kc">null</span><span class="p">;</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">tokenData</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">context</span><span class="p">.</span><span class="n">response</span><span class="p">.</span><span class="n">statusCode</span> <span class="o">=</span> <span class="m">401</span><span class="p">;</span>
</span><span class='line'>    <span class="n">context</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;Current user not connected.&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="k">return</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">final</span> <span class="kt">String</span> <span class="n">revokeTokenUrl</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">${</span><span class="n">TOKEN_REVOKE_ENDPOINT</span><span class="si">}</span><span class="s2">?token=</span><span class="si">${</span><span class="n">tokenData</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="n">context</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;access_token&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">new</span> <span class="n">http</span><span class="p">.</span><span class="n">Client</span><span class="p">()..</span><span class="kd">get</span><span class="p">(</span><span class="n">revokeTokenUrl</span><span class="p">).</span><span class="n">then</span><span class="p">((</span><span class="n">http</span><span class="p">.</span><span class="n">Response</span> <span class="n">response</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">context</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">session</span><span class="p">[</span><span class="s2">&quot;state_token&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_createStateToken</span><span class="p">();</span>
</span><span class='line'>    <span class="n">Map</span> <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>                <span class="s2">&quot;state_token&quot;</span><span class="o">:</span> <span class="n">context</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">session</span><span class="p">[</span><span class="s2">&quot;state_token&quot;</span><span class="p">],</span>
</span><span class='line'>                <span class="s2">&quot;message&quot;</span> <span class="o">:</span> <span class="s2">&quot;Successfully disconnected.&quot;</span>
</span><span class='line'>                <span class="p">};</span>
</span><span class='line'>    <span class="n">context</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">JSON</span><span class="p">.</span><span class="n">stringify</span><span class="p">(</span><span class="n">data</span><span class="p">));</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>Thats about it, Happy Dart Hacking! Special thanks to <a href="https://plus.google.com/112336147904981294875">Gerwin Sturm</a> for putting together the original example for client side. Full source code can be found at <a href="https://github.com/Scarygami/gplus-quickstart-dart">gplus-quickstart-dart</a> in the server folder. Please replace your own keys cause mine will be removed at some point.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/03/21/dart-multi-touch-canvas-with-realtime-apis/">Dart Multi Touch Canvas With Realtime APIs</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-03-21T18:19:00-07:00" pubdate data-updated="true">Mar 21<span>st</span>, 2013</time>
        
         | <a href="/blog/2013/03/21/dart-multi-touch-canvas-with-realtime-apis/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="https://developers.google.com/drive/">Google</a> has made the <a href="https://developers.google.com/drive/realtime/">realtime</a> api available for developers. Realtime api provides <a href="http://en.wikipedia.org/wiki/Operational_transformation">operational transformation</a> on <a href="https://developers.google.com/drive/realtime/reference/gapi.drive.realtime.CollaborativeString">strings</a>, <a href="https://developers.google.com/drive/realtime/reference/gapi.drive.realtime.CollaborativeList">lists</a>, <a href="https://developers.google.com/drive/realtime/reference/gapi.drive.realtime.CollaborativeMap">maps</a> and custom <a href="https://developers.google.com/drive/realtime/reference/gapi.drive.realtime.CollaborativeObject">objects</a>. The application data gets stored on Google Drive and is available from any supported browser. This is going to be the tooling of the future for collaborative applications.</p>

<p>I took some time to see what it would take for implementing a sample realtime application in dart. Also wanted to make sure my sample could run on mobile chrome.</p>

<p>Since realtime api is new, dart bindings don&#8217;t really exist. Lucky for us we have <a href="http://pub.dartlang.org/packages/js">js-interop</a> library. The <a href="http://pub.dartlang.org/packages/js">js-interop</a> library provides communications to existing javascript code from dart. I consider this mostly a quick hack to get started with the realtime api until a more native interface exists.</p>

<p>The sample <a href="http://financecoding.github.com/realtime_touch_canvas/web/index.html">realtime_touch_canvas</a> demonstrates a multi touch canvas surface that updates in realtime with all clients that have the application open.</p>

<iframe width="560" height="315" src="http://www.youtube.com/embed/xArfJdOb55Q" frameborder="0" allowfullscreen></iframe>


<p>Most of the heavy lifting is done by <a href="https://github.com/financeCoding/realtime_touch_canvas"><code>rtclient.dart</code></a>. I ported the <a href="https://github.com/googledrive/realtime-playground/blob/master/js/realtime-client-utils.js">code</a> from the javascript version. Its enough code to get started right away but a more structured solution should be done. The main class is <code>RealTimeLoader</code> used for realtime loading.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'>  <span class="n">rtl</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RealTimeLoader</span><span class="p">(</span><span class="nl">clientId:</span> <span class="s1">&#39;CLIENTID.apps.googleusercontent.com&#39;</span><span class="p">,</span> <span class="nl">apiKey:</span> <span class="s1">&#39;KEY&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="n">rtl</span><span class="p">.</span><span class="n">start</span><span class="p">().</span><span class="n">then</span><span class="p">((</span><span class="kt">bool</span> <span class="n">isComplete</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="cm">/* RealTimeLoader has authenticated the application and is ready to load a file */</span>
</span><span class='line'>    <span class="n">loadRealTimeFile</span><span class="p">(</span><span class="n">fileId</span><span class="p">,</span> <span class="n">model</span><span class="p">.</span><span class="n">onFileLoaded</span><span class="p">,</span> <span class="n">model</span><span class="p">.</span><span class="n">initializeModel</span><span class="p">);</span>
</span><span class='line'>  <span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>model.onFileLoaded</code> and <code>model.initializeModel</code> handle the creating of model data and loading of model data.</p>

<p>In the <a href="http://financecoding.github.com/realtime_touch_canvas/web/index.html">realtime_touch_canvas</a>, model data was a simple list of json strings. The ticky part here is you need to remember that your working with the realtime api within the javascript vm. So an array needs to be allocated from <a href="http://pub.dartlang.org/packages/js">js-interop</a>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'>  <span class="kt">void</span> <span class="n">_createNewModel</span><span class="p">(</span><span class="n">js</span><span class="p">.</span><span class="n">Proxy</span> <span class="n">model</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="n">list</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">createList</span><span class="p">(</span><span class="n">js</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">_defaultLines</span><span class="p">));</span>
</span><span class='line'>    <span class="n">model</span><span class="p">.</span><span class="n">getRoot</span><span class="p">().</span><span class="kd">set</span><span class="p">(</span><span class="n">_linesName</span><span class="p">,</span> <span class="n">list</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>After the model is created we then get called to load the file. Loading the file for our purposes is binding the collaborative objects. Some tricky things to note here is we are retaining the javascript objects so we can access them after exit of the callback. Also the callbacks have to be wrapped within <a href="http://pub.dartlang.org/packages/js">js-interop</a> <code>js.Callback.many</code> proxy object. The callbacks <code>_linesOnAddValuesChangedEvent</code> and <code>_linesOnRemovedValuesChangedEvent</code> are fired off when the collaborative list object has items added or removed.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'>  <span class="n">js</span><span class="p">.</span><span class="n">Proxy</span> <span class="n">_doc</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">String</span> <span class="n">_linesName</span> <span class="o">=</span> <span class="s2">&quot;lines&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="n">js</span><span class="p">.</span><span class="n">Proxy</span> <span class="n">_lines</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="kt">void</span> <span class="n">_bindModel</span><span class="p">(</span><span class="n">js</span><span class="p">.</span><span class="n">Proxy</span> <span class="n">doc</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">_doc</span> <span class="o">=</span> <span class="n">doc</span><span class="p">;</span>
</span><span class='line'>    <span class="n">js</span><span class="p">.</span><span class="n">retain</span><span class="p">(</span><span class="n">_doc</span><span class="p">);</span>
</span><span class='line'>    <span class="n">_lines</span> <span class="o">=</span> <span class="n">doc</span><span class="p">.</span><span class="n">getModel</span><span class="p">().</span><span class="n">getRoot</span><span class="p">().</span><span class="kd">get</span><span class="p">(</span><span class="n">_linesName</span><span class="p">);</span>
</span><span class='line'>    <span class="n">_lines</span><span class="p">.</span><span class="n">addEventListener</span><span class="p">(</span><span class="n">gapi</span><span class="p">.</span><span class="n">drive</span><span class="p">.</span><span class="n">realtime</span><span class="p">.</span><span class="n">EventType</span><span class="p">.</span><span class="n">VALUES_ADDED</span><span class="p">,</span> <span class="k">new</span> <span class="n">js</span><span class="p">.</span><span class="n">Callback</span><span class="p">.</span><span class="n">many</span><span class="p">(</span><span class="n">_linesOnAddValuesChangedEvent</span><span class="p">));</span>
</span><span class='line'>    <span class="n">_lines</span><span class="p">.</span><span class="n">addEventListener</span><span class="p">(</span><span class="n">gapi</span><span class="p">.</span><span class="n">drive</span><span class="p">.</span><span class="n">realtime</span><span class="p">.</span><span class="n">EventType</span><span class="p">.</span><span class="n">VALUES_REMOVED</span><span class="p">,</span> <span class="k">new</span> <span class="n">js</span><span class="p">.</span><span class="n">Callback</span><span class="p">.</span><span class="n">many</span><span class="p">(</span><span class="n">_linesOnRemovedValuesChangedEvent</span><span class="p">));</span>
</span><span class='line'>    <span class="n">js</span><span class="p">.</span><span class="n">retain</span><span class="p">(</span><span class="n">_lines</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>When the callback is called the data would be in the javascript virtual machine so we can parse it and store in our native dart code. This is more of a convenience then a must do, that way we can expose plan old dart objects to our other parts of the dart application.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'>  <span class="kt">void</span> <span class="n">_linesOnAddValuesChangedEvent</span><span class="p">(</span><span class="n">addedValue</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="n">insertedLine</span> <span class="o">=</span> <span class="n">_lines</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="n">addedValue</span><span class="p">.</span><span class="n">index</span><span class="p">);</span>
</span><span class='line'>    <span class="kd">var</span> <span class="n">line</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Line</span><span class="p">.</span><span class="n">fromJson</span><span class="p">(</span><span class="n">insertedLine</span><span class="p">);</span>
</span><span class='line'>    <span class="n">realtimeTouchCanvas</span><span class="p">.</span><span class="n">move</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">line</span><span class="p">.</span><span class="n">moveX</span><span class="p">,</span> <span class="n">line</span><span class="p">.</span><span class="n">moveY</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>Now when we want to store a line in the application we simply convert it to json and push it into the collaborative list. The little tick here is to make sure we are <code>scoped</code> when accessing the <code>_lines</code> object since it lives in the javascript virtual machine.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'>  <span class="kt">void</span> <span class="n">addLine</span><span class="p">(</span><span class="n">Line</span> <span class="n">line</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">js</span><span class="p">.</span><span class="n">scoped</span><span class="p">(()</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">_lines</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">line</span><span class="p">.</span><span class="n">toJson</span><span class="p">());</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>  <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The <a href="http://financecoding.github.com/realtime_touch_canvas/web/index.html">realtime_touch_canvas</a> is live on github gh-pages and <a href="https://github.com/financeCoding/realtime_touch_canvas">realtime_touch_canvas source</a> is available.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/03/09/rikulo-stream-on-heroku/">Rikulo Stream on Heroku</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-03-09T07:16:00-08:00" pubdate data-updated="true">Mar 9<span>th</span>, 2013</time>
        
         | <a href="/blog/2013/03/09/rikulo-stream-on-heroku/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Tonights hacking was with <a href="https://github.com/rikulo/stream">stream</a> and <a href="http://www.heroku.com/">heroku</a>. <em>Stream is a Dart web server supporting request routing, filtering, template technology, file-based static resources and MVC design pattern.</em> I just planned on serving static content from <a href="http://www.heroku.com/">heroku</a> using full dart based web server.</p>

<p>First setup the dart build pack</p>

<figure class='code'><figcaption><span>shell</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>adam@Adams-MacBook-Air:~/dart
</span><span class='line'><span class="nv">$ </span>mkdir stream_todomvc
</span><span class='line'>
</span><span class='line'>adam@Adams-MacBook-Air:~/dart/stream_todomvc
</span><span class='line'><span class="nv">$ </span><span class="nb">cd </span>stream_todomvc
</span><span class='line'>
</span><span class='line'>adam@Adams-MacBook-Air:~/dart/stream_todomvc
</span><span class='line'><span class="nv">$ </span>heroku create stream-todomvc
</span><span class='line'>
</span><span class='line'>adam@Adams-MacBook-Air:~/dart/stream_todomvc
</span><span class='line'><span class="nv">$ </span>heroku config:add <span class="nv">BUILDPACK_URL</span><span class="o">=</span>https://github.com/igrigorik/heroku-buildpack-dart.git
</span><span class='line'>
</span><span class='line'>adam@Adams-MacBook-Air:~/dart/stream_todomvc
</span><span class='line'><span class="nv">$ </span>git init
</span><span class='line'>
</span><span class='line'>adam@Adams-MacBook-Air:~/dart/stream_todomvc
</span><span class='line'><span class="nv">$ </span>git remote add heroku git@heroku.com:stream-todomvc.git
</span></code></pre></td></tr></table></div></figure>


<p>Creating a new project called <code>stream-todomvc</code>. Going to use the <a href="https://github.com/dart-lang/web-ui/tree/master/example/todomvc">todomvc</a> from the <a href="https://github.com/dart-lang/web-ui">web-ui</a> project as our content for the <a href="https://github.com/rikulo/stream">stream</a> server. First thing that should be done is adding the dependencies to the <code>pubspec.yaml</code> file.</p>

<figure class='code'><figcaption><span>pubspec.yaml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">stream_todomvc</span>
</span><span class='line'><span class="l-Scalar-Plain">description</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">A sample WebUI application</span>
</span><span class='line'><span class="l-Scalar-Plain">dependencies</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="l-Scalar-Plain">browser</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">any</span>
</span><span class='line'>  <span class="l-Scalar-Plain">js</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">any</span>
</span><span class='line'>  <span class="l-Scalar-Plain">web_ui</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">0.4.1+7</span>
</span><span class='line'>  <span class="l-Scalar-Plain">stream</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">0.5.5+1</span>
</span></code></pre></td></tr></table></div></figure>


<p>Next I simply compied the existing <a href="https://github.com/dart-lang/web-ui/tree/master/example/todomvc">todomvc</a> project out into my <a href="http://stream-todomvc.herokuapp.com/out/index.html">stream-todomvc</a> project.</p>

<figure class='code'><figcaption><span>shell</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>adam@Adams-MacBook-Air:~/dart/stream_todomvc
</span><span class='line'><span class="nv">$ </span>cp ~/dart/web-ui/example/todomvc/* ./web/
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p><a href="http://docs.rikulo.org/stream/latest/Getting_Started/Introduction.html">stream intro</a> documentation goes over some basic configurations and settings. I&#8217;m just going to use them for now to get something running right away. The key to note when serving code from the <code>web/</code> folder in dart projects is having the <a href="https://github.com/rikulo/stream">stream</a> server code in <code>web/webapp/</code>. That way <a href="https://github.com/rikulo/stream">stream</a> can find all your resources with little configuration. With very little dart code we can have static web server going.</p>

<figure class='code'><figcaption><span>web/webapp/server.dart</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'><span class="n">library</span> <span class="n">server</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">import</span> <span class="s1">&#39;dart:io&#39;</span><span class="p">;</span>
</span><span class='line'><span class="n">import</span> <span class="s2">&quot;package:stream/stream.dart&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="n">port</span> <span class="o">=</span> <span class="n">Platform</span><span class="p">.</span><span class="n">environment</span><span class="p">.</span><span class="n">containsKey</span><span class="p">(</span><span class="s1">&#39;PORT&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="kt">int</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="n">Platform</span><span class="p">.</span><span class="n">environment</span><span class="p">[</span><span class="s1">&#39;PORT&#39;</span><span class="p">])</span> <span class="o">:</span> <span class="m">8080</span><span class="p">;</span>
</span><span class='line'>  <span class="kd">var</span> <span class="n">host</span> <span class="o">=</span> <span class="s1">&#39;0.0.0.0&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="kd">var</span> <span class="n">streamServer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StreamServer</span><span class="p">();</span>
</span><span class='line'>  <span class="n">streamServer</span>
</span><span class='line'>  <span class="p">..</span><span class="n">port</span> <span class="o">=</span> <span class="n">port</span>
</span><span class='line'>  <span class="p">..</span><span class="n">host</span> <span class="o">=</span> <span class="n">host</span>
</span><span class='line'>  <span class="p">..</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Since this was a <a href="https://github.com/dart-lang/web-ui">web-ui</a> project we need to have a <code>build.dart</code> file help us with transforming the polyfill web components.</p>

<figure class='code'><figcaption><span>build.dart</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'><span class="n">import</span> <span class="s1">&#39;dart:io&#39;</span><span class="p">;</span>
</span><span class='line'><span class="n">import</span> <span class="s1">&#39;package:web_ui/component_build.dart&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">main</span><span class="p">()</span> <span class="o">=&gt;</span> <span class="n">build</span><span class="p">(</span><span class="k">new</span> <span class="n">Options</span><span class="p">().</span><span class="n">arguments</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;web/index.html&#39;</span><span class="p">]);</span>
</span></code></pre></td></tr></table></div></figure>


<p>The <a href="http://www.heroku.com/">heroku</a> environment requires a <a href="https://devcenter.heroku.com/articles/procfile">procfile</a> configuration to let the service know the type of commands to run.</p>

<figure class='code'><figcaption><span>Procfile</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>web: ./dart-sdk/bin/dart --package-root=./packages/ web/webapp/server.dart
</span></code></pre></td></tr></table></div></figure>


<p>Next we build all the static data for our webapp to function. This will include calling <code>build.dart</code> and <code>dart2js</code>. The second step of calling <code>dart2js</code> helps with clients that do not have the <code>dartvm</code> built in.</p>

<figure class='code'><figcaption><span>shell</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>adam@Adams-MacBook-Air:~/dart/stream_todomvc
</span><span class='line'><span class="nv">$ </span>pub install
</span><span class='line'>Resolving dependencies...
</span><span class='line'>Dependencies installed!
</span><span class='line'>
</span><span class='line'>adam@Adams-MacBook-Air:~/dart/stream_todomvc
</span><span class='line'><span class="nv">$ </span>dart build.dart
</span><span class='line'>Total <span class="nb">time </span>spent on web/index.html                           -- 839 ms
</span><span class='line'>Total <span class="nb">time</span>                                                   -- 863 ms
</span><span class='line'>
</span><span class='line'>adam@Adams-MacBook-Air:~/dart/stream_todomvc
</span><span class='line'><span class="nv">$ </span>dart2js -oweb/out/index.html_bootstrap.dart.js web/out/index.html_bootstrap.dart
</span><span class='line'>Using snapshot /Users/adam/Documents/DartEditor/dart/dart-sdk/lib/_internal/compiler/implementation/dart2js.dart.snapshot
</span></code></pre></td></tr></table></div></figure>


<p>Now everything should be ready for deployment.</p>

<figure class='code'><figcaption><span>shell</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>adam@Adams-MacBook-Air:~/dart/stream_todomvc
</span><span class='line'><span class="nv">$ </span>git add -a -m <span class="s2">&quot;ready for deploy&quot;</span>
</span><span class='line'>
</span><span class='line'>adam@Adams-MacBook-Air:~/dart/stream_todomvc
</span><span class='line'><span class="nv">$ </span>git push -v --set-upstream heroku master:master
</span><span class='line'>Pushing to git@heroku.com:stream-todomvc.git
</span><span class='line'>Counting objects: 5, <span class="k">done</span>.
</span><span class='line'>Delta compression using up to 4 threads.
</span><span class='line'>Compressing objects: 100% <span class="o">(</span>3/3<span class="o">)</span>, <span class="k">done</span>.
</span><span class='line'>Writing objects: 100% <span class="o">(</span>3/3<span class="o">)</span>, 283 bytes, <span class="k">done</span>.
</span><span class='line'>Total 3 <span class="o">(</span>delta 2<span class="o">)</span>, reused 0 <span class="o">(</span>delta 0<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>-----&gt; Fetching custom git buildpack... <span class="k">done</span>
</span><span class='line'>-----&gt; Dart app detected
</span><span class='line'>-----&gt; Installing Dart VM, build: latest
</span><span class='line'>-----&gt; Copy Dart binaries to app root
</span><span class='line'>-----&gt; Install packages
</span><span class='line'>*** Found pubspec.yaml in .
</span><span class='line'>Resolving dependencies...
</span><span class='line'>Dependencies installed!
</span><span class='line'>Fixed web symlink
</span><span class='line'>-----&gt; Discovering process types
</span><span class='line'>       Procfile declares types -&gt; web
</span><span class='line'>
</span><span class='line'>-----&gt; Compiled slug size: 8.9MB
</span><span class='line'>-----&gt; Launching... <span class="k">done</span>, v7
</span><span class='line'>       http://stream-todomvc.herokuapp.com deployed to Heroku
</span><span class='line'>
</span><span class='line'>To git@heroku.com:stream-todomvc.git
</span><span class='line'>   042f1f4..b35984b  master -&gt; master
</span><span class='line'>updating <span class="nb">local </span>tracking ref <span class="s1">&#39;refs/remotes/heroku/master&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Deploying to <a href="http://www.heroku.com/">heroku</a> in this style is just a good starting point. <a href="https://github.com/dart-lang/web-ui">web-ui</a> and <a href="http://www.dartlang.org">dart</a> in general is still working on a deployment story. The URL for the <a href="http://stream-todomvc.herokuapp.com/out/index.html">stream-todomvc</a> will contain <code>out</code> in its location, not very desirable. In the future a <a href="https://github.com/dart-lang/buildtool">buildtool</a> will aid the deployment story for <a href="http://www.dartlang.org">dart</a>.</p>

<p>Check out the live version of <a href="http://stream-todomvc.herokuapp.com/out/index.html">stream-todomvc</a> with full source code available at the <a href="https://github.com/financeCoding/stream-todomvc">stream-todomvc github project</a>.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/02/08/google-client-apis-now-available-on-pub/">Dart Google Client Apis Now Available on Pub</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-02-08T14:18:00-08:00" pubdate data-updated="true">Feb 8<span>th</span>, 2013</time>
        
         | <a href="/blog/2013/02/08/google-client-apis-now-available-on-pub/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The <a href="https://github.com/dart-gde?tab=members">dart-gde</a> team now brings you not only a generator to create google client apis but also <a href="http://pub.dartlang.org">pub.dartlang.org</a> hosted packages. Lot of thanks goes to <a href="https://profiles.google.com/scarygami">Gerwin Sturm</a> for all of his hard work over the last few weeks developing <a href="https://github.com/dart-gde/discovery_api_dart_client_generator">discovery_api_dart_client_generator</a> and <a href="https://github.com/dart-gde/dart-google-oauth2-library">dart-google-oauth2-library</a>.</p>

<p>We plan to keep the client libraries up to date with <a href="https://github.com/dart-gde/discovery_api_dart_client_generator/blob/master/tool/update.dart">uploader.dart</a> script. Still somewhat a manual process, future automation could happen when/if we have the ability to get notified about google api changes. For now we will push updates when appropriate. This will ensure that we can push the latest versions of the apis to pub and still have previous revisions available. Some of the more intricate parts of this script include auto version incrementing pubspec files and syncing to github, then pushing to pub.</p>

<p>Would you want to contribute to this project? Please feel free to ping us <a href="https://profiles.google.com/financeCoding">Adam Singer</a>/<a href="https://profiles.google.com/scarygami">Gerwin Sturm</a> on <a href="https://plus.google.com">g+</a>, we&#8217;re definitely looking to refactor some parts and test others. Our main focus for this release was to get something out the door that is pleasantly usable.</p>

<p>Many hours of testing and development was done to have a simple and easy way to use the google client apis in dart! We hope you enjoy and look forward to seeing what you build.
To get started with client api examples check out <a href="https://github.com/dart-gde/dart_api_client_examples">dart_api_client_examples</a>. The <a href="http://www.github.com">github</a> hosted source code can be found at <a href="https://github.com/dart-google-apis">dart-google-apis</a></p>

<h3>Full list of available Google client apis on <a href="http://pub.dartlang.org">pub.dartlang.org</a></h3>

<ul>
<li><a href="http://pub.dartlang.org/packages/google_adexchangebuyer_v1_api">google_adexchangebuyer_v1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_adexchangebuyer_v1_1_api">google_adexchangebuyer_v1_1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_adexchangeseller_v1_api">google_adexchangeseller_v1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_adsense_v1_api">google_adsense_v1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_adsense_v1_1_api">google_adsense_v1_1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_adsense_v1_2_api">google_adsense_v1_2_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_adsensehost_v4_1_api">google_adsensehost_v4_1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_analytics_v2_4_api">google_analytics_v2_4_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_analytics_v3_api">google_analytics_v3_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_androidpublisher_v1_api">google_androidpublisher_v1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_audit_v1_api">google_audit_v1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_bigquery_v2_api">google_bigquery_v2_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_blogger_v2_api">google_blogger_v2_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_blogger_v3_api">google_blogger_v3_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_books_v1_api">google_books_v1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_calendar_v3_api">google_calendar_v3_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_civicinfo_us_v1_api">google_civicinfo_us_v1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_compute_v1beta12_api">google_compute_v1beta12_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_compute_v1beta13_api">google_compute_v1beta13_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_compute_v1beta14_api">google_compute_v1beta14_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_coordinate_v1_api">google_coordinate_v1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_customsearch_v1_api">google_customsearch_v1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_dfareporting_v1_api">google_dfareporting_v1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_dfareporting_v1_1_api">google_dfareporting_v1_1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_discovery_v1_api">google_discovery_v1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_drive_v1_api">google_drive_v1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_drive_v2_api">google_drive_v2_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_freebase_v1sandbox_api">google_freebase_v1sandbox_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_freebase_v1_api">google_freebase_v1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_fusiontables_v1_api">google_fusiontables_v1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_gan_v1beta1_api">google_gan_v1beta1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_groupsmigration_v1_api">google_groupsmigration_v1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_groupssettings_v1_api">google_groupssettings_v1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_latitude_v1_api">google_latitude_v1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_licensing_v1_api">google_licensing_v1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_oauth2_v1_api">google_oauth2_v1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_oauth2_v2_api">google_oauth2_v2_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_orkut_v2_api">google_orkut_v2_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_pagespeedonline_v1_api">google_pagespeedonline_v1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_plus_v1moments_api">google_plus_v1moments_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_plus_v1_api">google_plus_v1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_prediction_v1_2_api">google_prediction_v1_2_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_prediction_v1_3_api">google_prediction_v1_3_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_prediction_v1_4_api">google_prediction_v1_4_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_prediction_v1_5_api">google_prediction_v1_5_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_reseller_v1sandbox_api">google_reseller_v1sandbox_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_reseller_v1_api">google_reseller_v1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_shopping_v1_api">google_shopping_v1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_siteverification_v1_api">google_siteverification_v1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_storage_v1beta1_api">google_storage_v1beta1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_taskqueue_v1beta1_api">google_taskqueue_v1beta1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_taskqueue_v1beta2_api">google_taskqueue_v1beta2_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_tasks_v1_api">google_tasks_v1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_translate_v2_api">google_translate_v2_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_urlshortener_v1_api">google_urlshortener_v1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_webfonts_v1_api">google_webfonts_v1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_youtube_v3_api">google_youtube_v3_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_youtubeanalytics_v1_api">google_youtubeanalytics_v1_api</a></li>
<li><a href="http://pub.dartlang.org/packages/google_youtubeanalytics_v1beta1_api">google_youtubeanalytics_v1beta1_api</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/02/07/using-createdartanalyzertask-in-bot-dot-dart-to-ensure-sanity/">Using createDartAnalyzerTask in bot.dart to Ensure Sanity</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-02-07T19:47:00-08:00" pubdate data-updated="true">Feb 7<span>th</span>, 2013</time>
        
         | <a href="/blog/2013/02/07/using-createdartanalyzertask-in-bot-dot-dart-to-ensure-sanity/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://drone.io">drone.io</a> has really proven to be useful for <a href="http://www.dartlang.org">dart</a> projects. One common pattern I find my self doing with projects these days is running the <code>dart_analyzer</code> before running unit tests. Had a <a href="https://github.com/kevmoo/bot.dart/issues/36">discussion</a> with <a href="https://github.com/kevmoo">Kevin Moore</a> about having a <code>dart_analyzer</code> task included in <code>hop</code>, part of the <a href="https://github.com/kevmoo/bot.dart">bot.dart</a> framework. We both agreed it would be nice to automate that task and not have shell scripts running the show. Thus <a href="http://kevmoo.github.com/bot.dart/hop_tasks.html#createDartAnalyzerTask"><code>createDartAnalyzerTask</code></a> was born. <code>createDartAnalyzerTask</code> allows you to add dart scripts that are libraries or main entry points to be analyzed by <code>dart_analyzer</code>, this allows for a first step of safety, so that code you have passes the static checker. It does not mean your code is perfect but can help you find warnings and errors. A great combination for this is pairing it up with <a href="http://drone.io">drone.io</a>, that way when a new sdk comes out drone can let you know automatically if it passes static checker.</p>

<p><em>Lets see this in action</em></p>

<p>First step is to add bot to your <code>pubspec.yaml</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">dependencies</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="l-Scalar-Plain">browser</span><span class="p-Indicator">:</span> <span class="s">&quot;&gt;=0.3.4&quot;</span>
</span><span class='line'>  <span class="l-Scalar-Plain">unittest</span><span class="p-Indicator">:</span> <span class="s">&quot;&gt;=0.3.4&quot;</span>
</span><span class='line'>  <span class="l-Scalar-Plain">bot</span><span class="p-Indicator">:</span> <span class="s">&quot;&gt;=0.12.0&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Create a minimal <code>tool/hop_runner.dart</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'><span class="n">library</span> <span class="n">hop_runner</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">import</span> <span class="s1">&#39;dart:async&#39;</span><span class="p">;</span>
</span><span class='line'><span class="n">import</span> <span class="s1">&#39;dart:io&#39;</span><span class="p">;</span>
</span><span class='line'><span class="n">import</span> <span class="s1">&#39;package:bot/bot.dart&#39;</span><span class="p">;</span>
</span><span class='line'><span class="n">import</span> <span class="s1">&#39;package:bot/hop.dart&#39;</span><span class="p">;</span>
</span><span class='line'><span class="n">import</span> <span class="s1">&#39;package:bot/hop_tasks.dart&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">//</span>
</span><span class='line'>  <span class="c1">// Analyzer</span>
</span><span class='line'>  <span class="c1">//</span>
</span><span class='line'>  <span class="n">addTask</span><span class="p">(</span><span class="s1">&#39;analyze_lib&#39;</span><span class="p">,</span> <span class="n">createDartAnalyzerTask</span><span class="p">([</span><span class="s1">&#39;lib/stats.dart&#39;</span><span class="p">]));</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">//</span>
</span><span class='line'>  <span class="c1">// Hop away!</span>
</span><span class='line'>  <span class="c1">//</span>
</span><span class='line'>  <span class="n">runHopCore</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Add a <code>bin/hop</code> script to your project, <code>bin/hop</code> script is not required but does help manage some flags you might be interested in having.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/bin/bash</span>
</span><span class='line'><span class="nv">PACK_DIR</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>/packages/
</span><span class='line'><span class="nv">cmd</span><span class="o">=</span><span class="s2">&quot;dart</span>
</span><span class='line'><span class="s2">--enable_asserts</span>
</span><span class='line'><span class="s2">--enable_checked_mode</span>
</span><span class='line'><span class="s2">--enable_type_checks</span>
</span><span class='line'><span class="s2">--error_on_malformed_type</span>
</span><span class='line'><span class="s2">--package-root=$PACK_DIR</span>
</span><span class='line'><span class="s2">--verbose_debug</span>
</span><span class='line'><span class="s2">--warning_as_error</span>
</span><span class='line'><span class="s2">./tool/hop_runner.dart $@&quot;</span>
</span><span class='line'><span class="nb">exec</span> <span class="nv">$cmd</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now <code>hop</code> away!</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>19:41:54-adam@Adams-MacBook-Air:~/dart/stats.dart
</span><span class='line'><span class="nv">$ </span>hop analyze_lib
</span><span class='line'>analyze_lib: PASSED - lib/stats.dart
</span><span class='line'>analyze_lib: PASSED: 1, WARNING: 0, ERROR: 0
</span><span class='line'>Finished
</span></code></pre></td></tr></table></div></figure>


<p>Now lets say we have the following warning of <code>String i = 42;</code>, bot can provide us a summary of warnings we might have in our code.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'><span class="n">library</span> <span class="n">not_cool_lib</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="kt">String</span> <span class="n">i</span> <span class="o">=</span> <span class="m">42</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Adding the library to our task</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'>  <span class="c1">//</span>
</span><span class='line'>  <span class="c1">// Analyzer</span>
</span><span class='line'>  <span class="c1">//</span>
</span><span class='line'>  <span class="n">addTask</span><span class="p">(</span><span class="s1">&#39;analyze_lib&#39;</span><span class="p">,</span> <span class="n">createDartAnalyzerTask</span><span class="p">([</span><span class="s1">&#39;lib/stats.dart&#39;</span><span class="p">,</span> <span class="s1">&#39;lib/notcoollib.dart&#39;</span><span class="p">]));</span>
</span></code></pre></td></tr></table></div></figure>


<p>Executing <code>hop</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'><span class="m">20</span><span class="o">:</span><span class="m">04</span><span class="o">:</span><span class="m">55</span><span class="o">-</span><span class="n">adam</span><span class="err">@</span><span class="n">Adams</span><span class="o">-</span><span class="n">MacBook</span><span class="o">-</span><span class="nl">Air:</span><span class="o">~/</span><span class="n">dart</span><span class="o">/</span><span class="n">stats</span><span class="p">.</span><span class="n">dart</span>
</span><span class='line'><span class="n">$</span> <span class="n">hop</span> <span class="n">analyze_lib</span>
</span><span class='line'><span class="nl">analyze_lib:</span> <span class="n">PASSED</span> <span class="o">-</span> <span class="n">lib</span><span class="o">/</span><span class="n">stats</span><span class="p">.</span><span class="n">dart</span>
</span><span class='line'><span class="nl">analyze_lib:</span> <span class="n">WARNING</span> <span class="o">-</span> <span class="n">lib</span><span class="o">/</span><span class="n">notcoollib</span><span class="p">.</span><span class="n">dart</span>
</span><span class='line'><span class="nl">analyze_lib:</span> <span class="nl">PASSED:</span> <span class="m">1</span><span class="p">,</span> <span class="nl">WARNING:</span> <span class="m">1</span><span class="p">,</span> <span class="nl">ERROR:</span> <span class="m">0</span>
</span><span class='line'><span class="n">Finished</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now we have a warning, but since dart is a dynamic langauge we should not treat that as an error <em>(at some point we might provide the option of making warnings fail <a href="http://drone.io">drone.io</a>)</em>.</p>

<p>If we introduce a real error, the task runner should yell at us.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'><span class="n">library</span> <span class="n">not_cool_lib</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="kt">String</span> <span class="n">i</span> <span class="o">=</span> <span class="m">42</span><span class="p">;</span>
</span><span class='line'>  <span class="n">bam</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>And it does!</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'><span class="m">20</span><span class="o">:</span><span class="m">11</span><span class="o">:</span><span class="m">38</span><span class="o">-</span><span class="n">adam</span><span class="err">@</span><span class="n">Adams</span><span class="o">-</span><span class="n">MacBook</span><span class="o">-</span><span class="nl">Air:</span><span class="o">~/</span><span class="n">dart</span><span class="o">/</span><span class="n">stats</span><span class="p">.</span><span class="n">dart</span>
</span><span class='line'><span class="n">$</span> <span class="n">hop</span> <span class="n">analyze_lib</span>
</span><span class='line'><span class="nl">analyze_lib:</span> <span class="n">PASSED</span> <span class="o">-</span> <span class="n">lib</span><span class="o">/</span><span class="n">stats</span><span class="p">.</span><span class="n">dart</span>
</span><span class='line'><span class="nl">analyze_lib:</span> <span class="n">ERROR</span> <span class="o">-</span> <span class="n">lib</span><span class="o">/</span><span class="n">notcoollib</span><span class="p">.</span><span class="n">dart</span>
</span><span class='line'><span class="nl">analyze_lib:</span> <span class="nl">PASSED:</span> <span class="m">1</span><span class="p">,</span> <span class="nl">WARNING:</span> <span class="m">0</span><span class="p">,</span> <span class="nl">ERROR:</span> <span class="m">1</span>
</span><span class='line'><span class="nl">analyze_lib:</span> <span class="n">Failed</span>
</span><span class='line'><span class="n">Failed</span>
</span><span class='line'><span class="m">20</span><span class="o">:</span><span class="m">18</span><span class="o">:</span><span class="m">11</span><span class="o">-</span><span class="n">adam</span><span class="err">@</span><span class="n">Adams</span><span class="o">-</span><span class="n">MacBook</span><span class="o">-</span><span class="nl">Air:</span><span class="o">~/</span><span class="n">dart</span><span class="o">/</span><span class="n">stats</span><span class="p">.</span><span class="n">dart</span>
</span><span class='line'><span class="n">$</span> <span class="n">echo</span> <span class="n">$</span><span class="o">?</span>
</span><span class='line'><span class="m">80</span>
</span></code></pre></td></tr></table></div></figure>


<p>The exit code will let <a href="http://drone.io">drone.io</a> know that we did not exit cleanly. I love <a href="http://drone.io">drone.io</a> for this reason, it&#8217;s simple to get setup right away with little fuss.</p>

<p>A complete run on <a href="http://drone.io">drone.io</a> might look something as follows</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='dart'><span class='line'><span class="n">$</span> <span class="n">git</span> <span class="n">clone</span> <span class="nl">git:</span><span class="c1">//github.com/Dartist/stats.dart.git /home/ubuntu/src/github.com/Dartist/stats.dart </span>
</span><span class='line'><span class="n">Cloning</span> <span class="kt">int</span><span class="n">o</span> <span class="s1">&#39;/home/ubuntu/src/github.com/Dartist/stats.dart&#39;</span><span class="p">...</span>
</span><span class='line'><span class="n">$</span> <span class="n">dart</span> <span class="o">--</span><span class="n">version</span>
</span><span class='line'><span class="n">Dart</span> <span class="n">VM</span> <span class="nl">version:</span> <span class="m">0.3</span><span class="p">.</span><span class="m">4.0</span><span class="n">_r18115</span> <span class="p">(</span><span class="n">Tue</span> <span class="n">Feb</span>  <span class="m">5</span> <span class="m">05</span><span class="o">:</span><span class="m">53</span><span class="o">:</span><span class="m">42</span> <span class="m">2013</span><span class="p">)</span>
</span><span class='line'><span class="n">$</span> <span class="n">cat</span> <span class="n">$DART_SDK</span><span class="o">/</span><span class="n">revision</span>
</span><span class='line'><span class="m">18137</span>
</span><span class='line'><span class="n">$</span> <span class="n">sudo</span> <span class="n">start</span> <span class="n">xvfb</span>
</span><span class='line'><span class="n">xvfb</span> <span class="n">start</span><span class="o">/</span><span class="n">running</span><span class="p">,</span> <span class="n">process</span> <span class="m">1017</span>
</span><span class='line'><span class="n">$</span> <span class="n">pub</span> <span class="n">install</span>
</span><span class='line'><span class="n">Resolving</span> <span class="n">dependencies</span><span class="p">...</span>
</span><span class='line'><span class="n">Downloading</span> <span class="n">browser</span> <span class="m">0.3</span><span class="p">.</span><span class="m">4.</span><span class="p">..</span>
</span><span class='line'><span class="n">Downloading</span> <span class="n">bot</span> <span class="m">0.12</span><span class="p">.</span><span class="m">1.</span><span class="p">..</span>
</span><span class='line'><span class="n">Downloading</span> <span class="n">unittest</span> <span class="m">0.3</span><span class="p">.</span><span class="m">4.</span><span class="p">..</span>
</span><span class='line'><span class="n">Downloading</span> <span class="n">logging</span> <span class="m">0.3</span><span class="p">.</span><span class="m">4.</span><span class="p">..</span>
</span><span class='line'><span class="n">Downloading</span> <span class="n">args</span> <span class="m">0.3</span><span class="p">.</span><span class="m">4.</span><span class="p">..</span>
</span><span class='line'><span class="n">Downloading</span> <span class="n">meta</span> <span class="m">0.3</span><span class="p">.</span><span class="m">4.</span><span class="p">..</span>
</span><span class='line'><span class="n">Dependencies</span> <span class="n">installed</span><span class="o">!</span>
</span><span class='line'><span class="n">$</span> <span class="n">export</span> <span class="n">PATH</span><span class="o">=</span><span class="p">.</span><span class="o">/</span><span class="nl">bin:</span><span class="n">$PATH</span>
</span><span class='line'><span class="n">$</span> <span class="n">hop</span> <span class="n">analyze_lib</span>
</span><span class='line'><span class="nl">analyze_lib:</span> <span class="n">PASSED</span> <span class="o">-</span> <span class="n">lib</span><span class="o">/</span><span class="n">stats</span><span class="p">.</span><span class="n">dart</span>
</span><span class='line'><span class="nl">analyze_lib:</span> <span class="nl">PASSED:</span> <span class="m">1</span><span class="p">,</span> <span class="nl">WARNING:</span> <span class="m">0</span><span class="p">,</span> <span class="nl">ERROR:</span> <span class="m">0</span>
</span><span class='line'><span class="n">Finished</span>
</span><span class='line'><span class="n">$</span> <span class="n">hop</span> <span class="n">headless_test</span>
</span><span class='line'><span class="n">unittest</span><span class="o">-</span><span class="n">suite</span><span class="o">-</span><span class="n">wait</span><span class="o">-</span><span class="k">for</span><span class="o">-</span><span class="n">done</span>
</span><span class='line'><span class="nl">headless_test:</span> <span class="n">DumpRenderTree</span> <span class="o">-</span> <span class="n">test</span><span class="o">/</span><span class="n">tests_browser</span><span class="p">.</span><span class="n">html</span>
</span><span class='line'><span class="nl">headless_test:</span> <span class="m">1</span> <span class="n">PASSED</span><span class="p">,</span> <span class="m">0</span> <span class="n">FAILED</span><span class="p">,</span> <span class="m">0</span> <span class="n">ERRORS</span>
</span><span class='line'><span class="n">Finished</span>
</span></code></pre></td></tr></table></div></figure>


<p>For a full example of a project that uses <a href="https://github.com/kevmoo/bot.dart">bot.dart</a> for testing and analyzer please refer to <a href="https://github.com/Dartist/stats.dart">stats.dart</a></p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/2/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    
<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/104569492481999771226?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>


<section>
  <h1>Tag Cloud</h1>
    <span id="tag-cloud"><a href='/blog/categories/-net' style='font-size: 103.39622641509433%'>.NET(3)</a> <a href='/blog/categories/activemq' style='font-size: 101.13207547169812%'>ActiveMQ(1)</a> <a href='/blog/categories/adk' style='font-size: 101.13207547169812%'>adk(1)</a> <a href='/blog/categories/adk2012' style='font-size: 101.13207547169812%'>adk2012(1)</a> <a href='/blog/categories/apache' style='font-size: 101.13207547169812%'>Apache(1)</a> <a href='/blog/categories/apache-nms' style='font-size: 101.13207547169812%'>Apache.Nms(1)</a> <a href='/blog/categories/api' style='font-size: 104.52830188679245%'>API(4)</a> <a href='/blog/categories/arm' style='font-size: 101.13207547169812%'>ARM(1)</a> <a href='/blog/categories/armv7' style='font-size: 101.13207547169812%'>ARMv7(1)</a> <a href='/blog/categories/beagleboard' style='font-size: 102.26415094339623%'>BeagleBoard(2)</a> <a href='/blog/categories/beagleboneblack' style='font-size: 101.13207547169812%'>BeagleBoneBlack(1)</a> <a href='/blog/categories/beagletouch' style='font-size: 102.26415094339623%'>BeagleTouch(2)</a> <a href='/blog/categories/blackjack' style='font-size: 101.13207547169812%'>Blackjack(1)</a> <a href='/blog/categories/bot-dart' style='font-size: 101.13207547169812%'>bot.dart(1)</a> <a href='/blog/categories/brainteaser' style='font-size: 101.13207547169812%'>Brainteaser(1)</a> <a href='/blog/categories/c-' style='font-size: 101.13207547169812%'>C#(1)</a> <a href='/blog/categories/canvas' style='font-size: 104.52830188679245%'>Canvas(4)</a> <a href='/blog/categories/canvas2d' style='font-size: 102.26415094339623%'>Canvas2d(2)</a> <a href='/blog/categories/card-counting' style='font-size: 101.13207547169812%'>Card Counting(1)</a> <a href='/blog/categories/chrome-' style='font-size: 101.13207547169812%'>chrome.*(1)</a> <a href='/blog/categories/chrome-dart' style='font-size: 102.26415094339623%'>chrome.dart(2)</a> <a href='/blog/categories/chromeapp' style='font-size: 103.39622641509433%'>ChromeApp(3)</a> <a href='/blog/categories/chromeos' style='font-size: 101.13207547169812%'>ChromeOS(1)</a> <a href='/blog/categories/client' style='font-size: 102.26415094339623%'>Client(2)</a> <a href='/blog/categories/cloud' style='font-size: 102.26415094339623%'>Cloud(2)</a> <a href='/blog/categories/cloudfoundry' style='font-size: 102.26415094339623%'>Cloudfoundry(2)</a> <a href='/blog/categories/computeengine' style='font-size: 101.13207547169812%'>ComputeEngine(1)</a> <a href='/blog/categories/cordova' style='font-size: 104.52830188679245%'>Cordova(4)</a> <a href='/blog/categories/couchdb' style='font-size: 101.13207547169812%'>CouchDB(1)</a> <a href='/blog/categories/dart' style='font-size: 160.0%'>Dart(53)</a> <a href='/blog/categories/dart-native-access' style='font-size: 102.26415094339623%'>Dart Native Access(2)</a> <a href='/blog/categories/dartanalyzer' style='font-size: 101.13207547169812%'>DartAnalyzer(1)</a> <a href='/blog/categories/darteditor' style='font-size: 103.39622641509433%'>DartEditor(3)</a> <a href='/blog/categories/dartiu' style='font-size: 101.13207547169812%'>Dartiu(1)</a> <a href='/blog/categories/dartium' style='font-size: 102.26415094339623%'>Dartium(2)</a> <a href='/blog/categories/dartvm' style='font-size: 103.39622641509433%'>DartVM(3)</a> <a href='/blog/categories/datastore' style='font-size: 101.13207547169812%'>datastore(1)</a> <a href='/blog/categories/debian' style='font-size: 101.13207547169812%'>Debian(1)</a> <a href='/blog/categories/debugging' style='font-size: 101.13207547169812%'>Debugging(1)</a> <a href='/blog/categories/drive' style='font-size: 104.52830188679245%'>Drive(4)</a> <a href='/blog/categories/drone-io' style='font-size: 101.13207547169812%'>Drone.io(1)</a> <a href='/blog/categories/embedded' style='font-size: 104.52830188679245%'>embedded(4)</a> <a href='/blog/categories/embedded' style='font-size: 101.13207547169812%'>Embedded(1)</a> <a href='/blog/categories/example' style='font-size: 113.58490566037736%'>Example(12)</a> <a href='/blog/categories/finance' style='font-size: 101.13207547169812%'>Finance(1)</a> <a href='/blog/categories/fractal' style='font-size: 101.13207547169812%'>Fractal(1)</a> <a href='/blog/categories/fullstack' style='font-size: 101.13207547169812%'>FullStack(1)</a> <a href='/blog/categories/gambling' style='font-size: 101.13207547169812%'>Gambling(1)</a> <a href='/blog/categories/game-of-life' style='font-size: 101.13207547169812%'>Game Of Life(1)</a> <a href='/blog/categories/gce' style='font-size: 101.13207547169812%'>GCE(1)</a> <a href='/blog/categories/google' style='font-size: 128.30188679245282%'>Google(25)</a> <a href='/blog/categories/google-apps-api' style='font-size: 101.13207547169812%'>Google Apps API(1)</a> <a href='/blog/categories/google-ext-api' style='font-size: 101.13207547169812%'>Google Ext API(1)</a> <a href='/blog/categories/googleapi' style='font-size: 102.26415094339623%'>googleapi(2)</a> <a href='/blog/categories/googleapi' style='font-size: 101.13207547169812%'>GoogleApi(1)</a> <a href='/blog/categories/googleapi' style='font-size: 102.26415094339623%'>GoogleAPI(2)</a> <a href='/blog/categories/gplus' style='font-size: 101.13207547169812%'>gplus(1)</a> <a href='/blog/categories/hardware' style='font-size: 105.66037735849056%'>Hardware(5)</a> <a href='/blog/categories/hash' style='font-size: 101.13207547169812%'>Hash(1)</a> <a href='/blog/categories/helloworld' style='font-size: 101.13207547169812%'>HelloWorld(1)</a> <a href='/blog/categories/heroku' style='font-size: 101.13207547169812%'>Heroku(1)</a> <a href='/blog/categories/high-low' style='font-size: 101.13207547169812%'>High-Low(1)</a> <a href='/blog/categories/html5' style='font-size: 102.26415094339623%'>HTML5(2)</a> <a href='/blog/categories/js-interop' style='font-size: 103.39622641509433%'>js-interop(3)</a> <a href='/blog/categories/kernel' style='font-size: 102.26415094339623%'>Kernel(2)</a> <a href='/blog/categories/linux' style='font-size: 105.66037735849056%'>Linux(5)</a> <a href='/blog/categories/macosx' style='font-size: 101.13207547169812%'>MacOSX(1)</a> <a href='/blog/categories/markdown' style='font-size: 101.13207547169812%'>Markdown(1)</a> <a href='/blog/categories/math' style='font-size: 102.26415094339623%'>Math(2)</a> <a href='/blog/categories/mongo' style='font-size: 101.13207547169812%'>Mongo(1)</a> <a href='/blog/categories/mongodb' style='font-size: 101.13207547169812%'>Mongodb(1)</a> <a href='/blog/categories/mvvm' style='font-size: 101.13207547169812%'>MVVM(1)</a> <a href='/blog/categories/netduino' style='font-size: 102.26415094339623%'>netduino(2)</a> <a href='/blog/categories/objectory' style='font-size: 101.13207547169812%'>objectory(1)</a> <a href='/blog/categories/phonegap' style='font-size: 104.52830188679245%'>Phonegap(4)</a> <a href='/blog/categories/phonegap-from-scratch' style='font-size: 104.52830188679245%'>phonegap-from-scratch(4)</a> <a href='/blog/categories/pub' style='font-size: 102.26415094339623%'>Pub(2)</a> <a href='/blog/categories/rabbitmq' style='font-size: 101.13207547169812%'>rabbitmq(1)</a> <a href='/blog/categories/realtime' style='font-size: 101.13207547169812%'>Realtime(1)</a> <a href='/blog/categories/rikulo' style='font-size: 102.26415094339623%'>Rikulo(2)</a> <a href='/blog/categories/snapshots' style='font-size: 101.13207547169812%'>snapshots(1)</a> <a href='/blog/categories/software' style='font-size: 128.30188679245282%'>Software(25)</a> <a href='/blog/categories/spring' style='font-size: 102.26415094339623%'>Spring(2)</a> <a href='/blog/categories/springframework-net' style='font-size: 101.13207547169812%'>Springframework.net(1)</a> <a href='/blog/categories/springsource' style='font-size: 101.13207547169812%'>SpringSource(1)</a> <a href='/blog/categories/stocks' style='font-size: 101.13207547169812%'>Stocks(1)</a> <a href='/blog/categories/stream' style='font-size: 102.26415094339623%'>Stream(2)</a> <a href='/blog/categories/template' style='font-size: 101.13207547169812%'>Template(1)</a> <a href='/blog/categories/testing' style='font-size: 101.13207547169812%'>Testing(1)</a> <a href='/blog/categories/ti-devkit' style='font-size: 102.26415094339623%'>TI DevKit(2)</a> <a href='/blog/categories/touchscreen' style='font-size: 102.26415094339623%'>TouchScreen(2)</a> <a href='/blog/categories/unittest' style='font-size: 103.39622641509433%'>unittest(3)</a> <a href='/blog/categories/urlshortener' style='font-size: 101.13207547169812%'>UrlShortener(1)</a> <a href='/blog/categories/vcap' style='font-size: 101.13207547169812%'>vcap(1)</a> <a href='/blog/categories/vmware' style='font-size: 102.26415094339623%'>vmware(2)</a> <a href='/blog/categories/web-ui' style='font-size: 101.13207547169812%'>web-ui(1)</a> <a href='/blog/categories/webcomponents' style='font-size: 101.13207547169812%'>WebComponents(1)</a> <a href='/blog/categories/webgl' style='font-size: 101.13207547169812%'>WebGL(1)</a> </span>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/03/28/getting-started-with-google-cloud-datastore-and-dart/">Getting started with Google Cloud Datastore and Dart</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/01/14/chrome-dot-dart-0-dot-4-0-release/">chrome.dart 0.4.0 release</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/11/29/build-and-deploy-dart-to-beaglebone-black/">Build and deploy dart to Beaglebone Black</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/10/22/google-client-apis-new-release-0-dot-4-x/">google client apis new release 0.4.x</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/09/30/getting-started-with-dart-on-compute-engine/">Getting Started with Dart on Compute Engine</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/financeCoding">@financeCoding</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'financeCoding',
            count: 3,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>




  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Adam Singer -
  <a href='https://plus.google.com/u/0/104569492481999771226/posts' rel='me'>Adam Singer</a>
  - <a href='https://github.com/financeCoding' rel='me'>Adam Singer @ Github</a>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'financecoding';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
